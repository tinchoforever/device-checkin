/*1365165748,178130529*/

if (self.CavalryLogger) { CavalryLogger.start_js(["jLywu"]); }

__d("ReactButton",["ReactDOM","React","ReactUtils"],function(a,b,c,d,e,f){var g=b('ReactDOM'),h=b('React'),i=b('ReactUtils'),j={forward:true},k={special:true,confirm:true},l=i.keyMirror({addConnection:true,addToProfile:true,allowAccess:true,back:true,block:true,bookmark:true,check:true,connect:true,create:true,download:true,edit:true,feature:true,forward:true,friendLists:true,like:true,message:true,placePin:true,poke:true,privacy:true,remove:true,search:true,settings:true,share:true,subscribe:true,signal:true,tag:true,takePhoto:true,trashCan:true,unfollow:true,videoCall:true,voteDown:true,voteUp:true}),m=i.keyMirror({special:true,confirm:true,dfault:true,overlay:true}),n=i.keyMirror({medium:true,large:true}),o=i.objMapKeyVal(l,function(q,r){var s={};s.ButtonImg=true;s[q]=true;return s;}),p=h.createClass({displayName:'Button',render:function(){var q=j[this.props.icon],r=!q,s=null;if(this.props.icon){var t=[{mls:q,mrs:r,selected:k[this.props.use]},o[this.props.icon]];s=g.i({classSet:t});}var u={uiButton:true,uiButtonOverlay:this.props.use===m.overlay,uiButtonConfirm:this.props.use===m.confirm,uiButtonSpecial:this.props.use===m.special,uiButtonDisabled:this.props.disabled,uiButtonLarge:this.props.size===n.large,uiButtonDepressed:this.props.depressed,uiButtonSuppressed:this.props.suppressed,uiButtonNoText:!this.props.label},v=g.input({value:this.props.label,type:this.props.type||'submit',style:this.props.style,classSet:{enter_submit_target:this.props.submitOnEnter}}),w=g.label({classSet:[u,this.props.classSet]},[r?s:null,v,q?s:null]);v.props=i.merge(this.props,v.props);return w;}});p.ICONS=l;p.USES=m;p.SIZES=n;e.exports=p;});
__d("ReactLayer",["ReactDOM","ReactCurrentOwner","ReactEvent","ReactMount","getObjectValues","emptyFunction","merge","mixInto","throwIf"],function(a,b,c,d,e,f){var g=b('ReactDOM'),h=b('ReactCurrentOwner'),i=b('ReactEvent'),j=b('ReactMount'),k=b('getObjectValues'),l=b('emptyFunction'),m=b('merge'),n=b('mixInto'),o=b('throwIf'),p={construct:function(r,s){this.props=r||{};if(typeof s!=='undefined')this.props.children=s;this.props.owner=h.current;},immutableProps:{},getDefaultEnabledBehaviors:function(){return {};},createLayer:null,receiveProps:null,mountLayer:function(){this.container=document.createElement('div');this._rootDomId=j.registerContainer(this.container);this.reactContent=this.wrapReactContent(this.props.children);this.reactContent.mountInContainerNode(this._rootDomId,this.container);this.layer=this.createLayer(this.container);o(!this.layer,'`createLayer` did not return a layer.');this.layerSubscriptions=[];this.layerSubscribe(['show','hide'],function(r){this.props.onToggle&&this.props.onToggle(r==='show');}.bind(this));},setProps:function(r){this.replaceProps(m(this.props,r));},replaceProps:function(r){var s;for(s in this.immutableProps)o(this.props[s]!==r[s],'`'+s+'` is not mutable.');var t=this.reactContent,u=this.wrapReactContent(r.children);t.replaceProps(u.props);this.receiveProps(r);this.props=r;},enumerateBehaviors:function(r){r=this.getEffectiveBehaviors(r);return k(r).filter(l.thatReturnsArgument);},updateBehaviors:function(r){var s=this.getEffectiveBehaviors(this.props.behaviors),t=this.getEffectiveBehaviors(r),u;for(u in s)if(!t[u])this.layer.disableBehavior(s[u]);for(u in t){var v=s[u],w=t[u];if(v&&w){o(v!==w,'Do not reuse keys for different behaviors: '+u);continue;}v&&this.layer.disableBehavior(v);w&&this.layer.enableBehavior(w);}},getEffectiveBehaviors:function(r){return m(this.getDefaultEnabledBehaviors(),r);},unmountLayer:function(){this.reactContent.unmountComponent();this.layer.destroy();delete this.reactContent;delete this.layer;this.container.innerHTML='';while(this.layerSubscriptions.length)this.layerSubscriptions.pop().unsubscribe();var r=this.props;if(r.ref!=null&&r.owner.refs[r.ref]===this)r.owner.detachRef(r.ref);},layerSubscribe:function(r,s){this.layerSubscriptions.push(this.layer.subscribe(r,function(t,u){i.isEnabled()&&s(t,u);}));},getNodeForOwnerRef:function(r){return this.props.owner.refs[r].getDOMNode();},wrapReactContent:function(r){return g.div(null,r);}},q={createClass:function(r){var s=function(u,v){this.construct(u,v);};n(s,p);n(s,r);var t=function(u,v){var w=u||this;return new s(w,v);};t.componentConstructor=s;t.originalSpec=r;return t;}};e.exports=q;});
__d("ReactContextualDialog",["ContextualDialog","ContextualDialogArrow","ReactLayer"],function(a,b,c,d,e,f){var g=b('ContextualDialog'),h=b('ContextualDialogArrow'),i=b('ReactLayer'),j=i.createClass({immutableProps:{modal:null},createLayer:function(k){var l=this.getNodeForOwnerRef(this.props.contextRef),m={context:l,position:this.props.position,alignment:this.props.alignment,offsetX:this.props.offsetX,offsetY:this.props.offsetY,arrowBehavior:h,addedBehaviors:this.enumerateBehaviors(this.props.behaviors)},n=new g(m,k);n.conditionShow(this.props.shown);return n;},receiveProps:function(k){this.updateBehaviors(k.behaviors);this.layer.setContext(this.getNodeForOwnerRef(this.props.contextRef));this.layer.setPosition(k.position);this.layer.setAlignment(k.alignment);this.layer.setOffsetX(k.offsetX);this.layer.setOffsetY(k.offsetY);this.layer.conditionShow(k.shown);}});e.exports=j;});
__d("DOMWrapper",[],function(a,b,c,d,e,f){var g,h,i={setRoot:function(j){g=j;},getRoot:function(){return g||document.body;},setWindow:function(j){h=j;},getWindow:function(){return h||self;}};e.exports=i;});
__d("Flash",["DOMWrapper","QueryString","UserAgent","copyProperties","guid"],function(a,b,c,d,e,f){var g=b('DOMWrapper'),h=b('QueryString'),i=b('UserAgent'),j=b('copyProperties'),k=b('guid'),l={},m,n=g.getWindow().document;function o(t){var u=n.getElementById(t);if(u)u.parentNode.removeChild(u);delete l[t];}function p(){for(var t in l)if(l.hasOwnProperty(t))o(t);}function q(t){return t.replace(/\d+/g,function(u){return '000'.substring(u.length)+u;});}function r(t){if(!m){if(i.ie()>=9)window.attachEvent('onunload',p);m=true;}l[t]=t;}var s={embed:function(t,u,v,w){var x=k();t=encodeURI(t);v=j({allowscriptaccess:'always',flashvars:w,movie:t},v||{});if(typeof v.flashvars=='object')v.flashvars=h.encode(v.flashvars);var y=[];for(var z in v)if(v.hasOwnProperty(z)&&v[z])y.push('<param name="'+encodeURI(z)+'" value="'+encodeURI(v[z])+'">');var aa=n.createElement('div'),ba='<object '+(i.ie()?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ':'type="application/x-shockwave-flash"')+'data="'+t+'" '+'id="'+x+'">'+y.join('')+'</object>';aa.innerHTML=ba;var ca=u.appendChild(aa.firstChild);r(x);return ca;},remove:o,getVersion:function(){var t='Shockwave Flash',u='application/x-shockwave-flash',v='ShockwaveFlash.ShockwaveFlash',w;if(navigator.plugins&&typeof navigator.plugins[t]=='object'){var x=navigator.plugins[t].description;if(x&&navigator.mimeTypes&&navigator.mimeTypes[u]&&navigator.mimeTypes[u].enabledPlugin)w=x.match(/\d+/g);}if(!w)try{w=(new ActiveXObject(v)).GetVariable('$version').match(/(\d+),(\d+),(\d+),(\d+)/);w=Array.prototype.slice.call(w,1);}catch(y){}return w;},checkMinVersion:function(t){var u=s.getVersion();if(!u)return false;return q(u.join('.'))>=q(t);},isAvailable:function(){return !!s.getVersion();}};e.exports=s;});
__d("MercuryAudioPlayer",["Event","Arbiter","DOM","Flash","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('DOM'),j=b('Flash'),k=b('copyProperties'),l=200;function m(){var v=i.create('audio'),w=false;try{if(!!v.canPlayType)if(v.canPlayType('video/mp4;').replace(/^no$/,''))w=true;}finally{return w;}}function n(){return j.isAvailable();}var o=function(){this.interval=null;this.arbiterInstance=null;this.audio=i.create('audio');g.listen(this.audio,'playing',function(){this.informAttachment('playing',this.audio.currentTime);this.interval=setInterval(function(){this.informAttachment('playing',this.audio.currentTime);}.bind(this),l);}.bind(this));g.listen(this.audio,'ended',function(){clearInterval(this.interval);this.informAttachment('finished');}.bind(this));};k(o.prototype,{setAudio:function(v,w){this.audio.setAttribute('src',v);this.arbiterInstance=w;},informAttachment:function(v,w){if(this.arbiterInstance)this.arbiterInstance.inform(v,w);},play:function(){this.audio.play();this.informAttachment('played');},resume:function(){this.audio.play();this.informAttachment('played');},pause:function(){this.audio.pause();clearInterval(this.interval);this.informAttachment('paused');},getType:function(){return 'html5';}});var p=function(){this.src=null;this.arbiterInstance=null;var v=i.create('div');document.body.appendChild(v);this.swf=j.embed('/swf/SoundStreamPlayer.swf',v,null,{});this.interval=null;h.subscribe('soundstream/finished',function(){clearInterval(this.interval);this.informAttachment('finished');}.bind(this));};k(p.prototype,{setAudio:function(v,w){this.src=v;this.arbiterInstance=w;},informAttachment:function(v,w){if(this.arbiterInstance)this.arbiterInstance.inform(v,w);},play:function(){this.swf.playSound(this.src);this.interval=setInterval(function(){var v=this.swf.getCurrentTime();this.informAttachment('playing',v);}.bind(this),l);this.informAttachment('played');},resume:function(){this.swf.resume();this.informAttachment('played');},pause:function(){clearInterval(this.interval);this.swf.pause();this.informAttachment('paused');},getType:function(){return 'flash';}});function q(){if(m()){return new o();}else if(n())return new p();return false;}var r=null,s=null,t=0;function u(v,w){this.src=v;this.arbiterInstance=w;this.audio_id=++t;r!==null||(r=q());if(!r)return false;}k(u.prototype,{getType:function(){if(!r){return false;}else return r.getType();},play:function(v){if(v&&s==this.audio_id){r.resume();}else{this.pause();s=this.audio_id;r.setAudio(this.src,this.arbiterInstance);r.play();}},pause:function(){r.pause();}});e.exports=u;});
__d("ReactLayeredComponentMixin",["ReactCurrentOwner"],function(a,b,c,d,e,f){var g=b('ReactCurrentOwner'),h={componentWillMount:function(){this._renderedLayers={};},componentDidMount:function(){this._updateLayers();},componentDidUpdate:function(){this._updateLayers();},componentWillUnmount:function(){var i=this._renderedLayers;for(var j in i)if(i.hasOwnProperty(j)){i[j]&&i[j].unmountLayer();delete this._renderedLayers[j];}delete this._renderedLayers;},_updateLayers:function(){var i=this._renderedLayers;g.current=this;var j=this.renderLayers()||{};g.current=null;var k;for(k in j){var l=j[k];if(l&&j.hasOwnProperty(k)){var m=i.hasOwnProperty(k)?i[k]:null;if(m&&m.constructor===l.constructor){if(!l.props.isStatic)m.replaceProps(l.props);}else{if(m)m.unmountLayer();l.mountLayer();this._renderedLayers[k]=l;}}}for(k in i)if(i.hasOwnProperty(k)&&(!j.hasOwnProperty(k)||!j[k])){i[k]&&i[k].unmountLayer();delete this._renderedLayers[k];}}};e.exports=h;});
__d("MercuryAttachmentAudioClip",["ReactDOM","MercuryAudioPlayer","Arbiter","ArbiterMixin","ReactButton","ReactContextualDialog","Env","JSLogger","LeftRight","React","ReactLayeredComponentMixin","cx","debounce","goURI","tx"],function(a,b,c,d,e,f){var g=b('ReactDOM'),h=b('MercuryAudioPlayer'),i=b('Arbiter'),j=b('ArbiterMixin'),k=b('ReactButton'),l=b('ReactContextualDialog'),m=b('Env'),n=b('JSLogger'),o=b('LeftRight'),p=b('React'),q=b('ReactLayeredComponentMixin'),r=b('cx'),s=b('debounce'),t=b('goURI'),u=b('tx'),v='MercuryAttachmentAudioClip/play',w=n.create('mercury_audio_clip'),x=p.createClass({displayName:'AudioClip',mixins:[q,j],getInitialState:function(){this.subscribe('playing',this.updateTime.bind(this));this.subscribe('played',this.updateState.shield(this,{playing:true,started:true}));this.subscribe('paused',this.updateState.shield(this,{playing:false}));this.subscribe('finished',this.updateState.shield(this,{playing:false,started:false,time:this.props.duration}));this.logged=false;this.show_help=(this.props.showHelp===undefined)||this.props.showHelp;var y=this.props.downloadOnly?false:new h(this.props.src,this);i.subscribe(v,function(z,aa){if(this.props.src!=aa)this.updateState({time:0});}.bind(this));return {time:0,playing:false,started:false,showinfo:false,duration:this.props.duration,audioPlayer:y};},updateTime:function(y,z){this.updateState({time:z});},play:function(){if(this.state.playing){this.state.audioPlayer.pause();}else{this.state.audioPlayer.play(this.state.started);i.inform(v,this.props.src);if(!this.logged){this.logged=true;w.log('play',{uid:m.user,duration:this.props.duration});}}},_formatSeconds:function(y){if(y){y=Math.ceil(y);var z=y%60;if(z<10)z='0'+z;var aa=Math.floor(y/60);return aa+':'+z;}else return null;},debounceEnter:function(){if(this.debouncedLeave)this.debouncedLeave.reset();if(!this.state.showinfo)this.updateState({showinfo:true});},debounceLeave:function(){this.debouncedLeave=s(this.stateUpdater({showinfo:false}),500);this.debouncedLeave();},renderLayers:function(){if(!this.show_help)return;var y={};y._ke=true;y._1miy=true;var z=(l({position:"right",contextRef:"helpDialogAnchor",shown:this.state.showinfo},[g.div({classSet:y,onMouseEnter:this.debounceEnter.bind(this),onMouseLeave:this.debounceLeave.bind(this)},[g.h3(null,"New! Send voice messages from mobile"),g.p(null,"Have more to say? Send friends a voice message with Messenger for mobile"),k({label:"Get the App",onClick:t.curry('/mobile/messenger?voice_message'),use:k.USES.special})])]));return {contextual:z};},_renderPlayer:function(y,z){return (g.a({className:"_1miz",style:{width:y},onClick:this.play.bind(this)},[g.span({className:"_1mi-"},g.i({className:"_1mi_"})),g.span({className:"_1mj0"},z),g.div({className:"_1mj1"})]));},render:function(){var y=this._formatSeconds(this.state.duration),z=this.props.width||170,aa=null,ba=Math.ceil((this.state.time*(z+2))/this.state.duration);if(this.state.audioPlayer&&this.state.audioPlayer.getType()){var ca=this._renderPlayer(z,y),da=this._renderPlayer(z,y),ea={};ea._1mj2=true;ea._1mj3=this.state.playing&&(this.state.time!=0);ea._4g4x=this.state.playing&&(this.state.time===0);aa=(g.div({classSet:ea},[ca,g.div({className:"_1mj4",posInfo:{w:ba}},da)]));}else aa=(g.div({className:"_1mj2"},g.div({className:"_1miz"},o(null,[g.a({className:"_1mj5",href:this.props.src},[g.span({className:"_3qi6"},g.i({className:"_1mj6"})),g.span({className:"_1mj7"},"Voice Message"),g.span({className:"_1mj8"},y)]),g.a({href:this.props.src,className:"_1mj9"},g.i({className:"_1mja"}))]))));var fa=this.show_help?(g.a({ref:"helpDialogAnchor",onMouseEnter:this.debounceEnter.bind(this),onMouseLeave:this.debounceLeave.bind(this),className:"_1mjc"},g.i({className:"_1mjd"}))):null;return (g.div({className:"_1mjb"},[aa,fa]));}});e.exports=x;});
__d("md5",[],function(a,b,c,d,e,f){function g(u,v){var w=u[0],x=u[1],y=u[2],z=u[3];w=i(w,x,y,z,v[0],7,-680876936);z=i(z,w,x,y,v[1],12,-389564586);y=i(y,z,w,x,v[2],17,606105819);x=i(x,y,z,w,v[3],22,-1044525330);w=i(w,x,y,z,v[4],7,-176418897);z=i(z,w,x,y,v[5],12,1200080426);y=i(y,z,w,x,v[6],17,-1473231341);x=i(x,y,z,w,v[7],22,-45705983);w=i(w,x,y,z,v[8],7,1770035416);z=i(z,w,x,y,v[9],12,-1958414417);y=i(y,z,w,x,v[10],17,-42063);x=i(x,y,z,w,v[11],22,-1990404162);w=i(w,x,y,z,v[12],7,1804603682);z=i(z,w,x,y,v[13],12,-40341101);y=i(y,z,w,x,v[14],17,-1502002290);x=i(x,y,z,w,v[15],22,1236535329);w=j(w,x,y,z,v[1],5,-165796510);z=j(z,w,x,y,v[6],9,-1069501632);y=j(y,z,w,x,v[11],14,643717713);x=j(x,y,z,w,v[0],20,-373897302);w=j(w,x,y,z,v[5],5,-701558691);z=j(z,w,x,y,v[10],9,38016083);y=j(y,z,w,x,v[15],14,-660478335);x=j(x,y,z,w,v[4],20,-405537848);w=j(w,x,y,z,v[9],5,568446438);z=j(z,w,x,y,v[14],9,-1019803690);y=j(y,z,w,x,v[3],14,-187363961);x=j(x,y,z,w,v[8],20,1163531501);w=j(w,x,y,z,v[13],5,-1444681467);z=j(z,w,x,y,v[2],9,-51403784);y=j(y,z,w,x,v[7],14,1735328473);x=j(x,y,z,w,v[12],20,-1926607734);w=k(w,x,y,z,v[5],4,-378558);z=k(z,w,x,y,v[8],11,-2022574463);y=k(y,z,w,x,v[11],16,1839030562);x=k(x,y,z,w,v[14],23,-35309556);w=k(w,x,y,z,v[1],4,-1530992060);z=k(z,w,x,y,v[4],11,1272893353);y=k(y,z,w,x,v[7],16,-155497632);x=k(x,y,z,w,v[10],23,-1094730640);w=k(w,x,y,z,v[13],4,681279174);z=k(z,w,x,y,v[0],11,-358537222);y=k(y,z,w,x,v[3],16,-722521979);x=k(x,y,z,w,v[6],23,76029189);w=k(w,x,y,z,v[9],4,-640364487);z=k(z,w,x,y,v[12],11,-421815835);y=k(y,z,w,x,v[15],16,530742520);x=k(x,y,z,w,v[2],23,-995338651);w=l(w,x,y,z,v[0],6,-198630844);z=l(z,w,x,y,v[7],10,1126891415);y=l(y,z,w,x,v[14],15,-1416354905);x=l(x,y,z,w,v[5],21,-57434055);w=l(w,x,y,z,v[12],6,1700485571);z=l(z,w,x,y,v[3],10,-1894986606);y=l(y,z,w,x,v[10],15,-1051523);x=l(x,y,z,w,v[1],21,-2054922799);w=l(w,x,y,z,v[8],6,1873313359);z=l(z,w,x,y,v[15],10,-30611744);y=l(y,z,w,x,v[6],15,-1560198380);x=l(x,y,z,w,v[13],21,1309151649);w=l(w,x,y,z,v[4],6,-145523070);z=l(z,w,x,y,v[11],10,-1120210379);y=l(y,z,w,x,v[2],15,718787259);x=l(x,y,z,w,v[9],21,-343485551);u[0]=r(w,u[0]);u[1]=r(x,u[1]);u[2]=r(y,u[2]);u[3]=r(z,u[3]);}function h(u,v,w,x,y,z){v=r(r(v,u),r(x,z));return r((v<<y)|(v>>>(32-y)),w);}function i(u,v,w,x,y,z,aa){return h((v&w)|((~v)&x),u,v,y,z,aa);}function j(u,v,w,x,y,z,aa){return h((v&x)|(w&(~x)),u,v,y,z,aa);}function k(u,v,w,x,y,z,aa){return h(v^w^x,u,v,y,z,aa);}function l(u,v,w,x,y,z,aa){return h(w^(v|(~x)),u,v,y,z,aa);}function m(u){var v=u.length,w=[1732584193,-271733879,-1732584194,271733878],x;for(x=64;x<=u.length;x+=64)g(w,n(u.substring(x-64,x)));u=u.substring(x-64);var y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(x=0;x<u.length;x++)y[x>>2]|=u.charCodeAt(x)<<((x&3)<<3);y[x>>2]|=128<<((x&3)<<3);if(x>55){g(w,y);for(x=0;x<16;x++)y[x]=0;}y[14]=v*8;g(w,y);return w;}function n(u){var v=[],w=0;while(w<64)v[w>>2]=u.charCodeAt(w++)|(u.charCodeAt(w++)<<8)|(u.charCodeAt(w++)<<16)|(u.charCodeAt(w++)<<24);return v;}var o='0123456789abcdef'.split('');function p(u){var v='',w=0;for(;w<4;w++)v+=o[(u>>((w<<3)+4))&15]+o[(u>>(w<<3))&15];return v;}function q(u){for(var v=0;v<u.length;v++)u[v]=p(u[v]);return u.join('');}var r=function(u,v){return (u+v)&4294967295;};function s(u){var v="",w,x;for(var y=0;y<u.length;y++){w=u.charCodeAt(y);x=y+1<u.length?u.charCodeAt(y+1):0;if(55296<=w&&w<=56319&&56320<=x&&x<=57343){w=65536+((w&1023)<<10)+(x&1023);y++;}if(w<=127){v+=String.fromCharCode(w);}else if(w<=2047){v+=String.fromCharCode(192|((w>>>6)&31),128|(w&63));}else if(w<=65535){v+=String.fromCharCode(224|((w>>>12)&15),128|((w>>>6)&63),128|(w&63));}else if(w<=2097151)v+=String.fromCharCode(240|((w>>>18)&7),128|((w>>>12)&63),128|((w>>>6)&63),128|(w&63));}return v;}function t(u){if(null===u||undefined===u){return null;}else{for(var v=0;v<u.length;v++)if(u[v]>"\u007F"){u=s(u);break;}return q(m(u));}}if(t('hello')!='5d41402abc4b2a76b9719d911017c592')r=function(u,v){var w=(u&65535)+(v&65535),x=(u>>16)+(v>>16)+(w>>16);return (x<<16)|(w&65535);};e.exports=t;});
__d("isRTL",[],function(a,b,c,d,e,f){var g='A-Za-z\xC0-\xD6\xD8-\xF6\xF8-\u02B8\u0300-\u0590\u0800-\u1FFF'+'\u200E\u2C00-\uFB1C\uFE00-\uFE6F\uFEFD-\uFFFF',h='\u0591-\u07FF\u200F\uFB1D-\uFDFF\uFE70-\uFEFC',i=new RegExp('^[^'+g+']*['+h+']'),j=new RegExp('['+g+']');function k(l){var m=0,n=0;l.split(/\s+/,20).forEach(function(o){if(/^https?:\/\//.test(o))return;if(i.test(o)){n++;m++;}else if(j.test(o))m++;});return !!(m&&(n/m>.4));}e.exports=k;});
__d("WaterfallIDGenerator",["Env","md5"],function(a,b,c,d,e,f){var g=b('Env'),h=b('md5');function i(){var l=2147483647;return Math.random()*l;}function j(){return Math.floor(Date.now()/1000);}var k={generate:function(){return h([g.user,j(),i()].join(':'));}};e.exports=k;});
__d("FeatureDetection",["UserAgent"],function(a,b,c,d,e,f){var g=b('UserAgent');e.exports={isFileAPISupported:function(){if(g.webkit()&&!g.chrome()&&g.windows())return false;return ('FileList' in window)&&('FormData' in window);},isBlobFactorySupported:function(){return !!a.Blob;}};});
__d("AsyncUploadBase",["ArbiterMixin","AsyncRequest","AsyncResponse","Form","FeatureDetection","copyProperties","removeFromArray"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('AsyncResponse'),j=b('Form'),k=b('FeatureDetection'),l=b('copyProperties'),m=b('removeFromArray');function n(p){this.setURI(p);}n.isSupported=function(){return k.isFileAPISupported();};l(n.prototype,g,{_limit:10,setAllowCrossOrigin:function(p){this._allowCrossOrigin=!!p;return this;},setData:function(p){this._data=p;return this;},setLimit:function(p){this._limit=p;return this;},setRelativeTo:function(p){this._relativeTo=p;return this;},setStatusElement:function(p){this._statusElement=p;return this;},setURI:function(p){this._uri=p;return this;},suspend:function(){this._suspended=true;return this;},resume:function(){this._suspended=false;this._processQueue();return this;},isUploading:function(){return this._inFlight;},_createFileUpload:function(p,q,r){return new o(p,q,r);},_parseFiles:function(p){var q={};for(var r in p){var s=p[r];if(Array.isArray(s)){q[r]=s;}else{q[r]=[];if(s instanceof window.FileList){for(var t=0;t<s.length;t++)q[r].push(s.item(t));}else if(s instanceof window.File||s instanceof window.Blob)q[r].push(s);}}return q;},_processQueue:function(){if(this._suspended)return;while(this._pending.length<this._limit){if(!this._waiting.length)break;var p=this._waiting.shift();this._processUpload(p);this._pending.push(p);}},_processUpload:function(p){var q=j.createFormData(p.getData()||this._data);if(p.getFile()){q.append(p.getName(),p.getFile());q.append('upload_id',p.getFile().uploadID);}var r=new h().setAllowCrossOrigin(this._allowCrossOrigin).setURI(this._uri).setRawData(q).setRelativeTo(this._relativeTo).setStatusElement(this._statusElement).setHandler(this._success.bind(this,p)).setErrorHandler(this._failure.bind(this,p)).setUploadProgressHandler(this._progress.bind(this,p)).setInitialHandler(this._initial.bind(this,p));r.send();p.setAsyncRequest(r);this._inFlight=true;this.inform('start',p);},_abort:function(p){m(this._waiting,p);p.abort();},_initial:function(p){this.inform('initial',p);},_success:function(p,q){this._complete(p);this.inform('success',p.handleSuccess(q));this._processQueue();},_failure:function(p,q){this._complete(p);if(this.inform('failure',p.handleFailure(q))!==false)i.defaultErrorHandler(q);this._processQueue();},_progress:function(p,event){this.inform('progress',p.handleProgress(event));},_complete:function(p){m(this._pending,p);if(!this._pending.length)this._inFlight=false;}});var o=function(p,q,r){this._name=p;this._file=q;this._data=r;this._success=null;this._response=null;this._progressEvent=null;this._request=null;};l(o.prototype,{getName:function(){return this._name;},getFile:function(){return this._file;},getData:function(){return this._data;},isComplete:function(){return this._success!==null;},isSuccess:function(){return this._success===true;},getResponse:function(){return this._response;},getProgressEvent:function(){return this._progressEvent;},setAsyncRequest:function(p){this._request=p;return this;},isWaiting:function(){return !this._request;},abort:function(){this._request&&this._request.abort();this._request=null;},handleSuccess:function(p){this._success=true;this._response=p;this._progressEvent=null;return this;},handleFailure:function(p){this._success=false;this._response=p;this._progressEvent=null;return this;},handleProgress:function(event){this._progressEvent=event;return this;}});e.exports=n;});
__d("AsyncUploadRequest",["AsyncUploadBase","Class","copyProperties"],function(a,b,c,d,e,f){var g=b('AsyncUploadBase'),h=b('Class'),i=b('copyProperties');function j(k){this.parent.construct(this,k);}j.isSupported=function(){return g.isSupported();};h.extend(j,g);i(j.prototype,{setFiles:function(k){this._files=this._parseFiles(k);return this;},send:function(){if(this._inFlight)return;this._inFlight=true;this._uploads=[];for(var k in this._files)this._files[k].forEach(function(l){this._uploads.push(this._createFileUpload(k,l));}.bind(this));if(this._uploads.length){this._waiting=this._uploads.slice(0);this._pending=[];this._processQueue();}else this._processUpload(this._createFileUpload(null,null));},_processQueue:function(){this.parent._processQueue();if(!this._pending.length&&!this._waiting.length)this.inform('complete',this._uploads);}});e.exports=j;});
__d("FileForm",["Event","ArbiterMixin","AsyncRequest","AsyncUploadRequest","AsyncResponse","BehaviorsMixin","DataStore","DOMQuery","Env","Form","JSONPTransport","Parent","URI","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('AsyncRequest'),j=b('AsyncUploadRequest'),k=b('AsyncResponse'),l=b('BehaviorsMixin'),m=b('DataStore'),n=b('DOMQuery'),o=b('Env'),p=b('Form'),q=b('JSONPTransport'),r=b('Parent'),s=b('URI'),t=b('copyProperties');function u(x){var y={},z=n.scry(x,'input[type="file"]');z.forEach(function(aa){y[aa.name]=aa.files;});return y;}function v(x){var y=n.scry(x,'input[type="file"]');y.forEach(function(z){z.files=null;});}function w(x,y,z){if(x.getAttribute('rel')==='async')throw new Error('FileForm cannot be used with Primer forms.');if(x.getAttribute('method').toUpperCase()!=='POST')throw new Error('FileForm must be used with POST forms.');this._form=x;this._previousEncoding=this._form.enctype;this._form.enctype=this._form.encoding='multipart/form-data';y&&this.enableBehaviors(y);this._options=z||{};this.setAllowCrossOrigin(this._options.allowCrossOrigin);this.setUploadInParallel(this._options.uploadInParallel);this._listener=g.listen(this._form,'submit',this._submit.bind(this));m.set(this._form,'FileForm',this);}t(w,{EVENTS:['start','submit','initial','progress','success','failure'],getInstance:function(x){return m.get(x,'FileForm');}});t(w.prototype,h,l,{getRoot:function(){return this._form;},setAllowCrossOrigin:function(x){this._allowCrossOrigin=!!x;return this;},setUploadInParallel:function(x){this._uploadInParallel=!!x;return this;},_submit:function(event){if(this.inform('submit')===false){event.prevent();return;}var x='FormData' in window;if(x)if(!s(this._form.action).isSameOrigin()&&!this._allowCrossOrigin)x=false;return x?this._sendViaXHR(event):this._sendViaFrame(event);},_sendViaFrame:function(event){var x=this._request=new i();x.setStatusElement(this._getStatusElement());x.addStatusIndicator();x.setOption('useIframeTransport',true);var y=x.handleResponse.bind(x),z=new q('iframe',this._form.action,y),aa=z.getTransportFrame(),ba=z.getRequestURI().addQueryData({__iframe:true,__user:o.user});this._form.setAttribute('action',ba.toString());this._form.setAttribute('target',aa.name);x.setJSONPTransport(z);x.setURI(ba);x.setHandler(this.success.bind(this,null));x.setErrorHandler(this.failure.bind(this,null));x.setInitialHandler(this.initial.shield(this,null));},_sendViaXHR:function(event){var x;if(this._uploadInParallel&&j.isSupported()){x=new j().setData(p.serialize(this._form)).setFiles(u(this._form));var y=[x.subscribe('progress',function(z,aa){this.progress(aa,aa.getProgressEvent());}.bind(this)),x.subscribe('initial',function(z,aa){this.initial(aa,aa.getResponse());}.bind(this)),x.subscribe('success',function(z,aa){this.success(aa,aa.getResponse());}.bind(this)),x.subscribe('start',function(z,aa){this.inform('start',{upload:aa});}.bind(this)),x.subscribe('failure',function(z,aa){this.failure(aa,aa.getResponse());return false;}.bind(this)),x.subscribe('complete',function(){while(y.length)y.pop().unsubscribe();})];}else x=new i().setRawData(p.createFormData(this._form)).setHandler(this.success.bind(this,null)).setErrorHandler(this.failure.bind(this,null)).setUploadProgressHandler(this.progress.bind(this,null)).setInitialHandler(this.initial.shield(this,null));x.setAllowCrossOrigin(this._allowCrossOrigin).setRelativeTo(this._form).setStatusElement(this._getStatusElement()).setURI(this._form.action).send();this._request=x;event.prevent();},initial:function(x){return this.inform('initial',{upload:x});},success:function(x,y){var z={response:y,upload:x};if(this.inform('success',z)!==false)g.fire(this._form,'success',z);this._cleanup();},failure:function(x,y){var z={response:y,upload:x};if(this.inform('failure',z)!==false)if(g.fire(this._form,'error',z)!==false)k.defaultErrorHandler(y);this._cleanup();},progress:function(x,event){this.inform('progress',{event:event,upload:x});},abort:function(){if(this._request){this._request.abort();this._cleanup();}},clear:function(){v(this._form);},destroy:function(){this._cleanup();this._listener.remove();this._listener=null;this._form.enctype=this._form.encoding=this._previousEncoding;m.remove(this._form,'FileForm');},_cleanup:function(){this._request=null;},_getStatusElement:function(){return r.byClass(this._form,'stat_elem')||this._form;}});e.exports=w;});
__d("FileFormResetOnSubmit",["DOMQuery","copyProperties"],function(a,b,c,d,e,f){var g=b('DOMQuery'),h=b('copyProperties');function i(j){this._form=j;}h(i.prototype,{enable:function(){this._subscription=this._form.subscribe('submit',Function.prototype.defer.bind(this._reset.bind(this)));},disable:function(){this._subscription.unsubscribe();this._subscription=null;},_reset:function(){var j=g.scry(this._form.getRoot(),'input[type="file"]');j.forEach(function(k){k.value='';});}});e.exports=i;});
__d("submitForm",["DOM"],function(a,b,c,d,e,f){var g=b('DOM'),h=function(i){var j=g.scry(i,'input[type="submit"]')[0];if(j){j.click();}else{j=g.create('input',{type:'submit',className:'hidden_elem'});g.appendContent(i,j);j.click();g.remove(j);}};e.exports=h;});
__d("FormSubmitOnChange",["Event","copyProperties","submitForm"],function(a,b,c,d,e,f){var g=b('Event'),h=b('copyProperties'),i=b('submitForm');function j(k){this._form=k;}h(j.prototype,{_listener:null,enable:function(){this._listener=g.listen(this._form.getRoot(),'change',this._submit.bind(this));},disable:function(){this._listener.remove();this._listener=null;},_submit:function(){i(this._form.getRoot());}});e.exports=j;});
__d("MercuryFileUploader",["Event","ArbiterMixin","CSS","DOM","Dialog","FileForm","FileFormResetOnSubmit","FileInput","FormSubmitOnChange","MercuryAttachment","MercuryAttachmentTemplates","MercuryConstants","SubscriptionsHandler","copyProperties","csx","getObjectValues","startsWith","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('CSS'),j=b('DOM'),k=b('Dialog'),l=b('FileForm'),m=b('FileFormResetOnSubmit'),n=b('FileInput'),o=b('FormSubmitOnChange'),p=b('MercuryAttachment'),q=b('MercuryAttachmentTemplates'),r=b('MercuryConstants'),s=b('SubscriptionsHandler'),t=b('copyProperties'),u=b('csx'),v=b('getObjectValues'),w=b('startsWith'),x=b('tx'),y=0;function z(ba,ca,da,ea){this._parentElem=ba;this._attachments={};this._uploading={};this._uploadTemplates={};this._uploadStartTimes={};this._subscriptionsHandler=new s();this._fileForm=new l(ca,[o,m]);var fa=j.find(ca,"._4q60"),ga=j.find(fa,"._4q61");new n(fa,ga,da);this._subscriptionsHandler.addSubscriptions(this._fileForm.subscribe('submit',function(){var ha='upload_'+y++;ea.value=ha;var ia={count:0,file_sizes:[]};if(da.files){for(var ja=0;ja<da.files.length;ja++)if(da.files[ja].size>r.AttachmentMaxSize){this._fileForm.abort();this._fileForm.clear();new k().setTitle("The file you have selected is too large").setBody("The file you have selected is too large. The maximum size is 25MB.").setButtons(k.OK).setSemiModal(true).show();return false;}for(var ka=0;ka<da.files.length;ka++){this._addFileUploadRow(ha,da.files[ka].name);ia.count++;ia.file_sizes.push(da.files[ka].size);}}else{this._addFileUploadRow(ha,da.value);ia.count=1;}this.inform('submit',ia);}.bind(this)),this._fileForm.subscribe('success',this._onFileUploadSuccess.bind(this)),this._fileForm.subscribe('failure',this._onFileUploadFailure.bind(this)),g.listen(ga,'click',this.inform.shield(this,'open')));}t(z.prototype,h,{isUploading:function(){return !!Object.keys(this._uploading).length;},getAttachments:function(){return v(this._attachments);},removeAttachments:function(){this._attachments={};this._uploadTemplates={};this._uploading={};this._uploadStartTimes={};j.empty(this._parentElem);this.inform('dom-updated');},destroy:function(){this._subscriptionsHandler.release();this._fileForm.destroy();this.removeAttachments();},_addFileUploadRow:function(ba,ca){var da=q[':fb:mercury:upload-file-row'].build(),ea=aa(ca),fa=ba+'/'+ea;this._uploadTemplates[fa]=da;this._uploading[fa]=true;this._uploadStartTimes[fa]=Date.now();j.appendContent(da.getNode('iconText'),ea);g.listen(da.getNode('closeFileUpload'),'click',this._removeFileUploader.bind(this,fa));j.appendContent(this._parentElem,da.getRoot());this.inform('dom-updated');},_removeFileUploader:function(ba,event){if(this._uploading[ba]){this.inform('upload-canceled-during-upload');}else if(this._attachments[ba])this.inform('upload-canceled-after-uploaded');delete this._attachments[ba];delete this._uploading[ba];delete this._uploadStartTimes[ba];var ca=this._uploadTemplates[ba];delete this._uploadTemplates[ba];if(ca){j.remove(ca.getRoot());this.inform('dom-updated');}this.inform('upload-canceled');return false;},_updateFileUploader:function(ba,ca){var da=this._uploadTemplates[ba],ea=p.getAttachIconClassByMime(ca.filetype);i.addClass(da.getNode('iconText'),ea);i.addClass(da.getRoot(),'done');},_onFileUploadSuccess:function(event,ba){var ca=ba.response.getPayload(),da=ca.uploadID,ea=ca.metadata;for(var fa=0;fa<ea.length;fa++){var ga=da+'/'+ea[fa].filename;if(this._uploading[ga]){delete this._uploading[ga];this._attachments[ga]=ea[fa];this._updateFileUploader(ga,ea[fa]);this.inform('one-upload-completed',{upload_time_ms:Date.now()-this._uploadStartTimes[ga]});}}if(!this.isUploading())this.inform('all-uploads-completed',{count:this.getAttachments().length});},_onFileUploadFailure:function(event,ba){this.inform('one-upload-failed');}});function aa(ba){if(ba&&w(ba,'C:\\fakepath\\'))return ba.substring(12);return ba;}e.exports=z;});
__d("MercuryThreadMuter",["AsyncDialog","AsyncRequest","Env","MercuryThreads"],function(a,b,c,d,e,f){var g=b('AsyncDialog'),h=b('AsyncRequest'),i=b('Env'),j=b('MercuryThreads').get(),k={getUserIDEmail:function(){return i.user+'@facebook.com';},getThreadMuteSettingForUser:function(l){return l.mute_settings&&l.mute_settings[k.getUserIDEmail()];},isThreadMuted:function(l){return k.getThreadMuteSettingForUser(l)!==undefined;},showMuteChangeDialog:function(l,m){g.send(new h('/ajax/mercury/mute_thread_dialog.php').setData({muting:l}),function(n){n.subscribe('confirm',function(){this.hide();j.updateThreadMuteSetting(m,l);}.bind(n));});}};e.exports=k;});
__d("WebMessengerEvents",["Arbiter","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=h(new g(),{MASTER_DOM_CHANGED:'master-dom-changed',DETAIL_DOM_CHANGED:'detail-dom-changed',FOCUS_COMPOSER:'focus-composer',FOCUS_SEARCH:'focus-search',FOCUS_AND_SELECT_SEARCH:'focus-and-select-search',SUBMIT_REPLY:'submit-reply',UPDATE_SELECTION:'update-selection',masterDOMChanged:function(){this.inform(i.MASTER_DOM_CHANGED);},detailDOMChanged:function(){this.inform(i.DETAIL_DOM_CHANGED);},focusComposer:function(){this.inform(i.FOCUS_COMPOSER);},focusSearch:function(){this.inform(i.FOCUS_SEARCH);},focusAndSelectSearch:function(){this.inform(i.FOCUS_AND_SELECT_SEARCH);},updateSelection:function(j){this.inform(i.UPDATE_SELECTION,j);},submitReply:function(){this.inform(i.SUBMIT_REPLY);}});e.exports=i;});
__d("WebMessengerSubscriptionsHandler",["SubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('SubscriptionsHandler'),h=new g('webmessenger');e.exports=h;});
__d("WebMessengerStateConstants",[],function(a,b,c,d,e,f){var g={STATE_CHANGE_EVENT:'state-changed',DETAIL:{COMPOSE_MAIN:'compose-main',COMPOSE_TYPEAHEAD_RESULTS:'compose-typeahead-results',COMPOSE_ALL_PEOPLE_RESULTS:'compose-all-people-results',RECENT_MESSAGES:'recent-messages',SEARCH_CONTEXT:'search-context',SEARCH_SNIPPET:'search-snippet',SEARCH_THREAD_SNIPPET:'search-thread-snippet'},MASTER:{RECENT_THREADS:'recent-threads',SEARCH:'search'},MESSAGE_ACTION:{DELETE:'delete',FORWARD:'forward',REPORT_SPAM:'report_spam'}};e.exports=g;});
__d("WebMessengerOldToNewPermalink",["WebMessengerPermalinkConstants","WebMessengerStateConstants"],function(a,b,c,d,e,f){var g=b('WebMessengerPermalinkConstants'),h=b('WebMessengerStateConstants');function i(n){if(!j(n))return n;k(n);m(n);l(n);return n;}function j(n){var o=n.getQueryData();if(o.sk)switch(o.sk){case 'inbox':n.setPath(g.BASE_PATH);n.removeQueryData('sk');break;case 'other':n.setPath(g.OTHER_PATH);n.removeQueryData('sk');break;default:return false;}return true;}function k(n){var o=n.getQueryData();switch(o.action){case 'read':if(!o.tid){n.addQueryData({action:h.DETAIL.RECENT_MESSAGES});}else n.removeQueryData('action');break;}}function l(n){var o=n.getQueryData();if(o.tid){n.setPath(g.getURIPathForThreadID(o.tid,n.getPath()));n.removeQueryData('tid');}}function m(n){var o=n.getQueryData();if(!n.getPath().match(g.SEARCH_POSTFIX_PATH)&&o.action!=h.DETAIL.SEARCH_SNIPPET&&!o.mid){var p=o.query;if(o.query){var q=/\bis:(archived|spam)\b(.*)/,r=q.exec(o.query);if(r){switch(r[1]){case 'archived':n.setPath(g.ARCHIVED_PATH);break;case 'spam':n.setPath(g.SPAM_PATH);break;}var s=o.query.substr(0,o.query.length-r[0].length),t=r[2];p=(s.trim()+' '+t.trim()).trim();}}if(o.thread_query){n.setPath(n.getPath()+g.SEARCH_POSTFIX_PATH);n.setQueryData({query:o.thread_query});}else if(p){n.setPath(n.getPath()+g.SEARCH_POSTFIX_PATH);n.addQueryData({query:p});}else n.removeQueryData('query');}}e.exports=i;});
__d("WebMessengerStateStore",["MercuryAssert","PresenceState"],function(a,b,c,d,e,f){var g=b('MercuryAssert'),h=b('PresenceState'),i=null;function j(){var l=h.get();if(l&&l.wml)return l.wml;return {};}h.registerStateStorer(function(l){if(i)l.wml=i;i=null;});var k={getLastSeenThreadID:function(){var l=j();return l.thread_id||null;},getLastSeenFolder:function(){var l=j();return l.folder||null;},setLastSeen:function(l,m){m&&g.isThreadID(m);i={folder:l,thread_id:m||null};h.doSync();}};e.exports=k;});
__d("Token",["CSS","DataStore","DOM","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DataStore'),i=b('DOM'),j=b('copyProperties'),k=b('tx');function l(m,n){this.info=m;this.paramName=n;}j(l.prototype,{getInfo:function(){return this.info;},getText:function(){return this.info.text;},getValue:function(){return this.info.uid;},isFreeform:function(){return !!this.info.freeform;},setSelected:function(m){g.conditionClass(this.getElement(),'uiTokenSelected',m);return this;},getElement:function(){if(!this.element)this.setElement(this.createElement());return this.element;},setElement:function(m){h.set(m,'Token',this);this.element=m;return this;},isRemovable:function(){return g.hasClass(this.element,'removable');},createElement:function(m,n){var o=this.paramName,p=this.getText(),q=this.getValue(),r=i.create('a',{href:'#','aria-label':k._("Remove {item}",{item:p}),className:'remove uiCloseButton uiCloseButtonSmall'});if(m)g.addClass(r,'uiCloseButtonSmallGray');var s=i.create('input',{type:'hidden',value:q,name:o+'[]',autocomplete:'off'}),t=i.create('input',{type:'hidden',value:p,name:'text_'+o+'[]',autocomplete:'off'}),u=i.create('span',{className:'removable uiToken'},[p,s,t,r]);if(m)g.addClass(u,'uiTokenGray');if(n){var v=i.create('i',{className:n});i.prependContent(u,v);}return u;}});e.exports=l;});
__d("WebMessengerPermalinks",["MercuryAPIArgsSource","MercuryFilters","MercuryIDs","MercuryParticipants","MercuryParticipantTypes","MessagingTag","WebMessengerOldToNewPermalink","WebMessengerPermalinkConstants","MercuryServerRequests","WebMessengerStateConstants","WebMessengerStateStore","MercuryThreads","Token","URI","WebMessengerConstants","MercuryUnreadState","goURI"],function(a,b,c,d,e,f){var g=b('MercuryAPIArgsSource'),h=b('MercuryFilters'),i=b('MercuryIDs'),j=b('MercuryParticipants'),k=b('MercuryParticipantTypes'),l=b('MessagingTag'),m=b('WebMessengerOldToNewPermalink'),n=b('WebMessengerPermalinkConstants'),o=b('MercuryServerRequests').get(),p=b('WebMessengerStateConstants'),q=b('WebMessengerStateStore'),r=b('MercuryThreads').get(),s=b('Token'),t=b('URI'),u=b('WebMessengerConstants'),v=b('MercuryUnreadState'),w=b('goURI'),x='(/|\\?|$)',y={getDefaultURI:function(){var ka=new t().setSubdomain('www');ka.setPath(n.BASE_PATH);return ka;},goNextURI:function(ka,la,ma,na){if(ha(ka,la,ma)){var oa=y.getURI(ka,la,ma);w(oa,false,na);return true;}return false;},getURI:function(ka,la,ma){var na=y.getDefaultURI();if(!ka||!la||!ma)return na;switch(ma.folder){case l.OTHER:na.setPath(n.OTHER_PATH);break;case l.ACTION_ARCHIVED:na.setPath(n.ARCHIVED_PATH);break;case l.SPAM:na.setPath(n.SPAM_PATH);break;}if(ma.filter&&(ma.filter!=h.ALL))na.addQueryData({filter:ma.filter});var oa;switch(ka){case p.MASTER.SEARCH:oa=false;na.setPath(na.getPath()+n.SEARCH_POSTFIX_PATH);break;}switch(la){case p.DETAIL.COMPOSE_MAIN:case p.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:case p.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:na.setPath(na.getPath()+n.COMPOSE_POSTFIX_PATH);oa=false;break;case p.DETAIL.RECENT_MESSAGES:oa=!ma.thread_id;break;case p.DETAIL.SEARCH_CONTEXT:oa=false;break;default:oa=true;break;}if(oa)na.addQueryData({action:la});if(ma.thread_id){var pa=r.getCanonicalUserInThread(ma.thread_id),qa=pa&&j.getNow(j.getIDForUser(pa));if(qa&&qa.type!==k.EVENT){var ra=(qa&&qa.vanity)||pa;na.setPath(n.getURIPathForIDOrVanity(ra,na.getPath()));}else{var sa=o.getServerThreadIDNow(ma.thread_id),ta=sa?sa:ma.thread_id;na.setPath(n.getURIPathForThreadID(ta,na.getPath()));}}if(ma.query)na.addQueryData({query:ma.query});if(ma.message_query)na.addQueryData({mquery:ma.message_query});if(ma.message_id)na.addQueryData({mid:ma.message_id});if(ma.reuse_composer)na.addQueryData({rc:true});return na;},processURI:function(ka){ka=m(ka);if(!y.isWebMessengerURI(ka))return false;var la=ia(ka);if(!la.master_state||!la.detail_state)return ja(ka);var ma={data:{folder:fa(ka),filter:ga(ka)},redirect:false,master_state:la.master_state,detail_state:la.detail_state};if(ka.getQueryData().rc)ma.data.reuse_composer=true;ma=ca(ka,ma);switch(la.detail_state){case p.DETAIL.RECENT_MESSAGES:return ea(ka,ma);case p.DETAIL.COMPOSE_MAIN:return z(ka,ma);case p.DETAIL.SEARCH_SNIPPET:ma=da(ka,ma);return ma;case p.DETAIL.SEARCH_CONTEXT:ma=ea(ka,ma);ma=da(ka,ma);return ba(ka,ma);}ma.redirect=true;return ma;},isWebMessengerURI:function(ka){return (/^(\/messages)/).test(ka.getPath());}};function z(ka,la){var ma=null;if(ka.getQueryData().to)ma=[].concat(ka.getQueryData().to);return aa(ma,la);}function aa(ka,la){if(ka){la.data.new_tokens=[];ka.forEach(function(ma){var na=j.getNow(j.getIDForUser(ma));if(na){var oa={uid:ma,text:na.name,type:u.USER_TYPE};la.data.new_tokens.push(new s(oa));}});}la.data.start=true;return la;}function ba(ka,la){var ma=ka.getQueryData().mid;if(ma){la.data.message_id=ma;}else la.redirect=true;return la;}function ca(ka,la){var ma=ka.getQueryData().query;la.data.query=ma;return la;}function da(ka,la){var ma=ka.getQueryData().mquery;la.data.message_query=ma;return la;}function ea(ka,la){var ma=n.getThreadIDFromURI(ka);if(ma){var na=i.isValidThreadID(ma)?ma:o.getClientThreadIDNow(ma);if(na){la.data.thread_id=na;}else la.redirect=true;}else{var oa=n.getUserIDOrVanity(ka.getPath());if(oa){var pa=j.getIDFromVanityOrFBID(oa),qa=pa&&r.getCanonicalThreadToParticipant(pa,null,g.WEBMESSENGER);if(qa){if(qa.timestamp){la.data.thread_id=qa.thread_id;}else{la.detail_state=p.DETAIL.COMPOSE_MAIN;la=aa([j.getUserID(pa)],la);}}else la.redirect=true;}}return la;}function fa(ka,la){var ma=ka.getPath();if(ma.match('^'+n.ARCHIVED_PATH+x))return l.ACTION_ARCHIVED;if(ma.match('^'+n.OTHER_PATH+x))return l.OTHER;if(ma.match('^'+n.SPAM_PATH+x))return l.SPAM;if(la!==undefined)return la;return l.INBOX;}function ga(ka){return ka.getQueryData().filter||h.ALL;}function ha(ka,la,ma){if(la===p.DETAIL.SEARCH_CONTEXT||la===p.DETAIL.SEARCH_THREAD_SNIPPET)return false;if(ma&&ma.no_uri===true){delete ma.no_uri;return false;}var na=la==p.DETAIL.COMPOSE_MAIN||la==p.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||la==p.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;if(na&&(!ma.start||ma.new_tokens))return false;if(!ka||!la||!ma)return true;if(ma.bug_reporting_enabled)return false;return !ma.message_action;}function ia(ka){var la={},ma=ka.getPath(),na=ka.getQueryData(),oa=ma.match(n.BASE_PATH+'(/[^/]+)?'+n.SEARCH_POSTFIX_PATH+x);la.master_state=oa&&na.query?p.MASTER.SEARCH:p.MASTER.RECENT_THREADS;if(na.action){la.detail_state=na.action;return la;}if(ma.match(n.BASE_PATH+'(/[^/]+)?'+n.COMPOSE_POSTFIX_PATH+x)){la.detail_state=p.DETAIL.COMPOSE_MAIN;return la;}if(ma.match(n.TID_POSTFIX_PARTIAL_PATH)||n.getUserIDOrVanity(ma)){if(na.mid&&na.mquery){la.detail_state=p.DETAIL.SEARCH_CONTEXT;}else la.detail_state=p.DETAIL.RECENT_MESSAGES;}else if(na.mquery)la.detail_state=p.DETAIL.SEARCH_SNIPPET;return la;}function ja(ka){var la=fa(ka,null)||q.getLastSeenFolder(),ma=q.getLastSeenThreadID(),na=v.get();if(la===l.OTHER&&na.getUnreadCount(la)===0){var oa=l.INBOX;if(na.exceedsMaxCount(oa)||na.getUnreadCount(oa)>0)la=oa;}var pa={redirect:!!ma||!!la,replace:true,master_state:p.MASTER.RECENT_THREADS,detail_state:p.DETAIL.RECENT_MESSAGES,data:{folder:la||l.INBOX,filter:h.ALL,thread_id:ma}};return pa;}e.exports=y;});
__d("WebMessengerWidthControl",["Event","Arbiter","CSS","CSSClassTransition","DOMDimensions","WebMessengerPermalinks","Style","URI","ViewportBounds","WebMessengerEvents","WebMessengerSubscriptionsHandler","$","cx","requestAnimationFrame","throttle"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('CSS'),j=b('CSSClassTransition'),k=b('DOMDimensions'),l=b('WebMessengerPermalinks'),m=b('Style'),n=b('URI'),o=b('ViewportBounds'),p=b('WebMessengerEvents'),q=b('WebMessengerSubscriptionsHandler'),r=b('$'),s=b('cx'),t=b('requestAnimationFrame'),u=b('throttle'),v=205,w=981,x=257,y=18,z=848,aa=724,ba=.57,ca=56,da,ea,fa;function ga(la,ma,na){this.masterChanged=la;this.detailChaned=ma;q.addSubscriptions(g.listen(window,'resize',u(ha.shield(this,this),100)),h.subscribe(['sidebar/initialized','sidebar/show','sidebar/hide'],ha.shield(this,this),h.SUBSCRIBE_NEW));var oa=ka()?ca:0;if(na)oa=v;this._width=ka()?0:z;fa=true;ha(this,oa);}function ha(la,ma){var na=o.getRight()+o.getLeft();na=na||ma||0;var oa=k.getViewportWithoutScrollbarDimensions().width-na,pa=Math.round(Math.max(0,oa/2-w/2));oa=w+pa-x;oa-=y;oa=Math.max(aa,Math.min(z,oa));if(!isNaN(oa)&&la._width!==oa){la._width=oa;var qa=Math.round(oa/(1+ba)),ra=oa-qa;la.masterChanged(ra);la.detailChaned(qa);if(ka()){var sa=oa+x;ia(function(){if(ea){document.body.className=ea;ea='';}ja(sa+'px');i.removeClass(document.body,"_5262");fa&&p.detailDOMChanged();fa=false;},ea);}}}function ia(la,ma){ma&&i.addClass(document.documentElement,"_5261");t(la);ma&&i.removeClass.curry(document.documentElement,"_5261").defer(1000,false);}function ja(la){m.set(r('pageHead'),'width',la);m.set(r('globalContainer'),'width',la);}function ka(){if(!da)da=i.hasClass(document.body,"_6nw");return da;}j.registerHandler(function(la,ma,na,oa){function pa(qa){return ka()&&l.isWebMessengerURI(n(qa));}if(pa(oa)){ea=ma;return true;}else if(pa(na)){ia(function(){la.className=ma;ja('');},true);return true;}});e.exports=ga;});
__d("endsWith",[],function(a,b,c,d,e,f){function g(h,i){return h.indexOf(i,h.length-i.length)>-1;}e.exports=g;});
__d("MessagesEmoticonView",["Event","function-extensions","DOM","InputSelection","Parent","TextAreaControl","Toggler","Focus","Keys","copyProperties","endsWith","startsWith","EmoticonsList"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('DOM'),i=b('InputSelection'),j=b('Parent'),k=b('TextAreaControl'),l=b('Toggler'),m=b('Focus'),n=b('Keys'),o=b('copyProperties'),p=b('endsWith'),q=b('startsWith'),r=b('EmoticonsList'),s=r.symbols;function t(v,w,x){var y=j.byClass(v,'emoticon');if(!y)return;var z='emoticon_',aa=null;y.className.split(' ').forEach(function(ha){if(q(ha,z))aa=ha.substring(z.length);});if(!s[aa])return;var ba=k.getInstance(w),ca=ba.getValue(),da=s[aa],ea=ca.substring(0,x.start),fa=ca.substring(x.end);if(x.start>0&&!p(ea,' '))da=' '+da;if(!q(fa,' '))da+=' ';var ga=ea+da+fa;x.start+=da.length;x.end=x.start;ba.setValue(ga);i.set(w,x.start,x.end);}function u(v,w){var x={start:0,end:0};function y(){x=i.get(w);}var z=h.find(v,'.uiToggleFlyout');this._subscription=l.subscribe('show',function(aa,ba){if(ba.active&&h.contains(v,ba.active)){i.set(w,x.start,x.end);var ca=h.scry(z,'a.emoticon')[0];m.setWithoutOutline(ca);}});this._eventListeners=[g.listen(z,'click',function(event){l.hide(v);t(event.getTarget(),w,x);}),g.listen(z,'keyup',function(event){if(event.keyCode===n.ESC){l.hide(v);i.set(w,x.start,x.end);}}),g.listen(w,'keyup',y),g.listen(w,'click',y)];}o(u.prototype,{destroy:function(){this._subscription.unsubscribe();while(this._eventListeners.length)this._eventListeners.pop().remove();}});o(u,{create:function(v,w){return new u(v,w);}});e.exports=u;});
__d("TypingDetector",["Event","function-extensions","ArbiterMixin","Input","Run","copyProperties","createObjectFrom","emptyFunction"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('ArbiterMixin'),i=b('Input'),j=b('Run'),k=b('copyProperties'),l=b('createObjectFrom'),m=b('emptyFunction');function n(o){this._input=o;this._ignoreKeys={};}n.INACTIVE=0;n.TYPING=1;n.QUITTING=2;k(n.prototype,h,{_timeout:7000,_currentState:n.INACTIVE,init:function(){this.init=m;this.reset();g.listen(this._input,'keyup',this._update.bind(this));j.onUnload(this._onunload.bind(this));},reset:function(){clearTimeout(this._checkTimer);this._checkTimer=null;this._lastKeystrokeAt=null;this._currentState=n.INACTIVE;},setIgnoreKeys:function(o){this._ignoreKeys=l(o);},_onunload:function(){if(this._currentState==n.TYPING)this._transition(n.QUITTING);},_update:function(event){var o=g.getKeyCode(event),p=this._currentState;if(!this._ignoreKeys[o])if(i.getValue(this._input).trim().length===0){if(p==n.TYPING)this._transition(n.INACTIVE);}else if(p==n.TYPING){this._recordKeystroke();}else if(p==n.INACTIVE){this._transition(n.TYPING);this._recordKeystroke();}},_transition:function(o){this.reset();this._currentState=o;this.inform('change',o);},_recordKeystroke:function(){this._lastKeystrokeTime=Date.now();if(!this._checkTimer)this._checkTimer=this._checkTyping.bind(this).defer(this._timeout);},_checkTyping:function(){var o=this._lastKeystrokeTime+this._timeout,p=Date.now();if(p>o){this._transition(n.INACTIVE);}else{clearTimeout(this._checkTimer);this._checkTimer=this._checkTyping.bind(this).defer(o-p+10);}}});e.exports=n;});
__d("MercuryTypingReceiver",["Arbiter","ChannelConstants","MercuryActionTypeConstants","MercuryParticipants","MercuryPayloadSource","MercuryServerRequests","MercuryThreads","TypingDetector","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('MercuryActionTypeConstants'),j=b('MercuryParticipants'),k=b('MercuryPayloadSource'),l=b('MercuryServerRequests').get(),m=b('MercuryThreads').get(),n=b('TypingDetector'),o=b('setTimeoutAcrossTransitions'),p,q={},r=30000,s=new g();function t(y){var z=q[y]||{},aa=Object.keys(z);aa.sort(function(ba,ca){return z[ba]-z[ca];});return aa;}function u(){p=null;var y=Date.now(),z={},aa=false;for(var ba in q){var ca=false;for(var da in q[ba]||{})if(q[ba][da]<y-r){delete q[ba][da];ca=true;}else aa=true;if(ca)z[ba]=t(ba);}for(var ea in z){s.inform('state-changed',z);break;}if(aa)p=o(u,3000);}function v(y,z){if(y in q)if(z in q[y]){delete q[y][z];w(y);}}function w(y){var z={};z[y]=t(y);s.inform('state-changed',z);}function x(y){if(y.thread)return l.getClientThreadIDNow(y.thread);if(y.type==='typ')return m.getThreadIdForUser(y.from);return null;}g.subscribe([h.getArbiterType('typ'),h.getArbiterType('ttyp')],function(y,z){var aa=z.obj,ba=x(aa);if(ba){var ca=j.getIDForUser(aa.from);if(aa.st==n.TYPING){q[ba]=q[ba]||{};var da=q[ba][ca];q[ba][ca]=Date.now();if(!p)p=o(u,3000);!da&&w(ba);}else if(aa.st==n.INACTIVE)v(ba,ca);}});l.subscribe('update-typing-state',function(y,z){var aa=z.payload_source;if(aa!=k.CLIENT_CHANNEL_MESSAGE)return;var ba=z.actions;if(!ba||!ba.length)return;var ca=i.USER_GENERATED_MESSAGE;ba.forEach(function(da){if(da.action_type==ca&&da.author!=j.user)v(da.thread_id,da.author);});});e.exports=s;});
__d("formatUnixTimestamp",["formatDate"],function(a,b,c,d,e,f){var g=b('formatDate');function h(i,j,k){return g(new Date(i*1000),j,k);}e.exports=h;});
__d("MercuryIndicatorController",["ArbiterMixin","DOM","MercuryActionTypeConstants","MercuryConfig","MercuryDelayedRoger","MercuryMessageSourceTags","MercuryParticipants","MercuryRoger","MercuryThreads","MercuryTypingReceiver","arrayContains","copyProperties","formatUnixTimestamp","removeFromArray","tx"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('DOM'),i=b('MercuryActionTypeConstants'),j=b('MercuryConfig'),k=b('MercuryDelayedRoger'),l=b('MercuryMessageSourceTags'),m=b('MercuryParticipants'),n=b('MercuryRoger'),o=b('MercuryThreads').get(),p=b('MercuryTypingReceiver'),q=b('arrayContains'),r=b('copyProperties'),s=b('formatUnixTimestamp'),t=b('removeFromArray'),u=b('tx'),v=[];function w(x){this._threadID=x;this._canonicalUser=o.getCanonicalUserInThread(x);v.push(this);}r(w.prototype,g,{destroy:function(){t(v,this);},setLastMessage:function(x){this._lastMsg=x;this._handleStateChange();},_informStateChanged:function(x){if(x.activity=='none'&&this._currentActivity=='none')return;if(this._lastMsg&&m.isAuthor(this._lastMsg.author))x.self_authored=true;this._currentActivity=x.activity;this.inform('state-changed',x);},_notifySentFrom:function(){var x,y,z=this._lastMsg.location_text,aa=this._lastMsg.source_tags||[];if(z){x=u._("Sent from {location}",{location:z});y='sentFromMobile';}else if(q(aa,l.MESSENGER)){x=h.create('a',{href:'/mobile/messenger','class':'fcg',target:'_blank'},"Sent from Messenger");y='sentFromMobile';}else if(q(aa,l.MOBILE)){x=h.create('a',{href:'/mobile','class':'fcg',target:'_blank'},"Sent from Mobile");y='sentFromMobile';}else if(q(aa,l.EMAIL)){x="Sent from email";y='sentFromEmail';}else{this._informStateChanged({activity:'none'});return;}this._informStateChanged({activity:y,text:x});},_notifySeenTimestamp:function(x){var y=n.getSeenTimestamp(this._threadID,x[0])*.001,z=Date.now()*.001,aa=j['24h_times']?'H:i':'g:i A';if(y<z-518400){aa='M j';}else if(y<z-86400)aa='D '+aa;var ba=s(y,aa);this._informStateChanged({activity:'seen-timestamp',text:u._("Seen {timestamp}",{timestamp:ba})});},_notifySeenBy:function(x){var y=this._lastMsg,z=true;m.getMulti(x,function(aa){z=false;if(this._lastMsg!=y)return;var ba=o.getThreadMetaNow(this._threadID),ca=ba?ba.participants.length:0,da=x.length+(y.author!=m.user),ea,fa=false;if(ca>2&&da>=ca-1){ea="Seen by everyone";}else if(x.length==1){ea=u._("Seen by {user}",{user:aa[x[0]].short_name});}else if(x.length==2){ea=u._("Seen by {user1}, {user2}",{user1:aa[x[0]].short_name,user2:aa[x[1]].short_name});}else if(x.length==3){ea=u._("Seen by {user1}, {user2}, {user3}",{user1:aa[x[0]].short_name,user2:aa[x[1]].short_name,user3:aa[x[2]].short_name});}else if(x.length>3){var ga=Object.keys(aa).length-2,ha=u._("{num} more",{num:ga}),ia=h.create('span',{className:'more'},ha);ea=h.tx._("Seen by {user1}, {user2}, {=num more link}",{user1:aa[x[0]].short_name,user2:aa[x[1]].short_name,'=num more link':ia});fa=true;}this._informStateChanged({activity:'seen-by',text:ea,seenBy:x,tooltip:fa});}.bind(this));z&&this._informStateChanged({activity:'none'});},_notifyTyping:function(x){var y=this._lastMsg,z=true;m.getMulti(x,function(aa){z=false;if(this._lastMsg!=y)return;if(this._canonicalUser||j.ChatMultiTypGK){var ba=o.getThreadMetaNow(this._threadID),ca=ba?ba.participants.length:0,da,ea=false;if(ca>2&&x.length>=ca-1){da="Everyone is typing...";}else if(x.length==1){da=u._("{name} is typing...",{name:aa[x[0]].short_name});}else if(x.length==2){da=u._("{user1} and {user2} are typing...",{user1:aa[x[0]].short_name,user2:aa[x[1]].short_name});}else if(x.length==3){da=u._("{user1}, {user2}, and {user3} are typing...",{user1:aa[x[0]].short_name,user2:aa[x[1]].short_name,user3:aa[x[2]].short_name});}else if(x.length>3){var fa=Object.keys(aa).length-2,ga=u._("{num} more",{num:fa}),ha=h.create('a',{href:'#'},ga);da=h.tx._("{user1}, {user2}, and {=num more link} are typing...",{user1:aa[x[0]].short_name,user2:aa[x[1]].short_name,'=num more link':ha});ea=true;}this._informStateChanged({activity:'typing',text:da,typing:x,tooltip:ea});}}.bind(this));z&&this._informStateChanged({activity:'none'});},_handleStateChange:function(){var x=i.LOG_MESSAGE;if(!this._lastMsg||this._lastMsg.action_type==x){this._informStateChanged({activity:'none'});return;}if(this._typing&&this._typing.length){this._notifyTyping(this._typing);return;}if(this._canonicalUser&&this._lastMsg.author!=m.user){this._notifySentFrom();return;}var y=k.getSeenBy(this._threadID,true);if(y.length)if(this._canonicalUser){this._notifySeenTimestamp(y);return;}else{this._notifySeenBy(y);return;}this._informStateChanged({activity:'none'});}});p.subscribe('state-changed',function(x,y){v.forEach(function(z){var aa=y[z._threadID];if(aa!==undefined){z._typing=aa;z._handleStateChange();}});});k.subscribe('state-changed',function(x,y){v.forEach(function(z){y[z._threadID]&&z._handleStateChange();});});e.exports=w;});
__d("MercuryLastMessageIndicator",["CSS","MercuryIndicatorController","DOM","MercuryParticipants","Tooltip","copyProperties","csx","cx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('MercuryIndicatorController'),i=b('DOM'),j=b('MercuryParticipants'),k=b('Tooltip'),l=b('copyProperties'),m=b('csx'),n=b('cx');function o(p,q,r,s){this._lastMessageIndicator=q;this._hideTyping=r||false;this._messagesView=s;this._controller=new h(p);this._subscription=this._controller.subscribe('state-changed',this._handleStateChanged.bind(this));}l(o.prototype,{destroy:function(){this._setClass(null);this._subscription.unsubscribe();this._controller.destroy();},setLastMessage:function(p){this._controller.setLastMessage(p);},_handleStateChanged:function(p,q){var r=this._messagesView.isScrolledToBottom();this._rerender(q);r&&this._messagesView.scrollToBottom();},_rerender:function(p){if(p.activity=='none'){this._setClass(null);return;}if(this._hideTyping&&p.activity=='typing'){this._setClass(null);return;}g.conditionClass(this._lastMessageIndicator,"_510e",p.self_authored);var q=i.find(this._lastMessageIndicator,"._510f");if(p.text){i.setContent(q,p.text);}else i.empty(q);if(p.activity.substring(0,4)=='seen'){this._setClass('seen');if(p.activity=='seen-by'&&p.tooltip)j.getMulti(p.seenBy,function(r){var s=i.create('div'),t=0;for(var u in r)if(t++>=2){var v=i.create('div');i.setContent(v,r[u].name);i.appendContent(s,v);}var w=i.find(this._lastMessageIndicator,'span.more');k.set(w,s,'above','center');}.bind(this));}else this._setClass(p.activity);},_setClass:function(p){if(this._lastClass===p)return;this._lastClass&&g.removeClass(this._lastMessageIndicator,this._lastClass);p&&g.addClass(this._lastMessageIndicator,p);this._lastClass=p;}});e.exports=o;});
__d("MercuryStateCheck",["Arbiter","ChannelConstants","MercuryFolders","MessagingTag","MercuryServerRequests","URI","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('MercuryFolders'),j=b('MessagingTag'),k=b('MercuryServerRequests').get(),l=b('URI'),m=b('copyProperties'),n=m(new g(),{initialize:function(){g.subscribe(h.ON_INVALID_HISTORY,o);d(['ChannelConnection'],function(p){p.subscribe(p.CONNECTED,function(q,r){if(!r.init)o();});});}});function o(){var p;if(l.getRequestURI().getPath().search(/messages/)!==-1){p=i.getSupportedFolders();}else p=[j.INBOX];k.fetchMissedMessages(p);}n.initialize();e.exports=n;});
__d("ReportResolutionActionList",["AsyncRequest","URI","md5"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('URI'),i=b('md5'),j={_cache:{},isInSocialReportHoldoutGroup:function(k,l){if(!l)return false;var m=i(k.toString());m=m.substring(l.start,l.start+l.length);m=parseInt(m,16);var n=l.buckets;return (((m%n)+n)%n)<l.limit;},fromServerOrCache:function(k,l,m,n){if(k in j._cache){n(j._cache[k]);return;}var o=h('/ajax/report/social_resolution/proxy/').setQueryData({attachment_fbid:k,photo_fbid:l,sender_id:m});new g(o).setHandler(function(p){var q=p.payload;if(q){j._cache[k]=q;n(q);}}).send();}};e.exports=j;});
__d("MercuryAttachmentRenderer",["JSXDOM","MercuryAttachmentTemplates","MercuryAttachmentAudioClip","CSS","MercuryConstants","ContextualDialog","ContextualLayerHideOnScroll","DOM","HoverFlyout","MercuryAttachment","MercuryAttachmentType","MercuryMessages","MercuryParticipants","React","ReportResolutionActionList","Style","URI","UserAgent","cx","tx"],function(a,b,c,d,e,f){var g=b('JSXDOM'),h=b('MercuryAttachmentTemplates'),i=b('MercuryAttachmentAudioClip'),j=b('CSS'),k=b('MercuryConstants'),l=b('ContextualDialog'),m=b('ContextualLayerHideOnScroll'),n=b('DOM'),o=b('HoverFlyout'),p=b('MercuryAttachment'),q=b('MercuryAttachmentType'),r=b('MercuryMessages').get(),s=b('MercuryParticipants'),t=b('React'),u=b('ReportResolutionActionList'),v=b('Style'),w=b('URI'),x=b('UserAgent'),y=b('cx'),z=b('tx'),aa=x.ie()<=8;function ba(ea,fa){var ga=h[fa].build().setNodeContent('filename',ea.name),ha=ga.getNode('link');ha.setAttribute('href',ea.url);ea.rel&&ha.setAttribute('rel',ea.rel);j.addClass(ga.getRoot(),p.getAttachIconClass(ea.icon_type));return ga;}function ca(ea,fa){var ga=h[fa].build().setNodeContent('filename',ea.name);j.addClass(ga.getRoot(),p.getAttachIconClass(ea.icon_type));return ga;}var da={renderAttachment:function(ea,fa,ga,ha,ia){var ja=100,ka=ea?160:400,la=fa.attach_type,ma=null,na=null,oa=k.MercurySupportedShareType;if(la==q.ERROR)ma=da.renderError(fa);if(!ea&&la==q.SHARE&&fa.share_xhp)na=da.renderShareXHP(fa,ga.id);if(!na&&la==q.SHARE){var pa=fa.share_data_type;switch(pa){case oa.FB_PHOTO:na=da.renderPreview(fa,ga,ha,ia);break;case oa.FB_VIDEO:na=da.renderVideoThumb(fa);break;case oa.FB_MUSIC_ALBUM:case oa.FB_SONG:na=da.renderMusic(fa);break;case oa.EXTERNAL:case oa.FB_TEMPLATE:case oa.FB_COUPON:case oa.FB_SOCIAL_REPORT_PHOTO:na=da.renderExternalLink(fa);break;case oa.FB_SUPER_SECRET_FEATURE:na=da.renderShareXHP(fa,ga.id);break;default:if(fa.name)na=da.renderShareLink(fa,ga&&ga.id,ea);break;}}if(!na&&fa.preview_loading)na=da.renderPreview(null);if(!na&&fa.preview_url)na=da.renderPreview(fa,ga,ha,ia);if(!na&&la==q.FILE)if(fa.metadata&&fa.metadata.type==k.MercuryAttachmentAudioClip){na=n.create('div');var qa=da.renderAudioClip(fa,ga.message_id,ja,ka);t.renderComponent(qa,na);}else na=ea?da.renderFileLink(fa):da.renderExtendedFileLink(fa);return [ma,na];},renderError:function(ea){var fa=h[':fb:mercury:attachment:error'].build();n.appendContent(fa.getNode('error'),ea.error_msg);return fa.getRoot();},renderExternalLink:function(ea){var fa=h[':fb:mercury:attachment:external-link'].build().setNodeContent('name',ea.name);ea.base_url&&fa.setNodeContent('shortLink',ea.base_url);var ga=fa.getNode('preview'),ha=fa.getNode('image-link');ha.setAttribute('href',ea.url);ea.rel&&ha.setAttribute('rel',ea.rel);if(ea.preview_url){var ia=fa.getNode('preview-image');ia.setAttribute('src',ea.preview_url);j.addClass(ga,ea.preview_class);j.show(ia);}else{j.addClass(fa.getRoot(),'noMedia');j.hide(ga);}fa.getNode('name').setAttribute('href',ea.url);d(['LinkshimHandler'],function(ja){ja.setUpLinkshimHandling(fa.getNode('name'));ja.setUpLinkshimHandling(fa.getNode('image-link'));});if(ea.rel)fa.getNode('name').setAttribute('rel',ea.rel);return fa.getRoot();},renderFileLink:function(ea){var fa=null;if(ea.url===''){fa=':fb:mercury:attachment:file-name';return ca(ea,fa).getRoot();}else{fa=':fb:mercury:attachment:file-link';return ba(ea,fa).getRoot();}},renderAudioClip:function(ea,fa,ga,ha){var ia=ea.metadata.duration/1000,ja=r.getMessagesFromIDs([fa])[0],ka=ja.author!=s.user,la=200;if(ga&&ha)if(ia<5){la=ga;}else la=(1-Math.pow(10,(ia-5)/-30))*(ha-ga)+ga;return i({src:ea.url,duration:ea.metadata.duration/1000,showHelp:ka,width:la});},renderExtendedFileLink:function(ea){var fa=null;if(ea.url===''){fa=':fb:mercury:attachment:file-name';return ca(ea,fa).getRoot();}var fa=':fb:mercury:attachment:extended-file-link',ga=ba(ea,fa);if(ea.open_url){var ha=ga.getNode('openLinkContainer');j.show(ha);var ia=ga.getNode('openFile');ia.setAttribute('href',ea.open_url);}var ja=ga.getNode('downloadFile');ja.setAttribute('href',ea.url);ea.rel&&ja.setAttribute('rel',ea.rel);return ga.getRoot();},renderMusic:function(ea){var fa=h[':fb:mercury:attachment:music'].build().setNodeContent('filename',ea.name),ga=fa.getNode('link');ga.setAttribute('href',ea.url);ga.setAttribute('target','_blank');ea.rel&&ga.setAttribute('rel',ea.rel);var ha=fa.getNode('image-link');ha.setAttribute('href',ea.url);ea.rel&&ha.setAttribute('rel',ea.rel);var ia=fa.getNode('preview-image');ia.setAttribute('src',ea.preview_url);j.show(ia);j.addClass(fa.getNode('icon_link'),'MercuryMusicIcon');return fa.getRoot();},renderPreview:function(ea,fa,ga,ha){var ia=h[':fb:mercury:attachment:preview'].build(),ja=ia.getNode('image-link');if(ea){ea.url&&ja.setAttribute('href',ea.url);ea.rel&&ja.setAttribute('rel',ea.rel);var ka;if(ea.metadata&&ea.metadata.fbid){ka=w('/ajax/mercury/attachments/photo.php').addQueryData({fbid:ea.metadata.fbid,mode:ha,width:ga,height:ga}).toString();}else ka=w(ea.preview_url).addQueryData({mode:ha,width:ga,height:ga}).toString();var la=ia.getNode('preview-image');if(ka){la.setAttribute('src',ka);if(!aa)v.set(ja,'backgroundImage','url('+ka+')');}if(fa)this.renderReportRespondLink(ia.getRoot(),ea,fa.message_id);}else j.addClass(ja,"_ksa");return ia.getRoot();},renderShareLink:function(ea,fa,ga){var ha=h[':fb:mercury:attachment:share-link'].build().setNodeContent('name',ea.name),ia=ha.getNode('link');ia.setAttribute('href',ea.url);ea.rel&&ia.setAttribute('rel',ea.rel);if(ea.share_xhp&&ga){var ja=g.div({className:"_51wu"},da.renderShareXHP(ea,fa)),ka=new l({position:'above',width:400,alignment:'right',addedBehaviors:[m]},ja);new o(ka,ia,100,150);}return ha.getRoot();},renderVideoThumb:function(ea){var fa=h[':fb:mercury:attachment:video-thumb'].build(),ga=fa.getNode('thumb');ga.setAttribute('href',ea.url);ga.setAttribute('rel',ea.rel);var ha=n.find(fa.getRoot(),'img');ha.src=ea.preview_url;return fa.getRoot();},renderShareXHP:function(ea,fa){var ga=n.create('div');if(ea){var ha=ea.share_xhp;n.appendContent(ga,ha);this.renderReportRespondLink(ga,ea,fa);}return ga;},renderReportRespondLink:function(ea,fa,ga){if(!fa.is_social_report_attachment)return null;switch(fa.share_data_type){case k.MercurySupportedShareType.FB_PHOTO:break;case k.MercurySupportedShareType.FB_SOCIAL_REPORT_PHOTO:return null;default:return null;}var ha=null;if(ga)ha=r.getMessagesFromIDs([ga])[0];if(!ha)return null;if(ha.author===s.user)return null;var ia=s.getUserID(ha.author),ja=u.isInSocialReportHoldoutGroup(ia,k.SocialReportHoldout);if(ja){u.fromServerOrCache(fa.attach_id,fa.shared_object_id,ia,function(la){n.appendContent(ea,la);});return null;}var ka=null;s.get(ha.author,function(la){ka=n.create('a',{rel:'dialog-post',className:"_z6l",id:'respond-link',ajaxify:w('/ajax/report/social_resolution/photo/').setQueryData({attachment_fbid:fa.attach_id,photo_fbid:fa.shared_object_id,sender_id:s.getUserID(la.id)}).toString()});n.setContent(ka,z._("Respond to {name}'s request",{name:la.name}));n.appendContent(ea,ka);});}};e.exports=da;});
__d("URLScraper",["ArbiterMixin","DataStore","Event","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('DataStore'),i=b('Event'),j=b('copyProperties'),k='scraperLastPermissiveMatch';function l(ma){this.input=ma;this.enable();}j(l.prototype,g,{reset:function(){h.set(this.input,k,null);},enable:function(){if(this.events)return;var ma=function(na){setTimeout(this.check.bind(this,na),30);};this.events=i.listen(this.input,{paste:ma.bind(this,false),keydown:ma.bind(this,true)});},disable:function(){if(!this.events)return;for(var event in this.events)this.events[event].remove();this.events=null;},check:function(ma){var na=this.input.value;if(ma&&l.trigger(na))return;var oa=l.match(na),pa=l.permissiveMatch(na);if(pa&&(pa!=h.get(this.input,k))){h.set(this.input,k,pa);this.inform('match',{url:oa||pa,alt_url:pa});}}});var m='!"#%&\'()*,-./:;<>?@[\\]^_`{|}',n='\u2000-\u206F\u00ab\u00bb\uff08\uff09',o='(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])',p='(?:(?:ht|f)tps?)://',q='(?:(?:'+o+'[.]){3}'+o+')',r='(?:\\b)www\\d{0,3}[.]',s='[^\\s'+m+n+']',t='(?:(?:[.:\\-_%@]|'+s+')*'+s+')',u='(?:[.][a-z]{2,4})',v='(?::\\d+){0,1}',w='(?=[/?#])',x='(?:'+'(?:'+p+t+v+')|'+'(?:'+q+v+')|'+'(?:'+r+t+u+v+')|'+'(?:'+t+u+v+w+')'+')',y='[/#?]',z='\\([^\\s()<>]+\\)',aa='[^\\s()<>?#]+',ba='[^\\s'+m+n+']',ca=new RegExp(x,'im'),da='(?:'+'(?:'+y+')'+'(?:'+'(?:'+z+'|'+aa+')*'+')*'+')*',ea=new RegExp('('+'(?:'+x+')'+'(?:'+da+')'+')','im'),fa=new RegExp('('+'(?:'+p+t+v+')|'+'(?:'+r+t+u+v+')'+')'),ga=/[\s'";]/,ha=new RegExp(y,'im'),ia=new RegExp('[\\s!"#%&\'()*,-./:;<>?@[\\]^_`{|}\u00ab\u00bb\u2000-\u206F\uff08\uff09]','im'),ja=new RegExp('[\\s()<>?#]','im'),ka=new RegExp('\\s()<>'),la=function(ma){if(ma&&ma.indexOf('@')!=-1){return (fa.exec(ma))?ma:null;}else return ma;};j(l,{match:function(ma){var na=ca.exec(ma);if(!na)return null;var oa=ma.substr(na.index+na[0].length);if(oa.length===0||!(ha.test(oa[0])))return la(na[0]);var pa=0,qa=0,ra=1,sa=qa;for(var ta=1;ta<oa.length;ta++){var ua=oa[ta];if(sa===qa){if(ua==='('){sa=ra;}else if(ha.test(ua)||!(ia.test(ua))){pa=ta;}else if(ja.test(ua))break;}else if(ua===')'){sa=qa;pa=ta;}else if(ka.test(ua))break;}return la(na[0]+oa.substring(0,pa+1));},permissiveMatch:function(ma){return l.matchToPattern(ma,ea);},matchToPattern:function(ma,na){var oa=(na.exec(ma)||[])[1]||null;return la(oa);},trigger:function(ma){return !ga.test(ma.charAt(ma.length-1));}});e.exports=l;});
__d("htmlHyperlink",["Env","htmlize","UntrustedLink","URI","URLScraper"],function(a,b,c,d,e,f){var g=b('Env'),h=b('htmlize'),i=b('UntrustedLink'),j=b('URI'),k=b('URLScraper');function l(m,n,o,p){if(typeof m==='undefined'||!m.toString)return '';if(typeof n!=='function')n=h;if(typeof o!=='function')o=h;var m=m.toString(),q=[],r;while((r=k.match(m))){var s=m.indexOf(r);if(s>=0)q.push(n(m.substring(0,s)));var t=o(r),u=r.replace(/"/g,'%22');if(!(/^[a-z][a-z0-9\-+.]+:\/\//i.test(r)))u='http://'+u;if(j.isValidURI(u)){q.push('<a target="_blank" rel="nofollow" href="'+u+'"');if(p&&!j(u).isFacebookURI()){a.UntrustedLink=i;q.push(' onmousedown="UntrustedLink.bootstrap(this, \''+g.lhsh+'\', event)"');}q.push('>'+t+'</a>');}else q.push(t);m=m.substring(s+r.length);}m&&q.push(n(m));return q.join('');}e.exports=l;});
__d("MercuryMessageRenderer",["MercuryAttachmentRenderer","CSS","DOM","DOMQuery","HTML","MercuryEmoji","MercuryLogMessageType","MercuryParticipants","Tooltip","cx","htmlHyperlink","tx"],function(a,b,c,d,e,f){var g=b('MercuryAttachmentRenderer'),h=b('CSS'),i=b('DOM'),j=b('DOMQuery'),k=b('HTML'),l=b('MercuryEmoji'),m=b('MercuryLogMessageType'),n=b('MercuryParticipants'),o=b('Tooltip'),p=b('cx'),q=b('htmlHyperlink'),r=b('tx'),s=["January","February","March","April","May","June","July","August","September","October","November","December"],t={renderDate:function(ma){var na=new Date();na.setHours(0);na.setMinutes(0);na.setSeconds(0);na.setMilliseconds(0);var oa=24*60*60*1000,pa=na.getTime()-ma.getTime();if(pa<=0){return "Today";}else if(pa<oa)return "Yesterday";var qa=s[ma.getMonth()],ra=ma.getDate(),sa=ma.getFullYear();if(sa!=na.getFullYear()){return r._("{month} {date}, {year}",{month:qa,date:ra,year:sa});}else return r._("{month} {date}",{month:qa,date:ra});},renderTooltipFlyout:function(ma,na){na.forEach(function(oa){var pa=i.create('div');i.setContent(pa,oa.name);i.appendContent(ma,pa);});},renderLogMessage:function(ma,na,oa,pa){w(ma,pa);x(na,pa);y(oa,pa);},formatMessageBody:function(ma,na,oa){var pa=(ma||'').replace(/\s+$/,'');if(!na)return v(pa,false,oa);var qa=Object.keys(na).map(function(ta){return window.parseInt(ta);}).sort(function(ta,ua){return ta-ua;}),ra=[],sa=0;qa.forEach(function(ta){var ua=pa.slice(sa,ta);if(ua)ra.push(v(ua,false,oa));sa=ta+na[ta].length;var va=pa.slice(ta,sa);if(va)ra.push(v(va,true,oa));});if(sa<pa.length)ra.push(v(pa.slice(sa),false,oa));return ra.length===0?null:ra.length===1?ra[0]:i.create('span',{},ra);}};function u(ma,na){var oa=ma.replace(/\r\n?/g,'\n').split(/\n{2,}/),pa=[];for(var qa=0;qa<oa.length;qa++){var ra=oa[qa];if(ra.length){pa.push('<p>');pa.push(na(ra));pa.push('</p>');}}return pa.join('');}function v(ma,na,oa){var pa=null;if(ma.length===0&&!na)return pa;function qa(ra){return q(ra,l.htmlEmojiAndEmote,null,true);}pa=oa?u(ma,qa):qa(ma);if(na)return i.create('span',{className:'highlight'},k(pa));return k(pa);}function w(ma,na){var oa='',pa;switch(na.log_message_type){case m.JOINABLE_CREATED:case m.JOINABLE_JOINED:case m.SUBSCRIBE:oa='mercurySubscribeIcon';break;case m.UNSUBSCRIBE:oa='mercuryUnsubscribeIcon';break;case m.THREAD_NAME:oa='mercuryThreadNameIcon';break;case m.THREAD_IMAGE:oa='mercuryThreadImageIcon';break;case m.VIDEO_CALL:pa=na.log_message_data.answered;if(pa||la(na)){oa='mercuryVideoCallIcon';}else oa='mercuryMissedVideoCallIcon';break;case m.PHONE_CALL:pa=na.log_message_data.answered;if(pa){oa='mercuryPhoneCallIcon';}else oa='mercuryMissedPhoneCallIcon';break;case m.SERVER_ERROR:oa='mercuryErrorIcon';break;}h.addClass(ma,oa);}function x(ma,na){switch(na.log_message_type){case m.JOINABLE_CREATED:da(ma,na);break;case m.JOINABLE_JOINED:ea(ma,na);break;case m.SUBSCRIBE:ia(ma,na);break;case m.UNSUBSCRIBE:ja(ma,na);break;case m.VIDEO_CALL:if(la(na)){z(ma,na);}else ba(ma,na);break;case m.PHONE_CALL:aa(ma,na);break;case m.THREAD_NAME:ca(ma,na);break;case m.THREAD_IMAGE:fa(ma,na);break;case m.SERVER_ERROR:ka(ma,na);break;}}function y(ma,na){var oa=na.log_message_type;if(oa==m.THREAD_IMAGE){var pa=na.log_message_data.image;if(pa){var qa=g.renderPreview(pa.preview_url?pa:null);i.setContent(ma,qa);h.addClass(qa,"_z6a");h.show(ma);}}}var z=function(ma,na){n.get(na.author,function(oa){var pa=i.create('span',{className:"_511e"},oa.short_name),qa;switch(na.log_message_data.event_name){case 'installing':qa=i.tx._("{firstname} is setting up video calling...",{firstname:pa});break;case 'installed':qa=i.tx._("{firstname} finished setting up video calling.",{firstname:pa});break;case 'install_canceled':qa=i.tx._("You canceled the video calling installation. ",{firstname:pa});break;}if(qa)i.setContent(ma,qa);});},aa=function(ma,na){var oa=na.log_message_data.caller,pa=na.log_message_data.callee,qa=[oa,pa];n.getMulti(qa,function(ra){if(oa==n.user){var sa=i.create('span',{className:"_511e"},ra[pa].short_name),ta;if(na.log_message_data.answered){ta=i.tx._("You called {firstname}.",{firstname:sa});}else ta=i.tx._("{firstname} missed a call from you. ",{firstname:sa});}else{var ua=i.create('span',{className:"_511e"},ra[oa].short_name);if(na.log_message_data.answered){ta=i.tx._("{firstname} called you.",{firstname:ua});}else ta=i.tx._("You missed a call from {firstname}. ",{firstname:ua});}i.setContent(ma,ta);});},ba=function(ma,na){var oa=na.log_message_data.caller,pa=na.log_message_data.callee,qa=[oa,pa];n.getMulti(qa,function(ra){if(oa==n.user){var sa=i.create('span',{className:"_511e"},ra[pa].short_name),ta;if(na.log_message_data.answered){ta=i.tx._("You called {firstname}.",{firstname:sa});}else ta=i.tx._("{firstname} missed a call from you. ",{firstname:sa});}else{var ua=i.create('span',{className:"_511e"},ra[oa].short_name);if(na.log_message_data.answered){ta=i.tx._("{firstname} called you.",{firstname:ua});}else ta=i.tx._("You missed a call from {firstname}. ",{firstname:ua});}i.setContent(ma,ta);});},ca=function(ma,na){var oa=na.log_message_data.name,pa=i.create('b',{},oa);if(na.author==n.user){if(oa){i.setContent(ma,i.tx._("You named the conversation: {name}.",{name:pa}));}else i.setContent(ma,i.tx._("You removed the conversation name."));}else n.get(na.author,function(qa){var ra,sa=ga(qa);if(oa){ra=i.tx._("{actor} named the conversation: {name}.",{actor:sa,name:pa});}else ra=i.tx._("{actor} removed the conversation name.",{actor:sa});i.setContent(ma,ra);});},da=function(ma,na){if(na.author==n.user){i.setContent(ma,i.tx._("You shared this conversation to your timeline. Others can join at this time."));}else n.get(na.author,function(oa){var pa=ga(oa);i.setContent(ma,i.tx._("{actor} shared this conversation to their timeline. Others can join at this time.",{actor:pa}));});},ea=function(ma,na){var oa=na.log_message_data.joined_participant;if(oa==n.user){i.setContent(ma,i.tx._("You joined the conversation. Others can join at this time."));}else n.get(oa,function(pa){var qa=ga(pa);i.setContent(ma,i.tx._("{actor} joined the conversation.",{actor:qa}));});},fa=function(ma,na){if(na.author==n.user){if(na.log_message_data.image){i.setContent(ma,i.tx._("You changed the conversation picture."));}else i.setContent(ma,i.tx._("You removed the conversation picture."));}else n.get(na.author,function(oa){var pa=ga(oa),qa;if(na.log_message_data.image){qa=i.tx._("{actor} changed the conversation picture.",{actor:pa});}else qa=i.tx._("{actor} removed the conversation picture.",{actor:pa});i.setContent(ma,qa);});},ga=function(ma){if(ma.href)return i.create('a',{href:ma.href,className:"_511e"},ma.name);return ma.name;},ha=function(ma){var na=ma.indexOf(n.user);if(na>0)return ma.splice(na,1).concat(ma);return ma;},ia=function(ma,na){var oa=ha(na.log_message_data.added_participants),pa=null,qa;if(oa.length==1){pa=[na.author,oa[0]];n.getMulti(pa,function(ra){if(na.author==n.user){qa=i.tx._("You added {subscriber1}.",{subscriber1:ga(ra[oa[0]])});}else if(oa[0]==n.user){qa=i.tx._("{actor} added you.",{actor:ga(ra[na.author])});}else qa=i.tx._("{actor} added {subscriber1}.",{actor:ga(ra[na.author]),subscriber1:ga(ra[oa[0]])});i.setContent(ma,qa);});}else if(oa.length==2){pa=[na.author].concat(oa);n.getMulti(pa,function(ra){if(na.author==n.user){qa=i.tx._("You added {subscriber1} and {subscriber2}.",{subscriber1:ga(ra[oa[0]]),subscriber2:ga(ra[oa[1]])});}else if(oa[0]==n.user){qa=i.tx._("{actor} added you and {subscriber2}.",{actor:ga(ra[na.author]),subscriber2:ga(ra[oa[1]])});}else qa=i.tx._("{actor} added {subscriber1} and {subscriber2}.",{actor:ga(ra[na.author]),subscriber1:ga(ra[oa[0]]),subscriber2:ga(ra[oa[1]])});i.setContent(ma,qa);});}else if(oa.length==3){pa=[na.author].concat(oa);n.getMulti(pa,function(ra){if(na.author==n.user){qa=i.tx._("You added {subscriber1}, {subscriber2} and {subscriber3}.",{subscriber1:ga(ra[oa[0]]),subscriber2:ga(ra[oa[1]]),subscriber3:ga(ra[oa[2]])});}else if(oa[0]==n.user){qa=i.tx._("{actor} added you, {subscriber2} and {subscriber3}.",{actor:ga(ra[na.author]),subscriber2:ga(ra[oa[1]]),subscriber3:ga(ra[oa[2]])});}else qa=i.tx._("{actor} added {subscriber1}, {subscriber2} and {subscriber3}.",{actor:ga(ra[na.author]),subscriber1:ga(ra[oa[0]]),subscriber2:ga(ra[oa[1]]),subscriber3:ga(ra[oa[2]])});i.setContent(ma,qa);});}else{pa=[na.author].concat(oa);n.getMulti(pa,function(ra){var sa=i.tx._("{num} more",{num:oa.length-2}),ta=i.create('span',{className:'more'},sa),ua=i.create('div');t.renderTooltipFlyout(ua,oa.slice(2).map(function(wa){return ra[wa];}));if(na.author==n.user){qa=i.tx._("You added {subscriber1}, {subscriber2} and {more_people}.",{subscriber1:ga(ra[oa[0]]),subscriber2:ga(ra[oa[1]]),more_people:ta});}else if(oa[0]==n.user){qa=i.tx._("{actor} added you, {subscriber2} and {more_people}.",{actor:ga(ra[na.author]),subscriber2:ga(ra[oa[1]]),more_people:ta});}else qa=i.tx._("{actor} added {subscriber1}, {subscriber2} and {more_people}.",{actor:ga(ra[na.author]),subscriber1:ga(ra[oa[0]]),subscriber2:ga(ra[oa[1]]),more_people:ta});i.setContent(ma,qa);var va=j.find(ma,'span.more');o.set(va,ua,'above','center');});}},ja=function(ma,na){n.get(na.author,function(oa){var pa;if(na.author==n.user){pa=i.tx._("You left the conversation.");}else pa=i.tx._("{actor} left the conversation.",{actor:ga(oa)});i.setContent(ma,pa);});},ka=function(ma,na){var oa="We were unable to fetch previous messages in this conversation.";i.setContent(ma,oa);},la=function(ma){return ma.log_message_data.event_name==='installing'||ma.log_message_data.event_name==='install_canceled';};e.exports=t;});
__d("MercurySheetPolicy",[],function(a,b,c,d,e,f){var g={canReplaceOpenSheet:function(h,i){if(h.getType()==i.getType())return false;if(h.isPermanent()&&!i.isPermanent())return false;return true;}};e.exports=g;});
__d("MercurySheetView",["Animation","MercurySheetPolicy","CSS","DOM","Style","MercurySheetTemplates","Vector","copyProperties","cx"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('MercurySheetPolicy'),i=b('CSS'),j=b('DOM'),k=b('Style'),l=b('MercurySheetTemplates'),m=b('Vector'),n=b('copyProperties'),o=b('cx'),p=5000,q=function(r,s,t){this._threadID=r;this._rootElement=s;this._tabMainElement=t;this._openSheet=null;};n(q.prototype,{destroy:function(){j.empty(this._rootElement);},_openCommon:function(r,s){if(this._openSheet&&!h.canReplaceOpenSheet(this._openSheet,r))return;this.clear(function(){this._openSheet=r;var t=l[':fb:mercury:tab-sheet:loading'].build().getRoot();j.setContent(this._rootElement,t);i.show(t);i.show(this._rootElement);r.render();if(s){i.addClass(this._tabMainElement,'sheetSlide');i.addClass(this._tabMainElement,"_1sk4");var u=m.getElementDimensions(this._rootElement).y;k.set(this._rootElement,'bottom',u+'px');this._animation=new g(this._rootElement).to('bottom',0).duration(150).ease(g.ease.both).ondone(function(){i.removeClass(this._tabMainElement,'sheetSlide');i.removeClass(this._tabMainElement,"_1sk4");}.bind(this)).go();}if(!r.isPermanent()){var v=p;if(r.getCloseTimeout)v=r.getCloseTimeout();this._sheetCloseHandler=this.close.bind(this,r).defer(v,false);if(r.timeoutCanBeReset)r.setResetTimeoutCallback(this.resetTimeout.bind(this));}}.bind(this));},resetTimeout:function(r,s){clearTimeout(this._sheetCloseHandler);this._sheetCloseHandler=this.close.bind(this,r).defer(s,false);},set:function(r){return this._openCommon(r,false);},open:function(r){return this._openCommon(r,true);},close:function(r,s){if(this._openSheet!=r)return;if(!this._openSheet){s&&s();return;}if(this._animation)this._animation.stop();if(this._sheetCloseHandler){clearTimeout(this._sheetCloseHandler);this._sheetCloseHandler=null;}i.addClass(this._tabMainElement,'sheetSlide');i.addClass(this._tabMainElement,"_1sk4");var t=m.getElementDimensions(this._rootElement).y;this._animation=new g(this._rootElement).to('bottom',t+'px').duration(100).ease(g.ease.begin).ondone(function(){j.empty(this._rootElement);i.hide(this._rootElement);i.removeClass(this._tabMainElement,'sheetSlide');i.removeClass(this._tabMainElement,"_1sk4");this._openSheet=null;s&&s();}.bind(this)).go();},clear:function(r){this.close(this._openSheet,r);}});e.exports=q;});
__d("WeakToken",["Class","CSS","Token","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('CSS'),i=b('Token'),j=b('copyProperties');function k(l,m){this.parent.construct(this,l,m);}g.extend(k,i);j(k.prototype,{createElement:function(){var l=this.parent.createElement(true,'UFIWeakReferenceIcon');h.addClass(l,'uiTokenWeakReference');return l;}});e.exports=k;});
__d("Tokenizer",["Arbiter","ArbiterMixin","CSS","DOM","DOMQuery","DataStore","Event","Focus","Input","Keys","Parent","StickyPlaceholderInput","Style","TextMetrics","Token","UserAgent","WeakToken","copyProperties","createObjectFrom","emptyFunction"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('CSS'),j=b('DOM'),k=b('DOMQuery'),l=b('DataStore'),m=b('Event'),n=b('Focus'),o=b('Input'),p=b('Keys'),q=b('Parent'),r=b('StickyPlaceholderInput'),s=b('Style'),t=b('TextMetrics'),u=b('Token'),v=b('UserAgent'),w=b('WeakToken'),x=b('copyProperties'),y=b('createObjectFrom'),z=b('emptyFunction');function aa(ba,ca){this.element=ba;this.typeahead=ca;this.input=ca.getCore().getElement();l.set(this.element,'Tokenizer',this);}aa.getInstance=function(ba){var ca=q.byClass(ba,'uiTokenizer');return ca?l.get(ca,'Tokenizer'):null;};x(aa.prototype,h,{inline:false,maxTokens:null,excludeDuplicates:true,placeholder:'',init:function(ba,ca,da,ea){this.init=z;this.tokenarea=ba;this.paramName=ca;if(!this.placeholder)this.placeholder=this.input.getAttribute('data-placeholder')||'';x(this,ea||{});this.initEvents();this.initTypeahead();this.reset(da);this.initBehaviors();g.inform('Tokenizer/init',this,g.BEHAVIOR_PERSISTENT);},reset:function(ba){this.tokens=[];this.unique={};if(ba){this.populate(ba);}else j.empty(this.tokenarea);this.updateTokenarea();},populate:function(ba){var ca=[];this.tokens=this.getTokenElements().map(function(da,ea){var fa=ba[ea];ca.push(this._tokenKey(fa));return this.createToken(fa,da);},this);this.unique=y(ca,this.tokens);},getElement:function(){return this.element;},getTypeahead:function(){return this.typeahead;},getInput:function(){return this.input;},initBehaviors:function(){this.behaviors=this.behaviors||[];if(this.behaviors instanceof Array){this.behaviors.forEach(function(da){da.behavior(this,da.config);}.bind(this));}else for(var ba in (this.behaviors||{})){var ca=window.TokenizerBehaviors&&window.TokenizerBehaviors[ba];ca.call(null,this,this.behaviors[ba]);}},initTypeahead:function(){var ba=this.typeahead.getCore();ba.resetOnSelect=true;ba.setValueOnSelect=false;ba.preventFocusChangeOnTab=true;if(this.inline){var ca=this.typeahead.getView();i.addClass(ca.getElement(),'uiInlineTokenizerView');}this.typeahead.subscribe('select',function(da,ea){var fa=ea.selected;if('uid' in fa){this.updateInput();this.addToken(this.createToken(fa));}}.bind(this));this.typeahead.subscribe('blur',this.handleBlur.bind(this));},handleBlur:function(event){this.inform('blur',{event:event});this.updatePlaceholder();},initEvents:function(){var ba=this.handleEvents.bind(this),ca=v.firefox()<4?'keypress':'keydown';m.listen(this.tokenarea,{click:ba,keydown:ba});m.listen(this.input,'paste',this.paste.bind(this));m.listen(this.input,ca,this.keydown.bind(this));},handleEvents:function(event){var ba=event.getTarget(),ca=ba&&this.getTokenElementFromTarget(ba);if(!ca)return;if(event.type!='keydown'||m.getKeyCode(event)==p.RETURN)this.processEvents(event,ba,ca);},processEvents:function(event,ba,ca){if(q.byClass(ba,'remove')){var da=ca.nextSibling;da=da&&k.scry(ca.nextSibling,'.remove')[0];var ea=this.getTokenFromElement(ca);ea=this.addTokenData(ea,ba);this.removeToken(ea);this.focusOnTokenRemoval(event,da);event.kill();}},focusOnTokenRemoval:function(event,ba){n.set(event.type=='keydown'&&ba||this.input);},addTokenData:function(ba,ca){return ba;},keydown:function(event){this.inform('keydown',{event:event});var ba=m.getKeyCode(event),ca=this.input;if(this.inline&&ba==p.BACKSPACE&&o.isEmpty(ca)){var da=this.getLastToken();if(da&&da.isRemovable())this.removeToken(da);}this.updateInput();},paste:function(event){this.inform('paste',{event:event});this.updateInput(true);},focusInput:function(){n.set(this.input);},updateInput:function(ba){if(!this.inline)return;setTimeout(function(){this.adjustWidth(this.input.value);if(ba)this.input.value=this.input.value;}.bind(this),20);r.setPlaceholderText(this.input,'');},setPlaceholder:function(ba){this.placeholder=ba;if(this.stickyPlaceholder)r.setPlaceholderText(this.input,ba);this.updatePlaceholder();},updatePlaceholder:function(){if(!this.inline||this.input.value)return;var ba=!this.tokens.length,ca='';if(ba||this.stickyPlaceholder){this.adjustWidth(this.placeholder);ca=this.placeholder;}else this.adjustWidth(this.input.value);r.setPlaceholderText(this.input,ca);},adjustWidth:function(ba){if(!this.inline||!this._getIsInDOM())return;if(!ba&&this.stickyPlaceholder&&this.input.value==='')ba=this.placeholder;var ca=this._getMetrics().measure(ba),da=ca.width+this._getWidthOffset()+10;s.set(this.input,'width',da+'px');},getToken:function(ba){return this.unique[ba]||null;},getTokens:function(){return this.tokens||[];},getTokenElements:function(){return k.scry(this.tokenarea,'span.uiToken');},getTokenElementFromTarget:function(ba){return q.byClass(ba,'uiToken');},getTokenFromElement:function(ba){return l.get(ba,'Token');},getTokenValues:function(){if(!this.tokens)return [];return this.tokens.map(function(ba){return ba.getValue();});},getFirstToken:function(){return this.tokens[0]||null;},getLastToken:function(){return this.tokens[this.tokens.length-1]||null;},hasMaxTokens:function(){return this.maxTokens&&this.maxTokens<=this.tokens.length;},createToken:function(ba,ca){var da=this.getToken(this._tokenKey(ba));if(!da)da=ba.weak_reference?new w(ba,this.paramName):new u(ba,this.paramName);ca&&da.setElement(ca);return da;},addToken:function(ba){if(this.hasMaxTokens())return;var ca=this._tokenKey(ba.getInfo());if(ca in this.unique)return;this.unique[ca]=ba;this.tokens.push(ba);this.insertToken(ba);this.updateTokenarea();this.inform('addToken',ba);g.inform('Form/change',{node:this.element});},insertToken:function(ba){j.appendContent(this.tokenarea,ba.getElement());},removeToken:function(ba){if(!ba)return;var ca=this.tokens.indexOf(ba);if(ca<0)return;this.tokens.splice(this.tokens.indexOf(ba),1);delete this.unique[this._tokenKey(ba.getInfo())];j.remove(ba.getElement());this.updateTokenarea();this.inform('removeToken',ba);g.inform('Form/change',{node:this.element});},removeAllTokens:function(){this.reset();this.inform('removeAllTokens');},updateTokenarea:function(){var ba=this.typeahead.getCore(),ca=this.getTokenValues();if(this.excludeDuplicates){this._exclusions||(this._exclusions=ba.getExclusions());ba.setExclusions(ca.concat(this._exclusions));}ba.setEnabled(!this.hasMaxTokens());this.updateTokenareaVisibility();this.updatePlaceholder();},updateTokenareaVisibility:function(){i.conditionShow(this.tokenarea,this.tokens.length!==0);},_tokenKey:function(ba){return ba.uid+(ba.freeform?':':'');},_widthOffset:null,_getWidthOffset:function(){if(this._widthOffset===null){var ba=this.input.clientWidth,ca=s.getFloat(this.input,'width');if(ba==ca){this._widthOffset=s.getFloat(this.input,'paddingLeft')+s.getFloat(this.input,'paddingRight');}else this._widthOffset=0;}return this._widthOffset;},_metrics:null,_getMetrics:function(){if(!this._metrics)this._metrics=new t(this.input,this.inline);return this._metrics;},_getIsInDOM:function(){return this._isInDOM||(this._isInDOM=k.contains(document.body,this.input));}});aa.init=function(ba,ca){ba.init(ca.tokenarea,ca.param_name,ca.initial_info,ca.options);};e.exports=aa;});
__d("MercuryTypeahead",["Event","ArbiterMixin","DOM","Input","MercuryTypeaheadTemplates","Tokenizer","Typeahead","TypeaheadCore","copyProperties","cx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('DOM'),j=b('Input'),k=b('MercuryTypeaheadTemplates'),l=b('Tokenizer'),m=b('Typeahead'),n=b('TypeaheadCore'),o=b('copyProperties'),p=b('cx'),q=function(r,s){this._domElement=null;this._typeahead=null;this._tokenizer=null;this._placeholder='';this._exclusions=[];this._viewNodeOrID=null;this._viewOptions={renderer:'compact',autoSelect:true};this._tokenizerBehaviors=[];this._dataSource=r;this._view=s;};o(q.prototype,h);o(q.prototype,{setPlaceholder:function(r){this._placeholder=r;return this;},setExcludedParticipants:function(r){this._exclusions=[];r.forEach(function(s){var t=s.indexOf(':');if(s.substr(0,t)=='fbid')this._exclusions.push(s.substr(t+1));}.bind(this));return this;},setViewNodeID:function(r){this._viewNodeOrID=r;},setViewNode:function(r){this._viewNodeOrID=r;},setFullWidthView:function(r){var s=i.create('div',{className:"_4ck uiTypeaheadView"});i.setContent(r,s);this.setViewNode(s);},setViewOption:function(r,s){this._viewOptions[r]=s;},addTokenizerBehavior:function(r){this._tokenizerBehaviors.push(r);},build:function(r){if(this._domElement)return;var s=k[':fb:mercury:tokenizer'].build(),t=k[':fb:mercury:typeahead'].build();this._domElement=s.getRoot();i.appendContent(this._domElement,t.getRoot());var u=t.getNode('textfield');j.setPlaceholder(u,this._placeholder);u.setAttribute('data-placeholder',this._placeholder);var v={node_id:this._viewNodeOrID,ctor:this._view,options:this._viewOptions},w={ctor:n,options:{setValueOnSelect:true}};this._typeahead=new m(this._dataSource,v,w,t.getRoot());this._typeahead.init();var x={inline:true,behaviors:this._tokenizerBehaviors};this._tokenizer=new l(this._domElement,this._typeahead);this._tokenizer.init(s.getNode('tokenarea'),'participants',[],x);this._tokenizer.subscribe(['addToken','removeToken','removeAllTokens'],function(){this.inform('tokens-changed');}.bind(this));g.listen(u,'focus',function(){this._resetDataSource();this._typeahead.init();}.bind(this));g.listen(this._domElement,'click',this.focus.bind(this));},getElement:function(){return this._domElement;},getSelectedParticipantIDs:function(){var r=[];if(this._tokenizer)(this._tokenizer.getTokenValues()||[]).forEach(function(s){r.push('fbid:'+s);});return r;},getTokens:function(){var r=[];if(this._tokenizer)r=this._tokenizer.getTokens();return r;},getTokenizer:function(){return this._tokenizer;},reset:function(){this._tokenizer&&this._tokenizer.removeAllTokens();this._typeahead&&this._typeahead.getCore().reset();},focus:function(){this._tokenizer&&this._tokenizer.focusInput();},getTypeahead:function(){return this._typeahead;},_resetDataSource:function(){this._dataSource.setExclusions(this._exclusions);}});e.exports=q;});
__d("PhotosUploadWaterfall",["AsyncSignal"],function(a,b,c,d,e,f){var g=b('AsyncSignal'),h={APP_FLASH:'flash_pro',APP_SIMPLE:'simple',APP_ARCHIVE:'archive',APP_COMPOSER:'composer',APP_MESSENGER:'messenger',APP_HTML5:'html5',APP_CHAT:'chat',INSTALL_CANCEL:1,INSTALL_INSTALL:2,INSTALL_UPDATE:3,INSTALL_REINSTALL:4,INSTALL_PERMA_CANCEL:5,INSTALL_SILENT_SKIP:6,INSTALL_DOWNLOAD:7,BEGIN:1,UPLOAD_START:4,ALL_UPLOADS_DONE:6,CLIENT_ERROR:7,IMAGES_SELECTED:9,UPGRADE_REQUIRED:11,VERSION:15,SELECT_START:18,SELECT_CANCELED:19,CANCEL:22,CANCEL_DURING_UPLOAD:83,ONE_UPLOAD_DONE:29,ONE_RESIZING_DONE:34,PROGRESS_BAR_STOPPED:44,MISSED_BEAT:45,HEART_ATTACK:46,PUBLISH_START:100,PUBLISH_SUCCESS:101,PUBLISH_FAILURE:102,SESSION_POSTED:72,POST_PUBLISHED:80,ONE_UPLOAD_CANCELED:81,ONE_UPLOAD_CANCELED_DURING_UPLOAD:82,RESIZER_AVAILABLE:20,OVERLAY_FIRST:61,ASYNC_AVAILABLE:63,FALLBACK_TO_FLASH:13,RETRY_UPLOAD:17,TAGGED_ALL_FACES:14,VAULT_IMAGES_SELECTED:62,VAULT_CREATE_POST_CANCEL:65,VAULT_SEND_IN_MESSAGE_CLICKED:66,VAULT_DELETE_CANCEL:68,VAULT_ADD_TO_ALBUM_CANCEL:74,VAULT_SHARE_IN_AN_ALBUM_CLICKED:76,VAULT_SHARE_OWN_TIMELINE_CLICKED:77,VAULT_SHARE_FRIENDS_TIMELINE_CLICKED:78,VAULT_SHARE_IN_A_GROUP_CLICKED:79,METHOD_DRAGDROP:'dragdrop',METHOD_FILE_SELECTOR:'file_selector',VAULTBOX:'vaultbox',GRID:'grid',SPOTLIGHT_VAULT_VIEWER:'spotlight_vault_viewer',sendSignal:function(i,j){new g('/ajax/photos/waterfall.php',{data:JSON.stringify(i)}).setHandler(j).send();}};e.exports=h;});