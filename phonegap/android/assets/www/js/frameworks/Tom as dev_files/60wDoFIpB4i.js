/*1365112010,178142561*/

if (self.CavalryLogger) { CavalryLogger.start_js(["LEbBV"]); }

__d("concatMap",[],function(a,b,c,d,e,f){function g(h,i){var j=-1,k=i.length,l=[],m;while(++j<k){m=h(i[j],j,i);Array.isArray(m)?Array.prototype.push.apply(l,m):Array.prototype.push.call(l,m);}return l;}e.exports=g;});
__d("FacebarResultStoreUtils",[],function(a,b,c,d,e,f){var g={processEntityResult:function(h,i,j,k){var l={semantic:i.toString(),structure:[{type:'ent:'+h,text:j,uid:i}],type:'{'+h+'}',cost:k,cache_id_length:0,bolding:[]};l.tuid=JSON.stringify({semantic:l.semantic,structure:l.structure});return l;}};e.exports=g;});
__d("FacebarResultStore",["copyProperties","concatMap","FacebarResultStoreUtils","TypeaheadUtil"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('concatMap'),i=b('FacebarResultStoreUtils'),j=b('TypeaheadUtil'),k='unimplemented';function l(m,n,o){this.facebarConfig=m;this.facebarConfig.grammar_stop_words_penalty=this.facebarConfig.grammar_stop_words_penalty||2;this.facebarConfig.grammar_stop_words=this.facebarConfig.grammar_stop_words||{};this.tokenize=n;this.getEntry=o;this.typeaheadTypeMap=this.facebarConfig.mapped_types;this.facebarConfig.typeahead_types.forEach(function(p){this.typeaheadTypeMap[p]=p;}.bind(this));this.resetCaches();this.cacheEnabled(true);}l.EPSILON=1e-05;g(l.prototype,{transformStructured:function(m){var n=[],o=[],p='',q='';m.forEach(function(t,u){if(t.isType('text')){p+=t.getText();q=(q==null)?null:q+t.getText();}else{var v=p.match(/\"/g);if(v&&v.length%2)p=p.replace(/\s+$/,'')+'"';if(p.length){Array.prototype.push.apply(n,this.tokenize(p));o.push(p);p='';}n.push(t.toStruct());o.push({uid:String(t.getUID()),type:this._getFBObjectType(t.getTypePart(1)),text:t.getText()});q=null;}}.bind(this));if(p.length){if(p[p.length-1]=='\'')p=p.substr(0,p.length-1);Array.prototype.push.apply(n,this.tokenize(p));o.push(p);if(p[p.length-1]==' ')n.push('');}var r=JSON.stringify(o),s=r.replace(/\]$/,'').replace(/\"$/,'');s=s.replace(/\s{2,}/g,' ');return {tokens:n,text_form:r,is_empty:!!r.match(/^\[(\"\s*\")?\]$/),raw_text:q,cache_id:s};},resetCaches:function(){this.bootstrapCache={};this.queryCache={'':{tokens:[],results:[]}};},setNullState:function(m){this.facebarConfig.null_state=m.map(this._extractStructure.bind(this));},setSortFunction:function(m){this._sortFunction=m;},addBootstrap:function(m){var n=this.bootstrapCache;m.forEach(function(o){var p=this.getEntry(o);p.bootstrapped=true;var q=this.tokenize(p.textToIndex,true);if(p.tokens)Array.prototype.push.apply(q,p.tokens.split(' '));q.forEach(function(r){if(!n.hasOwnProperty(r))n[r]={};n[r][o]=true;});},this);},getResults:function(m){if(m.tokens.length===0||(m.tokens.length==1&&m.tokens[0]===''))return {results:(this.facebarConfig.null_state||[])};var n=this._getBestQueryCache(m.cache_id),o=n.results,p=this._getBootstrapMatchByType(m.tokens),q=this._addMatchingBootstrapResults(m.tokens,p[0]||{});Array.prototype.push.apply(q,h(this._getResultsFromCache.bind(this,p,m.tokens),o));var r={},s=[],t=false;q.sort(this._sortFunction).forEach(function(u){var v=l.getUniqueSemantic(u.semantic);if(!v||r[v])return;if(t&&u.blankFilled)return;t=t||!!u.blankFilled;r[v]=u.semantic;s.push(u);}.bind(this));return {results:s,webSuggOnTop:n.webSuggOnTop,webSuggLimit:n.webSuggLimit,webSuggLimitSeeMore:n.webSuggLimitSeeMore};},cacheEnabled:function(m){this._enableCache=m;},saveResults:function(m,n,o,p){m=m.map(this._processBackendResult.bind(this));var q=[];if(this._enableCache){var r={},s={};m.forEach(function(u){s[u.semantic]=true;u.parse&&u.parse.disambiguation&&u.parse.disambiguation.forEach(function(v){r[v]=true;});});var t=this._getBestQueryCache(n.cache_id);t.results.forEach(function(u){if(u.semanticForest in r)return;var v=this._getDifferenceArrayTokens(u.tokens,n.tokens),w=this._getNumTokensMatching(v,u);w=this._tryMatchingFinalInsertedEntity(v,w,u);if(w>0&&w==v.length){u.cacheOnlyResult=!s[u.semantic];q.push(u);}}.bind(this));}m.forEach(function(u){u.tokens=n.tokens;u.cache_id_length=n.cache_id.length;q.push(u);});if(this.queryCache[n.cache_id]===undefined)this.queryCache[n.cache_id]={};g(this.queryCache[n.cache_id],{tokens:n.tokens,results:q,incomplete:o});g(this.queryCache[n.cache_id],p);},alreadyKnown:function(m){return !!this.queryCache[m]&&!this.queryCache[m].incomplete;},stripBrackets:function(m){return m.replace(/^[\[\{]/,'').replace(/[\]\}]$/,'');},_extractStructure:function(m){function n(q,r,s){return {type:q,text:r,uid:s||null};}function o(q,r){q.split(' ').forEach(function(s){if(s!==''){if(r)m.chunks.push(m.structure.length);m.structure.push(n('text',s));}m.structure.push(n('text',' '));});m.structure.pop();}function p(q){var r=(m.structure.length===0&&m.type!='websuggestion')?q.charAt(0).toUpperCase()+q.substr(1):q;return r;}m.structure=[];m.chunks=[];m.parse.display.forEach(function(q){if(typeof q==='string'){o(p(q),true);}else if(q.uid){var r=this.getEntry(q.uid,q.fetchType);m.chunks.push(m.structure.length);if(r.grammar_like){o(p(r.text),false);}else{var s=q.type;if(q.fetchType)s+=':'+q.fetchType;m.structure.push(n(s,r.text,q.uid));}}else{m.chunks.push(m.structure.length);m.blankType=q.type.replace(/^blank:/,'');m.structure.push(n(q.type,''));}}.bind(this));return m;},_getDifferenceArrayTokens:function(m,n){if(!m.length)return [''].concat(n);var o=m.length-1,p=m[o];if(p==='')p=m[--o];return [typeof(p)=='string'?n[o].substr(p.length):''].concat(n.slice(o+1));},_processBackendResult:function(m){m.semantic=m.semantic.toString();this._extractStructure(m);if(m.type.match(/^\{.*\}$/))m.useExtendedIndex=true;if(m.semantic.match(/\[.*\]/)){var n=m.parse,o=n.pos;if(o===undefined){m.semantic=m.semantic.replace(/\[(.*)\]/g,'$1');}else{var p=n.remTokens[n.remTokens.length-1];if(n.remTokens.length&&m.structure[m.chunks[p]].uid){o=n.remTokens[n.remTokens.length-1];m.completed=true;}var q=m.structure[m.chunks[o]].uid,r=new RegExp('\\['+q+'\\]','g');m.unsubstituted_semantic=m.semantic;m.semantic=m.semantic.replace(r,q);if(n&&n.disambiguation&&n.disambiguation.length>0){n.disambiguation=n.disambiguation.filter(function(s){return s.indexOf('['+q+']')!==-1;});n.unsubstituted_disambiguation=n.disambiguation.splice(0);n.disambiguation=n.disambiguation.map(function(s){return s.replace(r,q);});}}}m.tuid=JSON.stringify({semantic:m.semantic,structure:m.structure});return m;},_sortFunction:function(m,n){return (m.cost||0)-(n.cost||0);},_getResultsFromCache:function(m,n,o){var p=this._getDifferenceArrayTokens(o.tokens,n),q=[],r=this._getNumTokensMatching(p,o),s=this._tryMatchingFinalInsertedEntity(p,r,o);if(s>0&&s==p.length)q.push(o);o.bolding=this._computeBolding(o,p,0);Array.prototype.push.apply(q,this._trySubstitutingBootstrapResult(m[n.length-p.length],o,p));if(r<=0)return q;var t=p.slice(r);r+=n.length-p.length;var u={};if(r==n.length){--r;if(r<0)return q;if(n[r]!=='')u=this._computeBolding(o,p,1);}if(r==n.length-1&&n[r]===''){--r;if(r<0)return q;u=this._computeBolding(o,p,1);}var v=function(w,x){x.bolding=w;return x;}.bind(null,u);Array.prototype.push.apply(q,this._tryMatchingFinalBootstrapResult(m[r],t,o).map(v));return q;},_addMatchingBootstrapResults:function(m,n){return h(function(o){var p=n[o];if(p===undefined)return [];var q=[];p.forEach(function(r){var s=this.getEntry(r,o);if(!this._isTitleTermMatch(m,s))return;var t=this._isExactNameMatch(m,s)?0:this.facebarConfig.non_title_term_match_penalty,u=this._isNonGrammarTermMatch(m,s),v=s.grammar_costs['{'+o+'}']+t+this.facebarConfig.entity_cost+this.facebarConfig.grammar_stop_words_penalty*!u;q.push(i.processEntityResult(o,r,s.text,v,u));}.bind(this));return q;}.bind(this),this.facebarConfig.bootstrap_types);},_isTitleTermMatch:function(m,n){var o=m[0]||{};if(typeof(o)=='object')return false;var p=n.titleToIndex;return m.length===1?j.isPrefixMatch(o,p):j.isExactMatch(o,p);},_isExactNameMatch:function(m,n){var o=m[0]||{};if(typeof(o)=='object')return 0;var p=n.text;if(m.length===1?j.isPrefixMatch(o,p):j.isExactMatch(o,p))return true;return m.length==1&&n.alias!==undefined&&j.isExactMatch(o,n.alias);},_isNonGrammarTermMatch:function(m,n){var o=j.parse(n.titleToIndex.toLowerCase()),p=o.tokens.filter(function(s){return s!==''&&!this.facebarConfig.grammar_stop_words[s];}.bind(this));for(var q=0;q<m.length;++q){if(typeof(m[q])=='object')return true;var r=q===m.length-1?j.isPrefixMatch(m[q],p):j.isQueryMatch(m[q],p);if(r)return true;}return false;},_getBootstrapMatchByType:function(m){if(m.length===0)return [];var n=m.map(function(){return {};}),o=(m[m.length-1]===''),p={},q,r=(o?m.length-1:m.length);if(r&&m[r-1].uid){this._pushBootstrapEntryAtPosition(n,r-1,m[r-1].uid);return n;}for(var s in this.bootstrapCache)if(r&&s.indexOf(m[r-1])===0&&(!o||s===m[r-1]))for(q in this.bootstrapCache[s])if(!p[q]){p[q]=1;this._pushBootstrapEntryAtPosition(n,r-1,q);}for(var t=r-2;t>=0;t--){if(typeof(m[t])=='object')break;if(m[t].length&&m[t][0]=='"')break;for(q in this.bootstrapCache[m[t]]){if(!p[q])p[q]=0;if(p[q]+t==r-1){++p[q];this._pushBootstrapEntryAtPosition(n,t,q);}}}return n;},_pushBootstrapEntryAtPosition:function(m,n,o){var p=this.getEntry(o);if(!p)return;for(var q in p.grammar_costs){var r=this.stripBrackets(q);if(m[n][r]===undefined)m[n][r]=[];m[n][r].push(o);}},_getNumTokensMatching:function(m,n){var o=0,p=n.parse,q=m.length,r=null,s=null;if(p.pos!==undefined){var t=n.structure[n.chunks[p.pos]];r=t.uid;s=t.type.split(':')[2];}n.outputTokensUsed=[];if(r){o=this._prefixMatchEntity(m,p,r,n.outputTokensUsed,s,!!n.useExtendedIndex);if(o===0||o===q)return o;}else if(p.suffix&&q==1&&p.suffix.indexOf(m[0])===0){return q;}else if(p.suffix==m[0]){++o;}else return 0;var u=[];for(var v=0;v<p.remTokens.length;v++){if(typeof(m[o])!='string'||n.chunks.length<p.remTokens[v]||n.structure[n.chunks[p.remTokens[v]]].uid)break;var w=n.structure[n.chunks[p.remTokens[v]]].text;u.push(w.toLowerCase());}o=this._greedyMatchText(u,m,o,p.remTokens,n.outputTokensUsed);if(o==q-1&&m[o]==='')return q;return o;},_prefixMatchEntity:function(m,n,o,p,q,r){if(n.entTokens.length===0){if(m[0]!=='')return 0;if(n.possessive&&m.length>1&&m[1]=='\'s'){p.push([n.pos+1]);return 2;}else return 1;}var s=false,t=this.getEntry(o,q);if(typeof(q)!=='undefined'&&q!==t.fetchType)return 0;var u=this.tokenize(r?t.textToIndex:t.text,true).filter(function(fa){return !this.facebarConfig.grammar_stop_words[fa];}.bind(this)),v=[];for(var w=0;w<m.length+n.entTokens.length-1;w++)if(w<n.entTokens.length-1){v.push(n.entTokens[w]);}else if(w==n.entTokens.length-1){v.push(n.entTokens[w]+m[0]);}else v.push(m[w-n.entTokens.length+1]);var x=-n.entTokens.length+1;for(var y=0;y<v.length;++y){var z=v[y];if(typeof(z)!='string')break;if(z===''){x++;continue;}var aa=false;for(var ba=0;ba<u.length;ba++)if(u[ba]==z||(y===v.length-1&&u[ba].indexOf(z)===0)){u[ba]='';aa=true;++x;break;}if(aa)continue;if(!n.possessive||z.length<=2||z.substr(z.length-2)!='\'s')break;var ca=z.substr(0,z.length-2);for(ba=0;ba<u.length;ba++)if(u[ba]==ca){++x;if(p)s=true;break;}break;}if(x>0){if(s)p.push([n.pos+1]);return x;}if(p===undefined)return 0;var da=m[0],ea=da;if(n.possessive&&da.length>=2&&da.substr(da.length-2)=='\'s')ea=da.substr(0,da.length-2);if((m.length==1&&n.suffix.indexOf(da)===0)||n.suffix==ea||n.suffix==da){if(ea!=da&&n.suffix==ea)p.push([n.pos+1]);return 1;}return 0;},_tryMatchingFinalInsertedEntity:function(m,n,o){if(!o.completed||n<0)return n;var p=o.parse,q=p.remTokens[p.remTokens.length-1],r=o.structure[o.chunks[q]],s=this.getEntry(r.uid,r.type),t=this.tokenize(s.text,true);n=this._greedyMatchText(t,m,n);if(n==m.length-1&&m[n]==='')return m.length;return n;},_greedyMatchText:function(m,n,o,p,q){for(var r=0;r<m.length;r++){var s=m[r];if(s==n[o]){if(q!==undefined)q.push(p[r]);++o;continue;}if(o===n.length-1&&s.indexOf(n[o])===0){if(q!==undefined)if(s==n[o]){q.push([p[r]]);}else q.push([p[r],n[o].length]);return n.length;}}return o;},_createMapOverFinalBootstrapUids:function(m,n,o,p,q,r){return function(s){var t=this.getEntry(s,q);if(r(s,t)===false)return;var u={};g(u,m);if(!u.iconClass)u.photo=t.photo;u.cost=m.cost+l.EPSILON+t.grammar_costs['{'+q+'}']-o.grammar_costs['{'+q+'}'];u.cache_id_length=Infinity;u.structure=m.structure.slice(0);u.structure[m.chunks[p]]={type:n.type,text:t.text,uid:s};u.blankFilled=true;var v=new RegExp('\\['+n.uid+'\\]','g');u.semantic=m.unsubstituted_semantic.replace(v,s);if(u.parse&&u.parse.disambiguation&&u.parse.disambiguation.length>0)u.parse.disambiguation=u.parse.unsubstituted_disambiguation.map(function(w){return w.replace(v,s);});u.tuid=JSON.stringify({semantic:u.semantic,structure:u.structure});return u;}.bind(this);},_tryMatchingFinalBootstrapResult:function(m,n,o){if(!o.completed)return [];var p=o.parse,q=p.remTokens[p.remTokens.length-1],r=o.structure[o.chunks[q]],s=r.type.substr(4).replace(':blank',''),t=this.getEntry(r.uid,s),u=m[s];if(u===undefined||t===undefined)return [];return u.map(this._createMapOverFinalBootstrapUids(o,r,t,q,s,function(v,w){return n.length==this._greedyMatchText(this.tokenize(w.text),n,0);}.bind(this))).filter(function(v){return !!v;});},_trySubstitutingBootstrapResult:function(m,n,o){if(n.unsubstituted_semantic===undefined||n.completed||n.type===k)return [];var p=n.parse.pos,q=n.structure[n.chunks[n.parse.pos]],r=q.type.substr(4),s=m[r];if(s===undefined)return [];var t=this.getEntry(q.uid);if(!t||t.grammar_costs===undefined)return [];return s.map(this._createMapOverFinalBootstrapUids(n,q,t,p,r,function(u){return this._prefixMatchEntity(o,n.parse,u)===o.length;}.bind(this))).filter(function(u){return !!u;});},_computeBolding:function(m,n,o){var p={};if(m.parse.pos!==undefined){var q=m.structure[m.chunks[m.parse.pos]];if(!q.uid)p[m.chunks[m.parse.pos]]=q.text.length-m.parse.suffix.length+n[0].length;}m.parse.unmatch.forEach(function(t){if(typeof(t)=='object'){p[m.chunks[t[0]]]=m.structure[m.chunks[t[0]]].text.length-t[1].length;}else p[m.chunks[t]]=0;});m.parse.remTokens.forEach(function(t){p[m.chunks[t]]=0;});for(var r=0;r<m.outputTokensUsed.length-o;r++){var s=m.outputTokensUsed[r];if(s.length==1){delete p[m.chunks[s[0]]];}else p[m.chunks[s[0]]]=s[1];}return p;},_getBestQueryCache:function(m){for(var n=m.length;n>=0;n--){var o=this.queryCache[m.slice(0,n)];if(o)return o;}},_getFBObjectType:function(m){if(this.typeaheadTypeMap[m]){return this.typeaheadTypeMap[m];}else return 'page';}});l.getUniqueSemantic=function(m){var n=[],o=[],p=[];m='('+m+')';var q=m,r=false;m.replace(/[\(\),]/g,function(s,t){var u;switch(s){case ',':var v=p.length-1;u=q.substr(p[v],t-p[v]);n[v].push(u);p[v]=t+1;break;case '(':p.push(t+1);n.push([]);o.push(t+1);break;case ')':if(p.length===0)throw m+' is not a valid semantic string';var w=p.pop();u=q.substr(w,t-w);var x=n.pop();x.push(u);var y=x.sort();for(var z=1;z<y.length;z++)if(y[z]==y[z-1])r=true;var aa=y.join(',');q=q.substr(0,o.pop())+aa+q.substr(t);break;}return s;});if(r)return '';return q.replace(/\((.*)\)/,'$1');};e.exports=l;});
__d("FacebarSemanticQuery",["URI","copyProperties","Env"],function(a,b,c,d,e,f){var g=b('URI'),h=b('copyProperties'),i=b('Env'),j='str';function k(t){var u={me:i.user};return h(u,t.semantic_map);}function l(t,u){var v=k(t);if(typeof v[u]!=='undefined')return String(v[u]);return u;}function m(t){return new g("/profile.php").addQueryData({id:t});}function n(t,u){var v,w=q(u),x={};for(var y=0;y<w.length;++y)if(w[y].indexOf('path(')===0){v=g(q(w[y])[0]);}else{var z=w[y].substring(6,w[y].indexOf('(')).split('_'),aa=q(w[y]);for(var ba=0;ba<z.length;++ba)x[z[ba]]=l(t,aa[ba]);}v.addQueryData(x);return v;}function o(t,u){var v=[u],w=[],x=t.browse_functions,y=t.search_path;while(v.length>0){var z=v.pop();if(!p(z)){w.push(z);continue;}var aa=z.substring(0,z.indexOf('(')),ba=aa,ca=q(z);if(!x[aa]){w=[];break;}var da=x[aa].minNumParams,ea=x[aa].maxNumParams;if(v.length>0)if(x[aa].numParamsUnbounded){if(w.length>0)aa+='-'+ca.length;}else if((ca.length!=1&&ca.length>da)||(ca.length===0&&da!=ea))aa+='-'+ca.length;v.push(aa);for(var fa=0;fa<ca.length;fa++){if(ca[fa].length===0)continue;if(x[ba].allowsFreeText){v.push(j+'/'+encodeURIComponent(ca[fa]));}else v.push(ca[fa]);}}return g(y+w.join('/'));}function p(t){return (/^[a-z\-]+\(.*\)$/).test(t);}function q(t){if(!p(t)&&t.indexOf('param_')!==0)return [t];var u=t.substring(t.indexOf('(')+1,t.length-1);if(u.length===0)return [];return r(u);}function r(t){var u=[],v=0,w=0;for(var x=0;x<t.length;++x)if(t[x]==','&&w===0){u.push(t.substring(v,x));v=x+1;}else if(t[x]=='('){w++;}else if(t[x]==')')w--;u.push(t.substring(v,t.length));return u;}function s(t,u){this.facebarConfig=t;this.unmapped=(u||"").trim();this.mapped=l(t,this.unmapped);this.position=null;}h(s.prototype,{isEntity:function(){return (/^\d+$/).test(this.mapped);},isURI:function(){return this.mapped.indexOf('uri(')===0;},isImplemented:function(){return this.mapped&&this.mapped.indexOf('*')==-1;},getUnimplemented:function(){return (this.mapped.match(/\*[\w\-]+\(/g)||[]).map(function(t){return t.substr(1,t.length-2);});},getURI:function(){if(this.isEntity()){return m(this.mapped);}else if(this.isURI()){return n(this.facebarConfig,this.mapped);}else return o(this.facebarConfig,this.unmapped);}});e.exports=s;});
__d("FacebarURI",["URI","Env","FacebarSemanticQuery"],function(a,b,c,d,e,f){var g=b('URI'),h=b('Env'),i=b('FacebarSemanticQuery'),j={getSearchRawPrefix:function(){return 'search';},getSearchPath:function(){return '/'+this.getSearchRawPrefix()+'/';},getURI:function(k,l){var m=null,n=!l.song&&l.path;if(n){m=new g(n);}else{var o=new i(k,l.semantic);if(o&&o.isImplemented())m=o.getURI();}return m&&j.getQualifiedURI(m);},getQualifiedURI:function(k){var l=new g(k);if(!l.getDomain()){var m=g(h.www_base);l.setProtocol(m.getProtocol()).setDomain(m.getDomain()).setPort(m.getPort());}return l;}};e.exports=j;});
__d("FacebarTokenizer",["TypeaheadUtil"],function(a,b,c,d,e,f){var g=b('TypeaheadUtil'),h="[^\"]",i=["\\s's","'s","\""+h+"*\"?"],j=[[/\s+$/,''],[/\"\s+/,'"'],[/\s+\"/,'"'],[/\"\"/,''],[/^\"$/,''],[/\s+/,' ']],k={tokenize:function(l,m){var n=[],o=0;l=l.replace(/\s/g,' ').toLowerCase();l.replace(new RegExp(i.join('|'),'g'),function(q,r){if(r>o){var s=l.substr(o,r-o);Array.prototype.push.apply(n,g.parse(s).tokens.slice(0));}var t=q;for(var u=0;u<j.length;u++){var v=j[u];t=t.replace(v[0],v[1]);}if(n.length&&t=='\'s'){n[n.length-1]+=t;}else if(t!=='')n.push(t);if(m)Array.prototype.push.apply(n,g.parse(q).tokens);o=r+q.length;});if(o<l.length){var p=l.substr(o,l.length-o);Array.prototype.push.apply(n,g.parse(p).tokens.slice(0));}return n;}};e.exports=k;});
__d("FacebarDataSource",["Arbiter","AsyncRequest","Class","FacebarResultStore","FacebarStructuredText","FacebarURI","FacebarTokenizer","SearchDataSource","Vector","ViewportBounds","copyProperties","throttle","BingScalingCommon"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('Class'),j=b('FacebarResultStore'),k=b('FacebarStructuredText'),l=b('FacebarURI'),m=b('FacebarTokenizer'),n=b('SearchDataSource'),o=b('Vector'),p=b('ViewportBounds'),q=b('copyProperties'),r=b('throttle'),s=b('BingScalingCommon'),t=100,u=250;function v(w){this.parent.construct(this,w);this.filterOutWebSuggestion=true;this.bootstrap_saved=[];this.null_state=null;this._initialQueryData=null;this._curQueryId=-1;this._seeMore=false;this._waitingQueries=0;this.mixGrammarAndEntity=w.mixGrammarAndEntity!==undefined?w.mixGrammarAndEntity:true;if(w.recordingRoute)this.recordingRoute=w.recordingRoute;this.oldSeeMore=!!w.oldSeeMore;this.grammarVersion=w.grammarVersion||'';this._nullStateFetched=false;this.nullStateEndpoint=w.nullStateEndpoint||'/ajax/browse/null_state.php';this.setNullStateData(w.nullStateData||{},true);this._minWebSugg=w.minWebSugg||1;this._minQueryLength=w.minQueryLength||-1;this.allowWebSuggOnTop=w.allowWebSuggOnTop||false;this._maxWebSuggToCountFetchMore=w.maxWebSuggToCountFetchMore||0;this.respondThrottled=r(this.respond,t,this);this.sendRemoteQueryThrottled=r(this.sendRemoteQuery,u,this);var x=new h().setURI('/ajax/typeahead/search/facebar/config.php').setData({version:this.grammarVersion}).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true).setHandler(function(y){this.facebarConfig=y.payload;this.createResultStore();if(this.null_state){this.setNullState(this.null_state);this.null_state=null;}this.inform('ready',true);}.bind(this)).setFinallyHandler(this.activityEnd.bind(this));this.activityStart();x.send();this.fetchNullState();}i.extend(v,n);q(v.prototype,{events:['query','respond','bootstrap','activity','ready'],createResultStore:function(){this.resultStore=new j(this.facebarConfig,m.tokenize,this.getEntry.bind(this));this.addEntries(this.bootstrap_saved);this.bootstrap_saved=[];this.subscribe('enableCache',function(w,x){this.resultStore.cacheEnabled(x);}.bind(this));this.subscribe('setSortFunction',function(w,x){this.resultStore.setSortFunction(x);}.bind(this));},dirty:function(){this.bootstrap_saved=[];this._nullStateFetched=false;if(this.resultStore)this.resultStore.resetCaches();this.parent.dirty();},addEntries:function(w){if(this.resultStore){this.resultStore.addBootstrap(this.processEntries(w));}else Array.prototype.push.apply(this.bootstrap_saved,w);},setNullStateData:function(w,x){if(x)this.nullStateData={grammar_version:this.grammarVersion};q(this.nullStateData,w);return this;},setNullState:function(w){if(this.resultStore){this.processEntries(w.entities);this.resultStore.setNullState(w.queries);this.inform('ready',true);}},fetchNullState:function(){if(this._nullStateFetched)return;var w=new h().setURI(this.nullStateEndpoint).setData(this.nullStateData).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true).setHandler(function(x){if(this.resultStore){this.setNullState(x.payload);}else this.null_state=x.payload;this._nullStateFetched=true;}.bind(this)).setFinallyHandler(this.activityEnd.bind(this));this.activityStart();w.send();},toTypeaheadEntryUid:function(w){var x,y=k.fromStruct(w.structure),z=y.getFragment(0);if(y.getCount()==1&&z.isType('ent')){var aa=z.getType().split(':')[2];x=this.getEntry(z.getUID(),aa);x.type=this.resultStore.stripBrackets(w.type);}else{x=this.getEntry(w.tuid);if(!x){var aa,ba,ca;if(w.type==='websuggestion'){aa='websuggestion';}else{aa='grammar';ba=w.type;ca=w.iconClass;}x={error_message:w.errorMessage,icon_class:ca,memcache:w.fromMemcache,photo:w.photo,results_set_type:ba,tuid:w.tuid,type:aa,uid:w.tuid,websuggestion_source:w.websuggestion_source,extra_uri_params:w.extra_uri_params,dynamic_cost:w.dynamic_cost};this.processEntries([x]);x=this.getEntry(w.tuid);}}if(x.type==='websuggestion')x.path=w.path;x.structure=y;x.queryTypeText=w.queryTypeText;x.semantic=w.semantic;x.tree=w.tree;x.cost=w.cost;x.isSeeMore=!!w.isSeeMore;x.cacheOnlyResult=w.cacheOnlyResult||false;x.uri=l.getURI(this.facebarConfig,x);x.semanticForest=w.semanticForest;x.parse=w.parse;x.removable=true;if(w.parse&&w.parse.disambiguation&&w.parse.disambiguation.length>0){x.disambiguation_paths=[];for(var da=0;da<w.parse.disambiguation.length;da++){var ea={};ea.semantic=w.parse.disambiguation[da];var fa=l.getURI(this.facebarConfig,ea);if(fa){fa.path=fa.path.replace('/^\/'+l.getSearchRawPrefix()+'\//','');x.disambiguation_paths.push(fa.path);}}}return x.tuid;},getRawStructure:function(w){if(this.resultStore)return this.resultStore.transformStructured(w.toArray());},isSeeMore:function(){return this._seeMore;},saveResult:function(w){this._initialQueryData=w.uid;},buildUids:function(w,x,y){if(!w||!this.resultStore)return [];var z=this.getRawStructure(w),aa=this.resultStore.getResults(z),ba=aa.results;if(typeof ba==='undefined')return [];var ca=aa.webSuggOnTop;if(typeof ca==='undefined')ca=false;var da=(this._seeMore&&this.oldSeeMore?aa.webSuggLimitSeeMore:aa.webSuggLimit)||0,ea=this.filterOutWebSuggestion;ba=ba.filter(function(ha,ia){if(ha.type!='websuggestion'){return ha.semantic!='<blank>';}else return !ea;});var fa=[],ga=[];ba.forEach(function(ha){if(ha.isSeeMore){fa.push(ha);}else ga.push(ha);});ba=s.integrateWebsuggestions(ga,ca,this.getMaxResults(),da,this._minWebSugg);if(!this.oldSeeMore)ba.length=Math.min(ba.length,this._maxResults);if(this.isSeeMore())ba.push.apply(ba,fa);return ba.map(this.toTypeaheadEntryUid.bind(this));},handleResponse:function(w,x){if(!(w.payload.errors)){this.processEntries(w.payload.entities);this.filterOutWebSuggestion=true;for(var y=0;y<w.payload.results.length;y++)if(w.payload.results[y].type=='websuggestion'){this.filterOutWebSuggestion=false;break;}var z={};['webSuggOnTop','webSuggLimit','webSuggLimitSeeMore'].forEach(function(aa){if(w.payload.hasOwnProperty(aa))z[aa]=w.payload[aa];});this.resultStore.saveResults(w.payload.results,x,w.payload.incomplete,z);}},processEntries:function(w){return w.map(function(x,y){var z=(x.uid=x.uid+'');x.textToIndex=this.getTextToIndex(x);x.titleToIndex=this.getTitleTerms(x);z=this.getUID(z,x.fetchType);var aa=this.getEntry(z);if(!aa){this.setEntry(z,{});aa=this.getEntry(z);}q(aa,x);aa.tuid=z;aa.index===undefined&&(aa.index=y);return z;}.bind(this));},getUID:function(w,x){w=w+'';if(x!==undefined){x=/([^:]+:)?([^:]+)(:.*)?/.exec(x)[2];return JSON.stringify([w,x]);}return w;},getEntry:function(w,x){if(x!==undefined){var y=this.parent.getEntry(this.getUID(w,x));if(y)return y;}return this.parent.getEntry(w);},getEntryForFragment:function(w){return this.getEntry(w.getUID(),w.getTypePart(2));},getMaxResults:function(){return ((this.oldSeeMore&&this._seeMore)?3:1)*this._numResults.max;},query:function(w,x,y,z){this.executeQuery(w,z,this._initialQueryData);this._initialQueryData=null;},executeQuery:function(w,x,y){this._seeMore=!!x;this._curQueryId++;this.setQueryData({qid:this._curQueryId,see_more:this._seeMore,max_results:this.getMaxResults(),num_entities:((this._seeMore&&this.oldSeeMore)?this._numResults.max:0)});this.inform('beforeQuery',{value:w,queryId:this.curQueryId});var z=this.buildUids(w,[]);if(y){z=z.filter(function(ba){return ba!==y;});z.unshift(y);}this.value=w;this.inform('query',{value:w,results:z,see_more:this._seeMore,queryId:this._curQueryId});if(this.resultStore){var aa=this.getRawStructure(w);if(this.shouldFetchMore(aa,z))this.sendRemoteQueryThrottled(aa,w);this.respondThrottled(w,z,false);}},shouldFetchMore:function(w,x){if(w.is_empty)return false;if(this._seeMore)return true;if(this.resultStore.alreadyKnown(w.cache_id))return false;if(w.raw_text&&w.raw_text.length<this._minQueryLength)return false;if(x.length<this._maxResults)return true;return this.countValidResults(x)<this._maxResults;},countValidResults:function(w){var x=0,y=0;w.forEach(function(z){var aa=this.getEntry(z);if(aa&&!aa.grammarTermMatchOnly)if(aa.type==='websuggestion'){x++;}else y++;}.bind(this));return y+Math.min(this._maxWebSuggToCountFetchMore,x);},sendRemoteQuery:function(w,x){var y=new h().setURI(this.queryEndpoint).setData(this.getQueryData(w.text_form)).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true).setHandler(function(z,aa){aa.queryId=z;this.inform('response_received',aa);this.handleResponse(aa,w);this.respond(x,this.buildUids(x),true,aa.payload&&(!aa.payload.results||aa.payload.results.length===0));this.inform('backend_response',aa);}.bind(this,this._curQueryId)).setFinallyHandler(this.activityEnd.bind(this));this.inform('sending_request',y);this.activityStart();y.send();},activityStart:function(){if(!this._waitingQueries)this.inform('activity',{activity:true,seeMore:this._seeMore},g.BEHAVIOR_STATE);this._waitingQueries++;},activityEnd:function(){this._waitingQueries--;if(!this._waitingQueries)this.inform('activity',{activity:false,seeMore:this._seeMore},g.BEHAVIOR_STATE);},respond:function(w,x,y,z){this.inform('reorderResults',x);this.inform('respondValidUids',x);var aa=x.map(this.getEntry.bind(this));this.inform('respond',{value:w,results:aa,isAsync:!!y,isEmptyResults:z,isScrollable:this.isSeeMore()});return aa;},_updateMaxResults:function(){var w=o.getViewportDimensions().y,x=p.getTop()||42,y=56,z=48;this.setMaxResults(Math.max(this._numResults.min,Math.min(this._numResults.max,Math.floor((w-x-z-25)/y)-1)));},getCurQueryId:function(){return this._curQueryId;}});e.exports=v;});
__d("FacebarFragmentRenderer",["DOM"],function(a,b,c,d,e,f){var g=b('DOM');function h(l,m,n){var o=l.structure.getFragment(m),p=null,q=l.bolding&&l.bolding[m];if(typeof q=="number"){p=[q,o.getLength()-q];}else if(q)p=q;if(p&&p.length){return g.create('span',{},i(o.getText(),p,n));}else return g.create('span',{className:l.bolding&&n.unchanged||''},o.getText());}function i(l,m,n){var o=[],p=false,q=0;m.forEach(function(r){var s=l.substr(q,r),t=p?n.changed:n.unchanged;if(r&&t){o.push(g.create('span',{className:t},s));}else o.push(s);q+=r;p=!p;});return o;}function j(l,m){var n={};l.forEach(function(o,p){if(o.type.lastIndexOf('ent:',0)===0)n[p]=k(m,o);});return n;}function k(l,m){var n=false,o=[];l.tokens.forEach(function(s){if(typeof s=='object'){if(s.uid==m.getUID())n=true;}else{o.push(s);if(s.length>2&&s.substr(s.length-2)=='\'s')o.push(s.substr(0,s.length-2));}});if(n)return;var p=m.getText().split(' '),q='',r=[];p.forEach(function(s,t){var u=0;o.forEach(function(v){if(v.length>u&&s.toLowerCase().indexOf(v)===0)u=v.length;});q+=s.substr(0,u);if(u!=s.length){r.push(q.length);r.push(s.length-u);q='';}if(t<p.length-1)q+=' ';});r.push(q.length);return r;}e.exports={renderFragment:h,computeEntBolding:j};});
__d("FacebarTypeaheadItem",["copyProperties","createArrayFrom","CSS","cx","DOM","FacebarFragmentRenderer","hasArrayNature","tx"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('createArrayFrom'),i=b('CSS'),j=b('cx'),k=b('DOM'),l=b('FacebarFragmentRenderer'),m=b('hasArrayNature'),n=b('tx'),o="_7gk",p="_53ad",q=l.renderFragment;function r(v){var w=v.getTypePart(0);return w?"fragment"+w.charAt(0).toUpperCase()+w.substr(1):"fragment";}function s(v,w){w.forEach(function(x){if(m(x)){s(v,x);}else if(x)v.push(x);});}function t(v,w){return k.create('span',{className:v},w);}function u(v){this._result=v;this._aux=null;this._debug=null;this._renderEducation=true;this._classes=(v.classNames||'').split(' ');this._captionOptions={};this._shouldVAlign=false;this.addClass("_202");}g(u.prototype,{setCaptionOptions:function(v){this._captionOptions=v;this._shouldVAlign=this._captionOptions.valign;return this;},setVAlign:function(v){this._shouldVAlign=v;return this;},shouldVAlign:function(){return this._shouldVAlign;},addClass:function(v){this._classes.push(v);},setAux:function(v){this._aux=v;return this;},setShouldRenderEducation:function(v){this._renderEducation=v;return this;},setDebug:function(v){this._debug=v;return this;},makeChildren:function(){var v=[];s(v,h(arguments));return v;},renderText:function(){return this._result.structure.toArray().map(function(v,w){var x=q(this._result,w,{});return i.addClass(x,r(v));}.bind(this));},renderAux:function(){return this._aux?[this._aux]:[];},renderSubtext:function(){return [];},renderIcon:function(){return [];},renderEduContent:function(){if(!this._renderEducation)return [];var v="Use {tab} key to select".split('{tab}'),w=k.create('span',{className:"_78d"},"Tab");return k.create('span',{className:"_6ji"},this.makeChildren(v[0],w,v[1]));},render:function(){var v=this.renderAux(),w=this.renderIcon(),x=this.renderText(),y=this.renderEduContent(),z=this.renderSubtext(),aa=this._debug,ba=[],ca=null;if(this.shouldVAlign()){ca=t(p,this.makeChildren(x,z));ba.push(ca);}else{ca=t(p,x);ba.push(ca,z);}i.conditionClass(ca,"_53ae",this.shouldVAlign()&&z);ba.push(y,aa);var da=t(o,this.makeChildren(ba)),ea=k.create('a',{className:"_205",href:this._result.uri,rel:'ignore'},k.create('span',{className:"_6i1 fbFacebarTypeaheadItemMainContent"},this.makeChildren(w,da))),fa=k.create('span',{className:"_6i2 fbFacebarTypeaheadItemAuxContent"},this.makeChildren(v,this._aux));if(w)this._classes.push("_6_k");var ga=k.create('li',{className:this._classes.join(' ')},[ea,fa]);ga.setAttribute('aria-label',this._result.structure.toString());return ga;}});e.exports=u;});
__d("FacebarTypeaheadToken",["copyProperties","cx","DOM","CSS"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('cx'),i=b('DOM'),j=b('CSS'),k='\u00B7',l="_8ox",m="_13xm",n="_53a9",o="_53aa",p="_53ab",q="_53ac";function r(t,u){return i.create('span',{className:t},u);}function s(t){this._text=t;this._permanent=false;this._limit=null;this._showpill=true;}g(s.prototype,{setShowPill:function(t){this._showpill=t;return this;},setPermanent:function(t){this._permanent=t;return this;},setExpanded:function(t){this._expanded=t;return this;},setLimit:function(t){this._limit=t;return this;},getText:function(){return this._text;},render:function(){var t=this.getText();if(t.length){this._limit&&t.splice(this._limit);var u=t.shift(),v=[];t.forEach(function(x){v.push(' '+k+' ');v.push(x);});var w=r(n,r(o,[u,v.length?r(p,v):null]));j.conditionClass(w,q,this._showpill);j.conditionClass(w,l,this._permanent);j.conditionClass(w,m,this._expanded);return w;}}});e.exports=s;});
__d("FacebarTypeaheadEntityToken",["copyProperties","FacebarTypeaheadToken","Class","DOM","HTML"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('FacebarTypeaheadToken'),i=b('Class'),j=b('DOM'),k=b('HTML'),l='\u00B7';function m(n){this.parent.construct(this);this._entity=n;this._default={};this._showLeadingMiddot=false;}i.extend(m,h);g(m.prototype,{setLeadingMiddot:function(n){this._showLeadingMiddot=n;return this;},setDefaultText:function(n,o){this._default[n]=o;return this;},getText:function(){var n=[],o={},p=function(r){r=r.trim();if(!o[r]){n.push(r);o[r]=1;}},q=function(r){if(typeof r=='object')r=j.getText(k(r).getRootNode());r&&r.split(l).map(p);};q(this._entity.category||this._default[this._entity.type]);q(this._entity.subtext);if(this._showLeadingMiddot&&n.length)n[0]=' '+l+' '+n[0];return n;}});e.exports=m;});
__d("FacebarTypeaheadEntityItem",["Class","copyProperties","CSS","cx","DOM","FacebarTypeaheadItem","FacebarTypeaheadEntityToken","tx","TypeaheadFacepile"],function(a,b,c,d,e,f){var g=b('Class'),h=b('copyProperties'),i=b('CSS'),j=b('cx'),k=b('DOM'),l=b('FacebarTypeaheadItem'),m=b('FacebarTypeaheadEntityToken'),n=b('tx'),o=b('TypeaheadFacepile');function p(q){this.parent.construct(this,q);this.addClass("_20e");this._expandToken=false;}g.extend(p,l);h(l.prototype,{setExpandToken:function(q){this._expandToken=q;return this;},renderSubtext:function(){return new m(this._result).setDefaultText('user',"Timeline").setPermanent(true).setShowPill(!this._captionOptions.nopill).setExpanded(this._expandToken).render();},renderIcon:function(){var q=this._result.photos||this._result.photo;if(!q)return null;if(q instanceof Array){q=o.render(q);i.addClass(q,"_51l_");return q;}else return k.create('img',{className:"_20h",alt:'',src:q});}});e.exports=p;});
__d("FacebarDisambiguationDialog",["Event","BrowseLogger","copyProperties","CSS","cx","Dialog","DOM","FacebarStructuredText","FacebarTypeaheadEntityItem","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('BrowseLogger'),i=b('copyProperties'),j=b('CSS'),k=b('cx'),l=b('Dialog'),m=b('DOM'),n=b('FacebarStructuredText'),o=b('FacebarTypeaheadEntityItem'),p=b('tx'),q=650;function r(s,t,u,v,w){this._sets=s;this._path=t;this._ondone=u;this._oncancel=v;this._selection=[];this._typeaheadSID=w;}i(r.prototype,{show:function(){new l().setTitle("Which of these did you mean?").setBody(this._createBody()).setContentWidth(q).setModal(true).setButtons([l.CONFIRM,l.CANCEL]).setHandler(this._handleDone.bind(this)).setCancelHandler(this._handleCancel.bind(this)).show();this._sets.forEach(function(s){var t=[];s.forEach(function(v){t.push(v.uid);});var u=s[0];h.logDisambiguationImpression(u.text,u.type,this._path,t.join(','),this._typeaheadSID);}.bind(this));},_createBody:function(){var s=[];this._sets.forEach(function(t,u){s.length&&s.push(m.create('li',{className:"_200"}));t.forEach(function(v){var w=this._createItem(v,u);this._selection[u]||this._selectItem(w);s.push(w.root);}.bind(this));}.bind(this));return m.create('ul',{className:'viewList disambiguationList'},s);},_createItem:function(s,t){var u={uri:null,subtext:s.subtext,category:s.category,photo:s.photo,type:s.type,structure:n.fromStruct([{text:s.text,type:'ent:'+s.type,uid:s.uid}])},v=m.create('div',{className:"_201"}),w=new o(u).setAux(j.hide(v)).setExpandToken(true).setShouldRenderEducation(false).render(),x={setId:t,result:s,root:w,check:v};j.addClass(w,"_6i3");g.listen(w,'mouseover',this._toggleHover.bind(this,x,true));g.listen(w,'mouseout',this._toggleHover.bind(this,x,false));g.listen(w,'click',function(event){this._selectItem(x);return event.kill();}.bind(this));return x;},_toggleHover:function(s,t){j.conditionClass(s.root,'selected',t);},_toggleCheck:function(s,t){j.conditionShow(s.check,t);},_selectItem:function(s){var t=this._selection[s.setId];this._selection[s.setId]=s;t&&this._toggleCheck(t,false);this._toggleCheck(s,true);},_handleDone:function(s){this._ondone(s==l.CONFIRM?this._selection.map(function(t){var u=t.result;h.logDisambiguationClick(u.text,u.type,this._path,u.index,u.uid,this._typeaheadSID);return u;}.bind(this)):null);},_handleCancel:function(){this._oncancel();}});e.exports=r;});
__d("FacebarTypeahead",["Arbiter","Class","Typeahead","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Class'),i=b('Typeahead'),j=b('copyProperties'),k=b('emptyFunction');function l(m,n,o,p,q,r){this.parent.construct(this,m,n,o,p);this.getCore();this.proxyEvents();this.initBehaviors(q||[]);var s=this.core.subscribe('focus',function(){if(r)r.init(this);this.core.unsubscribe(s);this.data.bootstrap(false);this.core.input.focus();}.bind(this));this.data.bootstrap(true);this.inform('init',this,g.BEHAVIOR_PERSISTENT);g.inform('Facebar/init',this,g.BEHAVIOR_PERSISTENT);}h.extend(l,i);j(l.prototype,{init:k,proxyEvents:function(){var m,n=[],o=null,p=(function(){while(m=n.shift())this.inform(m[0],m[1]);o=null;}).bind(this);[this.data,this.view,this.core].forEach(function(q){q.subscribe(q.events,function(r,s){n.push([r,s]);o=o||p.defer();}.bind(this));},this);}});e.exports=l;});
__d("StructuredInputDOM",["createArrayFrom","CSS","DOM"],function(a,b,c,d,e,f){var g=b('createArrayFrom'),h=b('CSS'),i=b('DOM'),j={ENTITY_CLASS:'structuredEntity',encodeText:function(k){return k.replace(/ /g,'\u00a0');},decodeText:function(k){return k.replace(/\u00a0/g,' ');},createIconNode:function(k){if(k&&typeof k=='object'){var l=i.create('i',{className:k.className,style:k.uri&&{backgroundImage:'url("'+k.uri+'")'}});l.setAttribute('data-select','ignore');return l;}},createTextNode:function(k){return i.create('span',{'data-si':true},j.encodeText(k||""));},createEntityNode:function(k,l){var m=j.encodeText(k.text),n=j.createIconNode(l.icon),o=i.create('span',{},n?[n,m]:m),p=(l.className||'').split(/\s+/);p.push(j.ENTITY_CLASS);p.forEach(h.addClass.bind(h,o));var q={si:true,uid:k.uid,type:k.type,text:m,fulltext:m,group:l.group,select:l.select,icon:JSON.stringify(l.icon||null)};for(var r in q)if(q[r]!=null)o.setAttribute('data-'+r,q[r]);return o;},convertToTextNode:function(k){k.className='';k.setAttribute('data-type','text');k.removeAttribute('data-group');k.removeAttribute('data-select');k.removeAttribute('data-icon');k.removeAttribute('data-uid');for(var l=k.firstChild;l;l=l.nextSibling)if(!i.isTextNode(l))i.remove(l);},isEntityNode:function(k){return k&&h.hasClass(k,j.ENTITY_CLASS);},containsOnlyText:function(k,l){l=g(l);for(var m=k.firstChild;m;m=m.nextSibling)if(!(i.isTextNode(m)||k.nodeName in l))return false;return true;},getText:function(k){return i.getText(k).replace(/ /g,'\u00a0');},getDecodedText:function(k){return j.decodeText(i.getText(k));},getLength:function(k){return i.getText(k).length;},getMarker:function(k,l,m){var n=k.firstChild;while(n){var o=j.getLength(n);if(o>l||!n.nextSibling){if(i.isTextNode(n)||!m){return {node:n,offset:Math.min(l,o)};}else return j.getMarker(n,l);}else l-=o;n=n.nextSibling;}}};e.exports=j;});
__d("StructuredInputUtil",["StructuredInputDOM"],function(a,b,c,d,e,f){var g=b('StructuredInputDOM');function h(n,o,p){var q=n.substr(0,o).lastIndexOf(p);return q!==-1?q+1:0;}function i(n,o,p){var q=n.indexOf(p,o);return q!==-1?q:n.length;}function j(n,o,p){return (o===0||o===n.length||n.substr(o,p.length)==p);}function k(n,o,p,q){switch(o){case 'none':return p;case 'all':return q?n.length:0;case 'word':if(j(n,p,'\u00a0')){return p;}else if(q){return i(n,p,'\u00a0');}else return h(n,p,'\u00a0');}}function l(n,o){return o&&g.isEntityNode(n)&&!g.isEntityNode(o);}var m={getMarkerAtOffset:function(n,o){var p=n.firstChild,q=0,r=0;while(p){q+=r;r=g.getLength(p);if(q+r>o){break;}else p=p.nextSibling;}return {node:p||n.lastChild,offset:o-q};},validateEntityText:function(n){var o=g.getText(n),p=n.getAttribute('data-fulltext'),q=n.getAttribute('data-group'),r=o.indexOf(p),s={prefix:null,entity:null,suffix:null};switch(q){case 'none':s.entity=o;break;case 'all':if(r!=-1){s.prefix=o.substr(0,r);s.entity=o.substr(r,p.length);s.suffix=o.substr(r+p.length);}else s.suffix=o;break;case 'word':if(r!=-1){s.prefix=o.substr(0,r);o=o.substr(r);}var t=0,u=0;while(t<p.length){u=i(p,t+1,'\u00a0');if(o.substr(0,u)!=p.substr(0,u)){break;}else t=u;}s.entity=o.substr(0,t)||null;s.suffix=o.substr(t)||null;}return s;},getGrouping:function(n,o){var p=n.getAttribute('data-group'),q=n.getAttribute('data-select');if(o=='select'){return q=='group'?p:'none';}else return p;},snapMarkerToText:function(n,o){var p=n.node;if(g.isEntityNode(p)){var q=n.offset,r=m.getGrouping(p,o);if(r!='none')if(q===0){var s=p.previousSibling;if(l(p,s))return {node:s,offset:g.getLength(s)};}else if(q==g.getLength(p)){var t=p.nextSibling;if(l(p,t))return {node:t,offset:0};}}return n;},nextMarkerBoundary:function(n,o,p){var q=n.node;if(g.isEntityNode(q)){var r=m.getGrouping(q,p);if(r!='none')return {node:n.node,offset:k(g.getText(q),r,n.offset,o)};}return n;}};e.exports=m;});
__d("StructuredInputCleaner",["DOM","createArrayFrom","copyProperties","StructuredInputUtil","StructuredInputDOM","UserAgent"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('createArrayFrom'),i=b('copyProperties'),j=b('StructuredInputUtil'),k=b('StructuredInputDOM'),l=b('UserAgent');function m(n,o){this._node=n;this._wrapText=o;}i(m.prototype,{_cleanEntityNode:function(n){var o=n.getAttribute('data-text'),p=k.getText(n);n.style.cssText='';if(o==p&&k.containsOnlyText(n,{I:true}))return null;var q=[],r=j.validateEntityText(n),s=k.createIconNode(JSON.parse(n.getAttribute('data-icon')));if(!r.entity&&((r.suffix&&!r.prefix)||(r.prefix&&!r.suffix))){k.convertToTextNode(n);n.setAttribute('data-text',p);return null;}if(r.prefix)q.push(this._createTextNode(r.prefix));if(r.entity){g.setContent(n,s?[s,r.entity]:r.entity);n.setAttribute('data-text',r.entity);q.push(n);}if(r.suffix)q.push(this._createTextNode(r.suffix));return q;},_cleanTextNodes:(function(){var n=function(p){return (p.nodeName==='BR'||p.nodeName==='SPAN'&&o(p));},o=function(p){return p.getAttribute('data-si')&&k.containsOnlyText(p)&&k.getLength(p)>0;};return function(p){if(p.length!=1||!n(p[0])){var q=p.map(k.getText).join('');return q?[this._createTextNode(q)]:[];}else{p[0].style.cssText='';return;}};})(),_removeSpecialNodes:function(){var n=h(this._node.getElementsByTagName('script')),o=h(this._node.getElementsByTagName('style'));n.forEach(g.remove);o.forEach(g.remove);},_collapseNodes:function(){for(var n,o=this._node.firstChild;o;o=n){n=o.nextSibling;if(!g.isTextNode(o)&&!k.isEntityNode(o)&&!k.containsOnlyText(o))for(var p=o.lastChild;p;p=o.lastChild){this._node.insertBefore(p,n);n=p;}}},_createTextNode:function(n){if(this._wrapText){return k.createTextNode(n);}else return document.createTextNode(n);},replaceNodes:function(n,o){if(o==null)return;var p=n.length?n[n.length-1].nextSibling:null;n.forEach(g.remove);o.forEach(function(q){this._node.insertBefore(q,p);}.bind(this));},clean:function(){this._removeSpecialNodes();this._collapseNodes();var n=[],o=function(){if(n.length){this.replaceNodes(n,this._cleanTextNodes(n));n.length=0;}}.bind(this);h(this._node.childNodes).forEach(function(p){if(k.isEntityNode(p)){this.replaceNodes([p],this._cleanEntityNode(p));o(n);}else n.push(p);}.bind(this));o();if(!this._node.firstChild&&l.firefox())this._node.appendChild(this._createTextNode());},endOnText:function(){var n=function(o,p){if(k.isEntityNode(o))this._node.insertBefore(this._createTextNode(),p?o:null);}.bind(this);n(this._node.firstChild,true);n(this._node.lastChild,false);}});e.exports=m;});
__d("DOMSelection",[],function(a,b,c,d,e,f){(function(){var g=this,h={isPreceding:function(m,n){return n.compareDocumentPosition(m)&2;},contains:function(m,n){if(m.compareDocumentPosition!=null){return m.compareDocumentPosition(n)&16;}else return m.contains(n);},isCursorPreceding:function(m,n,o,p){if(m===o)return n<=p;if(h.isText(m)&&h.isText(o))return h.isPreceding(m,o);if(h.isText(m)&&!h.isText(o))return !h.isCursorPreceding(o,p,m,n);if(!h.contains(m,o))return h.isPreceding(m,o);if(m.childNodes.length<=n)return false;if(m.childNodes[n]===o)return 0<=p;return h.isPreceding(m.childNodes[n],o);},isText:function(m){return (m!=null?m.nodeType==3:false);},getChildIndex:function(m){var n=0;while(m=m.previousSibling)n++;return n;}},i=g.Selection=(function(){function m(n){this.win=n;}m.prototype.hasSelection=function(){return m.hasSelection(this.win);};m.prototype.isBidirectional=function(){return m.isBidirectional(this.win);};m.prototype.getOrigin=function(){return m.getOrigin(this.win);};m.prototype.getFocus=function(){return m.getFocus(this.win);};m.prototype.getStart=function(){return m.getStart(this.win);};m.prototype.getEnd=function(){return m.getEnd(this.win);};m.prototype.trySelection=function(n,o,p,q){return m.trySelection(this.win,n,o,p,q);};m.prototype.setSelection=function(n,o,p,q){return m.setSelection(this.win,n,o,p,q);};m.prototype.clearSelection=function(){return m.clearSelection(this.win);};return m;})();if(g.getSelection&&!g.document.selection){i.supported=true;i.hasSelection=function(m){var n;return (n=m.getSelection())&&(n.focusNode!=null)&&(n.anchorNode!=null);};i.isBidirectional=function(m){return true;};i.getOrigin=function(m){var n;if(!((n=m.getSelection())&&(n.anchorNode!=null)))return null;return [n.anchorNode,n.anchorOffset];};i.getFocus=function(m){var n;if(!((n=m.getSelection())&&(n.focusNode!=null)))return null;return [n.focusNode,n.focusOffset];};i.getStart=function(m){var n,o,p,q,r,s;if(!i.hasSelection(m))return null;r=i.getOrigin(m),n=r[0],p=r[1];s=i.getFocus(m),o=s[0],q=s[1];if(h.isCursorPreceding(n,p,o,q))return [n,p];return [o,q];};i.getEnd=function(m){var n,o,p,q,r,s;if(!i.hasSelection(m))return null;r=i.getOrigin(m),n=r[0],p=r[1];s=i.getFocus(m),o=s[0],q=s[1];if(h.isCursorPreceding(n,p,o,q))return [o,q];return [n,p];};var j=function(m,n,o,p,q,s){var t=n.getSelection();if(!t)return;if(q==null)q=o;if(s==null)s=p;if(t.collapse&&t.extend){t.collapse(o,p);t.extend(q,s);}else{r=n.document.createRange();r.setStart(o,p);r.setEnd(q,s);if(m||!i.hasSelection(n)||(r.endContainer===q&&r.endOffset===s&&r.startContainer===o&&r.startOffset===p)){try{t.removeAllRanges();}catch(u){}t.addRange(r);}}};i.setSelection=j.bind(i,true);i.trySelection=j.bind(i,false);i.clearSelection=function(m){try{var o=m.getSelection();if(!o)return;o.removeAllRanges();}catch(n){}};i.getText=function(m){var n=m.getSelection();if(!n)return;return n.toString();};}else if(g.document.selection){var k=function(m,n,o){var p,q,r,s,t;q=m.createElement('a');p=n.duplicate();p.collapse(o);t=p.parentElement();while(true){t.insertBefore(q,q.previousSibling);p.moveToElementText(q);if(!(p.compareEndPoints((o?'StartToStart':'StartToEnd'),n)>0&&(q.previousSibling!=null)))break;}if(p.compareEndPoints((o?'StartToStart':'StartToEnd'),n)===-1&&q.nextSibling){p.setEndPoint((o?'EndToStart':'EndToEnd'),n);r=q.nextSibling;s=p.text.length;}else{r=q.parentNode;s=h.getChildIndex(q);}q.parentNode.removeChild(q);return [r,s];},l=function(m,n,o,p,q){var r,s,t,u,v;v=0;r=h.isText(p)?p:p.childNodes[q];s=h.isText(p)?p.parentNode:p;if(h.isText(p))v=q;u=m.createElement('a');s.insertBefore(u,r||null);t=m.body.createTextRange();t.moveToElementText(u);u.parentNode.removeChild(u);n.setEndPoint((o?'StartToStart':'EndToEnd'),t);return n[o?'moveStart':'moveEnd']('character',v);};i.supported=true;i.hasSelection=function(m){var n;if(!m.document.selection)return false;n=m.document.selection.createRange();return n&&n.parentElement().document===m.document;};i.getStart=function(m){var n;if(!i.hasSelection(m))return null;n=m.document.selection.createRange();return k(m.document,n,true);};i.getEnd=function(m){var n;if(!i.hasSelection(m))return null;n=m.document.selection.createRange();return k(m.document,n,false);};i.isBidirectional=function(m){return false;};i.getOrigin=function(m){return i.getStart(m);};i.getFocus=function(m){return i.getEnd(m);};var j=function(m,n,o,p,q,r){if(q==null)q=o;if(r==null)r=p;var s=n.document.body.createTextRange();l(n.document,s,false,q,r);l(n.document,s,true,o,p);return s.select();};i.setSelection=j.bind(i,true);i.trySelection=j.bind(i,false);i.clearSelection=function(m){return m.document.selection.empty();};i.getText=function(m){if(!i.hasSelection(m))return null;var n=m.document.selection.createRange();return n&&n.text;};}else i.supported=false;}).call(this);e.exports=Selection;});
__d("StructuredInputSelection",["DOMSelection","Vector","copyProperties","StructuredInputUtil","StructuredInputDOM"],function(a,b,c,d,e,f){var g=b('DOMSelection'),h=b('Vector'),i=b('copyProperties'),j=b('StructuredInputUtil'),k=b('StructuredInputDOM');function l(n){var o=n.ownerDocument;this.window=o.defaultView||o.parentWindow;this.root=n;this.selection=false;this.start=new m(this,[]);this.end=new m(this,[]);this.update();}i(l.prototype,{isSupported:function(){return !!(g&&g.hasSelection);},update:function(){this.selection=false;if(this.isSupported()&&this.root==document.activeElement)if(g.hasSelection(this.window)){var n=g.getStart(this.window),o=g.getEnd(this.window),p=g.getFocus(this.window);this.start=this.makeMarker(n);this.end=this.makeMarker(o);this.backward=n[0]==p[0]&&n[1]==p[1];this.selection=this.start.node&&this.end.node;}},makeMarker:function(n){if(n[0]===this.root){return new m(this,[this.root.childNodes[n[1]],0]);}else return new m(this,n);},getFocus:function(){return this.backward?this.start:this.end;},getOrigin:function(){return this.backward?this.end:this.start;},move:function(n){if(this.selection){this.start.move(n);this.start.snap();this.end.setPosition(this.start);return this.apply();}},expand:function(n){if(this.selection){if(g.isBidirectional()){this.start.move(!n);this.start.snap();this.end.move(n);this.end.snap();}return this.apply();}},getText:function(){if(this.selection&&this.isSupported()){var n=g.getText(this.window);return n;}},getOffset:function(){if(this.selection)return this.start.rootOffset;},getLength:function(){return (this.getText()||"").length;},setPosition:function(n,o){this.backward=false;this.selection=true;this.start.setPosition(j.getMarkerAtOffset(this.root,n));this.start.snap();if(o>0){this.end.setPosition(j.getMarkerAtOffset(this.root,n+o));this.end.snap();}else this.end.setPosition(this.start);return this.apply();},hasRange:function(){return this.selection&&(this.start.node!=this.end.node||this.start.offset!=this.end.offset);},scrollToFocus:function(){var n=5,o=this.getFocus();if(o.node){var p=h.getElementDimensions(this.root).x,q=this.root.scrollLeft,r=o.node.offsetLeft+o.node.offsetWidth;if(r-q<n){this.root.scrollLeft=r-n;}else if(r-q>p-n)this.root.scrollLeft=r-p+n;}},apply:function(){if(this.start.hasChanged()||this.end.hasChanged()){var n=this.getOrigin().getMarker(true),o=this.getFocus().getMarker(true);this.selection=this.selection&&n&&n.node&&o&&o.node;if(this.selection&&this.isSupported()){this.start.changed=false;this.end.changed=false;g.trySelection(this.window,n.node,n.offset,o.node,o.offset);return true;}}}});function m(n,o){this.selection=n;this.node=o[0];this.offset=o[1];this.rootOffset=this.getRootOffset(o[0],o[1]);this.sibling=this.node&&this.node.previousSibling;this.changed=false;}i(m.prototype,{hasChanged:function(){return this.changed||!this.isNodeValid();},isNodeValid:function(){if(k.getLength(this.node)>this.offset){var n=this.node;while(n=n.parentNode)if(n==this.selection.root)return true;}},getMarker:function(n){if(this.isNodeValid()&&((n&&!this.node.firstChild)||(!n&&this.node.parentNode==this.selection.root))){return this;}else return k.getMarker(this.selection.root,this.rootOffset,n);},move:function(n){this.node&&this.setPosition(j.nextMarkerBoundary(this.getMarker(false),n,'select'));},snap:function(){this.node&&this.setPosition(j.snapMarkerToText(this.getMarker(false),'select'));},setPosition:function(n){if(n.offset!=this.offset||n.node!=this.node){this.changed=true;this.node=n.node;this.offset=n.offset;this.rootOffset=this.getRootOffset(this.node,this.offset);}},getRootOffset:function(n,o){var p=0,q=5;while(n&&p++<q)if(n===this.selection.root){return o;}else{var r=n;while(r=r.previousSibling)o+=k.getLength(r);n=n.parentNode;}}});e.exports=l;});
__d("StructuredInput",["Event","Arbiter","ArbiterMixin","CSS","DataStore","DOM","Input","InputSelection","Keys","Parent","requestAnimationFrame","StructuredInputCleaner","StructuredInputDOM","StructuredInputSelection","StructuredInputUtil","Style","UserAgent","copyProperties","createArrayFrom","createObjectFrom","emptyFunction"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('CSS'),k=b('DataStore'),l=b('DOM'),m=b('Input'),n=b('InputSelection'),o=b('Keys'),p=b('Parent'),q=b('requestAnimationFrame'),r=b('StructuredInputCleaner'),s=b('StructuredInputDOM'),t=b('StructuredInputSelection'),u=b('StructuredInputUtil'),v=b('Style'),w=b('UserAgent'),x=b('copyProperties'),y=b('createArrayFrom'),z=b('createObjectFrom'),aa=b('emptyFunction'),ba=229,ca=z([o.UP,o.DOWN,o.LEFT,o.RIGHT]),da=z([o.BACKSPACE,o.DELETE]),ea=z('IUB'.split('').map(function(ja){return ja.charCodeAt(0);})),fa=w.firefox(),ga=w.ie(),ha=w.webkit();function ia(ja){k.set(ja,'StructuredInput',this);this._root=ja;this._richInput=l.find(ja,'div.structuredRich');this._textInput=l.find(ja,'.structuredText');this._placeholderText=l.scry(ja,'.structuredPlaceholder')[0];this._hintText=l.find(ja,'.structuredHint');this._contentWidth=null;this._richWidth=null;this._hintNodes=[];this.init();}ia.getInstance=function(ja){var ka=p.byClass(ja,'uiStructuredInput');return ka?k.get(ka,'StructuredInput'):null;};x(ia.prototype,i,{init:function(){this.init=aa;this._initSelection();this._initCleaner();this._initInputs();this._initEvents();this._scheduledCleanInput=false;this._richChanged=false;this._textChanged=false;this._selectionChanged=false;this._selectionIgnore=false;this._imeMode=false;this.cleanInput();this.inform('init',null,h.BEHAVIOR_PERSISTENT);},_initInputs:function(){this._richInput.contentEditable=true;this._richInput.spellcheck=false;this._richInput.tabIndex=0;this._textInput.tabIndex=-1;this._multiline=this._textInput.nodeName=='TEXTAREA';if(!j.shown(this._richInput)){var ja=n.get(this._textInput);l.setContent(this._richInput,s.encodeText(m.getValue(this._textInput)));j.hide(this._textInput);j.show(this._richInput);this.cleanInput();this.setSelection({offset:ja.start,length:ja.end-ja.start});}this.togglePlaceholder();this._toggleHint();},_initEvents:function(){var ja=null;g.listen(this._richInput,'keydown',function(ka){ja=null;if(ka.ctrlKey&&ka.keyCode in ea){return ka.kill();}else if(ka.keyCode in ca){this._selectionChanged=true;this.scheduleCleanInput(false);}else if(ka.keyCode in da){this._richChanged=true;this.scheduleCleanInput(true);if(ka.keyCode===o.BACKSPACE)if(this._deleteTrailingChunk())return ka.kill();}else if(ka.keyCode==ba){this._imeMode=true;j.hide(this._placeholderText);}}.bind(this));g.listen(this._richInput,'keyup',function(ka){if(ka.keyCode==o.RETURN&&ja!=o.RETURN){this._imeMode=false;this._richChanged=true;this.scheduleCleanInput();}}.bind(this));g.listen(this._richInput,'keypress',function(ka){ja=ka.keyCode;if(ka.keyCode==o.RETURN){this._multiline&&this._insertText("\n");return ka.kill();}else if(!this._selectionChanged&&this._selectionIsText()){this._textChanged=true;this.scheduleCleanInput(false);}else{this._richChanged=true;this.scheduleCleanInput(true);}}.bind(this));g.listen(document,'selectionchange',function(){if(this._selectionIgnore){this._selectionIgnore=false;}else this._selectionChanged=true;}.bind(this));g.listen(this._richInput,'mousedown',function(){this._selectionChanged=true;this._selectionLength=0;this._selectionOffset=0;}.bind(this));g.listen(this._richInput,'mouseup',function(){this._selectionChanged=true;q(this.cleanInput.bind(this));}.bind(this));g.listen(this._richInput,'cut',function(){this._richChanged=true;this.scheduleCleanInput(false);}.bind(this));g.listen(this._richInput,'paste',function(ka){if(this._insertClipboard(ka&&ka.clipboardData||window.clipboardData)){return ka.kill();}else{this._richChanged=true;this.scheduleCleanInput(true);}}.bind(this));g.listen(this._richInput,'drop',function(ka){this.focus();this.selectAll();this._insertClipboard(ka&&ka.dataTransfer);return ka.kill();}.bind(this));g.listen(this._richInput,'dragover',function(ka){ka.dataTransfer.dropEffect='move';ka.dataTransfer.effectAllowed='move';return ka.kill();});g.listen(this._richInput,'focus',function(ka){this._toggleHint();this.inform('focus');}.bind(this));g.listen(this._richInput,'blur',function(ka){j.hide(this._hintText);this._imeMode=false;this._richChanged=true;this.scheduleCleanInput(false);this.inform('blur');}.bind(this));},_initCleaner:function(){this._cleaner=new r(this._richInput,true);},_initSelection:function(){this._selection=new t(this._richInput);this._selectionLength=0;this._selectionOffset=0;},_insertClipboard:function(ja){if(ja&&ja.getData){if(!ja.types){this._insertText(ja.getData('Text'));}else if(ja.types.indexOf('text/html')!=-1){this._insertHTML(ja.getData('text/html'));}else if(ja.types.indexOf('text/plain')!=-1)this._insertText(ja.getData('text/plain'));return true;}else return false;},_deleteTrailingChunk:function(ja){var ka=this.getSelection();if(ka.length>0||ka.offset===0)return false;var la=this.getSelection().offset-1,ma=u.getMarkerAtOffset(this._richInput,la);if(ma&&ma.node&&s.isEntityNode(ma.node)){l.remove(ma.node);return true;}return false;},_selectionIsText:function(){var ja=this._selection.start.node,ka=this._selection.end.node;return ja&&ja===ka&&!s.isEntityNode(ja)&&!s.isEntityNode(ja.parentNode);},_insertHTML:(function(){var ja=l.create('div'),ka=new r(ja,false);return function(la){if(la){ja.innerHTML=la;ka.clean();return this._insertNodes(ja);}};})(),_insertText:function(ja){if(ja){var ka=l.create('div',{},ja);return this._insertNodes(ka);}},_insertNodes:function(ja){if(document.selection){document.selection.createRange().pasteHTML(ja.innerHTML);}else document.execCommand('insertHTML',false,ja.innerHTML);this._richChanged=true;this.cleanInput();},togglePlaceholder:function(ja){if(!this._placeholderText)return;var ka=s.getLength(this._richInput)===0;if(ja&&ka){j.show(this._placeholderText);}else j.conditionShow(this._placeholderText,ka&&!this._imeMode);},_toggleHint:function(){var ja=y(this._hintNodes),ka=null,la='',ma=s.getText(this._richInput).toLowerCase();if(!this.hasFocus())return;if(this._contentOverflows()){j.hide(this._hintText);return;}while(ja.length&&la.length<ma.length){ka=ja.shift();la+=s.getText(ka);}if(ma.length&&la.substr(0,ma.length).toLowerCase()==ma.toLowerCase()){l.setContent(this._hintText,y(this._richInput.cloneNode(true).childNodes));var na=s.createTextNode(la.substr(ma.length));ja.unshift(na);l.appendContent(this._hintText,l.create('span',{className:'hintSuffix'},ja));j.show(this._hintText);j.hide(this._placeholderText);}else j.hide(this._hintText);},_contentOverflows:function(){if(this._richWidth===null)this._richWidth=this._richInput.clientWidth;if(this._contentWidth===null){var ja=this._richInput.lastChild;this._contentWidth=l.isElementNode(ja)?ja.offsetLeft+ja.offsetWidth:0;}return this._contentWidth>this._richWidth;},_forceTop:function(){if(!this._multiline)this._richInput.scrollTop=0;this._root.scrollTop=0;},_createStructureNodes:function(ja){return ja.map(function(ka){return ka.uid||(ka.type&&ka.type!='text')?s.createEntityNode(ka,ka.display||{}):s.createTextNode(ka.text);}.bind(this));},_suppressInput:function(){if(fa||ga){if(this._richClean)return;this._richClean=this._richInput.cloneNode(true);this._richClean.contentEditable=false;this._root.insertBefore(this._richClean,this._richInput.nextSibling);this._richClean.scrollLeft=this._richInput.scrollLeft;v.set(this._richInput,'padding',0);v.set(this._richInput,'height',0);}},_revealInput:function(){if(!this._richClean)return;v.set(this._richInput,'height','');v.set(this._richInput,'padding','');this._root.removeChild(this._richClean);this.focus();this._richClean=null;},_cleanInput:function(){var ja;if(this._textChanged&&!this._richChanged){this._selection.update();ja='change';}else if(this._richChanged||this._selectionChanged){this._selection.update();if(this._richChanged){this._contentWidth=null;this._cleaner.clean();this._cleaner.endOnText();this._selection.apply();ja='change';}if(this._selectionChanged){this._cleanSelection();if(this._selectionLength||!this._richChanged)ja='select';}}this._revealInput();this._forceTop();if(this._richChanged||this._textChanged){this.togglePlaceholder();this._toggleHint();}this._selectionIgnore=true;this._selectionChanged=false;this._richChanged=false;this._textChanged=false;ja&&this.inform(ja);},_cleanSelection:function(){var ja=this._selection.getLength(),ka=this._selection.getOffset();if(ja){this._selection.expand(ja>=this._selectionLength);ja=this._selection.getLength();ka=this._selection.getOffset();}this._selectionLength=ja;this._selectionOffset=ka;},cleanInput:function(){this._scheduledCleanInput||this._cleanInput();},scheduleCleanInput:function(ja){ja&&this._suppressInput();if(!this._scheduledCleanInput){this._scheduledCleanInput=true;q(function(){this._cleanInput();this._scheduledCleanInput=false;}.bind(this));}},setEnabled:function(ja){this._textInput.disabled=!ja;this._richInput.contentEditable=ja;},getRoot:function(){return this._root;},getRichInput:function(){return this._richInput;},getEnabled:function(){return !this._textInput.disabled;},getText:function(){return s.getDecodedText(this._richInput);},setText:function(ja){l.setContent(this._richInput,s.createTextNode(ja));this._richChanged=false;this._selectionChanged=false;this.inform('change');},setHint:function(ja){this._hintNodes=this._createStructureNodes(ja);this._toggleHint();},getStructure:function(){var ja=[];y(this._richInput.childNodes).forEach(function(ka){var la=!l.isTextNode(ka),ma=s.getDecodedText(ka);ma.length&&ja.push({text:ma,uid:la?ka.getAttribute('data-uid'):null,type:(la&&ka.getAttribute('data-type'))||'text'});}.bind(this));return ja;},setStructure:function(ja){l.setContent(this._richInput,this._createStructureNodes(ja));this._cleaner.endOnText();this._cleaner.clean();this.togglePlaceholder();this._toggleHint();this._richChanged=false;this._selectionChanged=false;this.inform('change');},getContentDimensions:function(){var ja=this._richInput.lastChild;return {width:ja?ja.offsetLeft+ja.offsetWidth:0,height:ja?ja.offsetTop+ja.offsetHeight:0};},getSelection:function(){return {offset:this._selection.getOffset(),length:this._selection.getLength()};},setSelection:function(ja){if(this.hasFocus()){this._selection.update();this._selection.setPosition(ja.offset,ja.length);this._selection.scrollToFocus();this._selectionChanged=false;this.inform('select');}},moveSelectionToEnd:function(){this.setSelection({length:0,offset:s.getLength(this._richInput)});},isSelectionAtEnd:function(){var ja=this.getSelection().offset,ka=s.getLength(this._richInput);return ja>=ka;},selectAll:function(){this.setSelection({offset:0,length:s.getLength(this._richInput)});},hasFocus:function(){return l.contains(this._root,document.activeElement);},focus:function(){this._richInput.focus();},blur:function(){var ja=l.create('input',{type:'text',tabIndex:-1,style:{position:'absolute',top:0,left:'-100px',width:'1px',height:'1px'}});l.appendContent(this._root,ja);var ka=function(){if(this.hasFocus()||(ha&&document.activeElement===document.body)){ja.focus();ja.blur();}};this.blur=ka;this.blur();}});e.exports=ia;});
__d("FacebarTypeaheadInput",["ArbiterMixin","DOM","FacebarStructuredText","StructuredInput","Vector","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('DOM'),i=b('FacebarStructuredText'),j=b('StructuredInput'),k=b('Vector'),l=b('copyProperties'),m={text:{className:"text",group:"all",select:"none"},grammar:{className:"grammar",group:"all",select:"none"},ent:{className:"entity",group:"all",select:"group"}};function n(p){return l(p.toStruct(),{display:m[p.getTypePart(0)]||{}});}function o(p){this.root=p;this.input=j.getInstance(p);this.value=null;this.selection={offset:0,length:0};this.resetOnChange=true;this.initEvents();}l(o.prototype,g,{events:['change','focus','blur'],initEvents:function(){var p=function(q,r){this.inform(q,r);}.bind(this);this.input.subscribe('blur',p);this.input.subscribe('focus',p);this.input.subscribe('change',function(q,r){if(this.resetOnChange)this.value=null;this.inform('change',r);}.bind(this));},togglePlaceholder:function(p){return this.input.togglePlaceholder(p);},focus:function(){this.input.focus();},blur:function(){this.input.blur();},getElement:function(){return this.root;},getRawPlaceholderElement:function(){return h.find(this.root,'.structuredPlaceholder');},getRawInputElement:function(){return h.scry(this.root,'.structuredRich')[0];},getValue:function(){if(this.value===null)this.value=i.fromStruct(this.input.getStructure());return this.value;},getLength:function(){return this.getValue().getLength();},resetPlaceholder:function(){this.input.resetPlaceholder();},setValue:function(p){p=p.pad();this.value=p;this.resetOnChange=false;var q=p.toArray().map(n);this.input.setStructure(q);this.input.setSelection({offset:p.getLength(),length:0});this.resetOnChange=true;},storeSelection:function(){this.selection=this.input.getSelection();},restoreSelection:function(){this.input.setSelection(this.selection);},setHint:function(p){var q=p?p.toArray().map(n):[];this.input.setHint(q);},isSelectionAtEnd:function(){return this.input.isSelectionAtEnd();},selectInput:function(p){this.input.setSelection({offset:p||0,length:this.getLength()});},getEndOffset:function(){var p=k.getElementDimensions(this.root),q=this.input.getContentDimensions();return Math.min(p.x,q.width);}});e.exports=o;});
__d("FacebarTypeaheadWebSearch",["startsWith","copyProperties","FacebarStructuredFragment","FacebarStructuredText"],function(a,b,c,d,e,f){var g=b('startsWith'),h=b('copyProperties'),i=b('FacebarStructuredFragment'),j=b('FacebarStructuredText'),k=new i({type:'ent:websuggestion',text:'Web Search: ',uid:null}),l=k.getText().toLowerCase().trim();function m(p,q){if(!p||p.type!=='websuggestion')return;var r=q.getValue().toArray();r.forEach(function(s){if(s.isType('ent')&&!s.isType('ent','user')&&s.getUID())if(p.extra_uri_params){p.extra_uri_params.qh=s.getUID();return;}});}function n(p){return p.getType()===k.getType();}function o(p){this._core=p.getCore();this._view=p.getView();this._input=this._core.input;}h(o,{addPrefix:function(p){if(!n(p.getFragment(0))){var q=[k].concat(p.toArray());return new j(q);}else return p;}});h(o.prototype,{enable:function(){this.changeListener=this._input.subscribe('change',this._changeWebSearch.bind(this));this.lockListener=this._input.subscribe('shortcut',this._lockWebSearch.bind(this));this._listener=this._view.subscribe('beforeSelect',this._beforeSelect.bind(this));},_changeWebSearch:function(){var p=this._input.getValue(),q=p.toArray(),r=q[0];if(r&&r.getType()==='text')if(g(r.getText().toLowerCase(),l)){q.splice(0,1,k,new i({text:r.getText().substr(l.length).replace(/^ /,'')}));this._replaceFragments(q);}else if(q.length>1&&q.some(n))this._replaceFragments([new i({text:p.toString()})]);},_replaceFragments:function(p){this._input.storeSelection();this._input.setValue(new j(p));this._input.restoreSelection();},_beforeSelect:function(p,q){m(q.selected,this._input);return true;},_lockWebSearch:function(p,q){if(q.shift){var r=this._input.getValue().toArray()[0];if(!r||!n(r))this._input.setValue(new j([k]));}},disable:function(){this.quickSelectListener.unsubscribe();this.changeListener.unsubscribe();this.lockListener.unsubscribe();}});e.exports=o;});
__d("FacebarTypeaheadCore",["Event","Arbiter","ArbiterMixin","Animation","arrayContains","Base64","copyProperties","CSS","DOM","FacebarSemanticQuery","FacebarStructuredText","FacebarTypeaheadInput","FacebarTypeaheadWebSearch","invariant","Keys","startsWith","Style"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('Animation'),k=b('arrayContains'),l=b('Base64'),m=b('copyProperties'),n=b('CSS'),o=b('DOM'),p=b('FacebarSemanticQuery'),q=b('FacebarStructuredText'),r=b('FacebarTypeaheadInput'),s=b('FacebarTypeaheadWebSearch'),t=b('invariant'),u=b('Keys'),v=b('startsWith'),w=b('Style');function x(y){m(this,y);}m(x.prototype,i,{events:['session','focus','select','change','execute','blur'],dataSourceReady:false,init:function(y,z,aa){this.init=function(){};this.data=y;this.view=z;this.root=aa;this.windowFocused=true;this.isFocused=false;this.keepOpen=false;this.shadowValue=null;this.hoverReplace=null;this.hoverAnimation=null;this.stickyQuery=null;this.settedQuery=null;this.selectedQuery=null;this.currentQuery=null;this.initSubcomponents();this.initEvents();this.checkValue();},initSubcomponents:function(){var y=o.find(this.root,'.uiStructuredInput');this.input=new r(y);this.view.setInputElement(this.input.getRawInputElement());},initEvents:function(){g.listen(this.root,'keydown',this.keydown.bind(this));g.listen(this.root.parentNode,'mousedown',this.mousedown.bind(this));g.listen(this.view.getElement(),'mousedown',this.mousedown.bind(this));g.listen(document,'mouseup',this.mouseup.bind(this));g.listen(window,'focus',this.focusWindow.bind(this));g.listen(window,'blur',this.blurWindow.bind(this));if(this.hoverPlaceholder){this.subscribe('faviconHide',this.hideInputValue.bind(this));this.subscribe('faviconShow',this.revealInputValue.bind(this));}this.view.subscribe('select',this.selectView.bind(this));this.view.subscribe('highlight',this.highlightView.bind(this));this.view.subscribe('render',this.highlightView.bind(this));this.input.subscribe('focus',this.focusInput.bind(this));this.input.subscribe('blur',this.blurInput.bind(this));this.input.subscribe('change',this.changeInput.bind(this));this.data.subscribe('activity',this.typeaheadActivity.bind(this));this.data.subscribe('respond',this.completeData.bind(this));this.data.subscribe('ready',this.typeaheadReady.bind(this));if(o.contains(this.input.root,document.activeElement)){this.isFocused=true;this._newSession();this.open();}},cleanQuery:function(y){y=m({},y)||{};if(!y.structure)y.structure=new q();t(y.structure instanceof q);if(y.type=='websuggestion')y.structure=s.addPrefix(y.structure);return y;},setPageQuery:function(y){y=this.cleanQuery(y);var z=this.input.getValue(),aa=y.structure,ba=!aa.isEmptyOrWhitespace()&&(z.isEmptyOrWhitespace()||z.toString().trim()==aa.toString().trim()),ca=!aa.toArray().some(function(da){return da.isType('text')&&!da.isWhitespace();});this.hoverReplace=ca?aa.trim():null;return this.selectQuery(y,ba);},selectQuery:function(y,z){z=z!==false;y=this.cleanQuery(y);if(z||!this.selectedQuery){if(z||this.getValue().isEmptyOrWhitespace())this.setQuery(y);this.selectedQuery=y;}return y;},completeSelection:function(){var y=this.view.getSelection();if(y&&!y.search){this.data.saveResult(y);this.setQuery(y);return true;}},setQuery:function(y,z){y=this.cleanQuery(y);this.input.setValue(y.structure);this.settedQuery=y;this.stickyQuery=z===false?this.stickyQuery:y;this.checkValue();},checkValue:function(){if(!this.view.visible||!this.dataSourceReady||this.getValue().matches(this.value))return;this.value=this.nextQuery=this.getValue();this.performQuery();},performQuery:function(){this.data.query(this.nextQuery);this.currentQuery=this.nextQuery;},expandView:function(){this.data.query(this.currentQuery,false,[],true);this.input.restoreSelection();},collapseView:function(){this.requery();},requery:function(){if(this.currentQuery)this.data.query(this.currentQuery);},executeQuery:function(y){y=this.cleanQuery(y);var z=this.inform('execute',y),aa=this.getSessionID();this.inform('session',null,h.BEHAVIOR_STATE);this.close();this.selectQuery(y);if(!z)this._navigateToQuery(y,aa);},getSearchType:function(){return 'facebar';},_newSession:function(){this._sessionID=Math.random().toString();this.inform('session',this._sessionID,h.BEHAVIOR_STATE);},getSessionID:function(){return this._sessionID;},_navigateToQuery:function(y,z){var aa=this.data.facebarConfig;if(y.uri){y.uri.addQueryData(y.extra_uri_params);y.uri.addQueryData({ref:'br_tf'});if(y.structure&&(y.type=='websuggestion'||(y.type=='grammar'&&(!aa||v(y.uri.getPath(),aa.search_path))))){var ba=this.data.getRawStructure(y.structure).text_form,ca=l.encode(ba).replace(/\=+$/,''),da={sid:z,qs:ca,gv:this.data.getQueryData().grammar_version},ea=l.encode(JSON.stringify(da)).replace(/\=+$/,'');y.uri.addQueryData({ref:ea});}y.uri.go();return;}if(y.semantic&&aa){var fa=new p(aa,y.semantic);if(!fa.isImplemented())alert('Don\'t panic. This is not a bug.\r\n\r\n'+'Your query contains function(s) that aren\'t implemented yet: '+fa.getUnimplemented().join(', ')+'. '+'Please try another query.');}},reset:function(){this.selectQuery();this.inform('reset');},hideInputValue:function(){if(this.hoverReplace&&this.hoverReplace.matches(this.input.getValue().trim())){this.shadowValue=this.getValue();this.animateInputValue(this.input.getRawPlaceholderElement(),this.input.getRawInputElement(),new q());}},revealInputValue:function(){if(this.hoverReplace){var y=this.input.getRawInputElement(),z=this.input.getRawPlaceholderElement(),aa=this.input.getValue(),ba=this.shadowValue;this.shadowValue=null;if(this.hoverAnimation&&ba){this.hoverAnimation.stop();this.hoverAnimation=null;w.set(z,'opacity','');w.set(y,'opacity','');this.input.setValue(ba);}else if(aa.isEmptyOrWhitespace()&&ba)this.animateInputValue(y,z,ba);}},animateInputValue:function(y,z,aa){this.hoverAnimation&&this.hoverAnimation.stop();var ba=new j(z).from('opacity',1).to('opacity',0).duration(150).ondone(function(){this.input.setValue(aa);this.hoverAnimation=ca.go();}.bind(this)),ca=new j(y).from('opacity',0).to('opacity',1).duration(150).ondone(function(){this.hoverAnimation=null;w.set(z,'opacity','');w.set(y,'opacity','');}.bind(this));w.set(y,'opacity',0);this.hoverAnimation=ba.go();},open:function(){n.addClass(document.body,'facebarOpened');this.inform('open');this.view.show();this.input.focus();this.checkValue();if(!this.isFocused){this.isFocused=true;this._newSession();this.inform('focus');}},close:function(){if(this.inform('close')===false)return;if((!this.value||this.value.isEmptyOrWhitespace())&&this.selectedQuery){this.input.setValue(this.selectedQuery.structure);}else if(this.stickyQuery)this.input.setValue(this.stickyQuery.structure);this.input.blur();this.view.hide();this.view.setAutoSelect(false);this.inform('session',null,h.BEHAVIOR_STATE);if(this.isFocused){n.addClass(document.body,'facebarClosing');n.removeClass(document.body,'facebarOpened');n.removeClass.curry(document.body,'facebarClosing').defer(355);this.isFocused=false;this.inform.bind(this,'blur').defer();}},getElement:function(){return this.root;},getValue:function(){return this.shadowValue?this.shadowValue:this.input.getValue();},getText:function(){return this.getValue().toString();},keydown:function(event){var y=true,z=g.getKeyCode(event);switch(z){case u.ESC:this.close();break;case u.RIGHT:y=this.input.isSelectionAtEnd()&&this.completeSelection();break;case u.TAB:if(event.getModifiers().shift||(!this.completeSelection()&&!this.loading)){this.view.setAutoSelect(false);this.view.hide();y=false;}break;case u.UP:this.view.prev();break;case u.DOWN:this.view.next();break;case u.RETURN:this.view.select();break;case u.PAGE_UP:this.view.first();break;default:if(z>='0'.charCodeAt(0)&&z<='z'.charCodeAt(0))this.view.setAutoSelect(true);this.stickyQuery=null;y=false;break;}this.input.storeSelection();if(y)return event.kill();},mousedown:function(){this.view.setAutoSelect(true);this.input.storeSelection();this.keepOpen=true;},mouseup:function(y){if(this.keepOpen)this.open();this.keepOpen=false;},focusWindow:function(){this.windowFocused=true;},blurWindow:function(){this.windowFocused=false;},selectView:function(y,z){if(!z||!z.selected)return;z.selected.see_more=this.data.isSeeMore();this.shadowValue=null;this.inform('select',z);var aa=this.cleanQuery(z.selected);this.executeQuery(aa);},highlightView:function(){var y=this.view.getSelection();y&&this.input.setHint(y.structure);},blurInput:function(){setTimeout((function(){if(this.windowFocused){this.input.togglePlaceholder();if(!this.keepOpen)this.close();}}).bind(this),0);},changeInput:function(){if(this.shadowValue)if(this.input.getValue().isEmptyOrWhitespace()){return;}else this.shadowValue=null;this.inform('change');this.checkValue();this.inform('change_end');},focusInput:function(){this.open();this.input.togglePlaceholder(false);},typeaheadReady:function(){this.dataSourceReady=true;this.checkValue();},updateData:function(){this.view.setLoading(this.loading);},completeData:function(y,z){if(z.forceDisplay||(this.value&&this.value.matches(z.value)))this.view.render(z.value,z.results,z.isAsync,(z.results.length===0)&&z.isEmptyResults,z.isScrollable);},typeaheadActivity:function(y,z){this.fetching=z.activity;if(this.loading!=this.fetching){this.loading=this.fetching;this.updateData();}},getNameTextFromSelected:function(){var y=this.settedQuery&&this.settedQuery.semantic,z=this.data.facebarConfig&&this.data.facebarConfig.name_functions,aa=y&&z&&y.match(/[a-z-]+\([^()]+\)/g);if(aa)for(var ba=0;ba<aa.length;ba++){var ca=aa[ba].match(/([a-z-]+)\(([^()]+)\)/);if(ca&&k(z,ca[1]))return ca[2];}return this.value.toString();}});e.exports=x;});
__d("FacebarTypeaheadRecorder",["Banzai","Class","clickRefAction","copyProperties","Env","Event","Keys","ScubaSample","SearchTypeaheadRecorder","URI","userAction","Arbiter"],function(a,b,c,d,e,f){var g=b('Banzai'),h=b('Class'),i=b('clickRefAction'),j=b('copyProperties'),k=b('Env'),l=b('Event'),m=b('Keys'),n=b('ScubaSample'),o=b('SearchTypeaheadRecorder'),p=b('URI'),q=b('userAction'),r=b('Arbiter'),s='facebar',t=function(u){this.typeahead=u;this.parent.construct(this,u);this.userText="";this.queryTimes=[];this._sessionDisabled=false;};h.extend(t,o);j(t.prototype,{_endPoint:'/ajax/typeahead/search/record_metrics.php',_sessionEnded:true,_extraRecorder:[],initEvents:function(){this.typeahead.getCore().subscribe('session',function(u,v){if(v===null){this.sessionEnd();}else this.sessionStart(v);}.bind(this));this.typeahead.getCore().subscribe('select',function(u,v){this.recordSelectInfo(v);}.bind(this));this.typeahead.getView().subscribe('render',function(u,v){this.recordRender(v);}.bind(this));this.typeahead.data.subscribe('query',function(u,v){if(!v.value.isEmpty())this.recordCountStat('num_queries');if(v.see_more)this.recordStat('clicked_see_more',1);this.recordAvgStat('num_results_from_cache',v.results.length);this.queryTimes[v.queryId-this.startQueryId]={send:Date.now()};}.bind(this));this.typeahead.subscribe('navigation',function(u,v){if(v&&v.structure){this.recordStat('navigation_input',JSON.stringify(v.structure.toStruct()));this.recordStat('navigation_text',v.structure.toString());}}.bind(this));this.typeahead.data.subscribe('response_received',function(u,v,w){if(v.queryId>=this.startQueryId){var x=this.queryTimes[v.queryId-this.startQueryId];x.recv=Date.now()-x.send;}}.bind(this));this.typeahead.data.subscribe('backend_response',function(u,v){if(v.queryId>=this.startQueryId){var w=this.queryTimes[v.queryId-this.startQueryId];w.render=Date.now()-w.send;if(v.payload.incomplete)w.incomplete=true;w.backendInfo=v.payload.info;if(this.core.scubaInfo)this.logToScuba(v,w,this.core.scubaInfo);}}.bind(this));r.subscribe('BrowseNUX/typing',this.disableThisSession.bind(this));this.typeahead.getCore().subscribe('change',function(u,v){this.userInput(this.core.getText());}.bind(this));this.typeahead.subscribe('clear',function(){this.recordAppendStat('before_clear_queries',this.userText);}.bind(this));l.listen(this.element,'keydown',function(event){this.recordStat('keypressed',1);if(l.getKeyCode(event)==m.BACKSPACE){if(!this._backspacing){this._backspacing=true;this.recordAppendStat('before_backspace_queries',this.userText);}}else this._backspacing=false;}.bind(this));this.typeahead.subscribe('record_after_reorder',function(u,v){this._reorderInfo=v;this._reorderInfo.s_organic_results=this._reorderInfo.s_organic_results.map(this.buildTypeaheadRecord.bind(this));}.bind(this));this.typeahead.getCore().subscribe('recordFunction',function(u,v){this._extraRecorder.push(v);}.bind(this));},_reset:function(u){this.stats={};this.avgStats={};this.appendStats={};this._backspacing=false;this._topreplace=false;this._inflightRequests={};},sessionStart:function(u){this._sessionEnded=false;this.data.setQueryData({sid:u});this.recordStat('sid',u);if(!this.stats.session_start_time)this.recordStat('session_start_time',Date.now());this.startQueryId=this.data.getCurQueryId()+1;this.recordStat('keypressed',0);this.queryTimes=[];},sessionEnd:function(){if(this._sessionEnded||this._sessionDisabled){if(this._sessionDisabled){this.reset();this._sessionDisabled=false;this._sessionEnded=true;}return;}this._sessionEnded=true;this.recordStat('session_end_time',Date.now());this.submit();},disableThisSession:function(){this._sessionDisabled=true;},userInput:function(u){this.userText=u;},buildTypeaheadRecord:function(u,v){var w=u.rankType||u.render_type||u.type,x=0,y=v;if(typeof u.groupIndex=='number'){x=u.groupIndex;y=u.indexInGroup;}var z={group_index:x,index_in_group:y,cost:u.cost,s_value:u.s_value||0,semantic:u.semantic,text:u.structure.toString(),cache_only:(u.cacheOnlyResult?1:0),parse:u.parse,semantic_forest:u.semanticForest,normalized_input:u.entityTypes,category:u.category,type:w,source:u.bootstrapped,grammar_results_type:(u.results_set_type||'').replace(/[\[\{](.*)[\]\}]/,'$1'),result_from_memcache:u.memcache,websuggestion_source:u.websuggestion_source,dynamic_cost:u.dynamic_cost};if(u.s_token)z.s_token=u.s_token;if(u.s_categories)z.s_categories=u.s_categories;return z;},buildListTypeaheadRecords:function(){var u=[];this.results&&this.results.forEach(function(v,w){if(v.uid!=='search')u.push(this.buildTypeaheadRecord(v,w));}.bind(this));return u;},recordStats:function(u,v){for(var w in v)this.recordStat(u+'_'+w,v[w]);},getTypeaheadIndex:function(u,v){var w=typeof u.groupIndex=='number'?u.groupIndex+1:0;return v-w;},recordSelectInfo:function(u){var v=u.selected,w=this.getTypeaheadIndex(v,u.index),x={};if(v.uid=='search'){x.selected_search=1;}else{x=this.buildTypeaheadRecord(v);var y=(x.type=='friend'?'user':x.type);x.position=w;x[y]=1;}x.with_mouse=u.clicked?1:0;x.see_more=v.see_more?1:0;x.input_query=this.userText;var z=v.dataGT?{gt:JSON.parse(v.dataGT)}:{},aa={href:v.path};i('click',aa,null,null,z);q('search').uai('click');this.recordStats('selected',x);this.recordAppendStat('selection_history',{selected:x,candidate_results:this.buildListTypeaheadRecords(),timestamp:Date.now()});var ba={};this._extraRecorder.forEach(function(ca){ca(u,this.results,ba);}.bind(this));this.recordStat('extra_select_info',JSON.stringify(ba));},_dataToSubmit:function(){this.recordStat('max_results',this.data._maxResults);if(this.stats&&this.stats.selected_input_query){this.recordStat('input_query',this.stats.selected_input_query);}else this.recordStat('input_query',this.userText);this.recordStat('uri',p().toString());var u=this.stats;for(var v in this.avgStats){var w=this.avgStats[v];u[v]=w[0]/w[1];}var x={candidate_results:this.buildListTypeaheadRecords(),timestamp:Date.now(),input_query:this.userText};if(this._reorderInfo)j(x,this._reorderInfo);this.recordAppendStat('suggestions_at_end_of_session',x);this.recordAppendStat('query_times',this.queryTimes);for(var y in this.appendStats)u[y]=JSON.stringify(this.appendStats[y]);return u;},getDataToSubmit:function(){return this._dataToSubmit();},reset:function(){return this._reset();},submit:function(){if(!this._sessionDisabled)if(this.data.recordingRoute=='non_banzai'){this.parent.submit();}else{var u=this._dataToSubmit();if(this.data.recordingRoute=='banzai_vital'){g.post(s,u,g.VITAL);}else g.post(s,u);}this.view.inform('feedback');this._reset();},logToScuba:function(u,v,w){if(this._sessionDisabled)return;var x=new n('search_facebar_js',null,{addBrowserFields:true});x.addInteger('sample_rate',w.sample_rate);x.addNormal('site',w.site);x.addDenorm('query',u.request.uri.query_s);var y=u.payload;y.entities&&x.addInteger('num_entities',y.entities.length);y.results&&x.addInteger('num_results',y.results.length);if(y.times){x.addInteger('time_bootstrap',y.times.bootstrap);x.addInteger('time_php_end_to_end',y.times.end_to_end);x.addInteger('time_fetchers',y.times.fetchers);x.addInteger('time_grammar',y.times.grammar);}x.addInteger('incomplete',v.incomplete?1:0);x.addInteger('time_render',v.render-v.recv);x.addInteger('time_js_async',v.recv);x.addInteger('query_id',v.queryId);x.addInteger('user_id',k.user);x.addInteger('session_id',this.typeahead.getCore().getSessionID());x.flush();}});e.exports=t;});
__d("FacebarTypeaheadView",["Event","Animation","Arbiter","Class","copyProperties","ContextualLayer","CSS","csx","cx","DOM","Ease","Parent","ScrollableArea","Style","TypeaheadView","throttle","tx","Vector","ViewportBounds","FacebarStructuredText"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Animation'),i=b('Arbiter'),j=b('Class'),k=b('copyProperties'),l=b('ContextualLayer'),m=b('CSS'),n=b('csx'),o=b('cx'),p=b('DOM'),q=b('Ease'),r=b('Parent'),s=b('ScrollableArea'),t=b('Style'),u=b('TypeaheadView'),v=b('throttle'),w=b('tx'),x=b('Vector'),y=b('ViewportBounds'),z=b('FacebarStructuredText'),aa=981,ba=500,ca='unimplemented';function da(ea,fa){this.parent.construct(this,ea,fa);this.sid='';this.index=-1;this.animation=null;this.warningShown=false;this.autoSelect=false;this.minResults=fa.minResults||3;this.maxResults=fa.maxResults;this.animateHeightThrottled=v(this.animateHeight,50,this);this.animateCount=-1;this.animateViewportWidth=-1;this.loading=false;}j.extend(da,u);k(da.prototype,{events:['highlight','render','filter'],init:function(){this.initializeElements();this.parent.init();},initializeElements:function(){var ea=this.element;this.content=p.find(ea,"._21r");this.throbber=p.find(ea,"._21f");this.warningNode=p.find(ea,"._5yp");this.scroller=p.find(ea,"._8v2");this.scrollableArea=s.getInstance(this.scroller);this.footer=this.createFooter();},initializeLayer:function(){var ea=p.scry(document.body,'#blueBar')[0],fa,ga;if(ea&&p.contains(ea,this.element)){fa=ea;ga='100%';}else{fa=this.element.parentNode;ga=aa+'px';}this.wrapper=p.create('div');p.appendContent(this.wrapper,this.element);this.layer=new l({context:fa,position:'below',alignment:this.alignment,causalElement:this.causalElement},this.wrapper);t.set(this.layer.getContentRoot(),'width',ga);},initializeEvents:function(){g.listen(this.content,{click:this.click.bind(this),mouseover:this.mouseover.bind(this)});},setInputElement:function(ea){this.setAccessibilityControlElement(ea);this.causalElement=ea;this.initializeLayer();},setAutoSelect:function(ea){this.autoSelect=ea;if(this.index===-1&&ea)this.first();},click:function(event){if(!event.isMiddleClick()&&!event.getModifiers().any){var ea=r.byTag(event.getTarget(),'a');if(!ea||m.hasClass(ea,"_205")){this.select(true);return event.kill();}}},show:function(){if(!this.visible){var ea=this.parent.show();this.first();this.layer.show();this.recalculateScrollableArea();this.animateCount=-1;this.animateHeight();this.inform('show');i.inform('layer_shown',{type:'FacebarTypeahead'});return ea;}},hide:function(){if(this.visible){this.layer.hide();this.parent.hide();t.set(this.scroller,'height','0px');this.inform('hide');i.inform('layer_hidden',{type:'FacebarTypeahead'});}return this;},select:function(){var ea=this.inform('beforeSelect',{index:this.index,selected:this.results[this.index]});if(ea&&this.results[this.index].node===this.footer)ea=false;if(ea!==false)this.parent.select();},buildResults:function(ea){this.list=m.addClass(this.parent.buildResults(ea),"_21c");return this.list;},animateHeight:function(){if(this.items.length==this.animateCount){var ea=x.getViewportDimensions().x;if(this.animateViewportWidth!=ea){this.animateViewportWidth=ea;this.recalculateScrollableArea();}return;}if(this.list&&m.shown(this.list)){this.animateCount=this.items.length;var fa=Math.min(x.getElementDimensions(this.list).y,this.calculateMaxAllowableHeight());this.animation&&this.animation.stop();this.animation=new h(this.scroller).to('height',fa).duration(ba).ease(q.makePowerOut(5)).ondone(this.recalculateScrollableArea.bind(this)).go();}},calculateMaxAllowableHeight:function(){var ea=x.getViewportDimensions().y,fa=y.getTop()||48,ga=56,ha=Math.max(this.minResults,Math.floor((ea-fa-25)/ga)-1)+1;return ha*ga+(ga/4);},render:function(ea,fa,ga,ha,ia){this.inform('filter',{results:fa,value:ea,isScrollable:ia});if(this.loading)fa.push({uid:'search',node:this.footer,structure:new z(),search:true});var ja=fa[0];if(ha){this.showWarning(w._("There are no results for '{query}'.",{query:ea.toString()}));}else if(ja&&ja.results_set_type===ca){this.showWarning(ja.error_message||"This search isn't currently supported.");}else this.hideWarning();if(this.inform('removeUnimplementedGrammar')!==false)fa=fa.filter(function(ka){return ka.results_set_type!==ca;}.bind(this));this.parent.render(ea,fa,ga);this.renderFooter();this.animateHeightThrottled();this.positionLayer();},positionLayer:function(){if(this.isVisible()&&this.layer.isShown())this.layer.updatePosition();},showWarning:function(ea){m.show(this.warningNode);p.setContent(this.warningNode,ea);this.warningShown=true;this.highlight(-1,false);},hideWarning:function(){m.hide(this.warningNode);this.warningShown=false;this.highlight(this.index,false);},recalculateScrollableArea:function(){t.set(this.scroller,'width',x.getElementDimensions(this.element).x+'px');this.scrollableArea.resize();this.scrollableArea.poke();},setLoading:function(ea){this.loading=ea;this.renderFooter();},scrollTo:function(ea){ea&&this.scrollableArea.scrollIntoView(ea,true);},renderFooter:function(){m.conditionShow(this.throbber,this.loading);m.conditionShow(this.footer,this.loading);if(this.loading){this.inform('showingFooter');}else this.inform('hidingFooter');},first:function(){this.index=this.autoSelect?0:-1;this.highlight(this.index);},prev:function(){if(this.index<=0)this.index=this.items.length;if(this.results[this.index-1].node===this.footer)this.index-=1;this.parent.prev();},next:function(){if(this.index+1>=this.items.length)this.index=-1;if(this.results[this.index+1].node===this.footer)this.index=-1;this.parent.next();},highlight:function(ea,fa){fa=fa!==false&&(this.index!=ea);if(!fa||this.inform('beforeHighlight')!==false){var ga=this.warningShown||!this.autoSelect?-1:0;this.parent.highlight(Math.max(ga,ea),fa);}},createFooter:function(){return p.create('li',{className:"_3su hidden_elem"},this.throbber);}});e.exports=da;});
__d("FacebarFaviconAnimation",["$","Animation","BrowseMouse","copyProperties","CSS","DOM","SubscriptionsHandler","Style"],function(a,b,c,d,e,f){var g=b('$'),h=b('Animation'),i=b('BrowseMouse'),j=b('copyProperties'),k=b('CSS'),l=b('DOM'),m=b('SubscriptionsHandler'),n=b('Style'),o,p,q=null,r=new m();function s(x,y,z){if(q){q.stop();q=null;n.set(x,'opacity',0);n.set(y,'opacity',1);return;}q=new h(x).from('opacity',1).to('opacity',0).duration(150).ondone(function(){z();q=new h(y).from('opacity',0).to('opacity',1).ondone(function(){q=null;}).duration(150).go();}).go();}function t(x){x.inform('faviconHide');s(o,p,function(){k.addClass(document.body,'searchIconShowing');});}function u(x){x.inform('faviconShow');s(p,o,function(){k.removeClass(document.body,'searchIconShowing');});}function v(x){if(!k.hasClass(document.body,'facebarOpened'))u(x);}function w(x){o=l.find(g('pageLogo'),'a');p=l.find(g('blueBar'),'.facebarSearchIcon');this._core=x.getCore();this._root=this._core.input.root;i.makeTarget(this._root);i.init();}j(w.prototype,{enable:function(){r.addSubscriptions(i.onMouseOver(this._root,t.curry(this._core),true),i.onMouseOut(this._root,v.curry(this._core),true),this._core.subscribe('focus',t.curry(this._core)),this._core.subscribe('blur',u.curry(this._core)));},disable:function(){r.release();}});e.exports=w;});
__d("FacebarTypeaheadBucketResults",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(p){return p.type=='grammar'&&!p.isSeeMore;}function i(p){return p.type=='websuggestion'&&!p.isSeeMore;}function j(p){return !!p.isSeeMore;}function k(p,q){var r={grammar:[],websuggestions:[],entity:[],seeMore:[]};p.forEach(function(s,t){var u;if(j(s)){u=r.seeMore;}else if(i(s)){u=r.websuggestions;}else if(q||h(s)){u=r.grammar;}else u=r.entity;s.bucketing={originalIndex:t,bucketIndex:u.length};u.push(s);});return r;}function l(p){var q=[],r={};p.forEach(function(t,u){var v=t.render_type||t.type;if(typeof r[v]=='undefined'){r[v]=[];q.push(v);}r[v].push(t);});var s=[];q.forEach(function(t){s.push.apply(s,r[t]);});return s;}function m(p,q,r,s,t,u){t.forceToBottom=!u;var v=[r,q,t];v.sort(function(w,x){if(!w||w.forceToBottom||w.length===0){return 1;}else if(!x||x.forceToBottom||x.length===0){return -1;}else return w[0].cost-x[0].cost;});p.length=0;v.forEach(function(w){Array.prototype.push.apply(p,w);});p.push.apply(p,s);}function n(p,q,r){var s=k(p,q),t=s.grammar,u=s.entity;u=l(u);m(p,u,t,s.seeMore,s.websuggestions.slice(0),r);}function o(p){this._typeahead=p;this._enabled=false;}g(o.prototype,{enable:function(){this._enabled=true;this._mixGrammarAndEntity=!!this._typeahead.getData().mixGrammarAndEntity;this._allowWebSuggOnTop=!!this._typeahead.getData().allowWebSuggOnTop;this._typeahead.view.subscribe('filter',function(p,q){this._enabled&&n(q.results,this._mixGrammarAndEntity,this._allowWebSuggOnTop);}.bind(this));},disable:function(){this._enabled=false;}});e.exports=o;});
__d("FacebarTypeaheadDecorateEntities",["arrayContains","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('arrayContains'),h=b('copyProperties'),i=b('emptyFunction');function j(n){var o=[];n.forEach(function(p){if(p.isType('ent'))o.push(p.getUID());});return o;}function k(n,o){var p=null;n.structure.forEach(function(q){if(q.isType('ent')&&!g(o,q.getUID()))p=q;});return p;}function l(n,o,p){n.forEach(function(q){var r=k(q,o);q.decoration={entity:r&&p.getEntryForFragment(r)};});}function m(n){this._typeahead=n;}h(m.prototype,{enable:function(){this._typeahead.view.subscribe('filter',function(n,o){l(o.results,j(this._typeahead.core.getValue()),this._typeahead.data);}.bind(this));},disable:i});e.exports=m;});
__d("FacebarTypeaheadDisambiguateResults",["FacebarDisambiguationDialog","FacebarStructuredFragment","FacebarStructuredText","URI","copyProperties","emptyFunction","getObjectValues"],function(a,b,c,d,e,f){var g=b('FacebarDisambiguationDialog'),h=b('FacebarStructuredFragment'),i=b('FacebarStructuredText'),j=b('URI'),k=b('copyProperties'),l=b('emptyFunction'),m=b('getObjectValues');function n(w,x){var y={};w.forEach(function(ba){if(ba.type=='grammar'){var ca=x(ba.structure).toLowerCase();y[ca]=y[ca]||[];y[ca].push(ba);}});var z=[];for(var aa in y)if(y[aa].length>1)z.push(y[aa]);return z;}function o(w){var x=[];w.toArray().forEach(function(y,z){if(y.isType('ent'))x.push(z);});return x;}function p(w,x,y){var z={},aa={},ba={};x.forEach(function(da){var ea=w[0].structure.getFragment(da),fa=ea.getHash();aa[fa]=aa[fa]||[];ba[da]=aa[fa];w.forEach(function(ga){var ha=ga.structure.getFragment(da),ia=ha.getUID();if(!z.hasOwnProperty(ia)){aa[fa].push(y.getEntryForFragment(ha));z[ia]=true;}});});for(var ca in ba)if(ba[ca].length<=1)delete ba[ca];return ba;}function q(w,x){var y={},z=[];w.forEach(function(aa){var ba=aa.structure.getFragment(x).getUID();if(!y.hasOwnProperty(ba)){y[ba]=z.length;z.push([]);}z[y[ba]].push(aa);});return z;}function r(w,x,y){var z=w.shift();z.ambiguity.entities=x;y.push.apply(y,w);return z;}function s(w,x){var y=[],z=[],aa=false;w.forEach(function(ca){ca.ambiguity={fragment:null,entities:null,text:null};});n(w,function(ca){return ca.getHash();}).forEach(function(ca){var da=ca[0].structure,ea=o(da),fa=p(ca,ea,x);if(aa){r(ca,fa,y);return;}var ga=ea.pop();if(typeof ga=='number'){var ha=q(ca,ga);aa=ha.length>1;if(aa)delete fa[ga];ha.forEach(function(ia){var ja=r(ia,fa,y);if(aa){var ka=ja.structure.getFragment(ga).getUID();ja.ambiguity.entity=x.getEntry(ka);z.push(ja);}});}});y.forEach(function(ca){var da=w.indexOf(ca);da!=-1&&w.splice(da,1);});n(w,function(ca){return ca.toString();}).forEach(function(ca){ca.forEach(function(da){if(!da.ambiguity.entities)da.ambiguity.text=da.queryTypeText;});});var ba=w.indexOf(z[0]);z.slice(1).forEach(function(ca){var da=w.indexOf(ca);if(da!=-1&&da!=++ba){w.splice(da,1);w.splice(ba,0,ca);}});}function t(w,x){var y=w&&w.ambiguity&&w.ambiguity.entities,z=y&&Object.keys(y).map(Number),aa=x.core.input;if(!z||z.length===0)return false;var ba=function(ea){x.core.executeQuery(u(w,z,ea));},ca=function(){aa.focus();aa.input.moveSelectionToEnd();},da=new g(m(y),w.uri.getPath(),ba,ca,x.getCore().getSessionID());aa.blur();da.show();return true;}function u(w,x,y){var z=w.structure.toArray(),aa=j(w.uri),ba=aa.getPath().split('/');x.forEach(function(ca){var da=z[ca],ea=y.shift(),fa=ba.indexOf(String(da.getUID()));if(fa!=-1)ba[fa]=ea.uid;z[ca]=new h({uid:ea.uid,text:ea.text,type:'ent:'+ea.type});});return {uri:aa.setPath(ba.join('/')),structure:new i(z)};}function v(w){this._typeahead=w;}k(v.prototype,{enable:function(){this._typeahead.view.subscribe('filter',function(w,x){s(x.results,this._typeahead.data);}.bind(this));this._typeahead.view.subscribe('beforeSelect',function(w,x){return !t(x.selected,this._typeahead);}.bind(this));},disable:l});e.exports=v;});
__d("FacebarTypeaheadNavigation",["Arbiter","FacebarNavigation","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('FacebarNavigation'),i=b('copyProperties'),j=b('emptyFunction');function k(l){this._core=l.core;this._preserveQuery=false;this._typeahead=l;}i(k.prototype,{enable:function(){h.registerBehavior(this);this._core.subscribe('execute',this.executedUserQuery.bind(this));},disable:j,executedUserQuery:function(){this._preserveQuery=true;},pageTransition:function(){if(!this._preserveQuery){this._core.close();this._core.reset();}else this._preserveQuery=false;},setPageQuery:function(l){l=this._core.setPageQuery(l);this._typeahead.inform('navigation',l,g.BEHAVIOR_PERSISTENT);}});e.exports=k;});
__d("FacebarTypeaheadRecorderBasic",["Arbiter","FacebarTypeaheadRecorder","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('FacebarTypeaheadRecorder'),i=b('copyProperties');function j(k){this._typeahead=k;}i(j.prototype,{_subscription:null,enable:function(){var k=this._typeahead;this._subscription=k.subscribe('init',function(l,m){var n=new h(k);k.inform('recorder',n,g.BEHAVIOR_PERSISTENT);});},disable:function(){this._typeahead.unsubscribe(this._subscription);this._subscription=null;}});e.exports=j;});
__d("FacebarTypeaheadSeeMore",["copyProperties","CSS","cx","DOM","FacebarStructuredText","tx"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('CSS'),i=b('cx'),j=b('DOM'),k=b('FacebarStructuredText'),l=b('tx');function m(n){this._core=n.getCore();this._view=this._core.view;this._moreBar=null;this._isOpen=false;}g(m.prototype,{enable:function(){this._subscriptions=[this._core.subscribe('close',this._close.bind(this)),this._view.subscribe('filter',this._buildSeeMore.bind(this)),this._view.subscribe('beforeSelect',this._beforeSelect.bind(this)),this._view.subscribe('next',this._scrollView.bind(this)),this._view.subscribe('prev',this._scrollView.bind(this)),this._view.subscribe('showingFooter',this._footerShow.bind(this)),this._view.subscribe('hidingFooter',this._footerHide.bind(this))];},disable:function(){while(this._subscriptions.length)this._subscriptions.pop().unsubscribe();},_beforeSelect:function(n,event){if(!event.selected||event.selected.node!==this._moreBar)return true;this._view.first();this._core.expandView();return false;},_buildSeeMore:function(n,event){var o=event.results;if(o.length===0||event.isScrollable||event.value.toString().trim()=="")return;if(o.length<this._view.maxResults){var p=o.some(function(r){return r.type!=='websuggestion';});if(!p)return;}else if(o.length>this._view.maxResults+1){this._isOpen=true;return;}var q="See More";this._isOpen=false;this._moreBar=j.create('li',{className:"_70_ calltoaction"},q);this._moreBar.setAttribute('aria-label',q);o.push({uid:'search',node:this._moreBar,structure:new k(),search:true});},_close:function(){if(this._isOpen){this._core.collapseView();this._isOpen=false;}return true;},_footerHide:function(){if(this._moreBar){h.show(this._moreBar);this._view.animateCount=-1;this._view.animateHeightThrottled();}return true;},_footerShow:function(){this._moreBar&&h.hide(this._moreBar);return true;},_scrollView:function(n,o){if(this._isOpen)this._view.scrollTo(o);return true;}});e.exports=m;});
__d("FacebarTypeaheadSelectAll",["copyProperties","requestAnimationFrame"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('requestAnimationFrame');function i(j){this._core=j.getCore();this._listener=null;}g(i.prototype,{enable:function(){var j=this._core.input;this._listener=this._core.subscribe('focus',function(){h(function(){var k=j.getValue().toArray()[0];if(k&&k.isType('ent','websuggestion')){j.selectInput(k.getLength());}else j.selectInput();}.bind(this));}.bind(this));},disable:function(){this._listener&&this._core.unsubscribe(this._listener);}});e.exports=i;});
__d("FacebarTypeaheadShortcut",["KeyEventController","Run","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('KeyEventController'),h=b('Run'),i=b('copyProperties'),j=b('emptyFunction');function k(l){this._input=l.core.input;this._view=l.view;this._listener=null;}i(k.prototype,{enable:function(){this._registerListener();},disable:j,_registerListener:function(){g.registerKey('SLASH',this._handleKeydown.bind(this));h.onLeave(function(){this._registerListener.bind(this).defer();}.bind(this));},_handleKeydown:function(l){this._view.setAutoSelect(true);this._input.focus();this._input.inform('shortcut',{shift:l.getModifiers().shift});return false;}});e.exports=k;});
__d("FacebarTypeaheadSizeAdjuster",["copyProperties","createArrayFrom","CSS","csx","DOM","emptyFunction","Style","throttle","Vector"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('createArrayFrom'),i=b('CSS'),j=b('csx'),k=b('DOM'),l=b('emptyFunction'),m=b('Style'),n=b('throttle'),o=b('Vector'),p=850,q=12,r=20,s=500,t=700,u=".selected ._7gk",v="._6ji";function w(x){this._core=x.getCore();this._view=this._core.view;this._input=this._core.input;this._defaultSize=this.getDefaultFontSize();this._calculatedSize=this._defaultSize;this._appliedSize=null;}g(w.prototype,{enable:function(){this._core.input.subscribe('change',n(this.adjustFontSize,50,this));this._view.subscribe('highlight',this.maybeRemoveEducationalText.bind(this));this._view.subscribe('render',this.maybeRemoveEducationalText.bind(this));this.adjustFontSize();},disable:l,getDefaultFontSize:function(){var x=m.get(this._input.getElement(),'font-size'),y=/^([\d\.]+)px$/.exec(x),z=y&&Number(y[1]);return Math.max(q,Math.min(r,z));},calculateFontSize:function(){var x=0,y=this._input.getRawInputElement().childNodes;h(y).forEach(function(z){x+=o.getElementDimensions(z).x;});if(x>t){this._calculatedSize=Math.max(q,this._calculatedSize-Math.ceil(1+(x-t)/50));}else if(x<s)this._calculatedSize=Math.min(this._defaultSize,this._calculatedSize+Math.ceil(1+(s-x)/50));return this._calculatedSize;},adjustFontSize:function(){var x=this.calculateFontSize();if(x!=this._appliedSize){this._appliedSize=x;m.set(this._input.getElement(),'font-size',x+'px');m.set(this._view.content,'font-size',x+'px');}},maybeRemoveEducationalText:function(){var x=k.scry(this._view.content,u)[0];if(x){var y=this.measureTextWidth(x);if(y>p)i.hide(k.find(x,v));}},measureTextWidth:function(x){i.addClass(x,'forceShowSubcomponents');var y=0;h(x.childNodes).forEach(function(z){y+=o.getElementDimensions(z).x;});i.removeClass(x,'forceShowSubcomponents');return y;}});e.exports=w;});
__d("FacebarTypeaheadSponsoredResults",["Arbiter","copyProperties","FacebarStructuredText","FacebarURI","FacebarResultStoreUtils","TypeaheadSearchSponsoredUtils"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('FacebarStructuredText'),j=b('FacebarURI'),k=b('FacebarResultStoreUtils'),l=b('TypeaheadSearchSponsoredUtils'),m={};function n(u,v,w,x,y){var z=u[v],aa=h(null,z);aa.isSponsored=true;aa.s_message=x.s_message;aa.s_token=x.s_token;u[v]=aa;if(v<w)return;if(v>w)u.splice(w,0,u.splice(v,1)[0]);}function o(u,v,w){u.splice(w,0,v);}function p(u){return 'cost' in u;}function q(u){return u.removable===true;}function r(u,v,w){if(w.rerankingStrategy!=6)return;if(u.length>0)u[0].score=-1*u[0].cost;var x=l.getTopAdPosition(u,v,w),y=l.buildResultIndices(u);for(var z=v.length-1;z>=0;z--){var aa=v[z],ba=y[aa.selected_target_id];if(aa.setSMessage)aa=aa.setSMessage(u[ba]);if(l.isSelfPromoted(aa)){n(u,ba,x,aa,w);}else o(u,aa,x);y=l.buildResultIndices(u);}}function s(u){this._typeahead=u;this._data=u.getData();this._enabled=false;this._sponsoredResults={};this._organicECPM=null;this._hiddenAds=null;this._dialog=null;}s.setAuctionOptions=function(u){h(m,u);};function t(u,v,w){var x=u.filter(p),y={};for(var z=0;z<x.length;z++)y[x[z].uid]=z;x.sort(function(fa,ga){return fa.cost-ga.cost;});var aa={},ba=x.map(function(fa){if(fa.s_categories)aa[fa.uid]=fa.s_categories;return String(fa.uid);}),ca=null;for(z=x.length-1;z>=0;--z)if(!q(x[z])){ca=String(x[z].uid);break;}var da=l.selectAds(ba,aa,v,w,ca);if(da.length===0)return da;var ea=da.filter(function(fa){return !l.isSelfPromoted(fa);}).length;x.splice(w.maxNumberResultsAndAds-ea).map(function(fa){return y[fa.uid];}).sort(function(fa,ga){return ga-fa;}).forEach(function(fa){u.splice(fa,1);});return da;}s.runAuction=function(u,v,w,x){if(u.length===0)return [];var y=l.prepareAndSortAds(u,v,w),z=t(u,y,x);if(z.length===0)return y;r(u,z,x);return y;};s.Ad=function(){};h(s.prototype,{enable:function(){this._enabled=true;g.subscribe('TypeaheadSearchSponsored/hideAdResult',function(u,v){this._hiddenAds=this._hiddenAds||{};this._hiddenAds[v.uid]=true;this._dialog=v.reason_dialog;this._forceRefreshResults();}.bind(this));g.subscribe('TypeaheadSearchSponsored/undoHideAdResult',function(u,v){this._hiddenAds&&delete this._hiddenAds[v.uid];this._dialog&&this._dialog.hide();this._dialog=null;this._forceRefreshResults();}.bind(this));this._typeahead.data.subscribe('beginFetchHandler',function(u,v){this._processResponse(u,v.response);}.bind(this));this._typeahead.data.subscribe('response_received',this._processResponse.bind(this));this._typeahead.view.subscribe('filter',function(u,v){l.setOrganicECPM(this._organicECPM,v.results);var w=v.results.filter(p),x=v.results.length,y=[];for(var z=0;z<x;z++){var aa=v.results[z];if(this._sponsoredResults[aa.uid]){var ba=this._sponsoredResults[aa.uid];for(var ca in ba)y.push(ba[ca].s_token);}}var da=w.length;if(v.isScrollable)da+=m.maxNumberAds;s.setAuctionOptions({maxNumberResultsAndAds:Math.max(da,(this._typeahead.data&&this._typeahead.data._maxResults)||m.maxNumberResultsAndAds)});var ea=s.runAuction(v.results,this._sponsoredResults,this._hiddenAds,m);this._typeahead.data.inform('debug_facebar_typeahead_sponsored',{options:m,query:v.value.toString(),results:v.results,original_organic:w,ads_in_auction:ea});this._typeahead.inform('record_after_reorder',{s_organic_results:w,s_candidate_tokens:y,s_count:v.results.length-x,s_bootstrap_id:0,s_options:m,s_variant:m.rerankingStrategy});}.bind(this));this._dataSubscriptions=[];if(m.bootstrap)this._dataSubscriptions.push(this._data.subscribe('extra_bootstrap',function(u,v){var w=h({no_cache:1,options:['sponsored']},this.bootstrapData);this.fetch(this.bootstrapEndpoint,w,{type:'sponsored'});}.bind(this._data)));},disable:function(){this._enabled=false;},_forceRefreshResults:function(){if(this._data&&this._data.value)this._data.respond(this._data.value,this._data.buildUids(this._data.value));},_processResponse:function(u,v){if(!this._enabled||!v.payload||!v.payload.s_entries)return;v.payload.s_entries.forEach(function(w){var x=new s.Ad();h(x,w);h(x,k.processEntityResult(w.type,w.uid,w.text,0));x.isSponsored=true;x.uri=j.getURI(this.facebarConfig,x);x.structure=i.fromStruct(x.structure);var y=x.s_target;if(!this._sponsoredResults[y])this._sponsoredResults[y]={};this._sponsoredResults[y][x.uid]=x;}.bind(this));if(v.payload.organic_s_value)this._organicECPM=h(this._organicECPM,v.payload.organic_s_value);}});e.exports=s;});
__d("FacebarTypeaheadTrigger",["copyProperties","Arbiter"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('Arbiter');function i(j){this._typeahead=j;this._core=j.getCore();this._subscription=null;}g(i.prototype,{enable:function(){this._subscription=h.subscribe('FacebarTrigger/select',this._activateTrigger.bind(this));},disable:function(){h.unsubscribe(this._subscription);},_activateTrigger:function(j,k){var l=g({type:'grammar',uri:null,structure:null},k);if(!l.uri){this._core.open();this._core.setQuery(l,false);}else this._core.executeQuery(l);}});e.exports=i;});
__d("FacebarTypeaheadGrammarItem",["Class","cx","DOM","copyProperties","FacebarTypeaheadItem","FacebarTypeaheadToken","FacebarTypeaheadEntityToken","tx"],function(a,b,c,d,e,f){var g=b('Class'),h=b('cx'),i=b('DOM'),j=b('copyProperties'),k=b('FacebarTypeaheadItem'),l=b('FacebarTypeaheadToken'),m=b('FacebarTypeaheadEntityToken'),n=b('tx');function o(p){this.parent.construct(this,p);this.addClass("_207");}g.extend(o,k);j(o.prototype,{renderIcon:function(){if(this._result.photo)return i.create('img',{className:"_20h",alt:'',src:this._result.photo});return i.create('span',{className:"_k83"},i.create('span',{className:this._result.icon_class}));},renderSubtext:function(){var p=this._result.decoration,q=this._result.ambiguity,r=q&&q.text,s=(p&&p.entity)||(q&&q.entity);if(r){return new l([r]).setPermanent(true).setShowPill(!this._captionOptions.nopill).render();}else if(s){this.setVAlign(false);return new m(s).setDefaultText('user',"Person").setPermanent(true).setShowPill(!this._captionOptions.nopill).setLeadingMiddot(this._captionOptions.nopill).setLimit(2).render();}}});e.exports=o;});
__d("FacebarTypeaheadSponsoredEntityItem",["Class","copyProperties","cx","DOM","HTML","FacebarTypeaheadEntityItem","FacebarTypeaheadToken","tx","URI"],function(a,b,c,d,e,f){var g=b('Class'),h=b('copyProperties'),i=b('cx'),j=b('DOM'),k=b('HTML'),l=b('FacebarTypeaheadEntityItem'),m=b('FacebarTypeaheadToken'),n=b('tx'),o=b('URI'),p='\u00B7';function q(r){this.parent.construct(this,r);this.addClass("_20e");}g.extend(q,l);h(q.prototype,{renderSubtext:function(){var r=this._result,s=r.category;if(r.category.__html)s=j.getText(k(s).getRootNode());var t=[];t.push(n._("Sponsored {category}",{category:s}));t.push(this.getHideLink());return new m(t).setPermanent(true).setShowPill(!this._captionOptions.nopill).render();},getHideLink:function(){var r=new o('/ajax/emu/end.php').addQueryData({eid:this._result.s_token,f:0,ui:'typeahead_'+this._result.s_token.replace('.','_'),en:'fad_hide',ed:'true',a:1}).toString();return j.create('a',{className:"_a0s",rel:'dialog-post',href:'#',ajaxify:r,title:"Hide the ad"},'\u2715');},renderText:function(){var r=this.parent.renderText();r.push(this.getSponsoredMessage());return r;},getSponsoredMessage:function(){if(this._result.s_message)return j.create('span',{className:"_a0t"},[' '+p+' ',this._result.s_message]);return [];}});e.exports=q;});
__d("FacebarTypeaheadWebSuggestionItem",["Class","cx","DOM","copyProperties","FacebarTypeaheadItem","FacebarTypeaheadToken"],function(a,b,c,d,e,f){var g=b('Class'),h=b('cx'),i=b('DOM'),j=b('copyProperties'),k=b('FacebarTypeaheadItem'),l=b('FacebarTypeaheadToken'),m={EXACT_MATCH:1,BING:2,BING_POPULAR:3};function n(o){this.parent.construct(this,o);this.addClass("_207");}g.extend(n,k);j(n.prototype,{renderIcon:function(){return i.create('span',{className:"_k83"},i.create('span',{className:"_6-a"}));},renderSubtext:function(){var o,p;o=this._result.websuggestion_source;if(o===m.BING_POPULAR){p=new l(["Popular Web Search"]).setShowPill(!this._captionOptions.nopill);}else p=new l(["Web Search"]).setShowPill(!this._captionOptions.nopill);return p.setPermanent(false).render();}});e.exports=n;});
__d("FacebarTypeaheadRenderer",["CSS","cx","FacebarTypeaheadEntityItem","FacebarTypeaheadGrammarItem","FacebarTypeaheadWebSuggestionItem","FacebarTypeaheadSponsoredEntityItem"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('cx'),i=b('FacebarTypeaheadEntityItem'),j=b('FacebarTypeaheadGrammarItem'),k=b('FacebarTypeaheadWebSuggestionItem'),l=b('FacebarTypeaheadSponsoredEntityItem'),m="_53af",n="_53ag",o="_53ah",p="_53ai",q={},r={};function s(v){if(v.isSponsored){return new l(v);}else if(v.type=='websuggestion'){return new k(v);}else if(v.type=='grammar'){return new j(v);}else return new i(v);}function t(v,w){g.conditionClass(v,m,r.blueTitle);g.conditionClass(v,n,r.nohover);g.conditionClass(v,o,r.nopill);g.conditionClass(v,p,w.isSponsored&&r.nohover);}function u(v){var w=!v.fetchType,x=v.uid,y=w&&q[x];if(!y){var z=s(v);z.setCaptionOptions(r);this.inform('renderingItem',{item:z,result:v});y=z.render();t(y,v);if(w)q[x]=y;}return y.cloneNode(true);}u.setCaptionOptions=function(v){r=v;};e.exports=u;});