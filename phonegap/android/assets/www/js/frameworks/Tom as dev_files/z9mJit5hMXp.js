/*1364911468,178142511*/

if (self.CavalryLogger) { CavalryLogger.start_js(["ufVEP"]); }

__d("FriendBrowserCheckboxController",["AsyncRequest","CSS","DOM","Event","Form","OnVisible","$","bind","copyProperties","ge"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CSS'),i=b('DOM'),j=b('Event'),k=b('Form'),l=b('OnVisible'),m=b('$'),n=b('bind'),o=b('copyProperties'),p=b('ge');function q(){}o(q,{instances:{},getInstance:function(r){return this.instances[r];}});o(q.prototype,{init:function(r,s,t){q.instances[r]=this;this._id=r;this._simplified=t;this._form=s;this._contentGrid=i.find(s,'.friendBrowserCheckboxContentGrid');this._loadingIndicator=i.find(s,'.friendBrowsingCheckboxContentLoadingIndicator');this._checkboxResults=i.find(s,'.friendBrowserCheckboxResults');this._contentPager=i.find(s,'.friendBrowserCheckboxContentPager');this.numGetNewRequests=0;this.queuedRequests={};j.listen(this._form,'submit',this.onFormSubmit.bind(this));},addTypeahead:function(r,s){r.subscribe('select',this.onHubSelect.bind(this,r,s));if(this._simplified)r.subscribe('unselect',this.onHubSelect.bind(this,r,s));},onFormSubmit:function(){this.getNew(true);return false;},addSelector:function(r){r.subscribe('change',this.getNew.bind(this,false));},onHubSelect:function(r,s,event,t){if(this._simplified){this.getNew(true);return;}if(!((event=='select')&&t.selected))return;var u=this.buildNewCheckbox(s,t.selected.text,t.selected.uid),v=i.find(this._form,'.checkboxes_'+s);i.appendContent(v.firstChild,u);var w=i.scry(r.getElement(),'input[type="button"]');if(w&&w[0])w[0].click();this.getNew(true);},buildNewCheckbox:function(r,s,t){var u=r+'_ids_'+t,v=r+'_ids[]',w=i.create('input',{id:u,type:'checkbox',value:t,name:v,checked:true});j.listen(w,'click',n(this,'getNew',false));var x=i.create('td',null,w);h.addClass(x,'vTop');h.addClass(x,'hLeft');var y=i.create('label',null,s),z=i.create('td',null,y);h.addClass(z,'vMid');h.addClass(z,'hLeft');var aa=i.create('tr');aa.appendChild(x);aa.appendChild(z);return aa;},showMore:function(){var r=i.scry(this._contentPager,'.friendBrowserMorePager')[0];if(!r)return false;if(h.hasClass(r,'async_saving'))return false;var s=this.numGetNewRequests,t=k.serialize(this._form);t.show_more=true;var u=new g().setURI('/ajax/growth/friend_browser/checkbox.php').setData(t).setHandler(n(this,function(v){this.showMoreHandler(v,s);})).setStatusElement(r).send();},showMoreHandler:function(r,s){if(s==this.numGetNewRequests){var t=r.payload;i.appendContent(this._contentGrid,t.results);this.updatePagerAndExtraData(t.pager,t.extra_data);}},getNew:function(r){this.numGetNewRequests++;var s=this.numGetNewRequests;h.addClass(this._checkboxResults,'friendBrowserCheckboxContentOnload');if(p('friendBrowserCI'))h.addClass(m('friendBrowserCI'),'friendBrowserCheckboxContentOnload');h.show(this._loadingIndicator);var t=k.serialize(this._form);t.used_typeahead=r;new g().setURI('/ajax/growth/friend_browser/checkbox.php').setData(t).setHandler(n(this,function(u){this.getNewHandler(u,s);})).send();},getNewHandler:function(r,s){if(s==this.numGetNewRequests){var t=r.payload;i.setContent(this._contentGrid,t.results);h.removeClass(this._checkboxResults,'friendBrowserCheckboxContentOnload');if(p('friendBrowserCI'))h.hide(m('friendBrowserCI'));h.hide(this._loadingIndicator);this.updatePagerAndExtraData(t.pager,t.extra_data);}},updatePagerAndExtraData:function(r,s){i.setContent(this._contentPager,r);this.setupOnVisible();i.replace(this._form.elements.extra_data,s);},setupOnVisible:function(){var r=i.scry(this._contentPager,'.friendBrowserMorePager')[0];if(r&&this._id!='jewel'){this._onVisible&&this._onVisible.remove();this._onVisible=new l(r,n(this,'showMore'),false,1000);}}});e.exports=q;});
__d("ContextualHelpSearchController",["Event","AsyncRequest","DOM","CSS","Focus","Input","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('AsyncRequest'),i=b('DOM'),j=b('CSS'),k=b('Focus'),l=b('Input'),m=b('copyProperties'),n=350;function o(){this._token=null;this._timerID=0;this._lastQuery=null;this.typing_listener=null;this.clear_listener=null;this.async_request=null;}m(o.prototype,{init:function(p,q,r,s,t){this.loader=p;this.search_box=q;this.topics_area=r;this.results_area=s;this.clear_button=t;this.typing_listener=g.listen(this.search_box,'keyup',this.setTimer.bind(this));this.clear_listener=g.listen(this.clear_button,'click',this.clearResults.bind(this));k.set(this.search_box);},source:'contextual_help',clearResults:function(){this.show(this.topics_area);this._lastQuery='';l.reset(this.search_box);k.set(this.search_box);if(this.async_request!==null){this.async_request.abort();this.async_request=null;}j.addClass(this.clear_button,'hidden_elem');},update:function(){var p=l.getValue(this.search_box);if(p===this._lastQuery)return;this._lastQuery=p;if(p===''){this.clearResults();return;}this.show(this.loader);var q={query:p,width:this._width||n,source:this.source};this.async_request=new h('/help/ajax/search/').setData(q).setHandler(function(r){this._update(r);}.bind(this));this.async_request.send();},_update:function(p){this.async_request=null;var q=p.getPayload().results;i.setContent(this.results_area,q);this.show(this.results_area);if(l.getValue(this.search_box)===''){this.clearResults();}else j.removeClass(this.clear_button,'hidden_elem');},setTimer:function(){if(this._timerID!==0)clearTimeout(this._timerID);this._timerID=setTimeout(this.update.bind(this),300);if(this.async_request!=null){this.async_request.abort();this.async_request=null;}},show:function(p){var q=[this.loader,this.topics_area,this.results_area];for(var r=0;r<q.length;r++)j.addClass(q[r],'hidden_elem');j.removeClass(p,'hidden_elem');}});e.exports=o;});
__d("RequestsJewel",["Arbiter","AsyncRequest","AsyncSignal","ChannelConstants","CSS","DOM","Event","FriendBrowserCheckboxController","LinkController","Parent","ScrollableArea","Vector","copyProperties","ge","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('AsyncSignal'),j=b('ChannelConstants'),k=b('CSS'),l=b('DOM'),m=b('Event'),n=b('FriendBrowserCheckboxController'),o=b('LinkController'),p=b('Parent'),q=b('ScrollableArea'),r=b('Vector'),s=b('copyProperties'),t=b('ge'),u=b('tx');function v(){}s(v,{instance:null,getInstance:function(){return this.instance;}});s(v.prototype,{init:function(w,x,y){v.instance=this;this.countNew=0;this.jewel=w;this.jewelFlyoutCase=w.getRoot();this.jewelFlyout=t('fbRequestsFlyout');this.newCountSpan=t('newRequestCount');this.folder=x;this.doNewMarkRead=y;this.openTimestamp=0;this._requestList={};this._requestCount=0;var z=t('requestsMarkReadButton');if(z)m.listen(z,'click',this._markRead.shield(this));this.jewel.subscribe('marked-seen',this._markSeenCallback.shield(this));this.jewel.subscribe('closed',this._clearNewItems.shield(this));this.jewel.subscribe('updated',this._updateCount.bind(this));this.jewel.subscribe('opened',this._openHandler.bind(this));o.registerHandler(this._handleLink.bind(this));g.subscribe(j.getArbiterType('jewel_requests_add'),this._addRequest.bind(this));g.subscribe(j.getArbiterType('jewel_requests_remove_old'),this._removeOldRequest.bind(this));g.subscribe(j.getArbiterType('friend_requests_seen'),this._markSeenFromMessage.bind(this));m.listen(this.jewelFlyout,'submit',function(aa){var ba=p.byClass(aa.getTarget(),'objectListItem');if(ba){k.removeClass(ba,'jewelItemNew');k.addClass(ba,'jewelItemResponded');this.pageInCollapsedRequests();}}.bind(this));this.setupScroll();return this;},setupScroll:function(){var w=l.scry(this.jewelFlyout,'.uiScrollableAreaWrap')[0];if(w){this._scrollableWrap=w;this._lastLinkPosition=0;this._scrollListener=m.listen(w,'scroll',this._handleScroll.bind(this),m.Priority._BUBBLE);}},fromDom:function(){l.scry(this.jewelFlyout,'.jewelItemList li.objectListItem').forEach(function(w){var x=w.getAttribute('id');if(x){var y=this._parseIDToInts(x);if(y.requester)this._requestList[y.requester]=x;++this._requestCount;}}.bind(this));this._conditionShowEmptyMessage();},_parseID:function(w){var x=w.match(/^(\d+)_(\d+)/);return (x)?{requester:x[1],type:x[2]}:undefined;},_parseIDToInts:function(w){var x=w?this._parseID(w):undefined,y;if(x&&x.requester){y=parseInt(x.requester,10);if(isNaN(y))y=undefined;}var z;if(x&&x.type){z=parseInt(x.type,10);if(isNaN(z))z=undefined;}return {requester:y,type:z};},_handleLink:function(w,event){var x=p.byClass(w,'jewelItemNew');if(x&&p.byClass(x,'fbRequestList')&&p.byClass(x,'beeperEnabled')){var y=this._parseID(x.id);y&&this._markSeenCallback(y.requester,y.type);g.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});k.removeClass(x,'jewelItemNew');}return true;},_handleScroll:function(){var w=l.scry(this._scrollableWrap,'.uiMorePager');if(!w||(t('fbRequestsJewelManualPager')&&w.length<2))return;var x=w.pop();if(x){var y=r.getElementPosition(x,'viewport').y;if(y>0)k.addClass(p.byClass(this._scrollableWrap,'uiScrollableArea'),'contentAfter');var z=l.find(x,'a');if(!z)return;var aa=r.getElementPosition(z,'viewport').y;if(aa==this._lastLinkPosition)return;var ba=r.getElementPosition(this._scrollableWrap,'viewport').y+r.getElementDimensions(this._scrollableWrap).y;if(aa-300<ba&&aa>0){this._lastLinkPosition=aa;var ca=z.getAttribute('ajaxify');if(ca){new h(ca).setRelativeTo(z).setStatusElement(p.byClass(z,'stat_elem')).send();}else n.getInstance('jewel').showMore();}}},_addRequest:function(w,x){if(!x)return;var y=x.obj.from,z=x.obj.suggester,aa=this._parseIDToInts(this._requestList[y]).type,ba=aa===19&&!z;if(!ba&&(aa||this.jewel.isOpen()))return;if(t('fbRequestsJewelLoading')){new h().setURI('/ajax/requests/loader/').send();}else{var ca=this._onMarkupCallback.bind(this,y,!!z),da={from:y};if(z)da.suggester=z;new h().setURI('/ajax/friends/jewel/request_markup').setData(da).setHandler(ca).send();}},_onMarkupCallback:function(w,x,y){var z=y.getPayload();if(!z)return;var aa=this._requestList[w],ba=this._parseIDToInts(aa).type;if(ba===19&&!x){var ca=aa&&t(aa);ca&&l.replace(ca,z.markup);}else{var da=l.scry(this.jewelFlyout,'.fbRequestList .uiList')[0];if(!da)return;l.prependContent(da,z.markup);var ea={jewel:'requests',count:++this.countNew};g.inform('jewel/count-updated',ea);++this._requestCount;this._conditionShowEmptyMessage();}this._requestList[w]=z.item_id;},_removeOldRequest:function(w,x){if(!x||this.jewel.isOpen()||t('fbRequestsJewelLoading')!==null)return;var y=this._requestList[x.obj.from],z=y&&t(y);if(z){k.hasClass(z,'jewelItemNew')&&g.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});if(!k.hasClass(z,'jewelItemResponded')){l.remove(z);delete this._requestList[x.obj.from];--this._requestCount;this._conditionShowEmptyMessage();}}},pageInCollapsedRequests:function(){var w=t('fbRequestsJewelManualPager');if(w){var x=l.scry(w,'.uiMorePagerPrimary')[0];if(x.style&&x.style.display!='none')setTimeout(function(){x.click();},100);}},_markRead:function(){this.jewel.markSeen();this._clearNewItems();},_markSeenCallback:function(w,x){var y=l.scry(this.jewelFlyout,'li');new i('/ajax/gigaboxx/endpoint/UpdateLastSeenTime.php',{folder:this.folder,first_item:y[0].id}).send();var z=typeof w!='undefined'&&typeof x!='undefined'?{requester:w,type:x}:{};this.doNewMarkRead&&new i('/ajax/requests/mark_read/',z).send();},_markSeenFromMessage:function(w,x){g.inform('jewel/count-updated',{jewel:'requests',count:0});},_removeRequest:function(w,x){var y=x.obj.item_id;if(y){var z=t(y),aa=z&&k.hasClass(z,'jewelItemNew');z?l.remove(z):false;aa&&g.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});}},_clearNewItems:function(w,x){l.scry(this.jewel.root,'li.jewelItemNew').forEach(function(y){k.removeClass(y,'jewelItemNew');});},_updateCount:function(w,x){this.countNew=x.count;k.conditionClass(this.jewelFlyout,'beeperUnread',this.countNew>0);k.conditionClass(this.jewelFlyoutCase,'showRequests',this.countNew>0);if(this.newCountSpan){var y=this.countNew==1?u._("{num} NEW REQUEST",{num:this.countNew}):u._("{num} NEW REQUESTS",{num:this.countNew});l.setContent(this.newCountSpan,y);}},_conditionShowEmptyMessage:function(){l.scry(this.jewelFlyout,'li.empty').forEach(function(w){k.conditionShow(w,this._requestCount<=0);}.bind(this));},_openHandler:function(){var w=l.scry(this.jewelFlyout,'.uiScrollableArea')[0];if(t('fbRequestsJewelLoading')){var x=Date.now();if(this.openTimestamp+5000<x){this.openTimestamp=x;new h().setURI('/ajax/requests/loader/').send();}}w&&q.poke(w);var y=Object.keys(this._requestList);if(y.length>0)new h().setURI('/friends/requests/log_impressions').setData({ids:y.join(','),ref:'jewel'}).send();}});e.exports=v;});
__d("legacy:RequestsJewel",["RequestsJewel"],function(a,b,c,d){a.RequestsJewel=b('RequestsJewel');},3);
__d("JewelX",["Event","Arbiter","ArbiterMixin","CSS","DOM","HTML","Keys","TabIsolation","Toggler","copyProperties","emptyFunction","reportData"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('CSS'),k=b('DOM'),l=b('HTML'),m=b('Keys'),n=b('TabIsolation'),o=b('Toggler'),p=b('copyProperties'),q=b('emptyFunction'),r=b('reportData'),s=function(t,u){t&&u&&this.init(t,u);};p(s,{_instancesByName:{},_resizeListener:null});p(s.prototype,i,{init:function(t,u){this.name=u.name;this.root=t;this.countNew=0;this.initialCount=0;this.escHandler=null;s._instancesByName[this.name]=this;var v=k.find(t,'.jewelFlyout'),w=new n(v);o.listen('show',this.root,function(x){this._logFirstClick();this.hasNew()&&this.markSeen();this.reset();this.inform('opened');h.inform('layer_shown',{type:'Jewel'});w.enable();this.setupEvents();}.bind(this));o.listen('hide',this.root,function(x,y){this.hasNew()&&this.markSeen();this.reset();this.inform('closed');h.inform('layer_hidden',{type:'Jewel'});w.disable();this.removeEvents();}.bind(this));h.subscribe('jewel/count-updated',function(x,y){y.jewel==this.name&&this.update(y);}.bind(this));h.subscribe('jewel/count-initial',function(x,y){y.jewel==this.name&&this.setInitial(y);}.bind(this));h.subscribe('jewel/reset',function(x,y){y.jewel==this.name&&this.reset();}.bind(this));s._resizeListener=s._resizeListener||(function(){var x=null;return g.listen(window,'resize',function(){clearTimeout(x);x=h.inform.bind(h,'jewel/resize').defer(100,false);});})();},getRoot:function(){return this.root;},hasNew:function(){return j.hasClass(this.root,'hasNew');},isOpen:function(){return j.hasClass(this.root,'openToggler');},reset:function(){j.removeClass(this.root,'hasNew');},setContent:function(t){var u=k.find(this.root,'ul.jewelItemList');k.setContent(u,l(t));},update:function(t){this.countNew=t.count;var u=k.find(this.root,'span.jewelCount span');k.setContent(u,this.countNew);var v=isNaN(this.countNew)||this.countNew>0;j.conditionClass(this.root,'hasNew',v);if(v){var w=(''+this.countNew).length;j.conditionClass(this.root,'hasCountSmall',w===1);j.conditionClass(this.root,'hasCountMedium',w===2);j.conditionClass(this.root,'hasCountLarge',w>2);}this.inform('updated',t);},setInitial:function(t){this.initialCount=t;},setupEvents:function(){this.escHandler=g.listen(document.documentElement,'keydown',function(t){if(t.keyCode===m.ESC&&this.isOpen())o.hide(this.root);}.bind(this));},removeEvents:function(){if(this.escHandler)this.escHandler.remove();},markSeen:function(){h.inform('jewel/count-updated',{jewel:this.name,count:0},h.BEHAVIOR_STATE);this.inform('marked-seen');},_logFirstClick:function(){this._logFirstClick=q;r('jewel_click',{gt:{count:this.countNew,initial:this.initialCount,jewel:this.name}});}});e.exports=s;});
__d("MercuryJewelCountControl",["Arbiter","DOM","MercuryThreadlistConstants","MercuryServerRequests","MercuryThreadInformer","MercuryUnseenState","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DOM'),i=b('MercuryThreadlistConstants'),j=b('MercuryServerRequests').get(),k=b('MercuryThreadInformer').get(),l=b('MercuryUnseenState').get(),m=b('copyProperties'),n=b('tx'),o,p,q,r=function(t){if(t||q.isOpen())l.markAsSeen();},s=function(t,u){o=t;p=h.find(o,'#mercurymessagesCountValue');q=u;this.render();j.subscribe('model-update-completed',function(v,w){r(false);});k.subscribe('unseen-updated',this.render.bind(this));q.subscribe('marked-seen',r.shield(this,true));};m(s.prototype,{render:function(){var t='';if(l.exceedsMaxCount()){t=n._("{count}+",{count:i.MAX_UNSEEN_COUNT});}else t=l.getUnseenCount().toString();g.inform('jewel/count-updated',{jewel:'mercurymessages',count:t},g.BEHAVIOR_STATE);}});e.exports=s;});
__d("MercuryJewelThreadlistControl",["Arbiter","ArbiterMixin","MercuryChatUtils","MercuryConfig","CSS","DOM","Event","JSLogger","MercuryAPIArgsSource","MercuryThreadlistConstants","MessagingTag","MercuryOrderedThreadlist","Parent","MercuryJewelTemplates","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreads","MercuryUnreadState","copyProperties","csx","cx","throttle","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('MercuryChatUtils'),j=b('MercuryConfig'),k=b('CSS'),l=b('DOM'),m=b('Event'),n=b('JSLogger'),o=b('MercuryAPIArgsSource'),p=b('MercuryThreadlistConstants'),q=b('MessagingTag'),r=b('MercuryOrderedThreadlist').get(),s=b('Parent'),t=b('MercuryJewelTemplates'),u=b('MercuryThreadInformer').get(),v=b('MercuryThreadMetadataRenderer').get(),w=b('MercuryThreads').get(),x=b('MercuryUnreadState').get(),y=b('copyProperties'),z=b('csx'),aa=b('cx'),ba=b('throttle'),ca=b('tx'),da=n.create('mercury_jewel');function ea(la,ma){this._contentArea=l.scry(la,'.scrollable')[0]||la;this._contentElement=l.find(this._contentArea,'.jewelContent');this._loadingElement=l.find(this._contentArea,'.jewelLoading');this._loadMoreButton=l.find(this._contentArea,"._8y5");this._loadMoreLink=l.find(this._contentArea,"a._8y6");this._currentFolder=q.INBOX;if(j.OtherFolderJewelGK){this._jewelFolderLinks=[];this._jewelFolderLinks[q.INBOX]=l.find(ma,"._1sde");this._jewelFolderLinks[q.OTHER]=l.find(ma,"._1sdf");this._jewelFolderCounts=[];this._jewelFolderCounts[q.INBOX]=l.find(ma,"._1sdg");this._jewelFolderCounts[q.OTHER]=l.find(ma,"._1sdh");ja.bind(this)();m.listen(this._jewelFolderLinks[q.INBOX],'click',ia.bind(this,q.INBOX));m.listen(this._jewelFolderLinks[q.OTHER],'click',ia.bind(this,q.OTHER));}this._curCount=[];this._curCount[q.INBOX]=p.JEWEL_THREAD_COUNT+1;this._curCount[q.OTHER]=p.JEWEL_THREAD_COUNT+1;this._isFolderLoaded=[];this._isFolderLoaded[q.INBOX]=false;this._isFolderLoaded[q.OTHER]=false;this._folderIsLoading=[];this._folderIsLoading[q.INBOX]=false;this._folderIsLoading[q.OTHER]=false;u.subscribe('threadlist-updated',this.render.bind(this));if(j.OtherFolderJewelGK)u.subscribe('unread-updated',ja.bind(this));this.render();da.bump('opened_threadlist_'+this._currentFolder);m.listen(this._contentArea,'scroll',ba(fa,50,this));m.listen(this._loadMoreLink,'click',this.renderMoreThreads.bind(this));}y(ea,{EVENT_THREADS_LOADED:'threads-loaded',EVENT_THREADS_RENDERED:'threads-rendered'});y(ea.prototype,h);y(ea.prototype,{render:function(){l.empty(this._contentElement);k.show(this._loadingElement);k.hide(this._loadMoreButton);var la=l.create('div');l.appendContent(this._contentElement,la);r.getThreadlist(p.RECENT_THREAD_OFFSET,this._curCount[this._currentFolder],this._currentFolder,this.renderThreads.bind(this,la),true);},renderThreads:function(la,ma){this.inform(ea.EVENT_THREADS_LOADED);if(ma.length){ma.forEach(function(na){var oa=t[':fb:mercury:jewel:threadlist-row'].build();w.getThreadMeta(na,function(pa){v.renderCoreThreadlist(pa,oa,this.renderSingleThread.bind(this),{show_unread_count:true});}.bind(this));l.appendContent(la,oa.getRoot());}.bind(this));}else l.setContent(this._contentElement,this.renderEmptyThreadlist());k.hide(this._loadingElement);k.conditionShow(this._loadMoreButton,!this._isFolderLoaded[this._currentFolder]);this.inform(ea.EVENT_THREADS_RENDERED);},renderSingleThread:function(la,ma){if(ma.unread_count>0)k.addClass(la.getRoot(),'jewelItemNew');if(j.MessagesJewelOpenInChat&&i.canOpenChatTab(ma)){m.listen(la.getRoot(),'click',function(event){g.inform('chat/open-tab',{thread_id:ma.thread_id});});}else v.renderTitanLink(ma.thread_id,la.getNode('link'),null,this._currentFolder);m.listen(la.getRoot(),'mouseover',function(event){var na=la.getRoot();if(!s.byClass(na,'notifNegativeBase'))k.addClass(na,'selected');});m.listen(la.getRoot(),'mouseout',function(event){k.removeClass(la.getRoot(),'selected');});},renderMoreThreads:function(){k.addClass(this._loadMoreButton,'async_saving');this._folderIsLoading[this._currentFolder]=true;var la=this._curCount[this._currentFolder]+p.JEWEL_MORE_COUNT;r.getThreadlist(p.RECENT_THREAD_OFFSET,la+1,this._currentFolder,ha.bind(this,la,this._currentFolder),true,o.JEWEL);},renderEmptyThreadlist:function(){return l.create('li',{className:'empty'},"No messages");}});function fa(){if(!this._isFolderLoaded[this._currentFolder]&&!this._folderIsLoading[this._currentFolder]&&ga.bind(this)())this.renderMoreThreads();}function ga(){return this._contentArea.scrollTop+this._contentArea.clientHeight>=this._contentArea.scrollHeight-1;}function ha(la,ma,na){this._curCount[ma]=la;if(!this._isFolderLoaded[ma]&&na.length<this._curCount[ma]+1)this._isFolderLoaded[ma]=true;this._folderIsLoading[ma]=false;k.removeClass(this._loadMoreButton,'async_saving');this.render();}function ia(la){if(this._currentFolder!=la){da.bump('opened_threadlist_'+la);k.addClass(this._jewelFolderLinks[la],"_1sdd");k.removeClass(this._jewelFolderLinks[this._currentFolder],"_1sdd");this._currentFolder=la;this.render();}}function ja(){ka.bind(this)(q.INBOX);ka.bind(this)(q.OTHER);}function ka(la){var ma;if(x.exceedsMaxCount(la)){ma=p.MAX_UNREAD_COUNT;}else ma=x.getUnreadCount(la);var na=this._jewelFolderCounts[la];if(ma>0){if(ma==p.MAX_UNREAD_COUNT)ma+='+';l.setContent(na,ca._("({unread_count})",{unread_count:ma}));}else l.setContent(na,'');}e.exports=ea;});
__d("MercuryJewel",["MercuryChannelHandler","MercuryJewelCountControl","DOM","MercuryJewelThreadlistControl","MercuryServerRequests","userAction"],function(a,b,c,d,e,f){b('MercuryChannelHandler');var g=b('MercuryJewelCountControl'),h=b('DOM'),i=b('MercuryJewelThreadlistControl'),j=b('MercuryServerRequests').get(),k=b('userAction'),l=false;function m(q,r,s,t){j.handleUpdate(t);var u=new g(r,s),v=h.find(q,'#MercuryJewelThreadList');if(s.getRoot()&&s.isOpen()){n.call(this,v,q);}else s.subscribe('opened',n.bind(this,v,q));}e.exports=m;function n(q,r){this._ua=k('messages').uai('click','jewel');this._listenForLoad=this._listenForRender=true;if(!l){var s=new i(q,r);s.subscribe(i.EVENT_THREADS_LOADED,o.bind(this));s.subscribe(i.EVENT_THREADS_RENDERED,p.bind(this));l=true;}}function o(){if(this._listenForLoad){this._ua.add_event('loaded');this._listenForLoad=false;}}function p(){if(this._listenForRender){this._ua.add_event('rendered');this._listenForRender=false;}}});
__d("MessagingEvents",["Arbiter","ChannelConstants","arrayContains","copyProperties","isEmpty"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('arrayContains'),j=b('copyProperties'),k=b('isEmpty'),l={},m=new g();function n(o){if(!k(l))return;for(var p in o)m.inform('count/'+p,o[p]);}m.subscribe('mark-as-read',function(o,p){(p.tids||p.chat_ids||[]).forEach(function(q){q=''+q;if(!(q in l)){l[q]=true;var r=function(){m.unsubscribe(s);clearTimeout(t);delete l[q];},s=m.subscribe('read',function(u,v){if(i((v.tids||[]),q)||i((v.chat_ids||[]),q))r();}),t=r.defer(60000);}});});g.subscribe(h.getArbiterType('messaging'),function(o,p){var q=j({},p.obj),event=q.event||'';delete q.type;delete q.event;m.inform(event,q);if('unread_counts' in q){var r=q.unread_counts;n({unread:r.inbox,other_unseen:r.other});}});g.subscribe(h.getArbiterType('inbox'),function(o,p){var q=j(p.obj);delete q.type;n(q);});a.MessagingEvents=e.exports=m;},3);
__d("TitanLeftNav",["CounterDisplay","MessagingEvents"],function(a,b,c,d,e,f){var g=b('CounterDisplay'),h=b('MessagingEvents'),i={initialize:function(){h.subscribe('count/other_unseen',function(j,k){g.setCount('other_unseen',k);});}};e.exports=i;});
__d("AccessibleMenu",["Event","CSS","DOM","Keys","TabbableElements","Toggler"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('Keys'),k=b('TabbableElements'),l=b('Toggler'),m,n,o;function p(){var x=i.scry(m,'a[rel="toggle"]')[0];x&&x.focus();l.getInstance(m).hide();}function q(x){if(!x)return false;h.removeClass(x,'selected');x.setAttribute('aria-selected','false');}function r(x){if(!x)return false;h.addClass(x,'selected');x.setAttribute('aria-selected','true');var y=k.find(x);if(y[0])y[0].focus();}function s(x){var y=i.scry(m,'.selected')[0],z=n.indexOf(y)+x,aa=n[z];if(!aa)return false;q(y);r(aa);}function t(x){if(!l.isShown()||l.getActive()!==m)return true;var y=g.getKeyCode(x);switch(y){case j.TAB:s(x.shiftKey?-1:1);g.prevent(x);break;case j.ESC:p();g.prevent(x);break;case j.UP:case j.DOWN:s(y===j.UP?-1:1);g.prevent(x);break;}}function u(x,y){m=y.getActive();n=i.scry(m,'[role="menuitem"]');if(!o)o=g.listen(document.documentElement,'keydown',t);}function v(){if(l.getActive()==m)q(i.scry(m,'.selected')[0]);}var w={init:function(x){l.listen('show',x,u);l.listen('hide',x,v);}};e.exports=w;});
__d("UserNoOp",["copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('emptyFunction'),i=function(){};g(i.prototype,{add_event:h.thatReturnsThis,add_data:h.thatReturnsThis,uai:h.thatReturnsThis,uai_fallback:h.thatReturnsThis});e.exports=i;});
__d("isEmail",[],function(a,b,c,d,e,f){var g=/^[\w!#\$%&'\*\+\/\=\?\^`\{\|\}~\-]+(:?\.[\w!#\$%&`\*\+\/\=\?\^`\{\|\}~\-]+)*@(?:[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?$/i;function h(i){return g.test(i);}e.exports=h;});
__d("NegativeNotif",["Animation","AsyncRequest","CSS","DataStore","DOM","Event","Parent","Tooltip","NotifXList","$","clickRefAction","copyProperties","userAction"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('AsyncRequest'),i=b('CSS'),j=b('DataStore'),k=b('DOM'),l=b('Event'),m=b('Parent'),n=b('Tooltip'),o=b('NotifXList'),p=b('$'),q=b('clickRefAction'),r=b('copyProperties'),s=b('userAction');function t(u,v){r(this,v);this.owner=u;this.xLink=k.find(this.obj,'.notif_x');this.confirmingMsg=k.find(this.obj,'.confirmingMsg');this.mainLink=k.find(this.obj,'.notifMainLink');this.userXClicked=false;this.userUnsubscribed=false;l.listen(this.xLink,'click',this.xClick.bind(this));if(i.hasClass(this.obj,'first_receipt')&&i.hasClass(p('jewelContainer'),'notifGentleAppReceipt'))this.gentleFirstReceiptHoverEventHandler=l.listen(this.obj,'mouseover',this.gentleFirstReceiptNotifHover.bind(this));}r(t.prototype,{FADE_AWAY_DURATION:2500,X_OUT_DURATION:100,X_OUT_DURATION_SHORT:2,GENTLE_FRUI_MIN_HOVER_DURATION:500,GENTLE_FRUI_FADE_DURATION_FAST:200,GENTLE_FRUI_FADE_DURATION_SLOW:2500,GENTLE_FRUI_DELAY_FADE_TIME:60000,xClick:function(event){this._activateX();var u=this.xLink.getAttribute('data-gt'),v=u?{gt:JSON.parse(u)}:{};s('xbutton',this.xLink,event).uai('click');q('click',this.xLink,event,null,v);return false;},gentleFirstReceiptNotifHover:function(event){event.stop();var u=k.find(this.obj,'.first_receipt_no_button'),v=j.get(u,'notif_fr_prompt');n.set(u,v,'above','center');n.show(u);this._gentleFirstReceiptTooltipFadeIn();if(!this.gentleFirstReceiptUnhoverEventHandler){this.hoverTime=new Date();this.gentleFirstReceiptUnhoverEventHandler=l.listen(document.documentElement,'mouseover',this.gentleFirstReceiptNotifUnhover.bind(this));}if(!this.gentleFirstReceiptNoClickEventHandler)this.gentleFirstReceiptNoClickEventHandler=l.listen(u,'click',this.gentleFirstReceiptNoClick.bind(this));},gentleFirstReceiptNotifUnhover:function(event){if(m.byClass(event.getTarget(),'uiContextualLayer')||m.byClass(event.getTarget(),'uiScrollableAreaTrack'))return false;var u=new Date();if(this.hoverTime&&u-this.hoverTime<this.GENTLE_FRUI_MIN_HOVER_DURATION){this.gentleFirstReceiptUnhoverEventHandler.remove();this.gentleFirstReceiptUnhoverEventHandler=null;this._gentleFirstReceiptTooltipAlreadyFadedIn=false;return;}this._removeGentleFirstReceiptListeners();this._gentleFirstReceiptTooltipFadeAway();this._gentleFirstReceiptXButtonFadeAway();var v=this;setTimeout(function(){v._gentleFirstReceiptUIFadeAway();},this.GENTLE_FRUI_DELAY_FADE_TIME);this._sendFirstReceiptYesToServer();},gentleFirstReceiptNoClick:function(event){this._removeGentleFirstReceiptListeners();},restore:function(){if(o.newNotifExist(this.id)){o.resumeInsert(this.id);}else o.removeNotif(this.id);this._confirmingMsgFadeAway(this.confirmingMsg);this._notifMainLinkShowUp(this.mainLink);this._buttonShowUp(this.xLink);this._adjustContainer(this.obj);},reset:function(){if(this.userXClicked&&!this.userUnsubscribed){this.userXClicked=false;this.restore();}},onTurnedOff:function(){this.userUnsubscribed=true;i.hide(this.confirmingMsg);this._notifMainLinkShowUp(k.find(this.obj,'.confirmedMsg'));this._adjustContainer(this.obj);},onUndid:function(){this.userXClicked=false;this.userUnsubscribed=false;this.restore();i.show(this.confirmingMsg);this._notifMainLinkFadeAway(k.find(this.obj,'.confirmedMsg'));k.remove(k.find(this.obj,'.confirmedMsg'));},onMarkedSpam:function(){k.remove(k.find(this.obj,'.confirmedMsg'));this._fadeAway(k.find(this.obj,'.spamMsg'));},onFirstReceiptYes:function(){this._hideFirstReceiptDiv();this._fadeAway(k.find(this.obj,'.firstConfirmedMsg'));},onFirstReceiptNo:function(){this._hideFirstReceiptDiv();i.hide(this.confirmingMsg);this._activateX();new h().setURI('/ajax/notifications/negative_req.php').setData({request_type:'turn_off',notification_id:this.id}).send();},_sendFirstReceiptYesToServer:function(){new h().setURI('/ajax/notifications/negative_req.php').setData({request_type:'first_receipt_yes',notification_id:this.id}).send();},_gentleFirstReceiptTooltipFadeIn:function(){if(this._gentleFirstReceiptTooltipAlreadyFadedIn)return;var u=k.find(document.documentElement,'.uiLayer .uiContextualLayer .uiTooltipX');new g(u).from('opacity','0').to('opacity','1').duration(this.GENTLE_FRUI_FADE_DURATION_FAST).go();this._gentleFirstReceiptTooltipAlreadyFadedIn=true;},_gentleFirstReceiptTooltipFadeAway:function(){if(!this._gentleFirstReceiptTooltipAlreadyFadedIn)return;var u=k.find(document.documentElement,'.uiLayer .uiContextualLayer .uiTooltipX'),v=m.byClass(u,'uiLayer'),w=v.cloneNode(true);k.insertAfter(v,w);new g(w).from('opacity','1').to('opacity','0').duration(this.GENTLE_FRUI_FADE_DURATION_FAST).ondone(function(){k.remove(w);}).go();this._gentleFirstReceiptTooltipAlreadyFadedIn=false;},_gentleFirstReceiptXButtonFadeAway:function(){var u=k.find(this.obj,'.first_receipt_no_button');new g(u).from('opacity','1').to('opacity','0').duration(this.GENTLE_FRUI_FADE_DURATION_FAST).hide().go();i.addClass(this.obj,'show_original_x');},_gentleFirstReceiptUIFadeAway:function(){var u=this.obj;this.new_label=k.find(this.obj,'.notif_new_label');new g(this.new_label).to('opacity','0').duration(this.GENTLE_FRUI_FADE_DURATION_SLOW).ondone(function(){i.removeClass(u,'first_receipt');}).go();if(!i.hasClass(this.obj,'jewelItemNew'))new g(this.obj).from('backgroundColor','#ECEFF5').to('backgroundColor','#FFFFFF').duration(this.GENTLE_FRUI_FADE_DURATION_SLOW).go();},_removeGentleFirstReceiptListeners:function(){if(this.gentleFirstReceiptHoverEventHandler)this.gentleFirstReceiptHoverEventHandler.remove();if(this.gentleFirstReceiptUnhoverEventHandler)this.gentleFirstReceiptUnhoverEventHandler.remove();if(this.gentleFirstReceiptNoClickEventHandler)this.gentleFirstReceiptNoClickEventHandler.remove();},_activateX:function(){i.addClass(this.obj,'forPushSafety');this.userXClicked=true;o.userXClick(this.id);this._notifMainLinkFadeAway(this.mainLink);this._buttonFadeAway(this.xLink);if(i.shown(this.confirmingMsg))this._confirmingMsgShowUp(this.confirmingMsg);this._adjustContainer(this.obj);},_hideFirstReceiptDiv:function(){i.removeClass(this.obj,'first_receipt');i.hide(k.find(this.obj,'.first_receipt_div'));},_fadeAway:function(u){new g(u).from('backgroundColor','#FFF9D7').to('backgroundColor','#FFFFFF').duration(this.FADE_AWAY_DURATION).checkpoint().to('opacity','0').blind().duration(this.X_OUT_DURATION).checkpoint().to('height','0px').to('paddingTop','0px').to('paddingBottom','0px').blind().hide().duration(this.X_OUT_DURATION).go();},_adjustContainer:function(u){new g(u).by('height','0px').duration(this.X_OUT_DURATION).checkpoint().by('height','0px').duration(this.X_OUT_DURATION_SHORT).checkpoint().to('height','auto').duration(this.X_OUT_DURATION).go();},_notifMainLinkShowUp:function(u){new g(u).duration(this.X_OUT_DURATION).checkpoint().to('height','auto').to('paddingTop','4px').to('paddingBottom','4px').blind().show().duration(this.X_OUT_DURATION_SHORT).checkpoint().to('opacity','1').blind().duration(this.X_OUT_DURATION).go();},_confirmingMsgShowUp:function(u){new g(u).duration(this.X_OUT_DURATION).checkpoint().to('height','auto').to('paddingTop','10px').to('paddingBottom','10px').blind().show().duration(this.X_OUT_DURATION_SHORT).checkpoint().to('opacity','1').blind().duration(this.X_OUT_DURATION).go();},_notifMainLinkFadeAway:function(u){new g(u).to('opacity','0').blind().duration(this.X_OUT_DURATION).checkpoint().to('height','0px').to('paddingTop','0px').to('paddingBottom','0px').blind().hide().duration(this.X_OUT_DURATION_SHORT).go();},_confirmingMsgFadeAway:function(u){new g(u).to('opacity','0').blind().duration(this.X_OUT_DURATION).checkpoint().to('height','0px').to('paddingTop','0px').to('paddingBottom','0px').blind().duration(this.X_OUT_DURATION_SHORT).go();},_buttonShowUp:function(u){new g(u).duration(this.X_OUT_DURATION).checkpoint().show().duration(this.X_OUT_DURATION_SHORT).checkpoint().to('opacity','1').blind().duration(this.X_OUT_DURATION).go();},_buttonFadeAway:function(u){new g(u).to('opacity','0').blind().duration(this.X_OUT_DURATION).checkpoint().hide().duration(this.X_OUT_DURATION_SHORT).go();}});e.exports=t;});
__d("NotificationCounter",["copyProperties","invariant","Arbiter","DocumentTitle","JSLogger"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('invariant'),i=b('Arbiter'),j=b('DocumentTitle'),k=b('JSLogger'),l={messages:0,notifications:0,requests:0},m=null,n=null,o={init:function(p){m=g({updateTitle:true,updateFavicon:false,favicons:{}},p);if(m.updateFavicon)h(m.favicons.many);if(m.updateTitle)i.subscribe('update_title',this._handleUpdateTitle.bind(this));i.subscribe('jewel/count-updated',this._handleCountUpdate.bind(this));},getCount:function(){var p=0;for(var q in l){var r=Number(l[q]);if(typeof l[q]=='string'&&isNaN(r))return l[q];if(isNaN(r)||r<0){k.create('jewels').error('bad_count',{jewel:q,count:l[q]});continue;}p+=r;}return p;},updateTitle:function(){var p=this.getCount(),q=j.get();q=p?'('+p+') '+q:q;j.set(q,true);},_getFaviconNode:function(){if(!n){n=document.createElement('link');n.rel='shortcut icon';document.getElementsByTagName('head')[0].appendChild(n);}return n;},_getFaviconImage:function(){return m.favicons[this.getCount()]||m.favicons.many;},updateFavicon:function(){this._getFaviconNode().href=this._getFaviconImage();},_handleCountUpdate:function(p,q){l[q.jewel]=q.count;if(m.updateFavicon)this.updateFavicon();if(m.updateTitle)this.updateTitle();},_handleUpdateTitle:function(p,q){this.updateTitle();}};e.exports=o;});
__d("NotificationList",["Animation","ArbiterMixin","CSS","DOM","DoublyLinkedListMap","HTML","NotificationURI","$","copyProperties","ge","isEmpty","tx","hasArrayNature"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('ArbiterMixin'),i=b('CSS'),j=b('DOM'),k=b('DoublyLinkedListMap'),l=b('HTML'),m=b('NotificationURI'),n=b('$'),o=b('copyProperties'),p=b('ge'),q=b('isEmpty'),r=b('tx'),s=b('hasArrayNature'),t="0",u="1",v="2";function w(z){return z==u||z==v;}function x(z){return z==u;}function y(z,aa){this._list=new k();this._filter_func=null;this.unseenCount=0;this.contentRoot=z;this.noItemsElement=null;this.ITEM_TAG='li';this.ITEM_CLASS='notification';this.NO_ITEMS_ID='jewelNoNotifications';this.NO_ITEMS_CLASS='empty';this.compare=aa.compare||this.compare;this.shouldBlockAnimation=aa.shouldBlockAnimation||null;this.unseenVsUnread=aa.unseenVsUnread||false;this.animations={};}o(y,{ITEM_UNREAD_CLASS:'jewelItemNew',MARK_READ_TYPE:'mark_read',UNREAD_COUNT_CHANGE_TYPE:'unread_count_change',INSERTION_TYPE:'insert',REMOVAL_TYPE:'remove',getIdFromDom:function(z){return z.getAttribute('id').replace('notification_','');},localizeUrls:function(z){j.scry(z,'a').forEach(function(aa){aa.href=m.localize(aa.href);});}});o(y.prototype,h,{FADE_DURATION:250,RESIZE_DURATION:200,_getField:function(z,aa){var ba=this._list.get(z);return ba&&ba[aa];},getDomObj:function(z){return this._getField(z,'obj');},fromDom:function(){var z=this.ITEM_TAG+'.'+this.ITEM_CLASS,aa=j.scry(this.contentRoot,z);for(var ba=0;ba<aa.length;++ba){var ca=aa[ba],da=y.getIdFromDom(ca);this.insert(da,ca.getAttribute('data-notiftime'),null);}},compare:function(z,aa){return z.time<aa.time||(z.time===aa.time&&z.id<aa.id);},insert:function(z,aa,ba,ca,da,ea){var fa=u,ga=0,ha=this._list.exists(z),ia=ea&&this._list.exists(ea),ja=null,ka;if(ha||ia)if(!(ca&&ba)){return false;}else{if(this._filter_func){ka={notif_id:z,notif_time:aa,notif_markup:ba,replace:ca,ignoreUnread:da,notif_alt_id:ea};if(this._filter_func(ka))return false;}fa=this._getField(z,'readness');ga=this._getField(z,'time');if(ga>aa)return false;ja=ha?z:ea;this._remove(ja);}var la=(ba&&l(ba).getRootNode())||n('notification_'+z),ma=Math.max(aa,ga),na=la.getAttribute('data-readness');if(!this.unseenVsUnread&&v==na)na=t;ka={id:z,obj:la,time:ma,readness:na,app_id:la.getAttribute('data-appid')};this._insert(ka);y.localizeUrls(la);this.noItemsElement&&i.hide(this.noItemsElement);if(x(na)){da&&!w(fa)&&this.markRead([z]);this.unseenCount=this.getUnseenIds().length;this.inform(y.UNREAD_COUNT_CHANGE_TYPE);}var oa=!ja||ga<ma||(na&&!fa&&!da);this.inform(y.INSERTION_TYPE,{id:z,is_new:oa,obj:la,replaced_id:ja,time:ma});return true;},showNoNotifications:function(){if(null==this.noItemsElement)this.noItemsElement=p(this.NO_ITEMS_ID);if(null==this.noItemsElement){this.noItemsElement=j.create(this.ITEM_TAG,{id:this.NO_ITEMS_ID,className:this.NO_ITEMS_CLASS},"No new notifications");j.appendContent(this.contentRoot,this.noItemsElement);}i.show(this.noItemsElement);},_insert:function(z){this._list.remove(z.id);var aa=null;this._list.find(function(ca){var da=this.compare(ca,z);!da&&(aa=ca.id);return da;}.bind(this));var ba=this.getDomObj(aa);if(ba){this._list.insertAfter(z.id,z,aa);j.insertAfter(ba,z.obj);}else{this._list.prepend(z.id,z);j.prependContent(this.contentRoot,z.obj);}},_remove:function(z){var aa=this._getField(z,'obj');if(!aa)return false;this.inform(y.REMOVAL_TYPE,{id:z});this._list.remove(z);j.remove(aa);this.isEmpty()&&this.showNoNotifications();return true;},getUnreadIds:function(){return this._list.reduce(function(z,aa){w(z.readness)&&aa.push(z.id);return aa;},[]);},getUnseenIds:function(){return this._list.reduce(function(z,aa){x(z.readness)&&aa.push(z.id);return aa;},[]);},getIds:function(){return this._list.reduce(function(z,aa){aa.push(z.id);return aa;},[]);},isUnreadId:function(z){var aa=this.getDomObj(z);return w(this._getField(z,'readness'))||(aa&&i.hasClass(aa,y.ITEM_UNREAD_CLASS));},isUnseenId:function(z){return x(this._getField(z,'readness'));},markRead:function(z,aa){z=z?z.filter(this.isUnreadId.bind(this)):this.getUnreadIds();var ba=false;for(var ca=0;ca<z.length;ca++){var da=this._list.get(z[ca]);if(da){if(this._setReadness(z[ca],t))ba=true;if(aa){this._markReadInDom(z[ca],da.obj);}else this.animateMarkRead(da.obj);}}if(ba){this.unseenCount=this.getUnseenIds().length;this.inform(y.UNREAD_COUNT_CHANGE_TYPE);}},markSeen:function(z){if(!s(z))return;if(!this.unseenVsUnread){this.markRead(z);return;}z=z.filter(this.isUnseenId.bind(this));var aa=false;for(var ba=0;ba<z.length;ba++)if(this._setReadness(z[ba],v))aa=true;if(aa){this.unseenCount=this.getUnseenIds().length;this.inform(y.UNREAD_COUNT_CHANGE_TYPE);}},_setReadness:function(z,aa){var ba=this._list.get(z);if(!ba||ba.readness==aa)return false;if(ba.readness==t&&aa==v)return false;ba.readness=aa;ba.obj.setAttribute('data-readness',aa);return true;},_markReadInDom:function(z,aa){if(!this.isUnreadId(z))return;var ba=n(aa);if(ba){this.stopAnimation(z);i.removeClass(ba,y.ITEM_UNREAD_CLASS);}},animateMarkRead:function(z){if(!i.hasClass(z,y.ITEM_UNREAD_CLASS))return;var aa=y.getIdFromDom(z),ba=this._markReadInDom.bind(this,aa,z);if(i.hasClass(z,'fbJewelBeep')){ba();return;}if(this.shouldBlockAnimation&&this.shouldBlockAnimation(z))return;ba.defer(10000);},stopAnimation:function(z){z in this.animations&&this.animations[z].stop();delete this.animations[z];return true;},insertMany:function(z,aa){if('object'==typeof z&&!q(z)){for(var ba in z){var ca=z[ba];this.insert(ba,ca.time,ca.markup,true,aa,ca.alt_id||null);}this.noItemsElement&&i.hide(this.noItemsElement);}else this.isEmpty()&&this.showNoNotifications();},isEmpty:function(){return this._list.isEmpty();},getEarliestNotifTime:function(){return this._list.isEmpty()?0:Math.min.apply(null,this.getIds().map(function(z){return this._getField(z,'time');}.bind(this)));},setFilterFn:function(z){this._filter_func=z;},toggleNotifsSimilarTo:function(z,aa,ba){var ca=this._getField(z,'app_id');if(ca){var da=this.getIds();for(var ea=0;ea<da.length;++ea)if(ca==this._getField(da[ea],'app_id')){var fa=this.getDomObj(da[ea]);if(z!=da[ea])aa?this._hideWithAnimation(fa):this._showWithAnimation(fa);var ga=j.scry(fa,'.first_receipt_div');if(ga.length==1)if(ba){i.hide(ga[0]);i.removeClass(fa,'first_receipt');}else{i.show(ga[0]);i.addClass(fa,'first_receipt');}}}},_hideWithAnimation:function(z){new g(z).to('opacity','0').blind().duration(this.FADE_DURATION).checkpoint().to('height','0px').to('paddingTop','0px').to('paddingBottom','0px').blind().hide().duration(this.RESIZE_DURATION).go();},_showWithAnimation:function(z){new g(z).to('height','auto').to('paddingTop','auto').to('paddingBottom','auto').blind().show().duration(this.RESIZE_DURATION).checkpoint().to('opacity','1').blind().duration(this.FADE_DURATION).go();}});e.exports=y;});
__d("Notifications",["Animation","Arbiter","AsyncRequest","AsyncSignal","Bootloader","ChannelConstants","CSS","DOM","Env","Event","JSLogger","NegativeNotif","NotificationCounter","NotificationList","NotifXList","Parent","Poller","ScrollableArea","Style","SystemEvents","Toggler","URI","UserActivity","UserNoOp","Vector","$","copyProperties","emptyFunction","ge","hasArrayNature","isEmpty","throttle","userAction"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('AsyncSignal'),k=b('Bootloader'),l=b('ChannelConstants'),m=b('CSS'),n=b('DOM'),o=b('Env'),p=b('Event'),q=b('JSLogger'),r=b('NegativeNotif'),s=b('NotificationCounter'),t=b('NotificationList'),u=b('NotifXList'),v=b('Parent'),w=b('Poller'),x=b('ScrollableArea'),y=b('Style'),z=b('SystemEvents'),aa=b('Toggler'),ba=b('URI'),ca=b('UserActivity'),da=b('UserNoOp'),ea=b('Vector'),fa=b('$'),ga=b('copyProperties'),ha=b('emptyFunction'),ia=b('ge'),ja=b('hasArrayNature'),ka=b('isEmpty'),la=b('throttle'),ma=b('userAction');function na(oa){this.updateTime=oa.updateTime||Date.now();this.update_period=oa.updatePeriod||60000;this.latest_notif_time=oa.latestNotif||0;this.latest_read_notif_time=oa.latestReadNotif||0;this.cache_version=oa.cacheVersion||0;this.notifReceivedType=oa.notifReceivedType||'notification';this.wrapperID=oa.wrapperID||'notificationsWrapper';this.contentID=oa.contentID||'jewelNotifs';this.shouldLogImpressions=oa.shouldLogImpressions||false;this.allowDesktopNotifications=oa.allowDesktopNotifications||false;this.logAutoShutOffImpression=true;this.useInfiniteScroll=oa.useInfiniteScroll||false;this.unseenVsUnread=oa.unseenVsUnread||false;this.counterConfig=oa.counterConfig||{};this.scrollableAreaNode=null;this.firstReceiptMap={};this.user=o.user;this.queuedNotifications=[];this.timeElement='small.time';this.ua=new da();this._init();}ga(na.prototype,{TIME_TRAVEL:'time_travel',ONLINE:'online',SCROLL_OFF_TINY:'scroll_off_tiny',INACTIVE_REFRESH:'inactive_refresh',_init:function(){this.cookieName='notifications_'+this.user;this.updateCheckCount=0;this.fetchListeners=[];this.currentFetchRequest=null;this.wrapper=ia(this.wrapperID);this.content=ia(this.contentID);this.jewelFlyout=ia('fbNotificationsFlyout');this.footer=n.find(this.jewelFlyout,'.jewelFooter');this.loadingIndicator=ia(this.contentID+'_loading_indicator');this.NOTIF_JEWEL_REF='notif_jewel';this.notifLogger=q.create('notifications');s.init(this.counterConfig);this.alertList=new t(this.content,this._getListParams());this._updateCount();a.MinNotifications&&a.MinNotifications.fetchSent()&&(this.fetch=ha);h.subscribe(l.getArbiterType(this.notifReceivedType),this._handleNotificationMsg.bind(this));h.subscribe(l.getArbiterType('notifications_read'),this._handleNotificationsReadMsg.bind(this));h.subscribe(l.getArbiterType('notifications_seen'),this._handleNotificationsSeenMsg.bind(this));h.subscribe('jewel/resize',this._hideOverflow.shield(this));this.alertList.subscribe(t.UNREAD_COUNT_CHANGE_TYPE,this._updateCount.bind(this));this._poller=new w({interval:this.update_period,setupRequest:this._update.bind(this),clearOnQuicklingEvents:false});if(this.wrapper)this.countSpan=n.find(this.wrapper,'span.jewelCount span');this.initializeEvents();this.fromDom();if(this.useInfiniteScroll){this._autoLoadNotifIndex=1;this._truncate=false;this.alertList.subscribe(t.INSERTION_TYPE,this._handleInsert.bind(this));}},_getListParams:function(){return {shouldBlockAnimation:function(oa){return this.isNotifJewelOpen();}.bind(this),unseenVsUnread:this.unseenVsUnread};},fromDom:function(){this.alertList.fromDom();a.MinNotifications&&a.MinNotifications.fetched()&&this.alertList.isEmpty()&&this.alertList.showNoNotifications();},initializeEvents:function(){var oa=this.alertList.ITEM_TAG,pa=null;p.listen(this.content,{mouseover:function(event){var sa=event.getTarget();pa=v.byTag(sa,oa);if(pa&&sa!=pa)if(v.byClass(pa,'notifNegativeBase')){m.addClass(pa,'notifHover');}else m.addClass(pa,'selected');},mouseout:function(event){pa&&m.removeClass(pa,'selected');pa&&m.removeClass(pa,'notifHover');pa=null;},mousedown:this.onContentMouseDown.bind(this)});p.listen(this.wrapper,'mouseover',this.onMouseOver.bind(this));aa.listen('show',this.wrapper,this.onClick.bind(this));aa.listen('hide',this.wrapper,this.onHide.bind(this));this.shouldLogImpressions&&aa.listen('show',this.wrapper,this._logImpression.bind(this));var qa=function(sa){this._poller.request();this.notifLogger.bump(sa);}.bind(this);z.subscribe(z.TIME_TRAVEL,qa.curry(this.TIME_TRAVEL));z.subscribe(z.ONLINE,function(sa,ta){ta&&qa(this.ONLINE);});var ra=1000*60*60;ca.subscribe(function(sa,ta){(ta.idleness>ra)&&qa(this.INACTIVE_REFRESH);}.bind(this));this.negativeNotifs={};this._initNotifNegativeFeedback();if(this.useInfiniteScroll){this._setupScroll();this._initializeScrollEvents();this._updateScrollDataStructures.bind(this).defer();this._hideOverflow();}},_setupScroll:function(){this._scrollArea=n.scry(this.jewelFlyout,'div.uiScrollableAreaWrap')[0];this._morePagerLink=n.find(this.jewelFlyout,'.notifMorePager a');this._morePager=v.byClass(this._morePagerLink,'notifMorePager')||this._morePagerLink;this._infiniteScrollNotif=null;this.afterFirstFetch=false;this.animate=false;if(a.MinNotifications&&a.MinNotifications.fetched()){this.afterFirstFetch=true;m.show(this._morePager);}},_initializeScrollEvents:function(){p.listen(this._scrollArea,'scroll',la(this._handleScroll.bind(this)));p.listen(this._morePagerLink,'success',function(oa){this.fetchHandler(oa.getData().response);}.bind(this));},_updateScrollDataStructures:function(){var oa=this.alertList.getIds(),pa=Math.max(0,oa.length-this._autoLoadNotifIndex);this._infiniteScrollNotif=this.alertList.getDomObj(oa[pa]);this._annotateMorePagerURI();},_annotateMorePagerURI:function(){this._morePagerLink.setAttribute('ajaxify',new ba(this._morePagerLink.getAttribute('ajaxify')).addQueryData({earliest_time:this.alertList.getEarliestNotifTime()}));},onContentMouseDown:function(event){var oa=v.byTag(event.getTarget(),this.alertList.ITEM_TAG),pa=oa&&t.getIdFromDom(oa);if(pa&&this.alertList.isUnreadId(pa))this.markRead(true,[pa]);},onMouseOver:function(event){if(m.hasClass(event.getTarget(),"jewelButton"))this.ua=ma('notifs',event.target,event,{mode:'DEDUP'}).uai('mouseover','jewel').add_event('hover');this.fetch();},onClick:function(){a.ArbiterMonitor&&this.fetch!=ha&&h.registerCallback(ha,['notifs/fetched']);this.ua.add_event('show');this.fetch();this.markRead(true);this._hideOverflow();if(this.scrollableAreaNode){var oa=x.getInstance(this.scrollableAreaNode);oa&&oa.poke();}},onHide:function(){this.animate=false;this.animation&&this.animation.stop();this.ua.add_event('hide');this.markRead(true);this._dequeueNotifications();},_dequeueNotifications:function(){this.queuedNotifications.forEach(function(oa){this._displayNotification(oa.type,oa.data);},this);this.queuedNotifications.length=0;},_handleScroll:function(){if(this._checkInfiniteScroll()){this._autoLoadNotifIndex=5;this._sendFetchRequest(this._morePager);}},_handleInsert:function(oa,pa){if(pa.is_new)this._newDataFromInsert=true;this._updateScrollDataStructures();},_checkInfiniteScroll:function(){if(this._infiniteScrollNotif&&this._scrollArea){var oa=ea.getElementPosition(this._infiniteScrollNotif).y,pa=ea.getElementPosition(this._scrollArea).y+ea.getElementDimensions(this._scrollArea).y;return oa<pa;}return false;},_initNotifNegativeFeedback:function(){u.init(this);this.alertList.setFilterFn(u.filterStoreClicked);aa.listen('hide',fa(this.wrapperID),function(){for(var oa in this.negativeNotifs)if(oa)this.negativeNotifs[oa] instanceof r&&this.negativeNotifs[oa].reset();}.bind(this));h.subscribe('notif/negativeCancel',function(oa,pa){this.negativeNotifs[pa.id]&&this.negativeNotifs[pa.id].restore();}.bind(this));h.subscribe('notif/negativeConfirmed',function(oa,pa){this.negativeNotifs[pa.id]&&this.negativeNotifs[pa.id].onTurnedOff();this.alertList.toggleNotifsSimilarTo(pa.id,true,true);this._hideOverflow();this._handleScroll();}.bind(this));h.subscribe('notif/negativeUndid',function(oa,pa){this.negativeNotifs[pa.id]&&this.negativeNotifs[pa.id].onUndid();this.alertList.toggleNotifsSimilarTo(pa.id,false,true);this._hideOverflow();}.bind(this));h.subscribe('notif/negativeMarkedSpam',function(oa,pa){this.negativeNotifs[pa.id]&&this.negativeNotifs[pa.id].onMarkedSpam();}.bind(this));h.subscribe('notif/negativeFirstReceiptYes',function(oa,pa){this.negativeNotifs[pa.id]&&this.negativeNotifs[pa.id].onFirstReceiptYes();this.alertList.toggleNotifsSimilarTo(pa.id,false,true);}.bind(this));h.subscribe('notif/negativeFirstReceiptNo',function(oa,pa){this.negativeNotifs[pa.id]&&this.negativeNotifs[pa.id].onFirstReceiptNo();this.alertList.toggleNotifsSimilarTo(pa.id,false,true);}.bind(this));this.alertList.subscribe(t.INSERTION_TYPE,function(oa,pa){this._updateFirstReceipt(pa);var qa=n.scry(pa.obj,'.notif_x');if(qa.length==1)this.negativeNotifs[pa.id]=new r(this,pa);}.bind(this));},_sendIDs:function(oa,pa,qa){var ra=qa||{};for(var sa=0;sa<oa.length;++sa)ra['alert_ids['+sa+']']=oa[sa];new j(ba(pa).getQualifiedURI().toString(),ra).send();},_waitForFetch:function(oa){return this.currentFetchRequest&&this.fetchListeners.push(oa.bind(this));},_logImpression:function(){var oa=this.alertList.getIds();if(oa.length===0&&this._waitForFetch(this._logImpression))return;this.logImpressionIds(oa,this.NOTIF_JEWEL_REF);},logImpressionIds:function(oa,pa){this.shouldLogImpressions&&this._sendIDs(oa,'/ajax/notifications/impression.php',{ref:pa});},markRead:function(oa,pa){var qa=!ja(pa);pa=qa?this.alertList.getUnseenIds():pa.filter(this.alertList.isUnreadId.bind(this.alertList));if(pa.length){oa&&this._sendIDs(pa,'/ajax/notifications/mark_read.php',{seen:qa?1:0});if(ia('jewelNoticeMessage')&&this.logAutoShutOffImpression){new j('/ajax/notifications/auto_shutoff_seen.php').send();this.logAutoShutOffImpression=false;}var ra=oa;qa?this.alertList.markSeen(pa):this.alertList.markRead(pa,ra);}qa&&this._waitForFetch(this.markRead.bind(this,oa));},markAllRead:function(){var oa=this.alertList.getUnreadIds();this.markRead(true,oa);},_updateErrorHandler:function(oa){},_updateURI:'/ajax/presence/update.php',_update:function(oa){oa.setHandler(this._handleUpdate.bind(this)).setOption('suppressErrorAlerts',true).setErrorHandler(this._updateErrorHandler.bind(this)).setData({notif_latest:this.latest_notif_time,notif_latest_read:this.latest_read_notif_time}).setURI(this._updateURI).setAllowCrossPageTransition(true);},_handleUpdate:function(oa){var pa=oa.payload.notifications;if(!pa.no_change){this.updateTime=oa.payload.time;this.latest_notif_time=pa.latest_notif;this.latest_read_notif_time=pa.latest_read_notif;this._updateDisplay();this.alertList.insertMany(pa.notifications);}},_updateDisplay:function(){if(!this.content)return;this._updateCount();},_updateCount:function(){h.inform('jewel/count-updated',{jewel:'notifications',count:this.alertList.unseenCount},h.BEHAVIOR_STATE);this._hideOverflow();},fetch:function(oa){this._sendFetchRequest(oa);},_getFetchQueryData:function(){var oa={time:this.latest_notif_time,user:this.user,version:this.cache_version,locale:o.locale};if(this.useInfiniteScroll)oa.earliest_time=this.alertList.getEarliestNotifTime();return oa;},_sendFetchRequest:function(oa){if(this.useInfiniteScroll){this._infiniteScrollNotif=null;this._newDataFromInsert=false;this._truncate=true;}var pa=ba('/ajax/notifications/get.php'),qa=oa||this.loadingIndicator;if(this.currentFetchRequest)return true;this.ua.add_event('fetch');pa.setQueryData(this._getFetchQueryData());this.currentFetchRequest=new i().setURI(pa).setStatusElement(qa).setMethod('GET').setReadOnly(true).setTimeoutHandler(30000,this.fetchErrorHandler.bind(this)).setHandler(this.fetchHandler.bind(this)).setErrorHandler(this.fetchErrorHandler.bind(this)).setAllowCrossPageTransition(true);!this.currentFetchRequest.send()&&this.fetchErrorHandler();return true;},fetchErrorHandler:function(oa){this.currentFetchRequest=null;this.ua.add_event('fetch_error');this.loadingIndicator&&m.hide(this.loadingIndicator);this.useInfiniteScroll&&this._updateScrollDataStructures();},fetchHandler:function(oa){this.ua.add_event('fetch_success');var pa=oa.getPayload();this.alertList.insertMany(pa.notifications,true);this.loadingIndicator&&m.hide(this.loadingIndicator);this.loadingIndicator=null;this.currentFetchRequest=null;this.fetch=ha;if(this.fetchListeners){for(var qa=0;qa<this.fetchListeners.length;qa++)this.fetchListeners[qa]();this.fetchListeners=[];}a.ArbiterMonitor&&h.inform('notifs/fetched','',h.BEHAVIOR_STATE);var ra=pa.generated,sa=Math.round(Date.now()/1000);if(sa-ra>15)ra=sa;k.loadModules(['LiveTimer'],function(ta){ta.restart(ra);ta.startLoop(0);});if(this.useInfiniteScroll){if(ka(pa.notifications)||!this._newDataFromInsert){this._noMoreNotifications();}else m.show(this._morePager);this._updateScrollDataStructures();if(this.isNotifJewelOpen()&&this.afterFirstFetch)this.animate=true;this.afterFirstFetch=true;}this._hideOverflow();},_noMoreNotifications:function(){m.hide(this._morePager);this.useInfiniteScroll=false;},_mergeNotification:function(oa,pa,qa,ra){var sa=!this.alertList.isUnreadId(oa);this.alertList.insert(oa,pa,qa,true,null,ra||null);this.latest_notif_time=0;if(sa)this._updateCount();var ta=this.alertList.getDomObj(oa);if(ta)k.loadModules(['LiveTimer'],function(ua){ua.addTimeStamps(ta);});},_handleNotificationMsg:function(oa,pa){if(this.isNotifJewelOpen()){var qa={type:oa,data:pa};this.queuedNotifications.push(qa);}else this._displayNotification(oa,pa);},_displayNotification:function(oa,pa){var qa=pa.obj;if(typeof this.useDesktopNotifications=='undefined')this.useDesktopNotifications=this.allowDesktopNotifications&&window.webkitNotifications&&window.webkitNotifications.checkPermission()===0;if(this.useDesktopNotifications)k.loadModules(['DesktopNotifications'],function(ra){ra.addNotification(qa.alert_id);});if(qa.markup){this._mergeNotification(qa.alert_id,qa.time,qa.markup,qa.alt_id||null);}else this._poller.request();},_handleNotificationsReadMsg:function(oa,pa){var qa=pa.obj;this.markRead(false,qa.alert_ids);},_handleNotificationsSeenMsg:function(oa,pa){if(!this.unseenVsUnread){this._handleNotificationsReadMsg(oa,pa);return;}var qa=pa.obj;this.alertList.markSeen(qa.alert_ids);},_hideOverflow:function(){if(!this.isNotifJewelOpen())return;var oa=n.scry(fa('fbNotificationsList'),'.notification');this.scrollableAreaNode=this.scrollableAreaNode||n.scry(this.jewelFlyout,'.uiScrollableArea')[0];var pa=20,qa=m.hasClass(document.documentElement,'tinyViewport')&&!m.hasClass(document.body,'fixedBody');if(!oa.length||qa){y.set(this.scrollableAreaNode,'height','100%');this.notifLogger.rate(this.SCROLL_OFF_TINY,qa);return;}var ra=this.scrollableAreaNode||oa[0],sa=ea.getViewportDimensions().y-ea.getElementPosition(ra,'viewport').y-ea.getElementDimensions(this.footer).y-5,ta=sa,ua=0;for(;ua<oa.length&&ta>0;++ua)if(m.shown(oa[ua]))ta-=ea.getElementDimensions(oa[ua]).y;var va=530,wa=Math.min(va,sa-Math.max(ta,0));if(ta>=0&&wa<va){if(!this.useInfiniteScroll){wa='100%';}else{if(this._truncate&&oa.length>=5)wa-=pa;wa+='px';}}else wa+='px';if(this.useInfiniteScroll&&this.animate&&wa!='100%'){this.animation&&this.animation.stop();this.animation=new g(this.scrollableAreaNode).to('height',wa).duration(200).go();}else{var xa=x.getInstance(this.scrollableAreaNode);xa&&xa.showScrollbar.bind(xa).defer();y.set(this.scrollableAreaNode,'height',wa);}},_updateFirstReceipt:function(oa){var pa=oa.obj.getAttribute('data-appid'),qa=n.scry(oa.obj,'.first_receipt_div');if(pa&&qa.length==1){if(this.firstReceiptMap[pa]){if(oa.id!=this.firstReceiptMap[pa].id&&this.firstReceiptMap[pa].time>oa.time)return;m.removeClass(this.firstReceiptMap[pa].obj,'first_receipt');}this.firstReceiptMap[pa]=oa;m.addClass(oa.obj,'first_receipt');}},isNotifJewelOpen:function(){var oa=aa.getInstance(this.wrapper).getActive();return (oa===this.wrapper&&m.hasClass(oa,'openToggler'));}});e.exports=na;});
__d("legacy:original-notifications-jewel",["Notifications"],function(a,b,c,d){a.Notifications=b('Notifications');},3);
__d("PagesVoiceBar",["$","Arbiter","AsyncRequest","CSS","ChannelConstants","DOM","PageTransitions"],function(a,b,c,d,e,f){var g=b('$'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('CSS'),k=b('ChannelConstants'),l=b('DOM'),m=b('PageTransitions'),n='PagesVoiceBar/toggle',o='PagesVoiceBar/initialized',p='PagesVoiceBar/switchVoice',q='page_transition',r='pages_voice_bar_sync',s=null,t=null,u=false,v=false;function w(){v=!v;j.conditionClass(document.body,'hasVoiceBar',v);}function x(da,ea){new i('/ajax/pages/switch_voice.php').setData(ea).setHandler(function(fa){ba();}).send();}function y(){s=null;}function z(da,ea){if(ea.obj.profile_id&&ea.obj.profile_id==s)ba();}function aa(da){h.subscribe(o,da);}function ba(){m.getNextURI().go();}var ca={initVoiceBar:function(){if(u)return;t=g('pagesVoiceBarContent');v=j.hasClass(document.body,'hasVoiceBar');h.subscribe(n,w);h.subscribe(p,x);h.subscribe(q,y);h.subscribe(k.getArbiterType(r),z);u=true;h.inform(o,null,h.BEHAVIOR_STATE);},update:function(da,ea){aa(function(){s=ea;l.setContent(t,da);});}};e.exports=ca;});
__d("PrivacyLiteFlyout",["Event","function-extensions","Animation","Arbiter","ArbiterMixin","AsyncRequest","CSS","DOM","Ease","Parent","Selector","Style","Toggler","copyProperties","cx","csx","ge"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('Animation'),i=b('Arbiter'),j=b('ArbiterMixin'),k=b('AsyncRequest'),l=b('CSS'),m=b('DOM'),n=b('Ease'),o=b('Parent'),p=b('Selector'),q=b('Style'),r=b('Toggler'),s=b('copyProperties'),t=b('cx'),u=b('csx'),v=b('ge'),w='PrivacyLiteFlyout/expandingSection',x={},y={};function z(ea,fa,ga){var ha=fa?0:ea.offsetHeight;q.set(ea,'height',ha+'px');q.set(ea,'overflow','hidden');l.show(ea);var ia=fa?ea.scrollHeight:0,ja=m.getID(ea);x[ja]&&x[ja].stop();x[ja]=new h(ea).to('height',ia).ondone(function(){x[ja]=null;q.set(ea,'height','');q.set(ea,'overflow','');ia||l.hide(ea);ga();}).duration(Math.abs(ia-ha)*1.5).ease(n.sineOut).go();}var aa=null,ba=false,ca=false,da=s({loadBody:function(ea){if(!ba&&v('fbPrivacyLiteFlyoutLoading')){ba=true;if(!ea)ea=false;new k('/ajax/privacy/privacy_lite/loader').setData({from_megaphone:ea}).send();}},renderBody:function(ea){var fa=v('fbPrivacyLiteFlyoutLoading');if(fa){m.replace(fa,ea);da.inform('load',null,i.BEHAVIOR_STATE);}},hideCleanup:function(ea){i.inform(w);var fa=m.scry(ea,"._2va0").forEach(function(ga){l.removeClass(ga,"_2va0");});},registerFlyoutToggler:function(ea,fa){aa=fa;var ga=r.createInstance(ea);ga.setSticky(false);r.listen(['show','hide'],fa,function(ha){da.inform(ha);ca=ha==='show';if(!ca){da.hideCleanup(ea);ga.hide();i.inform('layer_hidden',{type:'PrivacyShortcutsFlyout'});}else i.inform('layer_shown',{type:'PrivacyShortcutsFlyout'});});},registerReminderFlyout:function(ea){if(ca)return;ea.setOffsetY(o.byClass(ea.getContext(),'hasSmurfbar')?15:-5);da.subscribe('show',function(){ea.hide();});ea.show();},isFlyoutVisible:function(){return aa&&r.getActive()===aa;},exists:function(){return !!m.scry(document.body,"._91j")[0];},setFlyoutVisible:function(ea){ea?r.show(aa):r.hide(aa);},showSection:function(ea){var fa=y[ea],ga=fa.chevron,ha=fa.sublist_container;i.inform(w,ga);if(da.inform('expand',ea)!==false){l.removeClass(ga,"_9or");l.addClass(ga,"_9os");z(ha,true,function(){da.inform('expanded',ea);});}},hideSection:function(ea,fa,ga){var ha=y[ea],ia=ha.chevron,ja=ha.sublist_container;if(ga===ia)return;if(da.inform('collapse',ea)!==false){l.addClass(ia,"_9or");l.removeClass(ia,"_9os");z(ja,false,function(){da.inform('collapsed',ea);});}},toggleSection:function(ea){var fa=y[ea].chevron;r.getInstance(fa).hide();if(l.hasClass(fa,"_9or")){da.showSection(ea);new k('/ajax/privacy/privacy_lite/log_section_expand').setData({section:ea}).send();}else da.hideSection(ea);},registerSection:function(ea,fa){y[ea]=fa;i.subscribe(w,da.hideSection.curry(ea));g.listen(fa.section_block,'click',da.toggleSection.curry(ea));},registerInlineHelpOnAudienceChange:function(ea,fa,ga){p.subscribe('select',function(ha,ia){if(ia.selector!=ea)return;l.addClass(fa,"_2va0");if(ga)new k('/ajax/privacy/privacy_lite/kill_intro').send();});},registerInlineHelpXOutOnClick:function(ea,fa){g.listen(ea,'click',l.addClass.curry(fa,"_9p0"));},registerBlockUnhideOnFocus:function(ea,fa){g.listen(ea,'focus',l.show.curry(fa));},registerMessageFilterSettingOnClick:function(ea,fa){var ga=m.find(ea,"._fv0");g.listen(ea,'click',function(){if(ga.checked)new k('/ajax/mercury/change_filtering_type.php').setData({filtering_type:fa,source:'privacy_lite'}).send();});}},j);e.exports=da;});
__d("PrivacyLiteFlyoutHelp",["Event","Arbiter","AsyncRequest","ContextualHelpSearchController","CSS","DOM","Parent","copyProperties","csx","cx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('ContextualHelpSearchController'),k=b('CSS'),l=b('DOM'),m=b('Parent'),n=b('copyProperties'),o=b('csx'),p=b('cx'),q,r;function s(t,u,v,w,x){this._width=315;r=l.find(u,'input');var y=l.create('div');this.init(t,r,y,v,w);q=m.byClass(u,"_8-a");g.listen(x,'click',this._hideSearch.bind(this));h.subscribe('PrivacyLiteFlyout/expandingSection',this._hideSearch.bind(this));var z=l.scry(q,"._d1r")[0];z&&g.listen(z,'click',function(){k.addClass(q,"_aw6");r.focus();if(!this.suggestedResults)new i('/ajax/privacy/privacy_lite/help_suggestions').setHandler(function(aa){var ba=aa.getPayload().searchSuggestions,ca=l.find(q,"._4_8m");l.setContent(ca,ba);k.addClass(q,"_4_8l");}.bind(this)).send();}.bind(this));}n(s.prototype,new j(),{source:'privacy_shortcuts',_hideSearch:function(){this.clearResults();k.removeClass(q,"_aw6");},show:function(t){if(t===this.topics_area){k.removeClass(q,"_aw7");return;}else if(t===this.loader){k.addClass(q,"_aw7");k.hide(this.results_area);}else k.hide(this.loader);k.show(t);}});e.exports=s;});
__d("LayerSlowlyFadeOnShow",["Class","LayerFadeOnShow","emptyFunction"],function(a,b,c,d,e,f){var g=b('Class'),h=b('LayerFadeOnShow'),i=b('emptyFunction');function j(k){this.parent.construct(this,k);}g.extend(j,h);j.prototype._getDuration=i.thatReturns(500);e.exports=j;});
__d("PrivacyLiteNUXController",["AsyncRequest","CSS","Event","LayerSlowlyFadeOnShow","Locale","ModalMask","PageTransitions","Parent","PrivacyLiteFlyout","Toggler","$","copyProperties","cx"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CSS'),i=b('Event'),j=b('LayerSlowlyFadeOnShow'),k=b('Locale'),l=b('ModalMask'),m=b('PageTransitions'),n=b('Parent'),o=b('PrivacyLiteFlyout'),p=b('Toggler'),q=b('$'),r=b('copyProperties'),s=b('cx'),t="_3oye",u="_1luv",v=[],w={bootload:function(){},init:function(y){if(!w.initialized)r(this,{dialog:y.dialog,sectionID:y.sectionID,subsectionID:y.subsectionID,initialized:true,tourStarted:false});if(y.showOnExpand){w._attachFlyoutListener();}else w._detachFlyoutListener();},startTourFromAnywhere:function(){w._startTour(false);},startTourFromMegaphone:function(){w._startTour(true);},_startTour:function(y){if(w.tourStarted)return;w.tourStarted=true;w._detachFlyoutListener();new g('/ajax/privacy/privacy_lite/log_nux_imp').setData({from_megaphone:y}).send();l.show();h.conditionClass(w.dialog.getRoot(),t,y);if(!y)w._maskListener=i.listen(q('modalMaskOverlay'),'click',w._cleanup);p.setSticky(true);setTimeout(w._showFlyout);m.registerHandler(function(){w._cleanup();o.setFlyoutVisible(false);},10);},_showFlyout:function(){o.loadBody(true);o.setFlyoutVisible(true);w._initDialog();x('load',w._showTour);},_showTour:function(){o.showSection(w.sectionID);x('expanded',function(y,z){if(z===w.sectionID)w.dialog.setContext(q(w.subsectionID)).setOffsetY(20).show();});x(['collapse','hide'],w._cleanup);},_initDialog:function(){var y=w.dialog.getRoot(),z=w.dialog.getContent();h.addClass(y,"_1luy");h.conditionClass(y,"_3qz8",k.isRTL());h.addClass(z,"_1luz");w.dialog.enableBehavior(j);i.listen(y,'click',function(event){if(n.byClass(event.getTarget(),u))w._cleanup();});},_attachFlyoutListener:function(){if(!w.flyoutSubscription)if(o.isFlyoutVisible()){w.startTourFromAnywhere();}else w.flyoutSubscription=o.subscribe('show',w.startTourFromAnywhere);},_detachFlyoutListener:function(){if(w.flyoutSubscription){w.flyoutSubscription.unsubscribe();w.flyoutSubscription=null;}},_cleanup:function(){if(!w.tourStarted)return;w.tourStarted=false;p.setSticky(false);l.hide();w.dialog.hide();while(v.length)v.pop().unsubscribe();if(w._maskListener){w._maskListener.remove();w._maskListener=null;}}};function x(y,z){v.push(o.subscribe(y,z));}e.exports=w;});
__d("ViewasChromeBar",["Event","Arbiter","AsyncRequest","CSS","DOM","Focus","ModalMask","PageTransitions","Parent","cx","csx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('CSS'),k=b('DOM'),l=b('Focus'),m=b('ModalMask'),n=b('PageTransitions'),o=b('Parent'),p=b('cx'),q=b('csx'),r='ViewasChromeBar/initialized',s=null,t=false;function u(x){h.subscribe(r,x);}function v(x){j.addClass(x,"_7g7");var y=k.find(x,"._7g0");l.set(k.find(y,'.textInput'));}var w={initChromeBar:function(x){if(t)return;s=x;t=true;h.inform(r,null,h.BEHAVIOR_STATE);},update:function(x,y){u(function(){k.setContent(s,x);if(y)new i('/ajax/privacy/glasgow/viewas_bar_flyout_open').send();});},registerSpecificModeOnClick:function(x){g.listen(x,'click',v.curry(o.byClass(x,"_7f-")));},registerFlyoutModalMask:function(){m.show();n.registerHandler(m.hide,10);}};e.exports=w;});
__d("BingScalingCommon",["startsWith","URI"],function(a,b,c,d,e,f){var g=b('startsWith'),h=b('URI'),i={integrateWebsuggestions:function(j,k,l,m,n){var o=j.filter(function(y){return y.type&&y.type!=='websuggestion'&&!g(y.type,'browse_type');}).map(function(y){return y.uid;}),p={typeaheadResults:JSON.stringify(o)},q=[],r=k?q:[],s=[],t=0,u=0,v=l;m=Math.floor(l*m);for(var w=0;w<j.length;w++){var x=j[w];if(x.type==='websuggestion'&&!x.isSeeMore){if((v>0&&t<m)||(t>0&&t<n)){r.push(x);t++;v--;x.path=h(x.path).addQueryData(p).toString();}else if(v>0)s.push(x);}else{if(v<=0&&!k)continue;q.push(x);u++;v--;}}if(v>0&&s.length>0)r=r.concat(s.slice(0,v));if(!k)return q.concat(r);return r;}};e.exports=i;});
__d("TypeaheadSearchSponsoredUtils",[],function(a,b,c,d,e,f){function g(o){return o.selected_target_id!=o.s_target;}function h(o,p){return Math.min(p.maxNumberAds,p.maxNumberRemovedResults+p.maxNumberResultsAndAds-o);}function i(o,p){var q={};for(var r=o.length-1;r>=0;--r){var s=o[r];q[s]=s;if(p.hasOwnProperty(s))p[s].forEach(function(t){q[t]=s;});}return q;}function j(o,p,q){for(var r=p;r<o.length;r++)o[r].setDebugString&&o[r].setDebugString(q);}function k(o,p){return p.indexOf(String(o))!=-1;}function l(o,p,q,r){if(n.isSelfPromoted(o))return false;if(q+p.length<r.maxNumberResultsAndAds)return false;return true;}function m(o,p,q,r){var s=o[o.length-1];if(p.hasOwnProperty(s))return false;if(s==q)return false;if(s==r)return false;return true;}var n={isSelfPromoted:function(o){return o.uid==o.s_target;},prepareAndSortAds:function(o,p,q){if(!p)return [];var r=[],s=o.length,t={};for(var u=0;u<s;u++){var v=o[u];t[v.uid]=true;if(v.s_categories)v.s_categories.forEach(function(z){t[z]=true;});}for(var w in t)if(p[w])for(var x in p[w]){var y=p[w][x];if(q&&q.hasOwnProperty(y.uid))continue;r.push(y);}r.sort(function(z,aa){return aa.s_value-z.s_value;});return r;},selectAds:function(o,p,q,r,s){var t=[],u={},v={},w={},x=0,y=h(o.length,r),z=i(o,p);for(var aa=0;aa<q.length;aa++){if(t.length>=y){j(q,aa,'filtered: '+y+' ads already selected');break;}var ba=q[aa],ca=z[ba.s_target]||ba.s_target;ba.selected_target_id=ca;if(!k(ca,o)){ba.setDebugString&&ba.setDebugString('filtered: targeted organic '+ca+' does not exist. '+'promoted id '+ba.uid);continue;}if(l(ba,o,x,r)&&!m(o,v,ca,s)){ba.setDebugString&&ba.setDebugString('filtered: last organic need but cannot be removed');continue;}if(!n.isSelfPromoted(ba)&&o.indexOf(String(ba.uid))!=-1){ba.setDebugString&&ba.setDebugString('filtered: organic '+ba.uid+' targets another organic '+ca);continue;}if(u.hasOwnProperty(ba.s_account)){ba.setDebugString&&ba.setDebugString('filtered: ad account '+ba.s_account+' already selected');continue;}if(w.hasOwnProperty(ba.uid)){ba.setDebugString&&ba.setDebugString('filtered: ad promoted id '+ba.uid+' already selected');continue;}ba.setDebugString&&ba.setDebugString('selected');t.push(ba);u[ba.s_account]=true;v[ca]=true;w[ba.uid]=true;if(!n.isSelfPromoted(ba)){++x;if(x+o.length>r.maxNumberResultsAndAds)o.pop();}}return t;},hasTopResult:function(o,p,q){if(o==null)return false;if(o.type=='user')return false;if(o.type=='grammar')return false;if(o.score>q.v0)return true;if(o.s_value>q.v3)return true;if(o.s_value>p.s_value)return true;var r=g(p)?q.v4:(o.bootstrapped?q.v1:q.v2);if(r<p.s_value)return false;return true;},setOrganicECPM:function(o,p){if(o==null)return;for(var q=0;q<p.length;q++)if(o.hasOwnProperty(p[q].uid))p[q].s_value=o[p[q].uid];return;},buildResultIndices:function(o){var p={},q=o.length;for(var r=0;r<q;r++)p[o[r].uid]=r;return p;},getTopAdPosition:function(o,p,q){if(o.length<1)return null;if(p.length<1)return null;if((o[0].type=='user')||(o[0].type=='grammar')){for(var r=1;r<o.length;++r)if(o[r].type!=o[0].type)return r;return o.length;}if(n.hasTopResult(o[0],p[0],q))return 1;return 0;}};e.exports=n;});
__d("TypeaheadSearchSponsored",["Event","Arbiter","CSS","DOM","URI","copyProperties","TypeaheadSearchSponsoredUtils","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('CSS'),j=b('DOM'),k=b('URI'),l=b('copyProperties'),m=b('TypeaheadSearchSponsoredUtils'),n=b('tx');function o(p){this._typeahead=p;}o.auctionOptions={};o.query=null;o.getOriginalOrganics=function(p){return p.map(function(q){return {uid:q.uid,text:q.text,type:o.getRealType(q),source:q.bootstrapped?1:0,index:q.index,s_value:q.s_value||0,s_categories:q.s_categories||[],score:q.score};});};o.setTopResult=function(p){p[0].renderTypeOverride=true;p[0].orig_render_type=p[0].render_type;p[0].render_type='tophit';};o.finalizeAd=function(p,q,r){var s="Sponsored";p.rankType=p.rankType||p.render_type||p.type;if(m.isSelfPromoted(p)){q.s_token=p.s_token;q.message=p.s_message;if(r.rerankingStrategy===0)q.subtextOverride=q.subtext?q.subtext+' \xB7 '+s:s;if(p.path){q.pathOverride=true;q.orig_path=q.path;q.path=p.path;}q.is_self=true;}else{p.message=p.s_message;p.subtextOverride=null;if(r.rerankingStrategy===0)p.subtextOverride=p.subtext?p.subtext+' \xB7 '+s:s;if(r.debug){if(!p.subtextOverride&&p.subtext)p.subtextOverride=p.subtext;if(p.subtextOverride){p.subtextOverride+=' \xB7 (Debug: '+q.text+')';}else p.subtextOverride='(Debug: '+q.text+')';}p.type=q.type;p.render_type=q.render_type;p.is_self=false;}};o.promoteSelfPromotedResultToTop=function(p,q,r,s){var t=p[q];if(q<r){var u="Sponsored";t.subtextOverride=t.subtext?t.subtext+' \xB7 '+u:u;return;}if(q>r)p.splice(r,0,p.splice(q,1)[0]);t=p[r];t.renderTypeOverride=true;t.orig_render_type=t.render_type;t.render_type='ownsection';};o.insertAdToTop=function(p,q,r,s){p.splice(r,0,q);q.render_type='ownsection';};o.rerankMethod5=function(p,q,r){if(r.rerankingStrategy!=5)return;var s=m.getTopAdPosition(p,q,r),t=m.buildResultIndices(p);for(var u=q.length-1;u>=0;u--){var v=q[u],w=t[v.selected_target_id],x=p[w];o.finalizeAd(v,x,r);if(m.isSelfPromoted(v)){o.promoteSelfPromotedResultToTop(p,w,s,r);}else o.insertAdToTop(p,v,s,r);t=m.buildResultIndices(p);}};o.rerankAds=function(p,q,r){switch(r.rerankingStrategy){case 5:o.rerankMethod5(p,q,r);break;default:break;}p.length=Math.min(p.length,r.maxNumberResultsAndAds);return p;};o.initResults=function(p){var q=p.length;for(var r=0;r<q;r++){var s=p[r];s.is_self=null;s.s_token=null;s.message=null;s.subtextOverride=null;if(s.pathOverride){s.path=s.orig_path;s.pathOverride=false;}if(s.renderTypeOverride){s.render_type=s.orig_render_type;s.renderTypeOverride=false;}s.rankType=s.rankType||s.render_type||s.type;}return p;};o.setAuctionOptions=function(p){l(o.auctionOptions,p);};o.getRealType=function(p){if(p.renderTypeOverride)return p.orig_render_type||p.type;return p.render_type||p.type;};o.hideAdResult=function(p,q){h.inform('TypeaheadSearchSponsored/hideAdResult',{uid:p,reason_dialog:q});};o.undoHideAdResult=function(p){h.inform('TypeaheadSearchSponsored/undoHideAdResult',{uid:p});};o.Ad=function(){};l(o.prototype,{_dataSubscriptions:null,_viewSubscriptions:null,_globalSubscriptions:null,_data:null,_view:null,_sponsoredEntries:null,_hiddenSponsoredEntities:null,_hideReasonDialog:null,_sBootstrapID:null,_organicECPM:null,enable:function(){this._data=this._typeahead.getData();this._dataSubscriptions=[this._data.subscribe('beginFetchHandler',function(p,q){var r=q.response.getPayload();if(r.s_entries){this._sponsoredEntries=this._sponsoredEntries||{};var s=r.s_entries.length;for(var t=0;t<s;t++){var u=new o.Ad();l(u,r.s_entries[t]);var v=u.s_target;if(!this._sponsoredEntries[v])this._sponsoredEntries[v]={};this._sponsoredEntries[v][u.uid]=u;}if(r.s_bootstrap_id)this._sBootstrapID=r.s_bootstrap_id;if(r.organic_s_value)this._organicECPM=l(this._organicECPM,r.organic_s_value);}}.bind(this))];if(o.auctionOptions.bootstrap)this._dataSubscriptions.push(this._data.subscribe('onload',function(p,q){var r=l(this.bootstrapData,{no_cache:1,options:['sponsored']});this.fetch(this.bootstrapEndpoint,r,{type:'sponsored'});}.bind(this._data)));this._view=this._typeahead.getView();this._viewSubscriptions=[this._view.subscribe('finalResultsReordering',function(p,q){o.query=q.value;m.setOrganicECPM(this._organicECPM,q.results);var r=o.getOriginalOrganics(q.results);o.setAuctionOptions({maxNumberResultsAndAds:Math.max(q.results.length,(this._data&&this._data._maxResults)||o.auctionOptions.maxNumberResultsAndAds)});var s=this.runAuction(q.results,this._sponsoredEntries,this._hiddenSponsoredEntities,o.auctionOptions),t=m.prepareAndSortAds(q.results,this._sponsoredEntries,this._hiddenSponsoredEntities),u=t.map(function(y){return y.s_token;}),v=[];for(var w=0;w<s.length;w++){var x=s[w];if(x.s_token)v.push({position:w,is_self:x.is_self});}this._view.inform('recordAfterReorder',{organic:r,tokens:u,position_data:v,s_bootstrap_id:this._sBootstrapID,options:o.auctionOptions,variant:o.auctionOptions.rerankingStrategy});q.results=s;this._data.inform('recordAuctionState',{organic:r,auctionOptions:o.auctionOptions,event_data:q});}.bind(this)),this._view.subscribe('highlight',function(p,q){if(this._view.content)j.scry(this._view.content,'a.report').forEach(i.hide);if(!q.element||!q.selected||!q.selected.s_token)return;var r=j.scry(q.element,'a.report');if(r.length){i.show(r[0]);}else j.appendContent(q.element,this._createHideAdLink(q.selected));}.bind(this))];this._globalSubscriptions=[h.subscribe('TypeaheadSearchSponsored/hideAdResult',function(p,q){this._hiddenSponsoredEntities=this._hiddenSponsoredEntities||{};this._hiddenSponsoredEntities[q.uid]=true;this._hideReasonDialog=q.reason_dialog;this._forceRefreshResults();}.bind(this)),h.subscribe('TypeaheadSearchSponsored/undoHideAdResult',function(p,q){if(this._hiddenSponsoredEntities)delete this._hiddenSponsoredEntities[q.uid];if(this._hideReasonDialog){this._hideReasonDialog.hide();this._hideReasonDialog=null;}this._forceRefreshResults();}.bind(this))];},disable:function(){this._dataSubscriptions.forEach(this._data.unsubscribe.bind(this._data));this._dataSubscriptions=null;this._viewSubscriptions.forEach(this._view.unsubscribe.bind(this._view));this._viewSubscriptions=null;this._globalSubscriptions.forEach(h.unsubscribe.bind(h));this._globalSubscriptions=null;this._data=null;this._view=null;this._sponsoredEntries=null;},runAuction:function(p,q,r,s){if(p.length===0)return p;p=o.initResults(p);if(!q)return p;var t=m.prepareAndSortAds(p,q,r);if(this._typeahead){var u=this._typeahead.getData();u.inform('recordAuctionState',{sorted_ads:t});}var v={},w=p.map(function(ba){if(ba.s_categories)v[ba.uid]=ba.s_categories;return String(ba.uid);}),x=m.selectAds(w,v,t,s);if(x.length===0)return p;if(m.hasTopResult(p[0],x[0],s))o.setTopResult(p);var y=0;for(var z=0;z<x.length;++z)if(!m.isSelfPromoted(x[z]))y++;p.length=Math.min(p.length,s.maxNumberResultsAndAds-y);var aa=o.rerankAds(p,x,s);return aa;},_forceRefreshResults:function(){if(this._data&&this._data.value)this._data.respond(this._data.value,this._data.buildUids(this._data.value));},_createHideAdLink:function(p){var q=new k('/ajax/emu/end.php').addQueryData({eid:p.s_token,f:0,ui:'typeahead_'+p.s_token.replace('.','_'),en:'fad_hide',ed:'true',a:1}).toString(),r={className:'report',rel:'dialog-post',href:'#',ajaxify:q,title:"Hide the ad"},s=j.create('a',r);g.listen(s,'mouseover',function(event){this._view.index=-1;this._view.highlight(-1,false);event.kill();}.bind(this));return s;}});e.exports=o;});
__d("legacy:SearchSponsoredTypeaheadBehavior",["TypeaheadSearchSponsored"],function(a,b,c,d){var e=b('TypeaheadSearchSponsored');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.searchSponsored=function(f){f.enableBehavior(e);};},3);
__d("legacy:TypeaheadSearchSponsored",["TypeaheadSearchSponsored"],function(a,b,c,d){a.TypeaheadSearchSponsored=b('TypeaheadSearchSponsored');},3);
__d("SearchDataSource",["Event","Arbiter","AsyncResponse","Class","DataSource","copyProperties","createArrayFrom","BingScalingCommon"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncResponse'),j=b('Class'),k=b('DataSource'),l=b('copyProperties'),m=b('createArrayFrom'),n=b('BingScalingCommon');function o(p){this._token=p.token||'';this._lazyonload=p.lazyonload===false?false:true;this._extraTypes=p.extraTypes;this._buckets=p.buckets;this._noMultiFetch=p.noMultiFetch||false;this._maxWebSuggToCountFetchMore=p.maxWebSuggToCountFetchMore||0;var q=p.maxResults||8;this.parent.construct(this,p);this._numResults={min:3,max:q};this._minWebSugg=p.minWebSugg||2;this._queryToWebSuggState={};this._genTime=p.genTime;}j.extend(o,k);l(o.prototype,{init:function(){this.parent.init();this._leanPayload=null;this._bootstrapRequestsPending=0;this._criticalOnly=true;this._updateMaxResults();g.listen(window,'resize',this._updateMaxResults.bind(this));},dirty:function(){this.parent.dirty();this._fetchOnUseRequests=[];},asyncErrorHandler:function(p){if(window.Dialog&&window.Dialog.getCurrent()==null&&p.getError()==1400003)i.verboseErrorHandler(p);},fetch:function(p,q,r){r=r||{};r.fetch_start=Date.now();this.parent.fetch(p,q,r);},fetchHandler:function(p,q){var r=p.getPayload(),s=l({fetch_end:Date.now()},q),t=s.value?h.BEHAVIOR_EVENT:h.BEHAVIOR_PERSISTENT;this.inform('beginFetchHandler',{response:p});if(q.type=='lean'){this._leanPayload=r;this._processLean();}else{if(r.coeff2_ts)s.coeff2_ts=r.coeff2_ts;var u={limit:typeof r.webSuggLimit!=='undefined'?r.webSuggLimit:6,showOnTop:typeof r.webSuggOnTop!=='undefined'?r.webSuggOnTop:false};this._queryToWebSuggState[q.value]=u;this.parent.fetchHandler(p,q);if(q.bootstrap&&!p.getRequest().getData().no_cache)s.browserCacheHit=(r.timestamp<this._genTime);if(q.bootstrap&&!r.no_data&&this._bootstrapRequestsPending>0){q.bootstrap=false;--this._bootstrapRequestsPending;!this._bootstrapRequestsPending&&this._bootstrapPostProcess();}if(r.no_data||r.stale||r.token!==this._token){var v=l({},p.getRequest().getData());if(v.lazy){delete v.lazy;v.token=this._token;this._fetchOnUse(v,q);}}}this.inform('endpointStats',s,t);},respond:function(p,q,r){this.inform('respondValidUids',q);var s=this.buildData(q,p);this.inform('reorderResults',q);this.inform('respond',{value:p,results:s,isAsync:!!r});return s;},buildData:function(p,q){if(!p||p.length===0)return [];var r=this.getWebSuggState(q),s=r.showOnTop,t=n.integrateWebsuggestions(p.map(this.getEntry.bind(this)),s,this._maxResults,r.limit);t.length=Math.min(t.length,this._maxResults);return t;},getWebSuggState:function(p){while(p){var q=this._queryToWebSuggState[p];if(typeof q!=='undefined')return q;p=p.slice(0,p.length-1);}return {limit:0,showOnTop:false};},shouldFetchMoreResults:function(p){var q=0,r=0;p.forEach(function(s){if(s.type!=='websuggestion'||r++<this._maxWebSuggToCountFetchMore)q++;}.bind(this));return q<this._maxResults;},_bootstrapPostProcess:function(){var p={time:Date.now()};this.inform('bootstrapped',p,h.BEHAVIOR_PERSISTENT);this._processLean();},_processLean:function(){if(this._leanPayload){var p,q=this._leanPayload.entries;for(var r in q){p=this.getEntry(r);p&&(p.index=q[r]);}this.setExclusions(this._leanPayload.blocked);this._leanPayload=null;}},_updateMaxResults:function(){var p=window.innerHeight||document.documentElement.clientHeight;this.setMaxResults(Math.max(this._numResults.min,Math.min(this._numResults.max,Math.ceil(2+((p-370)/56)))));},_bootstrapFetch:function(p,q){var r=l(q,this.bootstrapData);if(this._criticalOnly&&this._lazyonload)r.lazy=1;this.fetch(this.bootstrapEndpoint,r,{bootstrap:true,type:p});++this._bootstrapRequestsPending;},_fetchOnUse:function(p,q){for(var r in this.bootstrapData)!p.hasOwnProperty(r)&&(p[r]=this.bootstrapData[r]);if(this._criticalOnly){this._fetchOnUseRequests.push({args:p,ctx:q});}else this.fetch(this.bootstrapEndpoint,p,q);},_fetchLean:function(){var p={no_cache:1};p.options=m(p.options);p.options.push('lean');this._fetchOnUse(p,{type:'lean'});},bootstrap:function(p){if(!p){this._criticalOnly=false;this._flushFetchOnUseRequests();}if(this._bootstrapped)return;var q={filter:['event'],no_cache:1};this._fetchOnUse(q,{type:'event'});var r=['app','page','group','friendlist'];r=r.concat(this._extraTypes||[]);if(this._noMultiFetch){r.push('user');this._bootstrapFetch('user',{filter:r});}else{this._bootstrapFetch('other',{filter:r});if(this._buckets){for(var s=0;s<this._buckets.length;++s){var t={filter:['user'],buckets:this._buckets[s]};this._bootstrapFetch('user',t);}}else this._bootstrapFetch('user',{filter:['user']});}this._fetchLean();this._bootstrapped=true;},_flushFetchOnUseRequests:function(){var p=this._fetchOnUseRequests.length;for(var q=0;q<p;++q){var r=this._fetchOnUseRequests[q];this.fetch(this.bootstrapEndpoint,r.args,r.ctx);}if(p>0)this.inform('extra_bootstrap',{time:Date.now()},h.BEHAVIOR_PERSISTENT);this._fetchOnUseRequests=[];},onLoad:function(p,q){this.inform('onload',{time:Date.now()},h.BEHAVIOR_PERSISTENT);if(p)this.bootstrap.bind(this,q).defer();},mergeUids:function(p,q,r,s){var t=r[0]?this.getEntry(r[0]):null,u=q[0]?this.getEntry(q[0]):null,v=(t&&t.replace_results)?t:null;v=(!v&&u&&u.replace_results)?u:v;var w=this.parent.mergeUids(p,q,r,s);if(v){this.inform('backend_topreplace',{});return this.deduplicateByKey([v.uid].concat(w));}return w;}});e.exports=o;});
__d("legacy:SearchDataSource",["SearchDataSource"],function(a,b,c,d){a.SearchDataSource=b('SearchDataSource');},3);
__d("SearchTypeaheadCore",["Event","function-extensions","Arbiter","Class","DOM","Input","Parent","TypeaheadCore","copyProperties"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('Arbiter'),i=b('Class'),j=b('DOM'),k=b('Input'),l=b('Parent'),m=b('TypeaheadCore'),n=b('copyProperties');function o(p){this.parent.construct(this,p);}i.extend(o,m);n(o.prototype,{init:function(p,q,r){this.parent.init(p,q,r);var s=l.byTag(r,'form'),t=this.reset.bind(this);h.subscribe('pre_page_transition',function(event,v){var w=/^\/search/,x=w.test(v.from.path),y=w.test(v.to.path);if(x&&!y)t.defer();});if(s){var u=j.find(s,'input.search_sid_input');g.listen(s,'submit',function(){if(this.data&&this.data.queryData)u.value=this.data.queryData.sid;t.defer();}.bind(this),g.Priority.URGENT);}},select:function(){this.reset();this.element.focus();(function(){this.element.blur();}).bind(this).defer();},handleTab:function(event){var p=this.view.getQuerySuggestion(this.value);if(p){k.setValue(this.element,p);this.checkValue();event.kill();}else this.parent.handleTab(event);},getSearchType:function(){return 'regular';}});e.exports=o;});
__d("legacy:SearchTypeaheadCore",["SearchTypeaheadCore"],function(a,b,c,d){a.SearchTypeaheadCore=b('SearchTypeaheadCore');},3);
__d("SearchTypeaheadView",["Arbiter","ContextualTypeaheadView","Class","ContextualLayerUpdateOnScroll","copyProperties","DOM","goURI","MusicConstants","MusicEvents","tx","URI","isEmail"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ContextualTypeaheadView'),i=b('Class'),j=b('ContextualLayerUpdateOnScroll'),k=b('copyProperties'),l=b('DOM'),m=b('goURI'),n=b('MusicConstants'),o=b('MusicEvents'),p=b('tx'),q=b('URI'),r=b('isEmail');function s(u,v){this.parent.construct(this,u,v);}i.extend(s,h);function t(u){var v,w,x,y,z=[],aa={};w=u.length;for(v=0;v<w;v++){x=u[v];y=x.render_type||x.type;if(!aa.hasOwnProperty(y)){aa[y]=z.length;z.push([]);}z[aa[y]].push(x);}var ba=[];w=z.length;for(v=0;v<w;++v){x=z[v][0];y=x.render_type||x.type;ba=ba.concat(z[v]);}return ba;}k(s.prototype,{initializeLayer:function(){this.parent.initializeLayer();this.layer.setOffsetY(-1);this.layer.enableBehavior(j);},ignoreClick:function(event){event.prevent();},_shouldShowSeeMore:true,_bucketize:true,queryData:{init:'quick'},render:function(u,v,w){if(this._bucketize)v=t(v);var x={results:v,value:u};this.inform('finalResultsReordering',x);return this.parent.render(u,x.results,w);},disableBucketization:function(){this._bucketize=false;},buildBuckets:function(u,v){var w=v.length,x=0,y;for(y=0;y<w;++y)if(v[y].type=='user')x++;this.setWebSuggLoggingParams(u,v);if(this._bucketize)v=this.parent.buildBuckets(u,v);if(u&&this._shouldShowSeeMore){v.push(this.buildSeeMore(u,w));if(r(u)&&(x<1))v.push(this.buildInvite(u));}return v;},buildSeeMore:function(u,v){var w=v>0?p._("See more results for {query}",{query:u}):p._("See results for {query}",{query:u}),x=v==1?"Displaying top result":p._("Displaying top {number} results",{number:v}),y=l.create('li',{className:'calltoaction'},[l.create('a',{href:this.getSeeMoreEndpoint(u),rel:'ignore'},[l.create('span',{className:'text'},[l.create('span',{className:'seeMore'},[w,l.create('span',{className:'arrow'})]),l.create('span',{className:'subtext'},[x])])])]);y.setAttribute('aria-label',w);return {uid:'search',node:y,search:true};},buildInvite:function(u){var v=p._("Invite {query} to Facebook",{query:u}),w=l.create('li',{className:'calltoaction'},[l.create('a',{href:this.getInviteEndpoint(u),rel:'ignore'},[l.create('span',{className:'text'},[l.create('span',{className:'invite'},[v])])])]);w.setAttribute('aria-label',v);return {uid:'invite',node:w,search:true};},searchPageQueryData:function(u){var v=this.results.filter(function(x){return x.type&&x.type!=='websuggestion'&&x.type!=='header';}).map(function(x){return x.uid;}),w={q:u,typeaheadResults:JSON.stringify(v)};return k(w,this.queryData||{});},select:function(u){var v=this.index,w=this.results[v];if(!w||w.type=='header')return;var x=this.items[v],y=l.scry(x,'a')[0];if(w.song){if(y)o.inform(n.MUSIC_BUTTON.ACTIVATE,y);u&&this.inform('highlight',{index:v,selected:w});}else{this.parent.select(u);if(y&&y.href)if(y.target=='_blank'){window.open(y.href);}else m(y.href);}},setSid:function(u){this.queryData.tas=u;},getSeeMoreEndpoint:function(u){return q(this.seeMoreEndpoint).addQueryData(this.searchPageQueryData(u)).toString();},getInviteEndpoint:function(u){return q('/invite.php').addQueryData({email_list:u});},show:function(){if(!this.isVisible()){g.inform('layer_shown',{type:'SearchTypeahead'});this.parent.show();}},hide:function(){if(this.isVisible()){g.inform('layer_hidden',{type:'SearchTypeahead'});this.parent.hide();}},getQuerySuggestion:function(u){var v=this.results[this.index],w=v&&v.type!='header'?v.text.toLowerCase():'';return w==u.toLowerCase()?'':w;},setWebSuggLoggingParams:function(u,v){var w=0,x=0;for(var y=0;y<v.length;y++)if(v[y].type==='websuggestion'){if(x===0)x=y+1;var z='FR'+(y-w)+'AS'+w,aa=y+1;v[y].path+='&wssk='+z+'&wssp='+aa+'&wspq='+encodeURIComponent(u);v[y].path+='&wssrc='+v[y].websuggestion_source;w++;}var ba='&wssc='+v.length+'-'+u.length+'&wsbp='+w+'-'+x;for(y=0;y<v.length;y++)if(v[y].type==='websuggestion')v[y].path+=ba;}});e.exports=s;});
__d("legacy:SearchTypeaheadView",["SearchTypeaheadView"],function(a,b,c,d){a.SearchTypeaheadView=b('SearchTypeaheadView');},3);
__d("legacy:Typeahead",["Typeahead"],function(a,b,c,d){a.Typeahead=b('Typeahead');},3);
__d("SearchTypeaheadRecorder",["Event","AsyncRequest","Keys","TypeaheadUtil","ge","clickRefAction","copyProperties","userAction"],function(a,b,c,d,e,f){var g=b('Event'),h=b('AsyncRequest'),i=b('Keys'),j=b('TypeaheadUtil'),k=b('ge'),l=b('clickRefAction'),m=b('copyProperties'),n=b('userAction');function o(q){this.init(q);this.initEvents();}var p=function(q,r){var s=j.parse(r);if(s.flatValue[s.flatValue.length-1]===' ')return s.flatValue;var t=s.tokens[s.tokens.length-1],u={};q.forEach(function(z){u[z]=(u[z]||0)+1;});var v={},w=s.tokens.slice(0,s.tokens.length-1);w.forEach(function(z){v[z]=(v[z]||0)+1;});for(var x=0;x<q.length;++x){var y=q[x];if(y.indexOf(t)===0&&(u[y]-(v[y]||0)>0)){w.push(y);return w.join(' ');}}return undefined;};m(o.prototype,{_endPoint:'/ajax/typeahead/record_metrics.php',init:function(q){this.core=q.getCore();this.data=q.getData();this.view=q.getView();this.element=this.core.getElement();this.initTime=Date.now();this._onloadTime=0;this._extraRecorder=[];var r=k('search_first_focus');this.initStartTime=r&&r.value;this.bootstrapStats={bootstrapped:0};this._reset();},_reset:function(){this.stats={};this.avgStats={};this.appendStats={};this._backspacing=false;this._topreplace=false;this._inflightRequests={};this._reorderInfo=null;var q=Math.random().toString();this.data.setQueryData({sid:q});this.view.setSid(q);this.recordStat('sid',q);},initEvents:function(){this.core.subscribe('focus',function(event){if(!this.stats.session_start_time)this.recordStat('session_start_time',Date.now());}.bind(this));this.core.subscribe('blur',function(event){var q=Date.now();for(var r in this._inflightRequests){var s=this._inflightRequests[r],t=q-s;this.recordAvgStat('search_endpoint_ms_from_js',t);}this.recordStat('session_end_time',q);this.submit();}.bind(this));this.view.subscribe('select',function(q,r){this.recordSelectInfo(r);}.bind(this));this.view.subscribe('render',function(q,r){this.recordRender(r);}.bind(this));this.view.subscribe('recordAfterReorder',function(q,r){this._reorderInfo=m(this._reorderInfo,r);}.bind(this));this.data.subscribe('activity',function(q,r){this.recordStat('pending_request',r.activity);}.bind(this));this.data.subscribe('respondValidUids',function(q,r){this.validUids=r.slice(0);}.bind(this));this.data.subscribe('beforeQuery',function(q,r){if(!r.value){this.query='';this.results=[];return;}if(!this.stats.first_query_time)this.recordStat('first_query_time',Date.now());this.query=r.value;this.recordCountStat('num_queries');}.bind(this));this.data.subscribe('queryEndpoint',function(q,r){this.recordCountStat('num_search_ajax_requests');this.recordAvgStat('endpoint_query_length',r.value.length);this._inflightRequests[r.value]=Date.now();}.bind(this));this.data.subscribe('onload',function(q,r){this._onloadTime=r.time;}.bind(this));this.data.subscribe('bootstrapped',function(q,r){this.bootstrapStats.endTime=r.time;this.bootstrapStats.bootstrapped=1;}.bind(this));this.core.subscribe('recordFunction',function(q,r){this._extraRecorder.push(r);}.bind(this));this.data.subscribe('endpointStats',function(q,r){var s=r.fetch_end-r.fetch_start;if(r.value){this.recordAvgStat('search_endpoint_ms_from_js',s);}else this.bootstrapStats[r.type]=s;if(r.coeff2_ts)this.bootstrapStats.coeff2_ts=r.coeff2_ts;if(typeof r.browserCacheHit!='undefined')this.recordCountStat(r.browserCacheHit?'bootstrap_cachehits':'bootstrap_cachemisses');if(this._inflightRequests[r.value])delete this._inflightRequests[r.value];}.bind(this));this.data.subscribe('query',function(q,r){this.recordAvgStat('num_results_from_cache',r.results.length);}.bind(this));this.data.subscribe('backend_topreplace',function(q,r){if(false===this._topreplace){this.recordStat("backend_topreplace",1);this._topreplace=true;}}.bind(this));g.listen(this.element,'keydown',function(event){if(g.getKeyCode(event)==i.BACKSPACE){if(!this._backspacing&&this.query){this._backspacing=true;this.recordAppendStat('before_backspace_queries',this.query);}}else this._backspacing=false;}.bind(this));},recordStat:function(q,r){this.stats[q]=r;},recordCountStat:function(q){var r=this.stats[q];this.stats[q]=r?r+1:1;},recordAvgStat:function(q,r){if(this.avgStats[q]){this.avgStats[q][0]+=r;++this.avgStats[q][1];}else this.avgStats[q]=[r,1];},recordAppendStat:function(q,r){if(!this.appendStats.hasOwnProperty(q))this.appendStats[q]=[];this.appendStats[q].push(r);},recordRender:function(q){this.results=q.filter(function(r){return r.uid!='search'&&r.type!='disabled_result'&&r.type!='header';});if(this.results.length>0&&!this.stats.first_result_time)this.recordStat('first_result_time',Date.now());},recordSelectInfo:function(q){var r=q.selected,s=q.index;if(r.groupIndex!==undefined)s=q.index-r.groupIndex-1;var t={href:r.path},u=r.dataGT?{gt:JSON.parse(r.dataGT)}:{};l('click',t,null,null,u);n('search').uai('click');if(r.uid=='search'){this.recordStat('selected_search',1);}else if(r.uid=='invite'){this.recordStat('selected_invite',1);}else{var v=r.rankType||r.render_type||r.type,w=(v=='friend'?'user':v);this.recordStat('selected_'+w,1);this.recordStat('selected_position',s);this.recordStat('selected_type',v);this.recordStat('selected_name_length',r.text.length);this.recordStat('selected_id',r.uid);this.recordStat('selected_degree',r.bootstrapped?1:2);var x=j.parse(this.data.getTextToIndex(r)).tokens,y=p(x,this.query);if(y)this.recordStat('matched_terms',y);}var z={};this._extraRecorder.forEach(function(aa){aa(q,this.results,z);}.bind(this));this.recordStat('extra_select_info',JSON.stringify(z));if(r.type==='websuggestion'){this.recordStat('selected_memcached_websuggestion',r.fromMemcache);this.recordStat('selected_websuggestion_source',r.websuggestion_source);}this.recordStat('selected_with_mouse',q.clicked?1:0);},_dataToSubmit:function(){this.recordStat('candidate_results',this.buildResults());this.recordStat('query',this.query);this.recordStat('init_time',this.initTime);if(this.initStartTime){this.recordStat('init_start_time',this.initStartTime);this.recordStat('onload_time',this._onloadTime);this.initStartTime=0;}this.recordStat('bootstrapped',this.bootstrapStats.bootstrapped);if(this.bootstrapStats.endTime){this.recordStat('bootstrapped_time',this.bootstrapStats.endTime);this.recordStat('user_bootstrap_ms',this.bootstrapStats.user);this.recordStat('other_bootstrap_ms',this.bootstrapStats.other);this.bootstrapStats.endTime=0;}this.recordStat('coeff2_ts',this.bootstrapStats.coeff2_ts);this.recordStat('max_results',this.data._maxResults);if(this._reorderInfo){var q=this._reorderInfo;q.organic.forEach(function(u){delete u.text;});this.recordStat('s_count',q.position_data.length);this.recordStat('s_bootstrap_id',q.s_bootstrap_id);this.recordStat('s_organic_results',JSON.stringify(q.organic));this.recordStat('s_candidate_tokens',JSON.stringify(q.tokens));this.recordStat('s_positions',JSON.stringify(q.position_data));this.recordStat('s_options',JSON.stringify(q.options));this.recordStat('s_variant',JSON.stringify(q.variant));}var r=this.stats;for(var s in this.avgStats){var q=this.avgStats[s];r[s]=q[0]/q[1];}for(var t in this.appendStats)r[t]=JSON.stringify(this.appendStats[t]);return r;},buildResults:function(){var q=(this.results||[]).map(function(r,s){var t=j.parse(this.data.getTextToIndex(r)).tokens,u=r.rankType||r.render_type||r.type,v=r.bootstrapped?1:0,w=r.s_token||'',x=p(t,this.query)||this.query,y=r.index_rank;if(typeof r.groupIndex=='number')return [r.groupIndex,r.indexInGroup,r.uid,u,v,w,x,y,-r.index];return [0,s,r.uid,u,v,w,x,y,-r.index];}.bind(this));return JSON.stringify(q);},submit:function(){var q=this._dataToSubmit();if(Object.keys(q).length>0)new h().setURI(this._endPoint).setMethod('POST').setData({stats:q}).setOption('handleErrorAfterUnload',true).setErrorHandler(function(r){q.retry=true;new h().setURI(this._endPoint).setMethod('POST').setData({stats:q}).setOption('asynchronous',false).send();}.bind(this)).send();this._reset();}});e.exports=o;});
__d("TypeaheadSearchRecorderBasic",["SearchTypeaheadRecorder","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('SearchTypeaheadRecorder'),h=b('copyProperties'),i=b('emptyFunction');function j(k){this._typeahead=k;}h(j.prototype,{enable:function(){new g(this._typeahead);},disable:i});e.exports=j;});
__d("legacy:SearchRecorderBasicTypeaheadBehavior",["TypeaheadSearchRecorderBasic"],function(a,b,c,d){var e=b('TypeaheadSearchRecorderBasic');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.searchRecorderBasic=function(f){f.enableBehavior(e);};},3);
__d("SearchTypeaheadRenderer",["DOM","Env","MusicButtonManager","TypeaheadFacepile","TypeaheadUtil"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('Env'),i=b('MusicButtonManager'),j=b('TypeaheadFacepile'),k=b('TypeaheadUtil');function l(m,n){var o=[],p=m.photos||m.photo;if(p){if(p instanceof Array){p=j.render(p);}else p=g.create('img',{alt:'',src:p});o.push(p);if(m.song){o.push(g.create('span',{className:'playButton'}));o.push(g.create('span',{className:'playLoader'}));}}if(m.text&&m.type=='websuggestion'&&m.photo){o.push(g.create('span',{className:'shiftedtext'},[m.text]));}else if(m.text){var q=m.alias,r=this.value,s=m.text,t=[s];if(q&&k.isQueryMatch(r,q)&&!k.isQueryMatch(r,s))t.push(g.create('span',{className:'alias'},[' \xB7 '+q]));o.push(g.create('span',{className:'text'},t));}if(m.category){var u=[m.category];if(m.is_external)u.push(g.create('span',{className:'arrow'}));var v=m.message?'preCategory':'category';o.push(g.create('span',{className:v},u));}if(m.message)o.push(g.create('span',{className:'category'},[m.message]));var w=m.subtextOverride||m.subtext;if(w)o.push(g.create('span',{className:'subtext'},[w]));var x=m.classNames||m.type||'',y=m.is_external?'_blank':'',z=!m.song&&m.path||'';if(z){if(!(/^https?\:\/\//).test(z))z=h.www_base+z.substr(1);z+=(z.indexOf('?')>0?'&':'?')+'ref=ts&fref=ts';}var aa=g.create('a',{href:z,rel:'ignore',target:y},o);if(m.song){aa.id='mb_'+(Math.random()*1e+06|0);i.addButton.curry(m.song.provider,aa.id,m.song.url,m.song.context,m.song.media_type).defer();aa.onclick=this.ignoreClick;}var ba=g.create('li',{className:x},[aa]);if(m.text)ba.setAttribute('aria-label',m.text);return ba;}l.className='search';e.exports=l;});
__d("legacy:SearchTypeaheadRenderer",["SearchTypeaheadRenderer"],function(a,b,c,d){if(!a.TypeaheadRenderers)a.TypeaheadRenderers={};a.TypeaheadRenderers.search=b('SearchTypeaheadRenderer');},3);
void(0);
__d("TypeaheadSearchFilter",["Arbiter","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties');function i(j){this._typeahead=j;}h(i.prototype,{_subscription:null,enable:function(){var j=this._typeahead,k=j.getView().seeMoreEndpoint;this._subscriptions=[g.subscribe('search/typeahead/updateFilter',function(l,m){if(m.filter_type=='web')j.getView().queryData.form='FBKBFR';j.getView().queryData.type=m.filter_type;}),g.subscribe('search/typeahead/updateSeeMoreEndpoint',function(l,m){j.getView().seeMoreEndpoint=m;}),g.subscribe('page_transition',function(l,m){if(j.getView().queryData.form)delete j.getView().queryData.form;delete j.getView().queryData.type;j.getView().seeMoreEndpoint=k;},g.SUBSCRIBE_NEW)];},disable:function(){this._subscriptions.forEach(function(j){j.unsubscribe();});this._subscriptions=null;}});e.exports=i;});
__d("legacy:SearchFilterTypeaheadBehavior",["TypeaheadSearchFilter"],function(a,b,c,d){var e=b('TypeaheadSearchFilter');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.initFilters=function(f){f.enableBehavior(e);};},3);
__d("TypeaheadDetectQueryLocale",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._typeahead=i;this._data=i.getData();this._queryCache={'':this._data.queryCache,ja_JP:{},zh_TW:{}};}g(h.prototype,{enable:function(){this._previousLocale='';this._reset=this._typeahead.subscribe('reset',this._swapQueryCache.bind(this,''));this._beforeQuery=this._data.subscribe('beforeQuery',function(i,j){var k=j.value;if(k===''){this._swapQueryCache('');return;}var l=null,m=k.charCodeAt(k.length-1);if(12352<=m&&m<=12543){l='ja_JP';}else if(12544<=m&&m<=12735)l='zh_TW';this._swapQueryCache(l);}.bind(this));},disable:function(){this._swapQueryCache('');this._data.unsubscribe(this._beforeQuery);this._typeahead.ubsubscribe(this._reset);},_swapQueryCache:function(i){if(i===null||i===this._previousLocale)return;this._data.queryCache=this._queryCache[i];this._data.setQueryData({query_locale:i});this._previousLocale=i;}});e.exports=h;});
__d("TypeaheadExcludeBootstrapFromQueryCache",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._data=i.getData();}g(h.prototype,{enable:function(){this._buildingQueryCache=false;this._buildQueryCache=this._data.subscribe('buildQueryCache',function(){this._buildingQueryCache=true;}.bind(this));this._mergeUids=this._data.subscribe('mergeUids',function(i,j){if(this._buildingQueryCache)j.local_uids.splice(0,j.local_uids.length);}.bind(this));this._fetchComplete=this._data.subscribe('fetchComplete',function(){this._buildingQueryCache=false;}.bind(this));},disable:function(){this._data.unsubscribe(this._buildQueryCache);this._data.unsubscribe(this._mergeUids);this._data.unsubscribe(this._fetchComplete);}});e.exports=h;});
__d("TypeaheadSearchBrowseUpsell",["Arbiter","CSS","DOM","Event","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('Event'),k=b('copyProperties'),l=b('emptyFunction'),m='TypeaheadSearchBrowseUpsell/form';function n(o){this._typeahead=o;this._form=null;g.subscribe(m,this._registerForm.bind(this));}k(n,{registerForm:function(o){g.inform(m,o,g.BEHAVIOR_STATE);}});k(n.prototype,{_registerForm:function(o,p){this._form=p.cloneNode(true);i.scry(this._form,'button').forEach(function(q){h.removeClass(q,'selected');});j.listen(this._form,'success',function(){this._typeahead.view.hide();h.addClass(this._form,'browseSuccess');}.bind(this));},addUpsell:function(o){if(this._form){var p=i.create('li',{className:'browseUpsell'},this._form);o.push({type:'disabled_result',uid:'upsell',node:p});}},decorateSeeMore:function(o){var p=o[o.length-1];if(p&&p.uid==='search')h.addClass(p.node,'browseMore');},showUpsell:function(){var o=this._typeahead.view;return o._shouldShowSeeMore&&!h.hasClass(o,'typeaheadViewLoading');},enable:function(){this._typeahead.subscribe('beforeRender',function(o,p){var q=p.results.length;if(q&&this.showUpsell()){this.decorateSeeMore(p.results);this.addUpsell(p.results);}}.bind(this));},disable:l});e.exports=n;});
__d("TypeaheadRegulateMemorializedUsers",["copyProperties","TypeaheadUtil"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('TypeaheadUtil');function i(j){this._typeahead=j;}g(i.prototype,{_filterRegistry:null,_filter:function(j,k){if(j.type!=='user'||!j.memorialized)return true;var l=h.parse(j.text).tokens;if(l.length===1&&h.isExactMatch(k,j.text))return true;var m=this._typeahead.getData().getTextToIndex(j),n=h.parse(k).tokens;return (n.length>1&&h.isQueryMatch(k,m));},enable:function(){this._filterRegistry=this._typeahead.getData().addFilter(this._filter.bind(this));},disable:function(){this._filterRegistry.remove();this._filterRegistry=null;}});e.exports=i;});
__d("legacy:RegulateMemorializedUsersTypeaheadBehavior",["TypeaheadRegulateMemorializedUsers"],function(a,b,c,d){var e=b('TypeaheadRegulateMemorializedUsers');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.regulateMemorializedUsers=function(f){f.enableBehavior(e);};},3);