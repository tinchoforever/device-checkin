/*1365196626,173213983*/

if (self.CavalryLogger) { CavalryLogger.start_js(["WYSnA"]); }

__d("GenderConst",[],function(a,b,c,d,e,f){var g={UNKNOWN:0,FEMALE_SINGULAR:1,MALE_SINGULAR:2,FEMALE_SINGULAR_GUESS:3,MALE_SINGULAR_GUESS:4,MIXED_SINGULAR:5,MIXED_PLURAL:5,NEUTER_SINGULAR:6,UNKNOWN_SINGULAR:7,FEMALE_PLURAL:8,MALE_PLURAL:9,NEUTER_PLURAL:10,UNKNOWN_PLURAL:11};e.exports=g;});
__d("AsyncLoader",["copyProperties","AsyncRequest","BaseAsyncLoader"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('AsyncRequest'),i=b('BaseAsyncLoader');function j(k,l){this._endpoint=k;this._type=l;}g(j.prototype,i.prototype);j.prototype.send=function(k,l,m,n,o){new h(k).setData({ids:l}).setHandler(n).setErrorHandler(o).setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};e.exports=j;});
__d("BlackbirdUpsell",["Event","Arbiter","AsyncRequest","LegacyContextualDialog","DOM","LayerDestroyOnHide","LayerHideOnTransition","PresencePrivacy","copyProperties","BlackbirdUpsellConfig","BlackbirdUpsellConstants","BlackbirdUpsellTemplates"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('LegacyContextualDialog'),k=b('DOM'),l=b('LayerDestroyOnHide'),m=b('LayerHideOnTransition'),n=b('PresencePrivacy'),o=b('copyProperties'),p=b('BlackbirdUpsellConfig'),q=b('BlackbirdUpsellConstants'),r=b('BlackbirdUpsellTemplates'),s='/ajax/chat/blackbird/update_clicks.php',t='/ajax/chat/blackbird/update_impressions.php',u='/ajax/chat/blackbird/dismiss.php',v=235,w=null,x=null,y=false,z=false;function aa(){}o(aa,{shouldShow:function(){if(this._dialogDismissed)return false;if(this.isEducation()){return !!p.EducationGK&&!p.EducationDismissed&&p.EducationImpressions<p.EducationImpressionLimit;}else return !!p.UpsellGK&&!p.UpsellDismissed&&p.UpsellImpressions<p.UpsellImpressionLimit&&p.FriendCount>=p.UpsellMinFriendCount;},isEducation:function(){return p.TimeOffline<=p.EducationTimeOfflineThresdhold;},getOfflineContent:function(){if(this.isEducation()){return this._getEducationContent();}else return this._getUpsellContent();},_getEducationContent:function(){ga();var ka=r[':fb:chat:blackbird:offline-educate'].build(),la=ka.getNode('chatSettingsButton');g.listen(la,'click',function(){h.inform('chat/advanced-settings-dialog-opened');ja(q.CLICK_TYPE_OPEN_SETTINGS);da();});return ka.getRoot();},_getUpsellContent:function(){fa();var ka=r[':fb:chat:blackbird:upsell'].build(),la=ka.getNode('chatSettingsButton');g.listen(la,'click',function(){h.inform('chat/advanced-settings-dialog-opened');ia(q.CLICK_TYPE_OPEN_SETTINGS);ca();});var ma=ka.getNode('enableChatButton');g.listen(ma,'click',function(){ia(q.CLICK_TYPE_ENABLE_CHAT);ca();});return ka.getRoot();},getBlackbirdContent:function(ka){ga();switch(ka){case n.ONLINE:return r[':fb:chat:blackbird:most-friends-educate'].build().getRoot();case n.OFFLINE:return r[':fb:chat:blackbird:some-friends-educate'].build().getRoot();}},showOfflineDialog:function(ka){this.showDialog(ka,this.getOfflineContent.bind(this));},showBlackbirdDialog:function(ka,la){this.showDialog(ka,this.getBlackbirdContent.curry(la));},showDialog:function(ka,la){!w&&this._constructDialog();k.setContent(x,la());w.setContext(ka);w.show();},hide:function(){if(w&&w.isShown())w.hide();},dismiss:function(){this.hide();if(this.isEducation()){da();}else ca();},registerDismissClick:function(){if(this.isEducation()){ja(q.CLICK_TYPE_DISMISS_PROMO);}else ia(q.CLICK_TYPE_DISMISS_PROMO);},isVisible:function(){return z&&!y;},_constructDialog:function(){var ka=r[':fb:chat:blackbird:dialog-frame'].build();x=ka.getNode('dialogContent');w=new j();w.init(ka.getRoot());w.setPosition('above').setWidth(v).setFixed(true).disableBehavior(l).disableBehavior(m);g.listen(ka.getNode('dialogCloseButton'),'click',this.dismiss.bind(this));g.listen(ka.getNode('dialogCloseButton'),'click',this.registerDismissClick.bind(this));}});function ba(ka,la){if(!y&&z){y=true;n.inform('privacy-user-presence-changed');var ma=new i(u);ma.setData({source:ka,impressions:la,time_offline:p.TimeOffline});ma.setErrorHandler(function(){y=false;});ma.send();}}function ca(){ba(q.ACTION_UPSELL,p.UpsellImpressions);}function da(){ba(q.ACTION_EDUCATE,p.EducationImpressions);}function ea(ka,la){if(!z){z=true;var ma=new i(t);ma.setData({action:ka,impressions:la,time_offline:p.TimeOffline});ma.setErrorHandler(function(){z=false;});ma.send();}}function fa(){ea(q.ACTION_UPSELL,p.UpsellImpressions);}function ga(){ea(q.ACTION_EDUCATE,p.EducationImpressions);}function ha(ka,la,ma,na){var oa=new i(s);oa.setData({action:ka,impressions:ma,source:la,time_offline:na});oa.send();}function ia(ka){ha(ka,q.ACTION_UPSELL,p.UpsellImpressions,p.TimeOffline);}function ja(ka){ha(ka,q.ACTION_EDUCATE,p.EducateImpressions,p.TimeOffline);}h.subscribe('chat/advanced-settings-dialog-opened',aa.dismiss.bind(aa));h.subscribe('chat-visibility/go-online',aa.dismiss.bind(aa));h.subscribe('chat-visibility/go-offline',aa.dismiss.bind(aa));e.exports=aa;});
__d("ChatFavoriteNux",["AsyncRequest"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=null,i=false,j={tryShow:function(k){if(h&&!i){h.setContext(k);h.show();i=true;}},tryHide:function(){if(h&&i){h.hide();h=null;}},registerDialog:function(k){h=k;if(k)k.subscribe('confirm',this.dismissDialog);},dismissDialog:function(){if(h){new g('/ajax/chat/dismiss_favorite_nux.php').send();h.hide();h=null;}}};e.exports=j;});
__d("ChatHovercard",["Arbiter","AsyncLoader","Hovercard","JSLogger","debounce"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncLoader'),i=b('Hovercard'),j=b('JSLogger'),k=b('debounce'),l=5,m=new h('/ajax/chat/hovercard/sidebar.php','hover'),n=j.create('chat_hovercard');g.subscribe('Hovercard/dirty',m.reset.bind(m));function o(s,t){m.get(s,function(u){(function(){if(!u){n.error('fetch_failure',{id:s});return;}var v=i.getDialog(u);if(!v){n.error('no_hovercard',{id:s,endpoint:u});return;}if(s==t.getActiveID())t.showHovercard(s,v);}).defer();});}function p(s,t){var u=[];function v(y){if(y>=0&&y<s.length)u.push(s[y]);}var w=s.indexOf(t);if(w>-1){v(w);for(var x=1;x<l;x++){v(w+x);v(w-x);}}return u.filter(function(y){return y;});}function q(s,t){var u=t.getActiveID();if(u){var v=s.getShowingUsers(),w=p(v,u);m.get(w,function(){});}}function r(s){var t=s.getHoverController();t.registerDefault(o);t.subscribe('hover',k(q.curry(s,t),100));}e.exports=r;});
__d("ChatImpressionLogger",["AvailableList","ChatConfig","Poller"],function(a,b,c,d,e,f){var g=b('AvailableList'),h=b('ChatConfig'),i=b('Poller'),j=null,k=null,l={init:function(m){j=m;var n=h.get('chat_periodical_impression_logging',0);if(n){var o=h.get('periodical_impression_logging_config.interval');k=new i({interval:o,setupRequest:this.logImps.bind(this),clearOnQuicklingEvents:false});}this.init=function(){};},logImps:function(m){var n={source:'periodical_imps'},o=j.getCachedSortedList(),p=[];for(var q=0;q<o.length;q++)p[q]=g.get(o[q]);n.sorted_list=o.toString();n.list_availability=p.toString();m.setURI('/ajax/chat/imps_logging.php').setData(n);}};e.exports=l;});
__d("ChatOptions",["Arbiter","ChannelConstants","JSLogger","PresenceUtil","copyProperties","ChatOptionsInitialData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('JSLogger'),j=b('PresenceUtil'),k=b('copyProperties'),l=i.create('chat_options'),m={};(function(){var o=b('ChatOptionsInitialData');for(var p in o){var q=o[p];m[p]=!!q;}})();var n=k(new g(),{getSetting:function(o){return m[o];},setSetting:function(o,p,q){if(this.getSetting(o)==p)return;if(q){q='from_'+q;l.log(q,{name:o,new_value:p,old_value:this.getSetting(o)});}m[o]=!!p;g.inform('chat/option-changed',{name:o,value:p});}});g.subscribe(h.getArbiterType('setting'),function(o,p){var q=p.obj;if(q.window_id===j.getSessionID())return;n.setSetting(q.setting,!!q.value,'channel');});g.subscribe(i.DUMP_EVENT,function(o,p){p.chat_options=m;});e.exports=n;});
__d("ChatOrderedListHover",["Event","function-extensions","ArbiterMixin","CSS","ErrorUtils","LayerFadeOnHide","LayerHideOnBlur","Parent","ChatFavoriteList","copyProperties","cx","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('ArbiterMixin'),i=b('CSS'),j=b('ErrorUtils'),k=b('LayerFadeOnHide'),l=b('LayerHideOnBlur'),m=b('Parent'),n=b('ChatFavoriteList'),o=b('copyProperties'),p=b('cx'),q=b('setTimeoutAcrossTransitions');function r(u){i.addClass(u,'fetching');}function s(u){i.removeClass(u,'fetching');}function t(u){this._orderedList=u;this._root=u.getRoot();g.listen(this._root,'mouseover',this._mouseOver.bind(this));g.listen(this._root,'mouseleave',this._mouseLeave.bind(this));u.subscribe('click',this._hide.shield(this));}o(t.prototype,h,{_root:null,_activeItem:null,_hideTimeout:null,_showTimeout:null,_showingDialog:null,_showingID:null,_alreadyShowing:false,_handlers:{},_defaultHandler:null,_mouseOver:function(u){var v=u.getTarget(),w=m.byClass(v,"_42fz");w&&this._setActiveItem(w);},_mouseLeave:function(u){this._setActiveItem(null);},_clearTimeouts:function(){this._showTimeout&&clearTimeout(this._showTimeout);this._showTimeout=null;this._hideTimeout&&clearTimeout(this._hideTimeout);this._hideTimeout=null;},_checkAlreadyShowing:function(){var u=this.getActiveID();if(!u&&!this._showingID)this._alreadyShowing=false;},_hide:function(){if(this._showingDialog){this._showingDialog.enableBehavior(k);this._showingDialog.hide();this._showingDialog=null;this._showingID=null;}this._checkAlreadyShowing();},_show:function(){this._alreadyShowing=true;var u=this.getActiveID(),v=false;if(this._handlers[u]){v=true;j.applyWithGuard(this._handlers[u],{},[u,this]);}else if(this._defaultHandler){v=true;j.applyWithGuard(this._defaultHandler,{},[u,this]);}if(v&&this._showingID!=this.getActiveID())r(this._activeItem);},_setActiveItem:function(u){if(n.isEditMode()){this._clearTimeouts();this._hide();return;}if(u!=this._activeItem){this._clearTimeouts();this._activeItem&&s(this._activeItem);this._activeItem=null;var v=u?0:100;this._hideTimeout=q(function(){if(this.getActiveID()!=this._showingID)this._hide();}.bind(this),v);if(u){var w=this._orderedList.getUserForNode(u);this._activeItem=u;var x=v+(this._alreadyShowing?75:500);this._showTimeout=q(function(){this._show();}.bind(this),x);this.inform('hover',w);}else this.inform('leave');this._checkAlreadyShowing();}},register:function(u,v){if(!this._handlers[u]){this._handlers[u]=v;return {unregister:function(){if(u==this._showingID)this._hide();delete this._handlers[u];var w=this._orderedList.getAllNodes(),x=w[u];x&&s(x);}.bind(this)};}},registerDefault:function(u){this._defaultHandler=u;},getActiveID:function(){var u=this._activeItem&&this._orderedList.getUserForNode(this._activeItem);return u||null;},showHovercard:function(u,v){if(u==this.getActiveID()&&u!=this._showingID){this._clearTimeouts();s(this._activeItem);this._hide();this._showingDialog=v;this._showingID=u;var w=v.subscribe('mouseenter',this._setActiveItem.bind(this,this._activeItem)),x=v.subscribe('mouseleave',function(){w.unsubscribe();this._setActiveItem(null);}.bind(this)),y=v.subscribe('hide',function(){this.inform('hovercard_hide');w.unsubscribe();x.unsubscribe();y.unsubscribe();}.bind(this));v.enableBehavior(l).setContext(this._activeItem).setPosition('left').show();this.inform('hovercard_show');}}});e.exports=t;});
__d("ChatQuietLinks",["Event","DOM","UserAgent","DataStore","Parent"],function(a,b,c,d,e,f){var g=b('Event'),h=b('DOM'),i=b('UserAgent'),j=b('DataStore'),k=b('Parent'),l={},m={silenceLinks:function(q){n(q,this.removeEmptyHrefs.bind(this));},nukeLinks:function(q){n(q,this.removeAllHrefs.bind(this));},removeEmptyHrefs:function(q){o(q,function(r){return !r||r==='#';});},removeAllHrefs:function(q){o(q);}};function n(q,r){var s=!!i.chrome(),t=!!i.chrome()||i.ie()>=9||i.firefox()>=4;if(l[h.getID(q)])return;l[h.getID(q)]=true;if(!t)return;if(!s){r&&r(q);return;}g.listen(q,'mouseover',function u(v){var w=k.byTag(v.getTarget(),'a');if(w){var x=w.getAttribute('href');if(p(x)){j.set(w,'stashedHref',w.getAttribute('href'));w.removeAttribute('href');}}});g.listen(q,'mouseout',function u(v){var w=k.byTag(v.getTarget(),'a'),x=w&&j.remove(w,'stashedHref');if(p(x))w.setAttribute('href',x);});g.listen(q,'mousedown',function(u){if(!u.isDefaultRequested())return true;var v=k.byTag(u.getTarget(),'a'),w=v&&j.get(v,'stashedHref');if(p(w))v.setAttribute('href',w);});}function o(q,r){var s=h.scry(q,'a');if(r)s=s.filter(function(t){return r(t.getAttribute('href'));});s.forEach(function(t){t.removeAttribute('href');t.setAttribute('tabindex',0);});}function p(q){return q&&q!=='#';}e.exports=m;});
__d("runAfterScrollingStops",["Arbiter","Event","Run","debounceAcrossTransitions","emptyFunction","throttleAcrossTransitions"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Event'),i=b('Run'),j=b('debounceAcrossTransitions'),k=b('emptyFunction'),l=b('throttleAcrossTransitions');function m(x,y,z){if(y&&p[y])return;if(!o){g.subscribe('page_transition',w);o=true;}if(!n){x();return;}y&&(p[y]=1);q.push(x);if(!z){if(s){i.onLeave(w);s=false;}r.push(q.length-1);}}var n,o,p={},q=[],r=[],s=true,t=500,u=j(function(){n=false;var x=q;q=[];r=[];p={};for(var y=0,z=x.length;y<z;++y)x[y]();},t);function v(){n=true;u();}function w(){var x=r;r=[];s=true;for(var y=0,z=x.length;y<z;++y)q[x[y]]=k;}h.listen(window,'scroll',l(v,250));e.exports=m;});
__d("ChatOrderedList",["Event","Animation","Arbiter","ArbiterMixin","AsyncDialog","AsyncRequest","AvailableList","AvailableListConstants","Bootloader","Chat","ChatConfig","ChatContexts","ChatFavoriteList","ChatFavoriteNux","ChatOrderedListHover","ChatQuietLinks","ChatVisibility","CSS","DataStore","DOM","Ease","HTML","JSLogger","LastMobileActiveTimes","MercuryParticipantTypes","OrderedFriendsList","Parent","PresencePrivacy","Rect","ShortProfiles","TypeaheadUtil","URI","Vector","XHPTemplate","copyProperties","createObjectFrom","cx","csx","debounceAcrossTransitions","guid","requestAnimationFrame","runAfterScrollingStops","throttleAcrossTransitions","tx","ChannelImplementation"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Animation'),i=b('Arbiter'),j=b('ArbiterMixin'),k=b('AsyncDialog'),l=b('AsyncRequest'),m=b('AvailableList'),n=b('AvailableListConstants'),o=b('Bootloader'),p=b('Chat'),q=b('ChatConfig'),r=b('ChatContexts'),s=b('ChatFavoriteList'),t=b('ChatFavoriteNux'),u=b('ChatOrderedListHover'),v=b('ChatQuietLinks'),w=b('ChatVisibility'),x=b('CSS'),y=b('DataStore'),z=b('DOM'),aa=b('Ease'),ba=b('HTML'),ca=b('JSLogger'),da=b('LastMobileActiveTimes'),ea=b('MercuryParticipantTypes'),fa=b('OrderedFriendsList'),ga=b('Parent'),ha=b('PresencePrivacy'),ia=b('Rect'),ja=b('ShortProfiles'),ka=b('TypeaheadUtil'),la=b('URI'),ma=b('Vector'),na=b('XHPTemplate'),oa=b('copyProperties'),pa=b('createObjectFrom'),qa=b('cx'),ra=b('csx'),sa=b('debounceAcrossTransitions'),ta=b('guid'),ua=b('requestAnimationFrame'),va=b('runAfterScrollingStops'),wa=b('throttleAcrossTransitions'),xa=b('tx'),ya=c('ChannelImplementation').instance,za=q.get('divebar_no_online_friends_separator',0),ab=q.get('chat_ranked_by_coefficient',0),bb=null,cb=50;function db(kb,lb,mb,nb){this._root=kb;this._itemsMap={};this._isVisible=false;this._excludedIds={};this._numTopFriends=5;this._hasRendered=false;this._preventRendering=false;this._hoverController=null;this._template=lb;this._messageTemplate=mb;this._favoriteMode=q.get('divebar_favorite_list',0);this._contextualDialog=nb;if(this._favoriteMode){this._favoriteSidebar=z.find(this._root,"._42g5");this._editButton=z.find(this._root,"._42g6");this._favoriteList=z.find(this._root,"._42g7");this._activeNowList=z.find(this._root,"._42g8");this._activeNowLabel=z.find(this._root,"._42g9");this._activeNowArea=this._activeNowLabel.parentNode;}this._orderedList=z.find(this._root,'.fbChatOrderedList');this._scrollableOrderedList=ga.byClass(this._root,'scrollableOrderedList');this._chatSidebar=ga.byClass(this._root,'fbChatSidebar');this._scrollableArea=ga.byClass(this._root,'scrollable');g.listen(this._root,'click',this._onClick.bind(this));g.listen(this._root,'mouseenter',this._mouseEnter.bind(this));g.listen(this._root,'mouseleave',this._mouseLeave.bind(this));if(this._editButton)g.listen(this._editButton,'click',this._onEditButtonClick.bind(this));m.subscribe(n.ON_AVAILABILITY_CHANGED,this.update.shield(this));ha.subscribe('privacy-changed',this.update.shield(this));ya.subscribe([ya.CONNECTED,ya.RECONNECTING,ya.SHUTDOWN,ya.MUTE_WARNING,ya.UNMUTE_WARNING],this.update.shield(this));this.inform('initialized',this,i.BEHAVIOR_PERSISTENT);this.render();i.subscribe(ca.DUMP_EVENT,function(ob,pb){pb.chat_lists=pb.chat_lists||{sorted_list:this.getCachedSortedList(),ordered_list:fa.getList(),available_list:db.getAvailableList(this._excludedIds),excluded_list:this._excludedIds};}.bind(this));i.subscribe(['LitestandSidebar/scrollableAreaSingled','LitestandSidebar/scrollableAreaRemoved'],function(){this._scrollContainerHeight=null;}.bind(this));i.subscribe('ChatOrderedList/itemHeightChange',function(){this._cachedItemHeight=null;}.bind(this));}function eb(kb,lb){var mb=fb(kb,lb);if(mb!==0)return mb;if(!ab){var nb=ib(kb,lb);if(nb!==0)return nb;}return fa.compare(kb,lb);}function fb(kb,lb){var mb=ha.allows(kb),nb=ha.allows(lb);if(mb!==nb)return mb?-1:1;return 0;}var gb={};function hb(kb){return gb[kb]||(gb[kb]=ka.flatten(kb));}function ib(kb,lb){var mb=ja.getNowUnsafe(kb),nb=ja.getNowUnsafe(lb),ob=hb((mb||{}).name||'~'),pb=hb((nb||{}).name||'~');if(ob!==pb)return ob<pb?-1:1;return 0;}function jb(kb,lb){var mb=m.get(kb)===n.MOBILE,nb=m.get(lb)===n.MOBILE;if(mb!==nb)return nb?-1:1;return ib(kb,lb);}oa(db,{getSortedList:function(kb,lb){var mb=fa.getList().filter(function(fc){return !(fc in kb);});mb=mb.filter(function(fc){return ha.getFriendVisibility(fc)!==ha.BLACKLISTED;});var nb=[],ob=w.isOnline();if(ob){if(ha.getOnlinePolicy()===ha.ONLINE_TO_WHITELIST){var pb=mb,qb={},rb,sb;mb=[];for(rb=0;rb<pb.length;++rb){sb=pb[rb];if(ha.allows(sb)){qb[sb]=true;mb.push(sb);}}var tb=ha.getWhitelist();for(rb=0;rb<tb.length;++rb){sb=tb[rb];if(!(sb in qb))mb.push(sb);}for(rb=0;rb<pb.length;++rb){sb=pb[rb];if(!ha.allows(sb))mb.push(sb);}}var ub=q.get('ordered_list.top_friends',0),vb=q.get('ordered_list.top_mobile',0),wb=q.get('ordered_list.available_target',0),xb=q.get('ordered_list.length',0);if(xb>0&&mb.length>cb){var yb=q.get('ordered_list.length.use.min',0);lb=(yb==1)?Math.min(lb,xb):xb;}var zb=Math.floor(lb*wb),ac=[];for(var rb=0,bc=mb.length;rb<bc&&zb>0;rb++){var sb=mb[rb],cc=m.get(sb),dc=cc===n.ACTIVE;if(q.get('chat_sidebar_mobile_available'))dc=dc||(cc===n.MOBILE);if(dc||(cc===n.MOBILE&&rb<vb)||(rb<ub)){nb.push(sb);dc&&zb--;}else ac.push(sb);}if(rb<bc)Array.prototype.push.apply(ac,mb.slice(rb));if(nb.length<lb)Array.prototype.push.apply(nb,ac);}else Array.prototype.push.apply(nb,mb);nb=nb.slice(0,lb);if(nb.length===lb){var ec=db.getAvailableList(nb.concat(kb)).length;ec&&nb.splice(-1);}nb.sort(eb);bb=nb.slice();return nb;},getAvailableList:function(kb){return m.getOnlineIDs().filter(function(lb){return !(lb in kb);});}});oa(db.prototype,j,{getAllNodes:function(){var kb={},lb=z.scry(this._root,"li._42fz");for(var mb=0;mb<lb.length;mb++){var nb=y.get(lb[mb],'id');if(nb)kb[nb]=lb[mb];}return kb;},getShowingUsers:function(){return z.scry(this._root,"li._42fz").map(function(kb){return y.get(kb,'id');});},getUserForNode:function(kb){return y.get(kb,'id');},getHoverController:function(){if(!this._hoverController)this._hoverController=new u(this,this._contextualDialog);return this._hoverController;},getPaddingOffset:function(){return this._favoriteMode?24:8;},getItemHeight:function(){if(this._cachedItemHeight)return this._cachedItemHeight;var kb=this._orderedList,lb=this._template.build(),mb=lb.getRoot();z.setContent(lb.getNode('name'),'test');if(this._favoriteSidebar){kb=this._favoriteList;x.addClass(this._favoriteSidebar,"_4zmr");}mb.style.visibility='hidden';z.appendContent(kb,mb);var nb=ma.getElementDimensions(mb).y;z.remove(mb);if(this._favoriteSidebar)x.removeClass(this._favoriteSidebar,"_4zmr");this._cachedItemHeight=nb;return nb;},_placeholderUpdate:function(){if(!this._usePlaceholder)return;var kb=this._root.offsetTop-this._scrollContainer.scrollTop;this._scrollContainerHeight=this._scrollContainerHeight||this._scrollContainer.offsetHeight;var lb=this.getItemHeight(),mb=Math.ceil(this._scrollContainerHeight/lb),nb=kb<0?Math.max(Math.floor(-kb/lb)-mb,0):0,ob=nb+mb+mb;this._cachedItems=this._cachedItems||z.scry(this._root,"li._42fz");for(var pb=0,qb=this._cachedItems.length;pb<qb;pb++)x.conditionClass(this._cachedItems[pb],"_50zv",pb<nb||pb>ob);},_getListItem:function(kb,lb){var mb=this._itemsMap[kb];if(!mb)return;var nb=m.get(kb),ob=ha.allows(kb)&&!ya.disconnected();if(mb.buttonNode===undefined){mb.buttonNode=z.scry(mb.node,"._42g2")[0];mb.contextNode=z.find(mb.node,"._52zk");mb.timeNode=z.scry(mb.node,'.active_time')[0];mb.statusNodes=z.scry(mb.node,'img.status');}x.conditionClass(mb.node,"_42f-",lb);if(mb.buttonNode){x.conditionClass(mb.buttonNode,"_42f_",lb);x.conditionClass(mb.buttonNode,"_42g0",!lb);}var pb={active:false,mobile:false};pb.active=nb===n.ACTIVE;pb.mobile=nb===n.MOBILE;if(pb.mobile){var qb=da.getShortDisplay(kb);if(mb.timeNode&&mb.lastActiveTime!==qb){mb.lastActiveTime=qb;z.setContent(mb.timeNode,qb);}}else if(mb.lastActiveTime){mb.lastActiveTime=null;z.empty(mb.timeNode);}for(var rb in pb)x.conditionClass(mb.node,rb,pb[rb]&&ob);x.conditionClass(mb.node,'invis',!ob);mb.statusNodes.forEach(function(tb){if(nb===n.ACTIVE&&ob){tb.alt="Online";}else if(nb===n.MOBILE&&ob){tb.alt="Mobile";}else tb.alt='';});var sb=r.getShortDisplay(kb)||'';if(mb.contextNode){z.setContent(mb.contextNode,sb);x.conditionClass(mb.node,"_52zj",sb);}return mb.node;},getRoot:function(){return this._root;},getSortedList:function(kb){return db.getSortedList(kb||this._excludedIds,this._numTopFriends);},getCachedSortedList:function(kb){if(bb==null)bb=this.getSortedList(kb);return bb;},toggleFavoriteSidebar:function(kb){if(this._favoriteSidebar)x.conditionShow(this._favoriteSidebar,kb);var lb=z.scry(this._scrollableOrderedList||this._root,"._ptt");lb.forEach(function(mb){x.conditionShow(mb,kb);var nb=ga.byClass(mb,'uiContextualLayerPositioner');nb&&x.conditionShow(nb,kb);});},hide:function(){if(!this._isVisible)return;this._isVisible=false;t.tryHide();x.hide(this._scrollableOrderedList||this._root);this.inform('hide');},_onFavoriteOrderChange:function(){var kb=this.sortableGroup.getOrder();s.updateList(kb);},_getFavoriteItems:function(){var kb=[],lb=s.get();for(var mb=0;mb<lb.length;mb++){var nb=this._itemsMap[lb[mb]];if(nb)kb.push(nb.node);}return kb;},_getChatTabOpenLogData:function(kb){var lb=x.hasClass(document.documentElement,'sidebarMode'),mb={mode:lb?'sidebar':'chatNub',typehead:false};if(this._scrollableArea&&this._scrollContainer){var nb=ma.getElementPosition(this._scrollableArea,'viewport').y,ob=ma.getElementPosition(kb,'viewport').y,pb=this._scrollContainer.scrollTop;if(ob>nb){mb.visible_slot=Math.round((ob-nb)/32);var qb=Math.round(pb/32);mb.global_slot=mb.visible_slot+qb;}}if(lb){mb.sidebar_height=this._chatSidebar&&this._chatSidebar.clientHeight;if(this._scrollContainer)mb.buddylist_height=this._scrollContainer.clientHeight;}return mb;},_resetFavoriteBounds:function(){var kb=s.get(),lb=kb.length;if(lb){var mb=kb[0],nb=kb[lb-1],ob=this._itemsMap[mb],pb=this._itemsMap[nb],qb=new ia(ma.getElementPosition(ob.node).y,0,ma.getElementPosition(pb.node).y+ma.getElementDimensions(pb.node).y,0);this.sortableGroup.setBoundingBox(qb);}},_createSortableGroup:function(){if(this.sortableGroup)this.sortableGroup.destroy();o.loadModules(['SortableGroup'],function(kb){this.sortableGroup=new kb().setBeforeGrabCallback(this._resetFavoriteBounds.bind(this)).setOrderChangeHandler(this._onFavoriteOrderChange.bind(this));var lb=this._getFavoriteItems();for(var mb=0;mb<lb.length;mb++){var nb=lb[mb];this.sortableGroup.addSortable(y.get(nb,'id'),nb);}}.bind(this));},_onEditButtonClick:function(event){t.dismissDialog();s.toggleEditMode();if(s.isEditMode()){this._createSortableGroup();z.setContent(this._editButton,"DONE");x.addClass(this._favoriteSidebar,"_4-d6");}else{z.setContent(this._editButton,"EDIT");x.removeClass(this._favoriteSidebar,"_4-d6");s.save();}},_onClick:function(event){var kb=event.getTarget(),lb=ga.byTag(kb,'li');if(s.isEditMode()){var mb=ga.byClass(kb,"_42g2");if(mb&&lb){var nb=y.get(lb,'id');if(nb)s.toggleID(nb);this.update();}event.prevent();return false;}if(lb){if(x.hasClass(lb,'blackbirdWhitelist')){var ob=new la('/ajax/chat/privacy/settings_dialog.php').addQueryData({ref:'whitelist_separator'});k.send(new l(ob));event.prevent();return false;}var pb=y.get(lb,'id');if(pb){var qb=this._getChatTabOpenLogData(lb),rb=x.hasClass(document.documentElement,'sidebarMode'),sb=ha.getOnlinePolicy()===ha.ONLINE_TO_WHITELIST,tb=sb?'white_list':'ordered_list';if(rb&&this._favoriteMode&&!sb){while(lb.parentNode){lb=lb.parentNode;if(x.hasClass(lb,"_42g8")){tb='more_online_friends';break;}if(x.hasClass(lb,"_42g7"))break;}}else while(lb.previousSibling){lb=lb.previousSibling;if(x.hasClass(lb,'separator')){if(x.hasClass(lb,'moreOnlineFriends')){tb='more_online_friends';break;}if(x.hasClass(lb,'blackbirdWhitelist')){tb='blackbird_offline_section';break;}}}qb.source=tb;var ub=[];if(q.get('chat_realtime_coefficient_impressions')){ub=this.getCachedSortedList();qb.sorted_list=ub;}var vb=[],wb=q.get('chat_periodical_impression_logging',0);if(wb){for(var xb=0;xb<ub.length;xb++)vb[xb]=m.get(ub[xb]);qb.list_availability=vb;}ja.get(pb,function(yb){p.openTab(pb,yb.name,ea.FRIEND,qb);});this.inform('click',{id:pb});}else if(x.hasClass(lb,'separator')&&ga.byClass(kb,'inner'))this.scrollTo(lb);return false;}},_mouseEnter:function(){this._preventRendering=true;},_mouseLeave:function(){this._preventRendering=false;},setExcludedIds:function(kb){this._excludedIds=pa(kb||[]);},setNumTopFriends:function(kb){if(kb!==this._numTopFriends){this._numTopFriends=kb;this.render();}},setUsePlaceholder:function(kb){this._usePlaceholder=kb;},setIsLitestand:function(kb){this._isLitestand=kb;},_getOfflineToSectionItems:function(){var kb='subheader-text-'+ta(),lb=z.create('a',{href:'#','aria-describedby':kb},z.tx._("Edit")),mb=[],nb=z.tx._("MORE FRIENDS");mb.push(ba('<li class="separator">'+'<div class="outer">'+'<div class="inner">'+'<span class="text">'+nb+'</span>'+'<div class="dive"><span class="bar"></span></div>'+'</div>'+'</div>'+'</li>'));mb.push(ba('<li class="separator blackbirdWhitelist">'+'<div class="outer">'+'<div class="inner">'+'<div class="subheader">'+'<span id="'+kb+'" class="subheaderText">'+z.tx._("These friends can't see you on chat. {=link}",{'=link':lb})+'</span>'+'</div>'+'</div>'+'</li>'));return mb;},_renderOrderedList:function(){if(!this._isVisible||(this._preventRendering&&this._hasRendered))return;this._hasRendered=true;this._cachedItems=null;var kb=[],lb,mb,nb=false,ob=x.hasClass(document.documentElement,'sidebarMode'),pb=ha.getVisibility(),qb=ha.getOnlinePolicy()===ha.ONLINE_TO_WHITELIST,rb=ob&&this._favoriteMode&&pb&&!qb,sb=[],tb,ub;if(rb){this._chatSidebar&&x.addClass(this._chatSidebar,'fbSidebarFavoriteList');this.toggleFavoriteSidebar(true);x.hide(this._orderedList);sb=s.get();for(tb=0,ub=sb.length;tb<ub;tb++){lb=sb[tb];mb=this._getListItem(lb,true);if(mb){kb.push(mb);}else{nb=true;this._renderListItem(lb,this.update.bind(this));}}}else{this.toggleFavoriteSidebar(false);x.show(this._orderedList);}var vb=db.getSortedList(pa(sb),Math.max(0,this._numTopFriends-sb.length));if(rb)if(sb.length&&vb.length){var wb=z.create('li',{className:"_42g3"});kb.push(wb);}var xb=ha.getVisibility()&&ha.getOnlinePolicy()==ha.ONLINE_TO_WHITELIST;for(var yb=0,zb=vb.length;yb<zb;yb++){lb=vb[yb];if(xb)if(!ha.allows(lb)){if(yb+2>=vb.length)break;xb=false;var ac=this._getOfflineToSectionItems();kb.push(ac[0]);kb.push(ac[1]);zb-=2;}mb=this._getListItem(lb);if(mb){kb.push(mb);}else this._renderListItem(lb,this.render.bind(this));}if(rb)z.setContent(this._favoriteList,kb);var bc=db.getAvailableList(this._excludedIds),cc=sb.concat(vb),dc=pa(cc);bc=bc.filter(function(jc){return !(jc in dc);});bc.sort(jb);var ec="MORE FRIENDS";if(rb){kb=[];}else if(bc.length&&kb.length){var fc;if(this._isLitestand){fc='<span class="fullText">'+ec+' &middot; '+bc.length+'</span>'+'<span class="collapsedText">'+'+'+bc.length+'</span>';}else fc=xa._("{MORE ONLINE FRIENDS} ({=count})",{'MORE ONLINE FRIENDS':ec,'=count':bc.length});if(!za)kb.push(ba('<li class="separator moreOnlineFriends">'+'<div class="outer">'+'<div class="inner">'+'<span class="text">'+fc+'</span>'+'<div class="dive"><span class="bar"></span></div>'+'</div>'+'</div>'+'</li>'));}for(tb=0,ub=bc.length;tb<ub;tb++){lb=bc[tb];mb=this._getListItem(lb);if(mb){kb.push(mb);}else this._renderListItem(lb,this.render.bind(this));}if(!vb.length&&!bc.length){var gc=this._messageTemplate.render(),hc=na.getNode(gc,'message');z.setContent(hc,"No one is available to chat.");kb.push(gc);}if(kb.length){if(rb){x.show(this._activeNowList);x.show(this._activeNowArea);var ic=xa._("{MORE ONLINE FRIENDS} ({=count})",{'MORE ONLINE FRIENDS':"ACTIVE NOW",'=count':bc.length});z.setContent(this._activeNowLabel,ic);z.setContent(this._activeNowList,kb);}else z.setContent(this._orderedList,kb);v.nukeLinks(this.getRoot());this.inform('render');this._placeholderUpdate();if(!this._renderingAfterScroll){this._renderingAfterScroll=true;this.render=sa(va.curry(this._renderOrderedList.bind(this),'ChatOrderedList/render',true),300);}}else if(rb){x.hide(this._activeNowList);x.hide(this._activeNowArea);}if(rb){this._editButton&&t.tryShow(this._editButton);}else t.tryHide();if(rb&&!nb)if(s.isEditMode()&&s.hasChanged())this._createSortableGroup();},render:function(){this.render=sa(this._renderOrderedList.bind(this),300);this.render();},_renderListItem:function(kb,lb){ja.get(kb,function(mb){var nb=this._template.render(),ob=na.getNode(nb,'profile-photo');ob.setAttribute('src',mb.thumbSrc);var pb=na.getNode(nb,'name');z.setContent(pb,mb.name);var qb=na.getNode(nb,'anchor');qb.setAttribute('href','/messages/'+kb);y.set(nb,'id',kb);this._itemsMap[kb]={node:nb};lb&&lb(nb);}.bind(this));},show:function(){if(this._isVisible)return;this._isVisible=true;x.show(this._scrollableOrderedList||this._root);this.render();this.inform('show');},isVisible:function(){return this._isVisible;},update:function(){this._hasRendered=false;if(!this._renderRequest)this._renderRequest=ua(function(){this.render();this._renderRequest=null;}.bind(this));},setScrollContainer:function(kb){if(z.contains(kb,this._root)){this._scrollContainer=kb;if(this._usePlaceholder){g.listen(kb,'scroll',wa(this._placeholderUpdate.bind(this)));g.listen(window,'resize',wa(function(){this._scrollContainerHeight=null;this._placeholderUpdate();}.bind(this),250));}}},scrollTo:function(kb){if(!this._scrollContainer)return;var lb=this._scrollContainer.scrollHeight,mb=this._scrollContainer.clientHeight,nb=this._scrollContainer.scrollTop,ob=Math.min(kb.offsetTop,lb-mb);if(nb!==ob){var pb=this._isLitestand?600:Math.abs(ob-nb)/this._scrollContainer.clientHeight*500,qb=this._isLitestand?aa.easeOutExpo:h.ease.end;new h(this._scrollContainer).to('scrollTop',ob).ease(qb).duration(pb).go();}}});e.exports=db;});
__d("TypingDetectorController",["AsyncRequest","AvailableList","AvailableListConstants","ChannelConnection","ChatVisibility","Keys","PresencePrivacy","ShortProfiles","TypingDetector","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('AvailableList'),i=b('AvailableListConstants'),j=b('ChannelConnection'),k=b('ChatVisibility'),l=b('Keys'),m=b('PresencePrivacy'),n=b('ShortProfiles'),o=b('TypingDetector'),p=b('copyProperties'),q=b('emptyFunction');function r(t){if(!k.isOnline())return false;if(t){var u=n.getNow(t);return u&&u.type=="friend"&&m.allows(t);}return true;}function s(t,u,v,w,x){this.userID=t;this.input=u;this.source=v;this.threadID=x;this.remoteState=o.INACTIVE;this.notifyTimer=null;w=w||{};this.notifyDelay=w.notifyDelay||this.notifyDelay;this._typingDetector=new o(u);this._typingDetector.init(w);this._typingDetector.subscribe('change',this._stateChange.bind(this));}p(s.prototype,{notifyDelay:1000,setUserAndThread:function(t,u){if(this.userID!==t||this.threadID!==u){this.resetState();this.userID=t;this.threadID=u;}},setIgnoreEnter:function(t){var u=t?[l.RETURN]:[];this._typingDetector.setIgnoreKeys(u);},resetState:function(){this.remoteState=s.INACTIVE;this._typingDetector.reset();clearTimeout(this.notifyTimer);this.notifyTimer=null;},_stateChange:function(t,u){if(u!=o.QUITTING){clearTimeout(this.notifyTimer);this.notifyTimer=this._notifyState.shield(this,u).defer(this.notifyDelay,false);}else this._notifyState(u,true);},_notifyState:function(t,u){if(!this.userID&&!this.threadID)return;var v=this.userID,w=r(v);if(w&&t!=this.remoteState){this.remoteState=t;if(j.disconnected())return;var x={typ:t,to:v,source:this.source,thread:this.threadID};new g().setHandler(this._onTypResponse.bind(this,v)).setErrorHandler(q).setData(x).setURI('/ajax/messaging/typ.php').setAllowCrossPageTransition(true).setOption('asynchronous',!u).send();}},_onTypResponse:function(t,u){var v=u.getPayload()||{};if(v.offline)h.set(t,i.OFFLINE,'typing_response');}});e.exports=s;});
__d("ChatBehavior",["Arbiter","AvailableList","AvailableListConstants","ChatConfig","copyProperties","MercuryConstants","ChatSidebarCalloutData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableList'),i=b('AvailableListConstants'),j=b('ChatConfig'),k=b('copyProperties'),l=b('MercuryConstants').ChatNotificationConstants,m=b('ChatSidebarCalloutData').isShown,n=h.getWebChatNotification(),o=m,p=true,q=k(new g(),{ON_CHANGED:'changed',notifiesUserMessages:function(){return n!==l.NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function(){return o;},showsTabUnreadUI:function(){if(j.get('web_messenger_suppress_tab_unread'))return p;return true;}});function r(){q.inform(q.ON_CHANGED);}h.subscribe(i.ON_CHAT_NOTIFICATION_CHANGED,function(){var s=n,t=h.getWebChatNotification();n=t;if(s!=t)r();});g.subscribe('chat/set_does_page_occlude_tabs',function(s,t){o=!!t;r();});g.subscribe('chat/set_show_tab_unread_ui',function(s,t){p=!!t;r();});e.exports=q;});
__d("ChatSidebarSheet",["JSXDOM","Event","function-extensions","ArbiterMixin","BlackbirdUpsell","ChannelConnection","ChannelConstants","ChatBehavior","ChatConfig","ChatVisibility","CSS","DOM","JSLogger","PresencePrivacy","Tooltip","csx","cx","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('JSXDOM'),h=b('Event');b('function-extensions');var i=b('ArbiterMixin'),j=b('BlackbirdUpsell'),k=b('ChannelConnection'),l=b('ChannelConstants'),m=b('ChatBehavior'),n=b('ChatConfig'),o=b('ChatVisibility'),p=b('CSS'),q=b('DOM'),r=b('JSLogger'),s=b('PresencePrivacy'),t=b('Tooltip'),u=b('csx'),v=b('cx'),w=b('copyProperties'),x=b('tx'),y=r.create('sidebar_sheet');function z(ca){switch(ca){case l.HINT_AUTH:return "Your session has timed out. Please log in.";case l.HINT_CONN:return x._("Facebook {Chat} is currently unavailable.",{Chat:"Chat"});case l.HINT_MAINT:return x._("Facebook {Chat} is currently down for maintenance.",{Chat:"Chat"});default:return x._("Facebook {Chat} is currently unavailable.",{Chat:"Chat"});}}function aa(ca){var da;if(ca===null){da="Unable to connect to chat. Check your Internet connection.";}else if(ca>n.get('warning_countdown_threshold_msec')){var ea=q.create('a',{href:'#',className:'fbChatReconnectLink'},"Try again");da=q.tx._("Unable to connect to chat. {try-again-link}",{'try-again-link':ea});}else if(ca>1000){da=x._("Unable to connect to chat. Reconnecting in {seconds}...",{seconds:Math.floor(ca/1000)});}else da="Unable to connect to chat. Reconnecting...";return da;}function ba(ca){this._root=ca;this._litestandOffline=q.scry(ca,"._52d2");this._message=q.find(ca,'div.fbChatSidebarMessage div.message');k.subscribe([k.CONNECTED,k.SHUTDOWN,k.RECONNECTING],this._handleConnectionChange.bind(this));k.subscribe([k.MUTE_WARNING,k.UNMUTE_WARNING],this._render.bind(this));s.subscribe('privacy-user-presence-changed',this._render.bind(this));m.subscribe(m.ON_CHANGED,this._render.bind(this));this._render();}w(ba.prototype,i,{_channelStatus:null,_channelData:null,_handleConnectionChange:function(ca,da){this._channelStatus=ca;this._channelData=da;this._render();},_showWarningTimeout:null,_warningMsgEventListener:null,_renderChannelDisconnect:function(){if(this._channelStatus===k.SHUTDOWN){return q.setContent(this._message,z(this._channelData));}else if(this._channelStatus===k.RECONNECTING){var ca=this._channelData;q.setContent(this._message,aa(ca));if(ca>1000){if(ca>n.get('warning_countdown_threshold_msec'))this._warningMsgEventListener=h.listen(this._message,'click',function(event){if(p.hasClass(event.getTarget(),'fbChatReconnectLink')){k.reconnect();return false;}});this._showWarningTimeout=setTimeout(this._handleConnectionChange.bind(this,k.RECONNECTING,ca-1000),1000,false);}}},_goOnlineEventListener:null,_renderOffline:function(){if(this._isLitestand)return;if(this._litestandOffline&&this._litestandOffline.length)this._renderLitestandOffline();var ca='fbChatGoOnlineLink',da="Turn on chat",ea=q.create('a',{href:'#',className:ca},da),fa=q.tx._("{=Go online} to see who's available.",{'=Go online':ea});q.setContent(this._message,fa);this._goOnlineEventListener=h.listen(this._message,'click',function(event){if(p.hasClass(event.getTarget(),ca)){y.log('sidebar_go_online');o.goOnline();return false;}});},_renderLitestandOffline:function(){this._litestandOffline=this._litestandOffline[0];this._isLitestand=true;var ca=g.div({className:"_4_vf"}),da=g.a({className:"_52cx _52i7"},[g.i({className:"_52c_"}),g.div({className:"_52cz"},g.div({className:"_52c-"},[g.i({className:"_52d1"}),g.div({className:"_52cy"},q.tx._("Turn on Chat"))])),g.i({className:"_52d0"}),ca]);t.set(ca,q.tx._("Turn on Chat"),'right','center');q.replace(this._litestandOffline,da);this._litestandOffline=null;h.listen(da,'click',function(event){y.log('sidebar_go_online');o.goOnline();event.prevent();});},_renderBlackbirdUpsell:function(){q.setContent(this._message,j.getOfflineContent());},_renderBlackbird:function(ca){q.setContent(this._message,j.getBlackbirdContent(ca));},_clear:function(){if(this._showWarningTimeout){clearTimeout(this._showWarningTimeout);this._showWarningTimeout=null;}if(this._warningMsgEventListener){this._warningMsgEventListener.remove();this._warningMsgEventListener=null;}if(this._goOnlineEventListener){this._goOnlineEventListener.remove();this._goOnlineEventListener=null;}p.removeClass(this._root,'upsell');p.removeClass(this._root,'offline');p.removeClass(this._root,'blackbird');p.removeClass(this._root,'error');p.removeClass(this._root,'notice');q.empty(this._message);},_render:function(){this._clear();if(j.shouldShow()){if(o.hasBlackbirdEnabled()){var ca=o.isOnline()?'blackbird':'upsell';p.addClass(this._root,ca);this._renderBlackbird(s.getVisibility());}else if(!o.isOnline()){p.addClass(this._root,'upsell');this._renderBlackbirdUpsell();}}else if(!o.isOnline()){p.addClass(this._root,'offline');this._renderOffline();}else if(k.disconnected()){p.addClass(this._root,'error');this._renderChannelDisconnect();}else if(!m.notifiesUserMessages()){p.addClass(this._root,'notice');q.setContent(this._message,"Alerts are off while you use another client to chat.");}this.inform('updated');}});e.exports=ba;});
__d("FBDesktopPlugin",["CacheStorage","DOM","Env","FBDesktopDetect","URI","Style"],function(a,b,c,d,e,f){var g=b('CacheStorage'),h=b('DOM'),i=b('Env'),j=b('FBDesktopDetect'),k=b('URI'),l=b('Style'),m=new g('localstorage','_socialfox_'),n={_plugin:'_not_checked',arbiterInform:function(o,p){var q=JSON.stringify({name:o,payload:p});this._transmitCommand('arbiterinform',q);},bringToFront:function(){this._transmitCommand('bringtofront');},dock:function(){this._transmitCommand('dock');},getPlugin:function(){if(this._plugin==='_not_checked'){this._plugin=null;if(j.isPluginInstalled()){var o=h.create('object',{id:'kiwi_plugin',type:j.mimeType});l.set(o,'width',0);l.set(o,'height',0);var p=h.create('div',{},o);l.set(p,'width',0);l.set(p,'height',0);document.body.appendChild(p);this._plugin=o;}}return this._plugin;},getUserID:function(){var o=this.getPlugin();return o&&'getUserID' in o&&o.getUserID();},getVersion:function(){var o=this.getPlugin();return o&&'getVersion' in o&&o.getVersion();},isAppRunning:function(){var o=this.getPlugin();return o&&'isAppRunning' in o&&o.isAppRunning();},launchApp:function(){var o=this.getPlugin();return o&&'launchApp' in o&&o.launchApp();},login:function(o,p){if(p&&o&&o.length>0){var q=this.getPlugin();if(q){this._transmitCommand('relogin\n'+o+'\n'+p);return;}}},logout:function(o){o=o||"0";var p=this.getPlugin();if(p)p.logout(o);},recheck:function(){if(this._plugin===null)this._plugin='_not_checked';},shouldSuppressBeeper:function(){return this.isAppRunning();},shouldSuppressMessages:function(){if(m&&m.get('connected'))return true;var o=this.getUserID();if(o){return o===i.user;}else return this.isAppRunning();},shouldSuppressSidebar:function(){var o=this.getPlugin(),p=o&&'isAppDocked' in o&&o.isAppDocked(),q=m&&m.get('active')==='true';return p||q;},transferAuthToken:function(o,p){if(o&&o.length>0){var q=this.getPlugin();if(q){q.setAccessToken(o,p);var r=setInterval(function(){q.setAccessToken(o,p);},500);setTimeout(function(){clearInterval(r);},10*1000);}}if(this.redirectHome)window.location.href=k().setPath().toString();},_transmitCommand:function(o,p){p=p||'';var q=this.getPlugin();if(q&&'transmitCommand' in q)q.transmitCommand(o,p);}};e.exports=n;});
__d("ChatSidebar",["JSXDOM","ChatOrderedList","ChatTypeaheadBehavior","ChatTypeaheadCore","ChatTypeaheadDataSource","ChatTypeaheadRenderer","Typeahead","Arbiter","ArbiterMixin","AsyncRequest","Chat","ChatConfig","ChatHovercard","ChatImpressionLogger","ChatOptions","ChatSidebarSheet","CSS","DOM","DOMDimensions","Event","FBDesktopPlugin","JSLogger","OrderedFriendsList","Parent","PresencePrivacy","ScrollableArea","Style","UserAgent","ViewportBounds","copyProperties","createArrayFrom","csx","cx","debounce","emptyFunction"],function(a,b,c,d,e,f){var g=b('JSXDOM');b('ChatOrderedList');b('ChatTypeaheadBehavior');b('ChatTypeaheadCore');b('ChatTypeaheadDataSource');b('ChatTypeaheadRenderer');b('Typeahead');var h=b('Arbiter'),i=b('ArbiterMixin'),j=b('AsyncRequest'),k=b('Chat'),l=b('ChatConfig'),m=b('ChatHovercard'),n=b('ChatImpressionLogger'),o=b('ChatOptions'),p=b('ChatSidebarSheet'),q=b('CSS'),r=b('DOM'),s=b('DOMDimensions'),t=b('Event'),u=b('FBDesktopPlugin'),v=b('JSLogger'),w=b('OrderedFriendsList'),x=b('Parent'),y=b('PresencePrivacy'),z=b('ScrollableArea'),aa=b('Style'),ba=b('UserAgent'),ca=b('ViewportBounds'),da=b('copyProperties'),ea=b('createArrayFrom'),fa=b('csx'),ga=b('cx'),ha=b('debounce'),ia=b('emptyFunction'),ja,ka=false,la=false,ma=false,na=false,oa=false,pa=false,qa,ra,sa,ta,ua,va=null,wa,xa,ya,za,ab,bb,cb,db=28,eb=38,fb=v.create('chat_sidebar');function gb(){if(wa)return;q.removeClass(document.documentElement,'sidebarMode');if(!na||!nb.isVisible()){h.inform('reflow');return;}ma=false;va=null;qa.hide();ta.getCore().reset();q.hide(ra);fb.rate('sidebar_hide',na);nb.inform('sidebar/hide',nb);h.inform('sidebar/hide',nb);h.inform('reflow');}function hb(){var ob=nb.shouldShowSidebar();q.conditionClass(document.documentElement,'sidebarCapable',ob);if(nb.isEnabled()&&ob){jb();var pb;if(wa&&xa){var qb=q.hasClass(ra,"_4w59");if(qb)return;ab=ab||r.find(ra,"._53de");cb=cb||r.find(ra,"._50g0");if(xa.has_chat_header)bb=bb||r.find(ra,"._53sr");pb=[cb,ab,bb];}else pb=ea(ra.childNodes);var rb=ib(pb),sb=qa.getItemHeight()||32,tb=qa.getPaddingOffset()||8,ub;if(wa){tb=tb+db;if(!k.isOnline())tb+=eb;if(xa&&xa.always_show_one_see_more)tb+=sb;ub=Math.ceil((rb-tb)/(sb));if(!qa.isVisible())aa.set(ja,'height',rb+'px');if(xa&&xa.chat_scrolls_separately){za=za||x.byClass(ja,"_4g6b");var vb;if(ya.isSingleScrollableArea()){vb='';}else vb=ua.height-ab.offsetHeight+'px';aa.set(za,'height',vb);}}else{ub=Math.floor((rb-tb)/(sb+1));aa.set(ja,'height',rb+'px');}qa.setNumTopFriends(ub);ta.getData().setMaxResults(ub);nb.inform('sidebar/resized',nb);h.inform('sidebar/resized',nb);h.inform('reflow');}else gb();if(!na){mb();na=true;}va=null;}function ib(ob){if(!ob)if(wa&&xa){ab=ab||r.find(ra,"._53de");cb=cb||r.find(ra,"._50g0");if(xa.has_chat_header)bb=bb||r.find(ra,"._53sr");ob=[cb,ab,bb];}else ob=ea(ra.childNodes);var pb=ua.height;ob.forEach(function(qb){if(qb&&qb!==ja)pb-=s.getElementDimensions(qb).height;});return Math.max(0,pb);}function jb(){if(nb.isVisible())return;ma=true;va=null;q.show(ra);q.addClass(document.documentElement,'sidebarMode');qa.show();fb.rate('sidebar_show',na);nb.inform('sidebar/show',nb);h.inform('sidebar/show',nb);}function kb(){o.setSetting('sidebar_mode',nb.isEnabled(),'sidebar');new j('/ajax/chat/settings.php').setHandler(ia).setErrorHandler(ia).setData({sidebar_mode:nb.isEnabled()}).setAllowCrossPageTransition(true).send();}function lb(){return w.getList().length<=l.get('sidebar.min_friends');}function mb(){var ob=true;if(!nb.isEnabled()){fb.log('state_not_enabled');ob=false;}if(!nb.isViewportCapable()){fb.log('state_not_shown_viewport');ob=false;}if(la){fb.log('state_not_shown_hidden');ob=false;}if(lb()){fb.log('state_not_shown_num_friends');ob=false;}if(u.shouldSuppressSidebar()){fb.log('state_not_shown_fbdesktop');ob=false;}fb.log(ob?'state_shown':'state_not_shown');}var nb={init:function(ob,pb,qb,rb){nb.init=ia;oa=true;ra=ob;qa=pb;ta=qb;sa=rb;ja=r.find(ob,'div.fbChatSidebarBody');wa=rb&&rb.has_lsb;ya=rb&&rb.ls_module;xa=rb&&rb.ls_config;if(ya){ya.init(ob);h.subscribe('ViewportSizeChange',function(){h.inform('ChatOrderedList/itemHeightChange');hb();});h.subscribe(['Sidebar/BookmarksHeightChange','LitestandSidebar/scrollableAreaSingled','LitestandSidebar/scrollableAreaRemoved'],hb);qa.setUsePlaceholder(true);qa.setIsLitestand(true);var sb=qa.getHoverController();sb.subscribe('hovercard_show',ya.allowCollapse.curry(false,'hover_card'));sb.subscribe('hovercard_hide',ya.allowCollapse.curry(true,'hover_card'));}else t.listen(window,'resize',hb);new m(pb);var tb=new p(ob);tb.subscribe('updated',hb);h.subscribe('sidebar/invalidate',hb);pb.setScrollContainer(x.byClass(pb.getRoot(),'uiScrollableAreaWrap'));pb.subscribe(['render','show','hide'],ha(function(ub){if(ub==='render'&&!pa){pa=true;nb.inform('sidebar/chatRendered');}var vb=pb.getRoot(),wb=z.getInstance(vb);wb&&wb.adjustGripper();}));if(ba.firefox()>=17)t.listen(window,'storage',function(ub){if(ub.key=='_socialfox_active'&&ub.oldValue!=ub.newValue)hb();});h.subscribe('chat/option-changed',function(ub,vb){if(vb.name=="sidebar_mode"){ka=!!o.getSetting('sidebar_mode');hb();}});qb.getCore().subscribe('sidebar/typeahead/active',nb.updateOnActiveTypeahead);qb.subscribe('reset',function(){if(!qb.getCore().getValue()&&!qa.isVisible())nb.updateOnActiveTypeahead(null,false);});if(wa)qb.getCore().subscribe('sidebar/typeahead/preActive',function(ub,vb){if(ka&&ta.getView().isVisible()){h.inform(ub,vb);}else hb();});h.subscribe('buddylist-nub/initialized',function(ub,vb){t.listen(vb.getButton(),'click',function(event){nb.enable();return !nb.shouldShowSidebar();});});ka=!!o.getSetting('sidebar_mode');y.subscribe('privacy-user-presence-changed',hb);hb();n.init(qa);if(wa){ca.addLeft(nb.getVisibleWidth);}else ca.addRight(nb.getVisibleWidth);nb.inform('sidebar/initialized',nb,h.BEHAVIOR_PERSISTENT);h.inform('sidebar/initialized',nb,h.BEHAVIOR_PERSISTENT);},updateOnActiveTypeahead:function(ob,pb){if(!ma)return;if(pb){qa.hide();if(wa){aa.set(ja,'height',ib()+'px');q.addClass(ra,"_5384");}}else{qa.show();if(wa){aa.set(ja,'height','auto');q.removeClass(ra,"_5384");h.inform('sidebar/typeahead/active',false);hb();}else hb();}},isInitialized:function(){return na;},disable:function(){if(!nb.isEnabled())return;ka=false;kb();gb();},enable:function(){if(nb.isEnabled())return;ka=true;kb();hb();!function(){if(nb.isVisible())ta.getCore().getElement().focus();}.defer();},ensureLoaded:function(){if(oa)return;d(['UIPagelet'],function(ob){var pb=g.div({id:"pagelet_sidebar"});r.appendContent(document.body,pb);ob.loadFromEndpoint('SidebarPagelet','pagelet_sidebar');});oa=true;},hide:function(){if(la)return;la=true;gb();},unhide:function(){if(!la)return;la=false;hb();},getBody:function(){return ja;},getRoot:function(){return ra;},getVisibleWidth:function(){if(!ma||!ra)return 0;if(va===null)va=ra.offsetWidth;return va;},isEnabled:function(){return ka;},isViewportCapable:function(){ua=s.getViewportWithoutScrollbarDimensions();if(wa)return true;var ob=l.get('sidebar.minimum_width');return ua.width>ob;},shouldShowSidebar:function(){var ob=nb.isViewportCapable();return wa||(ob&&!la&&!lb()&&!u.shouldSuppressSidebar());},isVisible:function(){return ma;},resize:hb,toggle:function(){if(wa){ya.toggle();}else nb.isEnabled()?nb.disable():nb.enable();}};da(nb,i);e.exports=nb;});
__d("VideoCallingTour",["Arbiter","ArbiterMixin","Chat","ChatSidebar","ChatVisibility","CSS","DOM","PresencePrivacy","Run","Toggler","Vector","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Chat'),j=b('ChatSidebar'),k=b('ChatVisibility'),l=b('CSS'),m=b('DOM'),n=b('PresencePrivacy'),o=b('Run'),p=b('Toggler'),q=b('Vector'),r=b('copyProperties'),s,t,u,v,w=[],x=function(){};function y(){if(j.isVisible()){z();}else if(u)aa();}function z(){s.setContext(t.getBody());ba();s.show();ca();}function aa(){if(!v)v=p.createInstance(u.getRoot());var fa=m.scry(u.getRoot(),'div.fbNubFlyout')[0];if(fa){s.setContext(fa);ba();s.show();ca();}}function ba(){var fa=q.getElementDimensions(s.getContext()).y;s.setOffsetY(fa*.6);s.updatePosition();}function ca(){if(u)w.push(u.subscribe('hide',function(){da();if(!j.isVisible())s.hide();}),u.subscribe('show',function(){s.show();}),u.subscribe('resize',function(){ba();s.updatePosition();}));w.push(g.subscribe('sidebar/show',z),g.subscribe('sidebar/hide',aa),g.subscribe('sidebar/resized',ba));}function da(){if(v){v.setSticky(false);v=null;}}function ea(){while(w.length)w.pop().unsubscribe();if(u)da();s.hide();l.show('fbVideoCallingGetStarted');}r(x,h,{start:function(fa){s=fa;l.hide('fbVideoCallingGetStarted');k.goOnline(function(){w.push(n.subscribe('privacy-user-presence-changed',ea));o.onLeave(ea);i.openBuddyList();var ga=null;w.push(j.subscribe('sidebar/initialized',function(ha,ia){t=ia;clearTimeout(ga);ga=y.defer();}),x.subscribe('videocallingtour/end',ea));w.push(g.subscribe('buddylist-nub/initialized',function(ha,ia){u=ia;clearTimeout(ga);ga=y.defer();}));});x.inform('videocallingtour/start');}});e.exports=x;});
__d("Dock",["Event","function-extensions","WebMessengerWidthControl","Arbiter","ArbiterMixin","ChatQuietLinks","CSS","DataStore","DOM","Parent","Style","Toggler","Vector","copyProperties","csx","emptyFunction","ge"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');b('WebMessengerWidthControl');var h=b('Arbiter'),i=b('ArbiterMixin'),j=b('ChatQuietLinks'),k=b('CSS'),l=b('DataStore'),m=b('DOM'),n=b('Parent'),o=b('Style'),p=b('Toggler'),q=b('Vector'),r=b('copyProperties'),s=b('csx'),t=b('emptyFunction'),u=b('ge');function v(){}r(v,i,{MIN_HEIGHT:140,INITIAL_FLYOUT_HEIGHT_OFFSET:10,init:function(w){this.init=t;this.rootEl=w;this.calculateViewportDimensions();this.calculateFlyoutHeightOffset();j.removeEmptyHrefs(this.rootEl);g.listen(w,'click',this._onClick.bind(this));g.listen(window,'resize',this._onWindowResize.bind(this));p.subscribe(['show','hide'],function(x,y){var z=y.getActive();if(!m.contains(w,z))return;if(k.hasClass(z,'fbNub')){this.notifyNub(z,x);if(x==='show')this._resizeNubFlyout(z);}else{var aa=n.byClass(z,'fbNubFlyout');if(aa)k.conditionClass(aa,'menuOpened',x==='show');}}.bind(this));this.inform('init',{},h.BEHAVIOR_PERSISTENT);},calculateViewportDimensions:function(){return (this.viewportDimensions=q.getViewportDimensions());},calculateFlyoutHeightOffset:function(){this.flyoutHeightOffset=this.INITIAL_FLYOUT_HEIGHT_OFFSET+q.getElementDimensions(this.rootEl).y;var w=u('blueBar');if(w){var x=o.isFixed(w)?'viewport':'document';this.flyoutHeightOffset+=q.getElementPosition(w,x).y+q.getElementDimensions(w).y;}},toggle:function(w){var x=this._findFlyout(w);if(!x)return;this.subscribe('init',function(){p.toggle(w);});},show:function(w){this.subscribe('init',function(){p.show(w);});},showNub:function(w){k.show(w);},hide:function(w){this.subscribe('init',function(){var x=p.getInstance(w);m.contains(w,x.getActive())&&x.hide();});},hideNub:function(w){k.hide(w);this.hide(w);},setUseMaxHeight:function(w,x){k.conditionClass(w,'maxHeight',x!==false);this._resizeNubFlyout(w);},_resizeNubFlyout:function(w){var x=this._findFlyout(w);if(!x||!(k.hasClass(w,'openToggler')||k.hasClass(w,'opened')))return;var y=m.find(x,'div.fbNubFlyoutOuter'),z=m.find(y,'div.fbNubFlyoutInner'),aa=m.find(z,'div.fbNubFlyoutBody'),ba=aa.scrollTop,ca=aa.offsetHeight;o.set(aa,'height','auto');var da=q.getElementPosition(x,'viewport'),ea=q.getElementDimensions(x),fa=q.getElementDimensions(aa),ga=this.getMaxFlyoutHeight(w);o.set(x,'max-height',ga+'px');o.set(y,'max-height',ga+'px');ea=q.getElementDimensions(x);var ha=q.getElementDimensions(z),ia=ha.y-fa.y;if(ea.y>ia)o.set(aa,'height',(ea.y-ia)+'px');k.removeClass(x,'swapDirection');var ja=q.getElementPosition(x).x;k.conditionClass(x,'swapDirection',function(){if(ja<0)return true;return (ja+ea.x>this.viewportDimensions.x);}.bind(this)());if(ba+ca>=fa.y){aa.scrollTop=aa.scrollHeight;}else aa.scrollTop=ba;this.notifyNub(w,'resize');},getMaxFlyoutHeight:function(w){var x=this._findFlyout(w),y=q.getElementPosition(x,'viewport'),z=q.getElementDimensions(x),aa=Math.max(this.MIN_HEIGHT,this.viewportDimensions.y-this.flyoutHeightOffset)-(this.viewportDimensions.y-y.y-z.y);return Math.max(aa,0);},resizeAllFlyouts:function(){var w=m.scry(this.rootEl,"div._50-v.openToggler");w=w.concat(m.scry(this.rootEl,"div._50-v.opened"));var x=w.length;while(x--)this._resizeNubFlyout(w[x]);},_onClick:function(event){var w=event.getTarget(),x=n.byClass(w,'fbNub');if(x){if(n.byClass(w,'fbNubFlyoutTitlebar')){var y=n.byTag(w,'a'),z=w.nodeName=='INPUT'&&w.getAttribute('type')=='submit';if(!y&&!z){this.hide(x);return false;}}this.notifyNub(x,'click');}},_onWindowResize:function(event){this.calculateViewportDimensions();this.resizeAllFlyouts();},_findFlyout:function(w){return k.hasClass(w,'fbNubFlyout')?w:m.scry(w,'div.fbNubFlyout')[0]||null;},registerNubController:function(w,x){l.set(w,'dock:nub:controller',x);x.subscribe('nub/button/content-changed',this.inform.shield(this,'resize',w));x.subscribe('nub/flyout/content-changed',this._resizeNubFlyout.shield(this,w));},unregisterNubController:function(w){l.remove(w,'dock:nub:controller');},notifyNub:function(w,x,y){var z=l.get(w,'dock:nub:controller');z&&z.inform(x,y);}});e.exports=a.Dock||v;});
__d("NubController",["ArbiterMixin","Dock","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('Dock'),i=b('copyProperties');function j(){}i(j.prototype,g,{init:function(k){this.el=k;h.registerNubController(k,this);return this;},buttonContentChanged:function(){this.inform('nub/button/content-changed');},flyoutContentChanged:function(){this.inform('nub/flyout/content-changed');},hide:function(){h.hide(this.el);},show:function(){h.show(this.el);}});e.exports=j;});
__d("DropdownContextualHelpLink",["DOM","ge"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('ge'),i={set:function(j){var k=h('navHelpCenter');if(k!==null)g.replace(k,j);}};e.exports=i;});
__d("ChatActivity",["Event","Arbiter","AvailableList","AvailableListConstants","JSLogger","MercuryConfig","PresenceState","UserActivity","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AvailableList'),j=b('AvailableListConstants'),k=b('JSLogger'),l=b('MercuryConfig'),m=b('PresenceState'),n=b('UserActivity'),o=b('copyProperties'),p=l.activity_limit||60000,q=l.idle_limit||1800000,r=l.idle_poll_interval||300000,s=k.create('chat_activity'),t=Date.now(),u=t,v=true;function w(){var aa=Date.now();return !!(v&&(aa-t<p));}var x=o(new h(),{isActive:w});function y(){var aa=t;t=Date.now();if(t-aa>q){s.debug('idle_to_active',aa);m.doSync();}x.inform('activity');}i.subscribe(j.ON_AVAILABILITY_CHANGED,function(){if(!i.isUserIdle())u=Date.now();});g.listen(window,'focus',function(){v=true;y();});g.listen(window,'blur',function(){v=false;});n.subscribe(function(){y();});function z(aa){var ba=aa&&aa.at&&m.verifyNumber(aa.at);if(typeof ba!=='number')ba=null;return ba||0;}setInterval(function(){var aa=Date.now(),ba=z(m.get()),ca=Math.max(t,ba,u);if(aa-ca>q){s.debug('idle',{cookie:ba,local:t,presence:u});x.inform('idle',aa-ca);}},r);m.registerStateStorer(function(aa){var ba=z(aa);if(ba<t)aa.at=t;return aa;});h.subscribe(k.DUMP_EVENT,function(aa,ba){ba.chat_activity={activity_limit:p,idle_limit:q,idle_poll_interval:r,last_active_time:t,last_global_active_time:u};});e.exports=x;});
__d("MercuryNotificationRenderer",["MercuryAssert","MercuryMessages","MercuryParticipants","MercuryThreads","tx"],function(a,b,c,d,e,f){var g=b('MercuryAssert'),h=b('MercuryMessages').get(),i=b('MercuryParticipants'),j=b('MercuryThreads').get(),k=b('tx');function l(m,n){g.isThreadID(m);j.getThreadMeta(m,function(o){h.getThreadMessagesRange(m,0,1,function(p){var q=p.length&&p[p.length-1];if(q&&q.author!=i.user){i.get(q.author,function(r){if(o.name){n(k._("{senderName} messaged {groupName}",{senderName:r.short_name,groupName:o.name}));}else n(k._("{name} messaged you",{name:r.short_name}));});}else n("New message!");});});}e.exports={renderDocumentTitle:l};});
__d("MercuryTimestampTracker",["MercuryActionTypeConstants","MercuryPayloadSource","MercurySingletonMixin","MercuryServerRequests","copyProperties"],function(a,b,c,d,e,f){var g=b('MercuryActionTypeConstants'),h=b('MercuryPayloadSource'),i=b('MercurySingletonMixin'),j=b('MercuryServerRequests'),k=b('copyProperties');function l(m){this._fbid=m;this._serverRequests=j.getForFBID(this._fbid);this._lastTimestamp=0;this._serverRequests.subscribe('update-messages',function(n,o){if(!o.actions||!o.actions.length)return;if(o.payload_source==h.CLIENT_SEND_MESSAGE||o.payload_source==h.UNKNOWN)return;for(var p=0;p<o.actions.length;p++){var q=o.actions[p],r=q.action_type;if(r==g.USER_GENERATED_MESSAGE&&q.thread_id&&q.timestamp>this._lastTimestamp)this._lastTimestamp=q.timestamp;}}.bind(this));}k(l.prototype,{getLastUserMessageTimestamp:function(){return this._lastTimestamp;}});k(l,i);e.exports=l;});
__d("ChatTitleBarBlinker",["ChatActivity","DocumentTitle","JSLogger","MercuryThreadInformer","MercuryNotificationRenderer","PresenceState","MercuryTimestampTracker"],function(a,b,c,d,e,f){var g=b('ChatActivity'),h=b('DocumentTitle'),i=b('JSLogger'),j=b('MercuryThreadInformer').get(),k=b('MercuryNotificationRenderer'),l=b('PresenceState'),m=b('MercuryTimestampTracker').get(),n=i.create('chat_title'),o=null,p=0,q=false;function r(){if(o){o.stop();o=null;return true;}return false;}function s(x){var y=x||m.getLastUserMessageTimestamp();if(p<=y){p=y;if(r()||q)l.doSync();}}var t={blink:function(x,y){if(!o&&p<y)k.renderDocumentTitle(x,function(z){if(!o)o=h.blink(z);});},stopBlinking:function(){s();},blinkingElsewhere:function(){q=true;}};function u(x){var y=l.verifyNumber(x.sb2);if(!y||y<=p)return null;return y;}function v(x){var y=x&&u(x);if(y){p=y;n.debug('load',p);r();q=false;}}function w(x){var y=u(x);if(!y){n.debug('store',p);x.sb2=p;q=false;}return x;}l.registerStateStorer(w);l.registerStateLoader(v);j.subscribe('thread-read-changed',function(x,y){var z=m.getLastUserMessageTimestamp(),aa=0;for(var ba in y)if(y[ba].mark_as_read&&y[ba].timestamp>=z&&y[ba].timestamp>aa)aa=y[ba].timestamp;aa&&s(aa);});g.subscribe('activity',function(){s();});(function(){var x=l.getInitial();if(x)p=u(x)||0;})();e.exports=t;});
__d("ControlledReferer",["Event","URI"],function(a,b,c,d,e,f){var g=b('Event'),h=b('URI'),i={useFacebookReferer:function(j,k,l){var m=false;function n(){if(m)return;m=true;j.contentWindow.document.body.style.margin=0;k();}var o;if(document.domain!=='facebook.com'){o='/intern/common/referer_frame.php';}else if(h().isSecure()){o='https://s-static.ak.facebook.com/common/referer_frame.php';}else o='http://static.ak.facebook.com/common/referer_frame.php';if(l)o+='?fb_source='+l;g.listen(j,'load',n);j.src=o;},useFacebookRefererHtml:function(j,k,l){i.useFacebookReferer(j,function(){j.contentWindow.document.body.innerHTML=k;},l);}};e.exports=i;});
__d("swfobject",["AsyncRequest","Bootloader","ControlledReferer","copyProperties","CSS","DOM","function-extensions","ge","htmlSpecialChars"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Bootloader'),i=b('ControlledReferer'),j=b('copyProperties'),k=b('CSS'),l=b('DOM');b('function-extensions');var m=b('ge'),n=b('htmlSpecialChars');if(typeof o=="undefined")var o={};if(typeof o.util=="undefined")o.util={};if(typeof o.SWFObjectUtil=="undefined")o.SWFObjectUtil={};o.SWFObject=function(u,v,w,x,y,z,aa,ba,ca,da){if(!document.getElementById)return;this.DETECT_KEY=da?da:'detectflash';this.skipDetect=o.util.getRequestParameter(this.DETECT_KEY);this.params={};this.variables={};this.attributes=[];this.fallback_html='';this.fallback_js_fcn=function(){};if(u)this.setAttribute('swf',u);if(v)this.setAttribute('id',v);if(w)this.setAttribute('width',w);if(x)this.setAttribute('height',x);this.installedVer=o.SWFObjectUtil.getPlayerVersion();if(y){if(!(y instanceof Array))y=[y];var ea;y.forEach(function(ha){ea=new o.PlayerVersion(ha.toString().split('.'));if(ea.major==this.installedVer.major){this.setAttribute('version',ea);return;}else if(!this.getAttribute('version')||ea.major<this.getAttribute('version').major)this.setAttribute('version',ea);}.bind(this));}if(!window.opera&&document.all&&this.installedVer.major>7)if(!o.unloadSet){o.SWFObjectUtil.prepUnload=function(){var ha=function(){},ia=function(){};window.attachEvent("onunload",o.SWFObjectUtil.cleanupSWFs);};window.attachEvent("onbeforeunload",o.SWFObjectUtil.prepUnload);o.unloadSet=true;}if(z)this.addParam('bgcolor',z);var fa=aa?aa:'high';this.addParam('quality',fa);this.setAttribute('useExpressInstall',false);this.setAttribute('doExpressInstall',false);var ga=(ba)?ba:window.location;this.setAttribute('xiRedirectUrl',ga);this.setAttribute('redirectUrl','');if(ca)this.setAttribute('redirectUrl',ca);this.setAttribute('useIframe',false);};o.SWFObject.ieWorkaroundApplied=false;o.SWFObject.ensureIEWorkaroundAttached=function(){if(!o.SWFObject.ieWorkaroundApplied&&document.attachEvent){o.SWFObject.ieWorkaroundApplied=true;document.attachEvent('onpropertychange',o.SWFObject.onDocumentPropertyChange);}};o.SWFObject.onDocumentPropertyChange=function(event){if(event.propertyName=="title"){var u=document.title;if(u!=null&&u.indexOf('#!')!=-1){u=u.substring(0,u.indexOf('#!'));document.title=u;}}};j(o.SWFObject.prototype,{useExpressInstall:function(u){this.xiSWFPath=!u?"/swf/expressinstall.swf":u;this.setAttribute('useExpressInstall',true);},setAttribute:function(u,v){this.attributes[u]=v;},getAttribute:function(u){return this.attributes[u]||"";},addParam:function(u,v){this.params[u]=v;},getParams:function(){return this.params;},addVariable:function(u,v){this.variables[u]=v;},getVariable:function(u){return this.variables[u]||"";},getVariables:function(){return this.variables;},getVariablePairs:function(){var u=[],v,w=this.getVariables();for(v in w)u[u.length]=v+"="+w[v];return u.join('&');},getSWFHTML:function(){var u,v,w;if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute('swf',this.xiSWFPath);}v={type:'application/x-shockwave-flash',src:this.getAttribute('swf'),width:this.getAttribute('width'),height:this.getAttribute('height'),style:this.getAttribute('style')||'display: block;',id:this.getAttribute('id'),name:this.getAttribute('id')};var x=this.getParams();for(var y in x)v[y]=x[y];w=this.getVariablePairs();if(w)v.flashvars=w;u=t('embed',v,null);}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute('swf',this.xiSWFPath);}v={id:this.getAttribute('id'),classid:'clsid:D27CDB6E-AE6D-11cf-96B8-444553540000',width:this.getAttribute('width'),height:this.getAttribute('height'),style:this.getAttribute('style')||'display: block;'};var z=t('param',{name:'movie',value:this.getAttribute('swf')},null),x=this.getParams();for(var y in x)z+=t('param',{name:y,value:x[y]},null);w=this.getVariablePairs();if(w)z+=t('param',{name:'flashvars',value:w},null);u=t('object',v,z);}return u;},write:function(u){if(this.getAttribute('useExpressInstall')){var v=new o.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(v)&&!this.installedVer.versionIsValid(this.getAttribute('version'))){this.setAttribute('doExpressInstall',true);this.addVariable("MMredirectURL",escape(this.getAttribute('xiRedirectUrl')));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title);}}var w=(typeof u=='string')?document.getElementById(u):u;if(!w)return false;k.addClass(w,'swfObject');w.setAttribute('data-swfid',this.getAttribute('id'));if(this.skipDetect||this.getAttribute('doExpressInstall')||this.installedVer.versionIsValid(this.getAttribute('version'))){if(!this.getAttribute('useIframe')){o.SWFObject.ensureIEWorkaroundAttached();w.innerHTML=this.getSWFHTML();}else this._createIframe(w);return true;}else{if(this.getAttribute('redirectUrl')!="")document.location.replace(this.getAttribute('redirectUrl'));var x=this.getAttribute('version').major+'.'+this.getAttribute('version').minor+'.'+this.getAttribute('version').release+'.'+this.getAttribute('version').build,y=this.installedVer.major+'.'+this.installedVer.minor+'.'+this.installedVer.release+'.'+this.installedVer.build;this.fallback_js_fcn(y,x);w.innerHTML=this.fallback_html;}return false;},_createIframe:function(u){var v=l.create('iframe',{width:this.getAttribute('width'),height:this.getAttribute('height'),frameBorder:0});l.empty(u);u.appendChild(v);i.useFacebookRefererHtml.bind(null,v,this.getSWFHTML(),this.getAttribute('iframeSource')).defer();}});o.SWFObjectUtil.getPlayerVersion=function(){var u=new o.PlayerVersion([0,0,0,0]),v;if(navigator.plugins&&navigator.mimeTypes.length){for(var w=0;w<navigator.plugins.length;w++)try{var y=navigator.plugins[w];if(y.name=='Shockwave Flash'){v=new o.PlayerVersion(y.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+(r|d)|\s+b[0-9]+)/,".").split("."));if(typeof u=='undefined'||v.major>u.major||(v.major==u.major&&(v.minor>u.minor||(v.minor==u.minor&&(v.release>u.release||(v.release==u.release&&v.build>u.build))))))u=v;}}catch(x){}}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var z=1,aa=3;while(z)try{aa++;z=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+aa);u=new o.PlayerVersion([aa,0,0]);}catch(ba){z=null;}}else{try{var z=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");}catch(ca){try{var z=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");u=new o.PlayerVersion([6,0,21]);z.AllowScriptAccess="always";}catch(da){if(u.major==6)return u;}try{z=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");}catch(ea){}}if(z!=null)u=new o.PlayerVersion(z.GetVariable("$version").split(" ")[1].split(","));}return u;};o.PlayerVersion=function(u){this.major=u[0]!=null?parseInt(u[0],10):0;this.minor=u[1]!=null?parseInt(u[1],10):0;this.release=u[2]!=null?parseInt(u[2],10):0;this.build=u[3]!=null?parseInt(u[3],10):0;};o.PlayerVersion.prototype.versionIsValid=function(u){if(this.major<u.major)return false;if(this.major>u.major)return true;if(this.minor<u.minor)return false;if(this.minor>u.minor)return true;if(this.release<u.release)return false;if(this.release>u.release)return true;if(this.build<u.build)return false;return true;};o.util={getRequestParameter:function(u){var v=document.location.search||document.location.hash;if(u==null)return v;if(v){var w=v.substring(1).split("&");for(var x=0;x<w.length;x++)if(w[x].substring(0,w[x].indexOf("="))==u)return w[x].substring((w[x].indexOf("=")+1));}return "";}};o.SWFObjectUtil.cleanupSWFs=function(){var u=document.getElementsByTagName("OBJECT");for(var v=u.length-1;v>=0;v--){u[v].style.display='none';for(var w in u[v])if(typeof u[v][w]=='function')u[v][w]=function(){};}};if(!document.getElementById&&document.all)document.getElementById=function(u){return document.all[u];};var p=o.util.getRequestParameter,q=o.SWFObject,r=o.SWFObject;o.spawn_flash_update_dialog=function(){new g().setURI('/ajax/flash_update_dialog.php').setMethod('GET').setReadOnly(true).send();};function s(u,v){var w=m(u),x=o.SWFObjectUtil.getPlayerVersion(),y;v.forEach(function(ba){ba=new o.PlayerVersion(ba.toString().split('.'));if(ba.major==x.major){y=ba;return;}else if(typeof y=='undefined'||ba.major<y.major)y=ba;}.bind(this));if(w&&x.major>0){var z=x.major+'.'+x.minor+'.'+x.release+'.'+x.build,aa=y.major+'.'+y.minor+'.'+y.release+'.'+y.build;l.setContent(w,l.tx._("Flash {required-version} is required to view this content. Your current version is {current-version}. Please download the latest Flash Player.",{'required-version':aa,'current-version':z}));}}o.showFlashErrorDialog=function(u,v){h.loadModules(['ErrorDialog'],function(w){w.show(u,v);});};function t(u,v,w){var x=/^[A-Za-z0-9\-]+$/;if(!u.match(x))throw new Error('Invalid tag '+u);var y='<'+u;for(var z in v){if(!z.match(x))throw new Error('Invalid attr '+z);y+=' '+z+'="'+n(v[z])+'"';}if(w===null){return y+'/>';}else return y+'>'+w+'</'+u+'>';}e.exports=a.deconcept||o;});
__d("swfobject2",[],function(a,b,c,d,e,f){var g=function(){var h="undefined",i="object",j="Shockwave Flash",k="ShockwaveFlash.ShockwaveFlash",l="application/x-shockwave-flash",m="SWFObjectExprInst",n="onreadystatechange",o=window,p=document,q=navigator,r=false,s=[ka],t=[],u=[],v=[],w,x,y,z,aa=false,ba=false,ca,da,ea=true,fa=function(){var eb=typeof p.getElementById!=h&&typeof p.getElementsByTagName!=h&&typeof p.createElement!=h,fb=q.userAgent.toLowerCase(),gb=q.platform.toLowerCase(),hb=gb?/win/.test(gb):/win/.test(fb),ib=gb?/mac/.test(gb):/mac/.test(fb),jb=/webkit/.test(fb)?parseFloat(fb.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,kb=!+"\v1",lb=[0,0,0],mb=null;if(typeof q.plugins!=h&&typeof q.plugins[j]==i){mb=q.plugins[j].description;if(mb&&!(typeof q.mimeTypes!=h&&q.mimeTypes[l]&&!q.mimeTypes[l].enabledPlugin)){r=true;kb=false;mb=mb.replace(/^.*\s+(\S+\s+\S+$)/,"$1");lb[0]=parseInt(mb.replace(/^(.*)\..*$/,"$1"),10);lb[1]=parseInt(mb.replace(/^.*\.(.*)\s.*$/,"$1"),10);lb[2]=/[a-zA-Z]/.test(mb)?parseInt(mb.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0;}}else if(typeof o.ActiveXObject!=h)try{var ob=new ActiveXObject(k);if(ob){mb=ob.GetVariable("$version");if(mb){kb=true;mb=mb.split(" ")[1].split(",");lb=[parseInt(mb[0],10),parseInt(mb[1],10),parseInt(mb[2],10)];}}}catch(nb){}return {w3:eb,pv:lb,wk:jb,ie:kb,win:hb,mac:ib};}(),ga=function(){if(!fa.w3)return;if((typeof p.readyState!=h&&p.readyState=="complete")||(typeof p.readyState==h&&(p.getElementsByTagName("body")[0]||p.body)))ha();if(!aa){if(typeof p.addEventListener!=h)p.addEventListener("DOMContentLoaded",ha,false);if(fa.ie&&fa.win){p.attachEvent(n,function(){if(p.readyState=="complete"){p.detachEvent(n,arguments.callee);ha();}});if(o==top)(function(){if(aa)return;try{p.documentElement.doScroll("left");}catch(eb){setTimeout(arguments.callee,0);return;}ha();})();}if(fa.wk)(function(){if(aa)return;if(!/loaded|complete/.test(p.readyState)){setTimeout(arguments.callee,0);return;}ha();})();ja(ha);}}();function ha(){if(aa)return;try{var fb=p.getElementsByTagName("body")[0].appendChild(xa("span"));fb.parentNode.removeChild(fb);}catch(eb){return;}aa=true;var gb=s.length;for(var hb=0;hb<gb;hb++)s[hb]();}function ia(eb){if(aa){eb();}else s[s.length]=eb;}function ja(eb){if(typeof o.addEventListener!=h){o.addEventListener("load",eb,false);}else if(typeof p.addEventListener!=h){p.addEventListener("load",eb,false);}else if(typeof o.attachEvent!=h){ya(o,"onload",eb);}else if(typeof o.onload=="function"){var fb=o.onload;o.onload=function(){fb();eb();};}else o.onload=eb;}function ka(){if(r){la();}else ma();}function la(){var eb=p.getElementsByTagName("body")[0],fb=xa(i);fb.setAttribute("type",l);fb.setAttribute('style','visibility: hidden; position: absolute; top: -1000px;');var gb=eb.appendChild(fb);if(gb){var hb=0;(function(){if(typeof gb.GetVariable!=h){var ib=gb.GetVariable("$version");if(ib){ib=ib.split(" ")[1].split(",");fa.pv=[parseInt(ib[0],10),parseInt(ib[1],10),parseInt(ib[2],10)];}}else if(hb<10){hb++;setTimeout(arguments.callee,10);return;}gb=null;ma();})();}else ma();}function ma(){var eb=t.length;if(eb>0)for(var fb=0;fb<eb;fb++){var gb=t[fb].id,hb=t[fb].callbackFn,ib={success:false,id:gb};if(fa.pv[0]>0){var jb=wa(gb);if(jb)if(za(t[fb].swfVersion)&&!(fa.wk&&fa.wk<312)){bb(gb,true);if(hb){ib.success=true;ib.ref=na(gb);hb(ib);}}else if(t[fb].expressInstall&&oa()){var kb={};kb.data=t[fb].expressInstall;kb.width=jb.getAttribute("width")||"0";kb.height=jb.getAttribute("height")||"0";if(jb.getAttribute("class"))kb.styleclass=jb.getAttribute("class");if(jb.getAttribute("align"))kb.align=jb.getAttribute("align");var lb={},mb=jb.getElementsByTagName("param"),nb=mb.length;for(var ob=0;ob<nb;ob++)if(mb[ob].getAttribute("name").toLowerCase()!="movie")lb[mb[ob].getAttribute("name")]=mb[ob].getAttribute("value");pa(kb,lb,gb,hb);}else{qa(jb);if(hb)hb(ib);}}else{bb(gb,true);if(hb){var pb=na(gb);if(pb&&typeof pb.SetVariable!=h){ib.success=true;ib.ref=pb;}hb(ib);}}}}function na(eb){var fb=null,gb=wa(eb);if(gb&&gb.nodeName=="OBJECT")if(typeof gb.SetVariable!=h){fb=gb;}else{var hb=gb.getElementsByTagName(i)[0];if(hb)fb=hb;}return fb;}function oa(){return !ba&&za("6.0.65")&&(fa.win||fa.mac)&&!(fa.wk&&fa.wk<312);}function pa(eb,fb,gb,hb){ba=true;y=hb||null;z={success:false,id:gb};var ib=wa(gb);if(ib){if(ib.nodeName=="OBJECT"){w=ra(ib);x=null;}else{w=ib;x=gb;}eb.id=m;if(typeof eb.width==h||(!/%$/.test(eb.width)&&parseInt(eb.width,10)<310))eb.width="310";if(typeof eb.height==h||(!/%$/.test(eb.height)&&parseInt(eb.height,10)<137))eb.height="137";p.title=p.title.slice(0,47)+" - Flash Player Installation";var jb=fa.ie&&fa.win?"ActiveX":"PlugIn",kb="MMredirectURL="+o.location.toString().replace(/&/g,"%26")+"&MMplayerType="+jb+"&MMdoctitle="+p.title;if(typeof fb.flashvars!=h){fb.flashvars+="&"+kb;}else fb.flashvars=kb;if(fa.ie&&fa.win&&ib.readyState!=4){var lb=xa("div");gb+="SWFObjectNew";lb.setAttribute("id",gb);ib.parentNode.insertBefore(lb,ib);ib.style.display="none";(function(){if(ib.readyState==4){ib.parentNode.removeChild(ib);}else setTimeout(arguments.callee,10);})();}sa(eb,fb,gb);}}function qa(eb){if(fa.ie&&fa.win&&eb.readyState!=4){var fb=xa("div");eb.parentNode.insertBefore(fb,eb);fb.parentNode.replaceChild(ra(eb),fb);eb.style.display="none";(function(){if(eb.readyState==4){eb.parentNode.removeChild(eb);}else setTimeout(arguments.callee,10);})();}else eb.parentNode.replaceChild(ra(eb),eb);}function ra(eb){var fb=xa("div");if(fa.win&&fa.ie){fb.innerHTML=eb.innerHTML;}else{var gb=eb.getElementsByTagName(i)[0];if(gb){var hb=gb.childNodes;if(hb){var ib=hb.length;for(var jb=0;jb<ib;jb++)if(!(hb[jb].nodeType==1&&hb[jb].nodeName=="PARAM")&&!(hb[jb].nodeType==8))fb.appendChild(hb[jb].cloneNode(true));}}}return fb;}function sa(eb,fb,gb){var hb,ib=wa(gb);if(fa.wk&&fa.wk<312)return hb;if(ib){if(typeof eb.id==h)eb.id=gb;if(fa.ie&&fa.win){var jb="";for(var kb in eb)if(eb[kb]!=Object.prototype[kb])if(kb.toLowerCase()=="data"){fb.movie=eb[kb];}else if(kb.toLowerCase()=="styleclass"){jb+=' class="'+eb[kb]+'"';}else if(kb.toLowerCase()!="classid")jb+=' '+kb+'="'+eb[kb]+'"';var lb="";for(var mb in fb)if(fb[mb]!=Object.prototype[mb])lb+='<param name="'+mb+'" value="'+fb[mb]+'" />';ib.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+jb+'>'+lb+'</object>';u[u.length]=eb.id;hb=wa(eb.id);}else{var nb=xa(i);nb.setAttribute("type",l);for(var ob in eb)if(eb[ob]!=Object.prototype[ob])if(ob.toLowerCase()=="styleclass"){nb.setAttribute("class",eb[ob]);}else if(ob.toLowerCase()!="classid")nb.setAttribute(ob,eb[ob]);for(var pb in fb)if(fb[pb]!=Object.prototype[pb]&&pb.toLowerCase()!="movie")ta(nb,pb,fb[pb]);ib.parentNode.replaceChild(nb,ib);hb=nb;}}return hb;}function ta(eb,fb,gb){var hb=xa("param");hb.setAttribute("name",fb);hb.setAttribute("value",gb);eb.appendChild(hb);}function ua(eb){var fb=wa(eb);if(fb&&fb.nodeName=="OBJECT")if(fa.ie&&fa.win){fb.style.display="none";(function(){if(fb.readyState==4){va(eb);}else setTimeout(arguments.callee,10);})();}else fb.parentNode.removeChild(fb);}function va(eb){var fb=wa(eb);if(fb){for(var gb in fb)if(typeof fb[gb]=="function")fb[gb]=null;fb.parentNode.removeChild(fb);}}function wa(eb){var fb=null;try{fb=p.getElementById(eb);}catch(gb){}return fb;}function xa(eb){return p.createElement(eb);}function ya(eb,fb,gb){eb.attachEvent(fb,gb);v[v.length]=[eb,fb,gb];}function za(eb){var fb=fa.pv,gb=eb.split(".");gb[0]=parseInt(gb[0],10);gb[1]=parseInt(gb[1],10)||0;gb[2]=parseInt(gb[2],10)||0;return (fb[0]>gb[0]||(fb[0]==gb[0]&&fb[1]>gb[1])||(fb[0]==gb[0]&&fb[1]==gb[1]&&fb[2]>=gb[2]))?true:false;}function ab(eb,fb,gb,hb){if(fa.ie&&fa.mac)return;var ib=p.getElementsByTagName("head")[0];if(!ib)return;var jb=(gb&&typeof gb=="string")?gb:"screen";if(hb){ca=null;da=null;}if(!ca||da!=jb){var kb=xa("style");kb.setAttribute("type","text/css");kb.setAttribute("media",jb);ca=ib.appendChild(kb);if(fa.ie&&fa.win&&typeof p.styleSheets!=h&&p.styleSheets.length>0)ca=p.styleSheets[p.styleSheets.length-1];da=jb;}if(fa.ie&&fa.win){if(ca&&typeof ca.addRule==i)ca.addRule(eb,fb);}else if(ca&&typeof p.createTextNode!=h)ca.appendChild(p.createTextNode(eb+" {"+fb+"}"));}function bb(eb,fb){if(!ea)return;var gb=fb?"visible":"hidden";if(aa&&wa(eb)){wa(eb).style.visibility=gb;}else ab("#"+eb,"visibility:"+gb);}function cb(eb){var fb=/[\\\"<>\.;]/,gb=fb.exec(eb)!=null;return gb&&typeof encodeURIComponent!=h?encodeURIComponent(eb):eb;}var db=function(){if(fa.ie&&fa.win)window.attachEvent("onunload",function(){var eb=v.length;for(var fb=0;fb<eb;fb++)v[fb][0].detachEvent(v[fb][1],v[fb][2]);var gb=u.length;for(var hb=0;hb<gb;hb++)ua(u[hb]);for(var ib in fa)fa[ib]=null;fa=null;for(var jb in g)g[jb]=null;g=null;});}();return {registerObject:function(eb,fb,gb,hb){if(fa.w3&&eb&&fb){var ib={};ib.id=eb;ib.swfVersion=fb;ib.expressInstall=gb;ib.callbackFn=hb;t[t.length]=ib;bb(eb,false);}else if(hb)hb({success:false,id:eb});},getObjectById:function(eb){if(fa.w3)return na(eb);},embedSWF:function(eb,fb,gb,hb,ib,jb,kb,lb,mb,nb){var ob={success:false,id:fb};if(fa.w3&&!(fa.wk&&fa.wk<312)&&eb&&fb&&gb&&hb&&ib){bb(fb,false);ia(function(){gb+="";hb+="";var pb={};if(mb&&typeof mb===i)for(var qb in mb)pb[qb]=mb[qb];pb.data=eb;pb.width=gb;pb.height=hb;var rb={};if(lb&&typeof lb===i)for(var sb in lb)rb[sb]=lb[sb];if(kb&&typeof kb===i)for(var tb in kb)if(typeof rb.flashvars!=h){rb.flashvars+="&"+tb+"="+kb[tb];}else rb.flashvars=tb+"="+kb[tb];if(za(ib)){var ub=sa(pb,rb,fb);if(pb.id==fb)bb(fb,true);ob.success=true;ob.ref=ub;}else if(jb&&oa()){pb.data=jb;pa(pb,rb,fb,nb);return;}else bb(fb,true);if(nb)nb(ob);});}else if(nb)nb(ob);},switchOffAutoHideShow:function(){ea=false;},ua:fa,getFlashPlayerVersion:function(){return {major:fa.pv[0],minor:fa.pv[1],release:fa.pv[2]};},hasFlashPlayerVersion:za,createSWF:function(eb,fb,gb){if(fa.w3){return sa(eb,fb,gb);}else return undefined;},showExpressInstall:function(eb,fb,gb,hb){if(fa.w3&&oa())pa(eb,fb,gb,hb);},removeSWF:function(eb){if(fa.w3)ua(eb);},createCSS:function(eb,fb,gb,hb){if(fa.w3)ab(eb,fb,gb,hb);},addDomLoadEvent:ia,addLoadEvent:ja,getQueryParamValue:function(eb){var fb=p.location.search||p.location.hash;if(fb){if(/\?/.test(fb))fb=fb.split("?")[1];if(eb==null)return cb(fb);var gb=fb.split("&");for(var hb=0;hb<gb.length;hb++)if(gb[hb].substring(0,gb[hb].indexOf("="))==eb)return cb(gb[hb].substring((gb[hb].indexOf("=")+1)));}return "";},expressInstallCallback:function(){if(ba){var eb=wa(m);if(eb&&w){eb.parentNode.replaceChild(w,eb);if(x){bb(x,true);if(fa.ie&&fa.win)w.style.display="block";}if(y)y(z);}ba=false;}}};}();e.exports=g;});
__d("SoundPlayer",["Arbiter","ChatConfig","swfobject","swfobject2","URI","createArrayFrom"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChatConfig'),i=b('swfobject').SWFObject,j=b('swfobject2'),k=b('URI'),l=b('createArrayFrom'),m={},n=null,o=false,p='so_sound_player',q='/swf/SoundPlayer.swf?v=1',r='10.0.22.87',s=null,t=h.get('sound.useswfobject_2',false),u=h.get('sound.force_flash',false);function v(da){var ea=k(da);if(!ea.getDomain())return k().setPath(ea.getPath()).toString();return da;}function w(da){var ea=k(da).getPath();if(/\.mp3$/.test(ea))return 'audio/mpeg';if(/\.og[ga]$/.test(ea))return 'audio/ogg';return '';}function x(){if(!s&&!u){var da=document.createElement('audio');if(!da||!da.canPlayType)return null;da.setAttribute('preload','auto');document.body.appendChild(da);s=da;}return s;}function y(){var da=document[p]||window[p];if(da)if(!da.playSound&&da.length)da=da[0];return (da&&da.playSound&&da.loopSound)?da:null;}function z(){return o;}function aa(da,ea,fa){n={path:da,sync:ea,loop:fa};}function ba(){o=true;if(n){var da=y();if(n.loop){da.loopSound(n.path,n.sync);}else da.playSound(n.path,n.sync);}}var ca={init:function(da){da=l(da);var ea;for(var fa=0;fa<da.length;++fa){ea=da[fa];if(m[ea])return;}var ga=x();for(fa=0;ga&&fa<da.length;++fa){ea=da[fa];if(ga.canPlayType(ea)){m[ea]=true;return;}}m['audio/mpeg']=true;if(y())return;try{g.registerCallback(ba,['sound/player_ready','sound/ready']);var ia=document.createElement('div');ia.id='sound_player_holder';document.body.appendChild(ia);if(t){j.embedSWF(q,ia.id,'1px','1px',r,null,{swf_id:p},{allowscriptaccess:'always',wmode:'transparent'},null,function(ka){window[p]=ka.ref;g.inform('sound/player_ready');});}else{var ja=new i(q,p,'1px','1px',[r],'#ffffff');ja.addParam('allowscriptaccess','always');ja.addParam('wmode','transparent');ja.addVariable('swf_id',p);ja.fallback_html=' ';ja.write(ia.id);window[p]=ja;g.inform('sound/player_ready');}}catch(ha){}},play:function(da,ea){da=l(da);var fa=x(),ga,ha;for(var ia=0;fa&&ia<da.length;++ia){ga=da[ia];ha=w(ga);if(!fa.canPlayType(ha))continue;ca.init([ha]);fa.src=v(ga);if(ea){fa.setAttribute('loop','');}else fa.removeAttribute('loop');fa.play();return;}for(ia=0;ia<da.length;++ia){ga=v(da[ia]);ha=w(ga);if(ha!='audio/mpeg')continue;ca.init([ha]);var ja=y();if(!z()){aa(ga,true,ea);return;}else if(ja){if(ea){ja.loopSound(ga,true);}else ja.playSound(ga,true);return;}}},stop:function(da){da=l(da);for(var ea=0;ea<da.length;++ea){var fa=v(da[ea]),ga=x(),ha=y();if(ga&&ga.src==fa){ga.pause();ga.src=undefined;}else ha&&ha.stopSound(fa);}}};e.exports=ca;});
__d("SoundSynchronizer",["hasArrayNature","SoundPlayer","createArrayFrom"],function(a,b,c,d,e,f){var g=b('hasArrayNature'),h=b('SoundPlayer'),i=b('createArrayFrom'),j='fb_sounds_playing3';function k(){if(window.localStorage)try{var p=window.localStorage[j];if(p){p=JSON.parse(p);if(g(p))return p;}}catch(o){}return [];}function l(o){if(window.localStorage){var p=k();p.push(o);while(p.length>5)p.shift();try{window.localStorage[j]=JSON.stringify(p);}catch(q){}}}function m(o){return k().some(function(p){return p===o;});}var n={play:function(o,p,q){o=i(o);p=p||(o[0]+Math.floor(Date.now()/1000));if(m(p))return;h.play(o,q);l(p);},isSupported:function(){return !!window.localStorage;}};e.exports=n;});
__d("SoundRPC",["Event","SoundSynchronizer"],function(a,b,c,d,e,f){var g=b('Event'),h=b('SoundSynchronizer');function i(k,l,m){h.play(k,l,m);}var j={playLocal:i,playRemote:function(k,l,m,n){var o={paths:l,sync:m,loop:n};k.postMessage(JSON.stringify(o),'*');},supportsRPC:function(){return !!window.postMessage;},_listen:function(){g.listen(window,'message',function(k){if(!/\.facebook.com$/.test(k.origin))return;var l=JSON.parse(k.data);i(l.paths,l.sync,l.loop);});}};e.exports=j;});
__d("Sound",["SoundPlayer","SoundRPC","SoundSynchronizer","UserAgent"],function(a,b,c,d,e,f){var g=b('SoundPlayer'),h=b('SoundRPC'),i=b('SoundSynchronizer'),j=b('UserAgent'),k=null,l={init:function(o){if(!k)g.init(o);},play:function(o,p,q){if(k){h.playRemote(k.contentWindow,o,p,false);}else h.playLocal(o,p,q);},stop:function(o){if(!k)g.stop(o);}},m=location.host.replace(/^[^.]+/,'www');function n(){if(j.ie()<9)return false;return i.isSupported()&&h.supportsRPC();}if(location.host!==m&&n()){k=document.createElement('iframe');k.setAttribute('src','//'+m+'/sound_iframe.php');k.style.display='none';document.body.appendChild(k);}e.exports=l;});
__d("MercuryBrowserAlerts",["ArbiterMixin","ChatActivity","ChatConfig","ChatOptions","ChatTitleBarBlinker","MercuryConfig","MercuryParticipants","MercuryThreadMuter","MercuryThreads","MessagingTag","Sound","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('ChatActivity'),i=b('ChatConfig'),j=b('ChatOptions'),k=b('ChatTitleBarBlinker'),l=b('MercuryConfig'),m=b('MercuryParticipants'),n=b('MercuryThreadMuter'),o=b('MercuryThreads').get(),p=b('MessagingTag'),q=b('Sound'),r=b('copyProperties');q.init(['audio/ogg','audio/mpeg']);function s(u){if(j.getSetting('sound'))q.play([i.get('sound.notif_ogg_url'),i.get('sound.notif_mp3_url')],u,false);}var t={messageReceived:function(u){if(u.author==m.user||!u.is_unread||(u.folder!=p.INBOX&&u.folder!=p.ARCHIVED))return;var v=u.thread_id,w=h.isActive();if(w){var x=false;t.inform('before-alert',{threadID:v,cancelAlert:function(){x=true;}});}o.getThreadMeta(v,function(y){var z=n.isThreadMuted(y);if(l.MuteThreadsOnDesktopGK&&z)return;var aa=u.timestamp;if(w){!x&&s(aa);}else{k.blink(v,aa);s(aa);}k.blinkingElsewhere();}.bind(this));}};e.exports=r(t,g);});
__d("ActiveXSupport",[],function(a,b,c,d,e,f){var g=null,h={isSupported:function(){if(g!==null)return g;try{g=!!window.ActiveXObject&&!!new ActiveXObject("htmlfile");}catch(i){g=false;}return g;}};e.exports=h;});
__d("VideoCallRecordMessageDialog",["AsyncDialog","AsyncRequest","Dialog","MercuryConfig","URI","tx"],function(a,b,c,d,e,f){var g=b('AsyncDialog'),h=b('AsyncRequest'),i=b('Dialog'),j=b('MercuryConfig'),k=b('URI'),l=b('tx'),m={get:function(n,o){var p=j.MessagesMercuryIntegrationGK?"Would you like to leave a message?":"Would you like to leave a video message?",q=j.MessagesMercuryIntegrationGK?"New Message":"Record Message";return new i().setTitle(l._("{firstname} is Unavailable",{firstname:o})).setBody(p).setButtons([{name:'record-message',label:q},i.CANCEL]).setHandler(function(){var r=k('/ajax/messaging/composer.php').setQueryData({ids:[n],autoloadvideo:true}).toString();g.send(new h(r));});}};e.exports=m;});
__d("VideoCallCore",["Event","ActiveXSupport","Arbiter","AsyncRequest","AvailableList","AvailableListConstants","Bootloader","ChannelConstants","Cookie","CSS","Dialog","MercuryConfig","UserAgent","emptyFunction","ge","ShortProfiles","VideoCallRecordMessageDialog"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ActiveXSupport'),i=b('Arbiter'),j=b('AsyncRequest'),k=b('AvailableList'),l=b('AvailableListConstants'),m=b('Bootloader'),n=b('ChannelConstants'),o=b('Cookie'),p=b('CSS'),q=b('Dialog'),r=b('MercuryConfig'),s=b('UserAgent'),t=b('emptyFunction'),u=b('ge'),v=[],w=[],x={isSupported:function(){if(s.windows()){if(s.ie()>=9&&!s.ie64()){return h.isSupported();}else return (s.ie()>=7&&!s.ie64())||s.firefox()>=3.6||s.chrome()>=5||s.opera()>=12;}else if(s.osx()>10.4)return (s.firefox()>=3.6||s.chrome()>=5||s.webkit()>=500||s.opera()>=12);return false;},isInstalled:function(){var ba=false;if(this.isSupported())if(y()){var ca=null;try{ca=new ActiveXObject('SkypeLimited.SkypeWebPlugin');ba=!!ca;}catch(da){}ca=null;}else{ba=z();if(r.VideoCallingNoJavaGK)if(ba&&s.osx()>=10.8)if(ba.description&&ba.description.charAt(0)!='v')ba=false;}return ba;},mightReloadPostInstall:function(){return s.windows();},onVideoMessage:function(ba){v.push(ba);m.loadModules(['VideoCallController'],t);},onRTCMessage:function(ba){if(r.NewVCGK){w.push(ba);m.loadModules(['FBRTCCallController'],t);}},setMessageHandler:function(ba){this.onVideoMessage=ba;if(ba)while(v.length)ba(v.shift());},setRTCMessageHandler:function(ba){this.onRTCMessage=ba;if(ba)while(w.length)ba(w.shift());},availableForCall:function(ba){var ca=k.get(ba);return ca==l.ACTIVE||ca==l.IDLE;},onProfileButtonClick:function(ba){x.startCallOrLeaveMessage(ba,'profile_button_click');},attachListenerToProfileButton:function(ba){var ca=u('videoCallProfileButton');if(ca){if(!x.isSupported()){p.hide(ca);return;}g.listen(ca,'click',function(event){x.startCallOrLeaveMessage(ba,'profile_button_click_timeline');});}},startCallOrLeaveMessage:function(ba,ca){if(this.availableForCall(ba)){x.showOutgoingCallDialog(ba,ca);}else b('ShortProfiles').get(ba,function(da){b('VideoCallRecordMessageDialog').get(ba,da.firstName).show();});},showOutgoingCallDialog:function(ba,ca){var da=ca||'unknown';x.logClick(ba,da);var ea=x.isInstalled()||r.NewVCGK?'outgoing_dialog.php':'intro.php',fa='/ajax/chat/video/'+ea+'?idTarget='+ba;new q().setAllowCrossPageTransition(true).setAsync(new j(fa)).show();},logClick:function(ba,ca){new j().setURI('/ajax/chat/video/log_click.php').setData({targetUserID:ba,clickSource:ca}).setAllowCrossPageTransition(true).setErrorHandler(t).send();}};function y(){return s.ie()&&s.windows()&&!s.opera();}function z(){if(!navigator)return null;navigator.plugins.refresh(false);var ba=navigator.mimeTypes['application/skypesdk-plugin'];return ba&&ba.enabledPlugin;}function aa(){if(!x.mightReloadPostInstall())return;var ba=o.get('vcpwn');if(ba){o.clear('vcpwn');var ca=o.get('vctid');if(ca){o.clear('vctid');if(o.get('vctid'))return;if(ca&&x.isInstalled()){var da='/ajax/chat/video/outgoing_dialog.php?idTarget='+ca;new q().setAllowCrossPageTransition(true).setAsync(new j(da)).show();}}}}i.subscribe(n.getArbiterType('video'),function(ba,ca){x.onVideoMessage(ca.obj);});i.subscribe(n.getArbiterType('webrtc'),function(ba,ca){x.onRTCMessage(ca.obj);});i.subscribe(n.getArbiterType('chat_event'),function(ba,ca){if(ca.obj.event_name=="missed-call")m.loadModules(['VideoCallController'],function(da){da.onMissedCallEvent(ca.obj);});});aa();e.exports=x;});
__d("ChatApp",["CSS","JSLogger"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('JSLogger'),i=false,j=false,k=false,l=null,m={init:function(n,o,p){if(l){h.create('chat_app').error('repeated_init');return;}l=n;d(['TabsViewport','ChatTabController','ChatTabViewCoordinator','MercuryServerRequests','MercuryChannelHandler','MercuryStateCheck'],function(q,r,s,t,u,v){t.get().handleUpdate(p);this.tabsViewport=new q(o);this.tabController=new r(this.tabsViewport);this.tabViewCoordinator=new s(o,this.tabsViewport);i=j=true;}.bind(this));},hide:function(){if(!i||k)return;g.hide(l);k=true;},unhide:function(){if(i){if(k){g.show(l);this.tabsViewport.checkWidth();d(['Dock'],function(n){n.resizeAllFlyouts();});k=false;}}else if(!j){d(['UIPagelet'],function(n){n.loadFromEndpoint('DockChatPagelet','pagelet_chat');});j=true;}}};e.exports=m;});
__d("ChatTabModel",["function-extensions","Arbiter","ArbiterMixin","ChatBehavior","ChatConfig","JSLogger","MercuryAssert","MercuryServerRequests","MercuryThreads","MercuryTimestampTracker","PresenceInitialData","PresenceState","PresenceUtil","areObjectsEqual","copyProperties"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ChatBehavior'),j=b('ChatConfig'),k=b('JSLogger'),l=b('MercuryAssert'),m=b('MercuryServerRequests').get(),n=b('MercuryThreads').get(),o=b('MercuryTimestampTracker').get(),p=b('PresenceInitialData'),q=b('PresenceState'),r=b('PresenceUtil'),s=b('areObjectsEqual'),t=b('copyProperties'),u=[],v=null,w=null,x=null,y=null;function z(){return parseInt(p.serverTime,10);}var aa=j.get('tab_max_load_age')||3600000,ba=z()-aa,ca=0,da=20,ea=k.create('chat_tab_model'),fa=false;function ga(xa){var ya=q.verifyNumber(xa.uct2);if(!ya||typeof ya!=='number'){ea.warn('bad_cookie_version',xa.uct2);return null;}if(ya<=ca||ya<ba)return null;return ya;}function ha(xa){var ya=ga(xa);if(!ya){var za={};za.old_tabs=xa&&xa.t2&&JSON.stringify(xa.t2);za.old_promoted=xa&&xa.lm2;za.old_time=xa&&xa.uct2;za.old_reason=xa&&xa.tr;za.old_window=xa&&xa.tw;var ab;if(w&&xa.t2)for(var bb=0;bb<xa.t2.length;bb++){var cb=xa.t2[bb];if(cb.i===w)ab=cb.r;}var db=[];u.forEach(function(eb){if(!eb.fragile){var fb={i:eb.id,si:eb.server_id};if(eb.raised||(eb.id===w&&ab))fb.r=1;db.push(fb);}});xa.t2=db;xa.uct2=ca;xa.lm2=v;xa.tr=y;xa.tw=r.getSessionID();za.new_tabs=JSON.stringify(xa.t2);za.new_promoted=xa.lm2;za.new_time=xa.uct2;za.new_reason=xa.tr;za.new_window=xa.tw;ea.debug('store',za);}return xa;}function ia(xa){if(xa){var ya=ga(xa);if(ya){var za={};za.old_tabs=JSON.stringify(u);za.old_promoted=v;za.old_time=ca;za.old_reason=y;za.window_id=r.getSessionID();za.cookie_tabs=xa&&xa.t2&&JSON.stringify(xa.t2);za.cookie_promoted=xa&&xa.lm2;za.cookie_time=xa&&xa.uct2;za.cookie_reason=xa&&xa.tr;za.cookie_window=xa&&xa.tw;ca=ya;y='load';var ab=ja(xa.t2,xa.lm2||null);za.load_result=ab;za.new_tabs=JSON.stringify(u);za.new_promoted=v;za.new_time=ca;za.new_reason=y;var event='load';if(!fa)event+='_init';ea.log(event,za);return ab;}}return false;}function ja(xa,ya){if(ka(xa,ya)){var za=u.filter(function(cb){return cb.fragile;}),ab={};v=null;u=xa.map(function(cb){var db={id:cb.i,server_id:cb.si};if(db.id==ya)v=db.id;if(w==cb.i){var eb=pa(w);if(eb!=-1){db.raised=u[eb].raised;return db;}else return null;}if(cb.r)db.raised=true;ab[db.id]=db;return db;});u=u.filter(function(cb){return cb!=null;});if(x)for(var bb in x)if(!ab[bb]||!ab[bb].raised)delete x[bb];za=za.filter(function(cb){return !ab[cb.id];});u=u.concat(za);oa();return true;}return false;}function ka(xa,ya){if(ya!=v)return true;var za=u.filter(function(cb){return !cb.fragile;});if(xa.length!=za.length)return true;for(var ab=0,bb=xa.length;ab<bb;ab++){if(xa[ab].id===w)continue;if(!s(xa[ab],za[ab]))return true;}return false;}function la(xa,ya,za){var ab=ia(q.get());if(ya===undefined||ya>ca){if(xa()){ab=true;y=za||null;na(ya);}}else ea.error('rejected',{change_time:ya,state_time:ca});ab&&ma();}function ma(){if(fa)va.inform('chat/tabs-changed',va.get());}function na(xa){if(xa===undefined)xa=Math.max(o.getLastUserMessageTimestamp()||1,ca+1);ca=xa;q.doSync();}function oa(){var xa=u.length-da;if(xa>0)u=u.filter(function(ya){return ya.raised||xa--<=0;});}function pa(xa){for(var ya=0;ya<u.length;ya++)if(u[ya].id==xa)return ya;return -1;}function qa(xa){var ya=n.getThreadMetaNow(xa);if(!ya)return false;if(ya.is_canonical_user){return sa(xa);}else{var za=ra(xa);if(za)m.getServerThreadID(xa,function(ab){if(ta(xa,ab)){na();ma();}});return za;}}function ra(xa){if(pa(xa)===-1){u.push({id:xa,fragile:true});ea.log('open_fragile_tab',{tabs:JSON.stringify(u),opened:xa,window_id:r.getSessionID()});return true;}return false;}function sa(xa){var ya=pa(xa);if(ya!=-1)if(u[ya].fragile){u.splice(ya,1);}else return false;for(var za=0;za<=u.length;za++)if(za==u.length||u[za].fragile){u.splice(za,0,{id:xa});oa();ea.log('open_tab',{tabs:JSON.stringify(u),opened:xa,window_id:r.getSessionID()});return true;}}function ta(xa,ya){var za=pa(xa);if(za!=-1&&u[za].fragile){var ab=u[za];ab.fragile=false;ab.server_id=ya;var bb=[];u.forEach(function(cb){if(cb.id!=xa){if(ab&&cb.fragile){bb.push(ab);ab=null;}bb.push(cb);}});if(ab)bb.push(ab);u=bb;ea.log('make_permanent',{tabs:JSON.stringify(u),tab_id:xa,window_id:r.getSessionID()});return true;}return false;}function ua(xa){var ya=pa(xa);if(xa==v)v=null;if(ya!=-1){u.splice(ya,1);ea.log('close_tab',{tabs:JSON.stringify(u),closed:xa,window_id:r.getSessionID()});return true;}return false;}q.registerStateStorer(ha);q.registerStateLoader(function(xa){if(ia(xa))ma();});function va(){}t(va,h,{indexOf:function(xa){return pa(xa);},getTab:function(xa){l.isThreadID(xa);var ya=this.indexOf(xa);if(ya>-1){var za=u[ya];return t({},za);}return null;},getEmptyTab:function(){for(var xa=0;xa<u.length;xa++){var ya=u[xa].id;if(n.isNewEmptyLocalThread(ya))return ya;}return null;},getServerTime:function(){return z();},closeAllTabs:function(){if(u.length){ea.log('close_all_tabs',{closed_tabs:JSON.stringify(u),window_id:r.getSessionID()});u=[];v=null;if(x)x={};na();ma();}},closeFragileTabs:function(){var xa=[];for(var ya=0;ya<u.length;ya++)if(u[ya].fragile){xa.push(u[ya]);u.splice(ya);ma();break;}ea.log('close_fragile_tabs',{tabs:JSON.stringify(u),fragile_closed:xa,window_id:r.getSessionID()});},closeTab:function(xa,ya){l.isThreadID(xa);var za=false;if(x){delete x[xa];za=true;}la(function(){if(ua(xa))za=true;return za;},undefined,ya);},closeTabAndDemote:function(xa,ya,za){l.isThreadID(xa);var ab=false;if(x){delete x[xa];ab=true;}la(function(){if(ua(xa)){if(v){var bb=pa(v);if(bb>ya){var cb=u.splice(bb,1)[0];u.splice(ya,0,cb);v=null;}}ab=true;}return ab;},undefined,za);},raiseTab:function(xa,ya){l.isThreadID(xa);var za=false;if(x&&ya){x[xa]=true;za=true;}if(!ya&&xa===w){za&&ma();return;}la(function(){if(qa(xa))za=true;var ab=pa(xa);if(ab!=-1&&!u[ab].raised){u[ab].raised=true;za=true;ea.log('raise_tab',{tabs:JSON.stringify(u),raised:xa,window_id:r.getSessionID()});}return za;});},get:function(){var xa=u.map(function(ya){var za=t({},ya);delete za.fragile;if(x)za.raised=x[za.id];return za;});return {tabs:xa,promoted:v};},openFragileTab:function(xa){l.isThreadID(xa);if(ra(xa))ma();},openTab:function(xa){l.isThreadID(xa);la(qa.curry(xa));},lowerTab:function(xa){l.isThreadID(xa);var ya=false;if(x){delete x[xa];ya=true;}la(function(){var za=pa(xa);if(za!=-1&&u[za].raised){delete u[za].raised;ea.log('lower_tab',{tabs:JSON.stringify(u),lowered:xa,window_id:r.getSessionID()});ya=true;}return ya;});},raiseAndPromoteTab:function(xa,ya,za,ab){l.isThreadID(xa);var bb=false;if(x&&ya){x[xa]=true;bb=true;}if(!ya&&xa===w){bb&&ma();return;}la(function(){if(qa(xa))bb=true;var cb=pa(xa);if(cb!=-1&&(!u[cb].raised||v!=xa)){u[cb].raised=true;v=xa;bb=true;ea.log('raise_and_promote_tab',{tabs:JSON.stringify(u),promoted:xa,window_id:r.getSessionID()});}return bb;},za,ab);},promoteThreadInPlaceOfThread:function(xa,ya){l.isThreadID(xa);l.isThreadID(ya);la(function(){var za=pa(xa),ab=pa(ya);if(v===ya)v=xa;var bb=u[za];u[za]=u[ab];u[ab]=bb;return true;});},squelchTab:function(xa){l.isThreadID(xa);w=xa;this.lowerTab(xa);ea.log('squelch_tab',{squelched:xa,tabs:JSON.stringify(u),window_id:r.getSessionID()});},clearSquelchedTab:function(){if(w)ea.log('unsquelch_tab',{squelched:w,tabs:JSON.stringify(u),window_id:r.getSessionID()});w=null;},persistLocalRaised:function(){if(x){la(function(){var xa=false;u.forEach(function(ya){if(ya.raised!=x[ya.id]){xa=true;if(x[ya.id]){ya.raised=true;}else delete ya.raised;}});return xa;});ea.log('persist_local_raise',{tabs:JSON.stringify(u),window_id:r.getSessionID()});}}});g.subscribe(k.DUMP_EVENT,function(xa,ya){ya.chat_tabs={promoted:v,tabs:u.map(function(za){return t({},za);}),time:ca,max_load_age:aa};});function wa(){var xa=i.ignoresRemoteTabRaise();if(xa&&!x){ea.log('start_ignore_remote_raise');x={};ma();}else if(!xa&&x){ea.log('stop_ignore_remote_raise');x=null;ma();}}i.subscribe(i.ON_CHANGED,wa);wa();ia(q.getInitial(),true);if(ca===0)ca=z()-600000;fa=true;e.exports=va;});
__d("VideoCallPromo",["ArbiterMixin","AsyncRequest","ChatConfig","ChatVisibility","LegacyContextualDialog","CSS","MercuryParticipants","MercuryThreads","ChatTabTemplates","VideoCallCore","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('ChatConfig'),j=b('ChatVisibility'),k=b('LegacyContextualDialog'),l=b('CSS'),m=b('MercuryParticipants'),n=b('MercuryThreads').get(),o=b('ChatTabTemplates'),p=b('VideoCallCore'),q=b('copyProperties'),r=b('emptyFunction');function s(){this._dialog=null;}function t(v){if(!(p.isSupported()&&i.get('video.show_promo')))return false;var w=n.getCanonicalUserInThread(v);if(!w)return false;return j.isOnline()&&p.availableForCall(w);}function u(v){new h().setURI('/ajax/chat/video/log_promo.php').setData({viewedUserID:v}).setAllowCrossPageTransition(true).setErrorHandler(r).send();}q(s.prototype,g);q(s.prototype,{render:function(v,w){var x=t(w);if(!x)return;var y=n.getCanonicalUserInThread(w);m.get('fbid:'+y,function(z){if(!z.call_promo)return;var aa=o[':fb:mercury:call:promo'].build();this._dialog=new k();this._dialog.init(aa.getRoot()).setWidth(250).setAlignH('center').setContext(v).show();l.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');l.addClass(v,'video_call_promo');u(n.getCanonicalUserInThread(w));this.inform('chat/dialog-rendered',{dialog:this,thread_id:w});}.bind(this));},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=s;});
__d("VideoCallTourDialog",["ArbiterMixin","LegacyContextualDialog","CSS","MercuryThreads","ChatTabTemplates","VideoCallCore","VideoCallingTour","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('LegacyContextualDialog'),i=b('CSS'),j=b('MercuryThreads').get(),k=b('ChatTabTemplates'),l=b('VideoCallCore'),m=b('VideoCallingTour'),n=b('copyProperties');function o(){this._dialog=null;}n(o.prototype,g);n(o.prototype,{render:function(p,q){var r=j.getCanonicalUserInThread(q);if(!r||!l.availableForCall(r))return;var s=k[':fb:mercury:call:tour'].build();this._dialog=new h();this._dialog.init(s.getRoot()).setWidth(250).setAlignH('center').setContext(p).show();i.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');i.addClass(p,'video_call_tour');this.inform('chat/dialog-rendered',{dialog:this,thread_id:q});m.inform('videocallingtour/end');},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=o;});
__d("ChatContextualDialogController",["Event","ArbiterMixin","ChatTabModel","VideoCallingTour","VideoCallPromo","VideoCallTourDialog","copyProperties","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('ChatTabModel'),j=b('VideoCallingTour'),k=b('VideoCallPromo'),l=b('VideoCallTourDialog'),m=b('copyProperties'),n=b('setTimeoutAcrossTransitions'),o=60000,p=false,q=false,r=function(y,z){this._videoCallPromo=new k();this._videoCallTour=new l();this._threadID=y;this._tabMainElement=z;this._openDialog=null;this._subscriptionTokens=[];this._scrollListener=null;this._timeout=null;};function s(y,event,z){if(y._openDialog)y._openDialog.updatePosition();}function t(y){if(y._openDialog)y._openDialog.updatePosition();}function u(y){if(y._openDialog){y._openDialog.hide();y._openDialog=null;}if(y._timeout){clearTimeout(y._timeout);y._timeout=null;}while(y._subscriptionTokens.length)y._subscriptionTokens.pop().unsubscribe();if(y._scrollListener){y._scrollListener.remove();y._scrollListener=null;}}function v(y,event,z){if(z.thread_id===y._threadID){y._openDialog=z.dialog;p=true;x(y);y._timeout=n(y.destroy.bind(y,y._threadID),o);y._scrollListener=g.listen(window,'scroll',t.curry(y));}}function w(y,z){if(!y._openDialog){y._subscriptionTokens.push(z.subscribe('chat/dialog-rendered',v.curry(y)));z.render(y._tabMainElement,y._threadID);}}function x(y){y._subscriptionTokens.push(i.subscribe('chat/tabs-changed',s.curry(y)),r.subscribe('dialog/close-all',u.curry(y)));}m(r,h);m(r.prototype,{destroy:function(){u(this);},tabFocused:function(){if(q){w(this,this._videoCallTour);return;}if(!p)w(this,this._videoCallPromo);},tabNotActive:function(){u(this);},hideVideoCallouts:function(){u(this);}});j.subscribe('videocallingtour/start',function(){q=true;r.inform('dialog/close-all');});j.subscribe('videocallingtour/end',function(){q=false;});e.exports=r;});
__d("ChatPrivacyActionController",["ChatVisibility","JSLogger","PresencePrivacy","copyProperties"],function(a,b,c,d,e,f){var g=b('ChatVisibility'),h=b('JSLogger'),i=b('PresencePrivacy'),j=b('copyProperties'),k=function(l,m){this._userID=l;this._logger=h.create('blackbird');this._getState=function(){if(g.isOnline())return i.allows(this._userID)?k.NORMAL:k.BLOCKED;return k.OFFLINE;};this._togglePrivacy=function(){var n=this._getState();switch(this._getState()){case k.OFFLINE:if(g.isOnline()){this._logger.error('tabs_already_online');break;}this._logger.log('tabs_go_online',{tab_id:this._userID});g.goOnline(function(){if(!i.allows(this._userID)){if(this._getState()!==k.BLOCKED)this._logger.error('privacy_action_controller_blocked_inconsistency');this._togglePrivacy();}}.bind(this));break;case k.BLOCKED:i.allow(this._userID);this._logger.log('tabs_unblock',{tab_id:this._userID});break;case k.NORMAL:i.disallow(this._userID);this._logger.log('tabs_block',{tab_id:this._userID});break;}};(function(){var n=function(){m&&m(this._getState());}.bind(this);n();this._subscribeToken=i.subscribe('privacy-changed',n);}.bind(this)).defer();};k.OFFLINE='offline';k.BLOCKED='blocked';k.NORMAL='normal';j(k.prototype,{togglePrivacy:function(){this._logger.log('gear_menu_toggle_privacy',{tab_id:this._userID});this._togglePrivacy();},destroy:function(){i.unsubscribe(this._subscribeToken);}});e.exports=k;});
__d("MercuryTypingIndicator",["Animation","CSS","DOM","MercuryTypingReceiver","MercuryParticipants","Style","ChatTabTemplates","MercuryThreadInformer","Tooltip","copyProperties","cx","tx"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('CSS'),i=b('DOM'),j=b('MercuryTypingReceiver'),k=b('MercuryParticipants'),l=b('Style'),m=b('ChatTabTemplates'),n=b('MercuryThreadInformer').get(),o=b('Tooltip'),p=b('copyProperties'),q=b('cx'),r=b('tx'),s=[];n.subscribe('messages-received',function(v,w){s.forEach(function(x){var y=w[x._threadID];y&&x.receivedMessages(y);});});j.subscribe('state-changed',function(v,w){s.forEach(function(x){var y=w[x._threadID];y&&x._handleStateChanged(y);});});function t(v){var w=m[':fb:chat:conversation:message-group'].build(),x=m[':fb:mercury:typing-indicator:typing'].build();h.addClass(w.getRoot(),"_50kd");var y=w.getNode('profileLink');o.set(y,v.name,'left');y.href=v.href;w.setNodeContent('profileName',v.name);w.setNodeProperty('profilePhoto','src',v.image_src);var z=r._("{name} is typing...",{name:v.short_name});o.set(x.getRoot(),z,'above');i.appendContent(w.getNode('messages'),x.getRoot());return w;}function u(v,w,x){this._animations={};this._activeUsers={};this._typingIndicator=w;this._messagesView=x;this._threadID=v;this._subscription=j.subscribe('state-changed',function(y,z){var aa=z[this._threadID];aa&&this._handleStateChanged(aa);}.bind(this));s.push(this);}p(u.prototype,{destroy:function(){Object.keys(this._activeUsers).forEach(this._removeUserBubble.bind(this));this._controller.destroy();s.remove(this);},receivedMessages:function(v){v.forEach(function(w){if(!k.isAuthor(w.author))this._removeUserBubble(w.author);}.bind(this));},_handleStateChanged:function(v){for(var w in this._activeUsers)if(v.indexOf(w)===-1){this._slideOutUserBubble(w);delete this._activeUsers[w];}if(v.length)k.getMulti(v,function(x){var y=this._messagesView.isScrolledToBottom(),z={};for(var aa in x){var ba=this._activeUsers[aa];z[aa]=ba||t(x[aa]).getRoot();if(!ba)i.appendContent(this._typingIndicator,z[aa]);}var ca=Object.keys(z).length>0;y&&this._messagesView.scrollToBottom(ca);this._activeUsers=z;}.bind(this));},_removeUserBubble:function(v,w){var x=this._getCurrentAnimation(v,w);if(x){x.animation.stop();i.remove(x.elem);delete this._animations[v];}if(v in this._activeUsers){i.remove(this._activeUsers[v]);delete this._activeUsers[v];}w&&i.remove(w);},_slideOutUserBubble:function(v){var w=this._activeUsers[v];if(this._getCurrentAnimation(v,w)){return;}else if(w){l.set(w,'overflow','hidden');var x=(new g(w)).from('opacity',1).from('height',w.offsetHeight).to('height',0).to('opacity',0).ease(g.ease.end).duration(250).ondone(this._removeUserBubble.bind(this,v,w)).go();this._animations[v]={animation:x,elem:w};}},_getCurrentAnimation:function(v,w){if(this._animations[v]&&(!w||this._animations[v].elem===w))return this._animations[v];}});e.exports=u;});
__d("ChatTabMessagesView",["JSXDOM","Event","Animation","Arbiter","ArbiterMixin","MercuryAttachment","MercuryAttachmentRenderer","CSS","ChannelConstants","ChatConfig","ChatVisibility","DOM","Env","MercuryActionTypeConstants","MercuryAPIArgsSource","MercuryLastMessageIndicator","MercuryLogMessageType","MercuryMessages","MercuryServerRequests","MercurySourceType","MercuryThreadMetadataRawRenderer","MercuryThreadMetadataRenderer","MercuryThreads","MercuryThreadlistConstants","MercuryTypingIndicator","MercuryMessageRenderer","Parent","MercuryParticipants","MercuryStatusTemplates","Style","ChatTabTemplates","MercuryThreadInformer","Tooltip","VideoCallCore","copyProperties","cx","formatDate","isRTL","removeFromArray","throttle","tx"],function(a,b,c,d,e,f){var g=b('JSXDOM'),h=b('Event'),i=b('Animation'),j=b('Arbiter'),k=b('ArbiterMixin'),l=b('MercuryAttachment'),m=b('MercuryAttachmentRenderer'),n=b('CSS'),o=b('ChannelConstants'),p=b('ChatConfig'),q=b('ChatVisibility'),r=b('DOM'),s=b('Env'),t=b('MercuryActionTypeConstants'),u=b('MercuryAPIArgsSource'),v=b('MercuryLastMessageIndicator'),w=b('MercuryLogMessageType'),x=b('MercuryMessages').get(),y=b('MercuryServerRequests').get(),z=b('MercurySourceType'),aa=b('MercuryThreadMetadataRawRenderer'),ba=b('MercuryThreadMetadataRenderer').get(),ca=b('MercuryThreads').get(),da=b('MercuryThreadlistConstants'),ea=b('MercuryTypingIndicator'),fa=b('MercuryMessageRenderer'),ga=b('Parent'),ha=b('MercuryParticipants'),ia=b('MercuryStatusTemplates'),ja=b('Style'),ka=b('ChatTabTemplates'),la=b('MercuryThreadInformer').get(),ma=b('Tooltip'),na=b('VideoCallCore'),oa=b('copyProperties'),pa=b('cx'),qa=b('formatDate'),ra=b('isRTL'),sa=b('removeFromArray'),ta=b('throttle'),ua=b('tx'),va,wa=34;function xa(hb){return qa(new Date(hb),p.get('24h_times')?'H:i':'g:ia');}function ya(hb){var ib=ka[':fb:chat:conversation:message-group'].build(),jb=ib.getNode('profileLink'),kb=p.get('chat_tab_bubbles'),lb=ha.isAuthor(hb.author),mb=y.tokenizeThreadID(hb.thread_id),nb=mb.type!=='user',ob=!lb||!kb;if(!kb)ib.setNodeContent('timestamp',xa(hb.timestamp));n.conditionClass(ib.getRoot(),"_50kd",!lb&&kb);n.conditionClass(ib.getRoot(),"_50x4",nb&&!lb&&kb);n.conditionShow(jb,ob);ha.get(hb.author,function(pb){if(ob){jb.href=pb.href;var qb=lb?"You":pb.name;if(!lb&&kb)qb=g.div({className:"_522l"},[g.div({className:"_522m"},xa(hb.timestamp)),pb.name]);ma.set(jb,qb,'left');if(!lb&&kb&&nb)ib.setNodeContent('profileName',pb.name);ib.setNodeProperty('profilePhoto','src',pb.image_src);}});return ib;}function za(hb){var ib=ka[':fb:chat:conversation:message:event'].build(),jb=p.get('chat_tab_bubbles'),kb=xa(hb.timestamp);if(jb){ib.getRoot().setAttribute('title',kb);}else ib.setNodeContent('timestamp',kb);fa.renderLogMessage(ib.getNode('icon'),ib.getNode('message'),ib.getNode('attachment'),hb);var lb=bb(hb);if(lb)r.appendContent(ib.getNode('message'),lb);return ib.getRoot();}function ab(hb){if(!p.get('chat_tab_bubbles'))return;var ib,jb,kb=hb.firstChild;if(hb.childNodes.length===1&&kb.getAttribute('data-measureme')){ib=kb.getClientRects();var lb=kb.offsetHeight;if(ib&&ib.length>1&&ib[0].height<lb){jb=true;if(!va){r.remove(kb);va=hb.offsetWidth;r.appendContent(hb,kb);}var mb=kb.offsetWidth,nb=hb.offsetWidth-mb-va;if(nb>0)ja.set(hb,'max-width',mb+'px');}}var ob=ga.byClass(hb,"_50x4");if(ob)n.conditionClass(ob,"_51lo",ib?!jb:hb.offsetHeight<wa);}function bb(hb){var ib,jb;if(hb.log_message_type==w.VIDEO_CALL)if(hb.log_message_data.event_name=='install_canceled'){ib=r.tx._("Retry setup and call back.");jb='callback_cancelinstall_link';return cb(ib,hb.thread_id,hb.log_message_data.to,jb);}else if(!hb.log_message_data.event_name&&hb.log_message_data.callee==ha.user&&!hb.log_message_data.answered){ib=r.tx._("Call Back");jb='callback_link';return cb(ib,hb.thread_id,hb.log_message_data.caller.split(':')[1],jb);}return null;}function cb(hb,ib,jb,kb){if(na.isSupported()){var lb=!q.isOnline()||!na.availableForCall(jb),mb=r.create('a',{href:'#',className:'callBackLink'},hb);if(lb)n.hide(mb);mb.setAttribute('data-gt',JSON.stringify({videochat:'clicked_callback_link'}));h.listen(mb,'click',function(){fb.inform('video-call-clicked',{userID:jb,threadID:ib,clickSource:kb});});return mb;}return null;}function db(hb){var ib=ka[':fb:mercury:chat:message:forward'].build(),jb=ib.getNode('forwardText');if(jb){n.hide(ib.getRoot());ba.renderTitanLink(hb.thread_id,ib.getNode('forwardLink'),n.show.bind(n,ib.getRoot()));if(hb.forward_count>1){r.appendContent(jb,ua._("{count} forwarded messages",{count:hb.forward_count}));}else r.appendContent(jb,"1 forwarded message");}return ib.getRoot();}var eb=[];function fb(hb,ib,jb,kb,lb,mb,nb){this.loadingIcon=lb;this.threadID=hb;this.sheetController=ib;this.scrollContainer=jb;this.conversationElem=kb;this.messageElements={};this.messageGroup=null;this.prevMessage=null;this._fetchMultiplier=1;this._oldestMessageDisplayedTimestamp=null;this._loadingMoreMessages=false;this._currentMessageCount=0;this._hasReachedClearedMessages=false;var ob=da.MESSAGE_TIMESTAMP_THRESHOLD;this._oldestMessageDisplayedTimestamp=Date.now()-ob;eb.push(this);this._subscription=j.subscribe('overflow-applied-to-body',this.scrollToBottom.bind(this));h.listen(this.scrollContainer,'scroll',ta(this.scrolling,50,this));var pb=p.get('chat_tab_bubbles');this.lastMessageIndicator=new v(this.threadID,mb,pb,this);if(pb)this.typingIndicator=new ea(this.threadID,nb,this);x.getThreadMessagesRange(this.threadID,0,da.RECENT_MESSAGES_LIMIT,this._updateTimestamp.bind(this));this.rerender();}oa(fb,k);oa(fb.prototype,{scrolling:function(){if(!this._loadingMoreMessages&&this.isScrolledNearTop()&&!this.isScrolledToBottom()&&!this._hasReachedClearedMessages)this.loadMoreMessages();if(!this._newMessagesSheetOpened)return;if(this.isScrolledToBottom()){this.sheetController.closeNewMessagesSheet();this._newMessagesSheetOpened=false;}},destroy:function(){r.empty(this.conversationElem);this._subscription.unsubscribe();sa(eb,this);this.lastMessageIndicator&&this.lastMessageIndicator.destroy();this.destroyed=true;},_appendMessage:function(hb){if(hb==this.prevMessage)return;var ib=da,jb=ib.GROUPING_THRESHOLD,kb=hb.action_type==t.LOG_MESSAGE&&hb.log_message_type==w.SERVER_ERROR;if(hb.is_cleared){this._hasReachedClearedMessages=true;return;}var lb=null;if(this.prevMessage)lb=new Date(this.prevMessage.timestamp);var mb=new Date(hb.timestamp);if(!kb&&(!lb||lb.getDate()!=mb.getDate()||lb.getMonth()!=mb.getMonth()||lb.getFullYear()!=mb.getFullYear())){var nb=ka[':fb:chat:conversation:date-break'].build();r.setContent(nb.getNode('date'),fa.renderDate(mb));r.appendContent(this.conversationElem,nb.getRoot());this.messageGroup=null;}if(hb.action_type==t.LOG_MESSAGE){r.appendContent(this.conversationElem,za(hb));this.messageGroup=null;this.prevMessage=hb;return;}var ob=p.get('chat_tab_bubbles');if(!this.messageGroup||ob&&hb.author!==ha.user||this.prevMessage.author!=hb.author||this.prevMessage.timestamp<hb.timestamp-jb){this.messageGroup=ya(hb);r.appendContent(this.conversationElem,this.messageGroup.getRoot());}var pb=this._renderSingleMessage(hb);this.messageElements[hb.message_id]=pb;r.appendContent(this.messageGroup.getNode('messages'),pb);ab(pb);this.prevMessage=hb;},rerender:function(){if(!this._oldestMessageDisplayedTimestamp)return;var hb=this._finishedFetchingMoreMessages&&this.scrollContainer.scrollHeight,ib=this._finishedFetchingMoreMessages&&this.scrollContainer.scrollTop,jb=this.isScrolledToBottom();r.empty(this.conversationElem);this.messageElements={};this.messageGroup=null;this.prevMessage=null;var kb=x.getThreadMessagesSinceTimestamp(this.threadID,this._oldestMessageDisplayedTimestamp);this._renderOlderMessages(kb,hb,ib,jb);this._finishedFetchingMoreMessages=false;},update:function(hb){for(var ib in hb){var jb=this.messageElements[ib];if(jb){var kb=this.isScrolledToBottom(),lb=this._renderSingleMessage(x.getMessagesFromIDs([ib])[0]);this.messageElements[ib]=lb;r.replace(jb,lb);ab(lb);if(kb)this.scrollToBottom();}}},_getLoadingHeight:function(){return this.loadingHeight||this.loadingIcon.clientHeight;},_appendMessages:function(hb){hb.forEach(this._appendMessage.bind(this));this.lastMessageIndicator&&this.lastMessageIndicator.setLastMessage(this.prevMessage);this.sheetController.displayMessengerPromoTabSheet(this.prevMessage);},_appendNewMessages:function(hb){var ib=this.isScrolledToBottom(),jb=this._messagesOnlySentFromSelf(hb);this._appendMessages(hb);if(ib){this.scrollToBottom();}else if(!jb){this.sheetController.openNewMessagesSheet();this._newMessagesSheetOpened=true;}},_messagesOnlySentFromSelf:function(hb){for(var ib=0;ib<hb.length;ib++)if(hb[ib].author!==ha.user)return false;return true;},_renderOlderMessages:function(hb,ib,jb,kb){if(!hb)return;this._appendMessages(hb);if(kb){this.scrollToBottom();}else if(this._finishedFetchingMoreMessages)this.scrollToPosition(this.scrollContainer.scrollHeight-ib-this.loadingHeight+jb);},_updateTimestamp:function(hb){if(hb&&hb.length){this._oldestMessageDisplayedTimestamp=hb[0].timestamp;this._currentMessageCount=hb.length;}this._loadingMoreMessages=false;this._finishedFetchingMoreMessages=true;n.hide(this.loadingIcon);},isScrolledToBottom:function(){var hb=this.scrollContainer;return hb.scrollTop+hb.clientHeight>=hb.scrollHeight-1;},isScrolledNearTop:function(){return this.scrollContainer.scrollTop<this.scrollContainer.clientHeight;},scrollToBottom:function(hb){this.scrollToPosition(this.scrollContainer.scrollHeight,hb);},scrollToPosition:function(hb,ib){this._scrollTopAnimation&&this._scrollTopAnimation.stop();if(ib===true){this._scrollTopAnimation=(new i(this.scrollContainer)).to('scrollTop',hb).ease(i.ease.end).duration(400).go();}else this.scrollContainer.scrollTop=hb;},loadMoreMessages:function(){if(x.hasLoadedExactlyNMessages(this.threadID,this._currentMessageCount)&&x.hasLoadedAllMessages(this.threadID))return;n.show(this.loadingIcon);this.loadingHeight=this._getLoadingHeight();this._loadingMoreMessages=true;if(this._fetchMultiplier<10)this._fetchMultiplier+=1;var hb=da.RECENT_MESSAGES_LIMIT*this._fetchMultiplier,ib=this._currentMessageCount+hb,jb=x.hasLoadedNMessages(this.threadID,ib);x.getThreadMessagesRange(this.threadID,0,ib,this._updateTimestamp.bind(this),null,u.CHAT);if(jb)this.rerender();},_renderSingleMessage:function(hb){var ib=ka[':fb:chat:conversation:message'].render(),jb=p.get('chat_tab_bubbles');if(jb&&ha.isAuthor(hb.author))ib.setAttribute('title',xa(hb.timestamp));if(hb.subject){var kb=ka[':fb:chat:conversation:message:subject'].render();r.setContent(kb,hb.subject);r.appendContent(ib,kb);}function lb(rb){if(jb)rb=r.create('span',{'data-measureme':1},rb);return rb;}if(hb.is_filtered_content){var mb=ia[':fb:mercury:filtered-message'].build();r.appendContent(ib,lb(mb.getRoot()));return ib;}if(hb.body.substr(0,4)=='?OTR'){r.setContent(ib,lb("[encrypted message]"));n.addClass(ib,'cyphertext');}else{n.addClass(ib,ra(hb.body)?'direction_rtl':'direction_ltr');var nb=fa.formatMessageBody(hb.body);r.appendContent(ib,lb(nb));}if(hb.has_attachment)this._appendMessageAttachments(ib,hb);if(hb.forward_count)r.appendContent(ib,db(hb));if(hb.is_spoof_warning){var ob=ka[':fb:chat:conversation:message:undertext'].build();r.appendContent(ob.getNode('message'),ib);ha.get(hb.author,function(rb){ba.renderChatSpoofWarning(ob.getNode('status'),hb.is_spoof_warning,rb);});return ob.getRoot();}var pb=aa.renderStatusIndicator(hb.status,hb.error_data,x.resendMessage.shield(x,hb));if(pb){n.addClass(ib,'errorStatus');var qb=ka[':fb:chat:conversation:message:status'].build();r.appendContent(qb.getNode('message'),ib);r.appendContent(qb.getNode('status'),pb);return qb.getRoot();}return ib;},_appendMessageAttachments:function(hb,ib){var jb=ib.attachments;if(ib.raw_attachments&&ib.raw_attachments.length>0)jb=l.convertRaw(ib.raw_attachments);for(var kb=0,lb=jb.length;kb<lb;++kb){var mb=m.renderAttachment(true,jb[kb],ib);if(mb[1]){var nb=r.scry(mb[1],'img');nb.forEach(function(ob){h.listen(ob,'load',this._thumbLoaded.shield(this,ob));}.bind(this));}r.appendContent(hb,mb);}},_thumbLoaded:function(hb){var ib=this.scrollContainer.scrollTop+this.scrollContainer.clientHeight;if(ib+hb.offsetHeight>=this.scrollContainer.scrollHeight)this.scrollToBottom();}});la.subscribe('messages-reordered',function(hb,ib){eb.forEach(function(jb){ib[jb.threadID]&&jb.rerender();});});la.subscribe('messages-updated',function(hb,ib){eb.forEach(function(jb){ib[jb.threadID]&&jb.update(ib[jb.threadID]);});});la.subscribe('messages-received',function(hb,ib){eb.forEach(function(jb){var kb=ib[jb.threadID];if(kb&&kb.length)jb._currentMessageCount+=kb.length;kb&&jb._appendNewMessages(kb);});});j.subscribe(o.getArbiterType('chat_event'),function(hb,ib){if(gb(ib.obj)){var jb=(s.user==ib.obj.from)?ib.obj.to:ib.obj.from,kb=ca.getThreadIdForUser(jb),lb=eb.filter(function(ob){return ob.threadID===kb;});if(lb.length>0){var mb=lb[0],nb=x.constructLogMessageObject(z.CHAT_WEB,kb,w.VIDEO_CALL,ib.obj);nb.author='fbid:'+ib.obj.from;mb._appendNewMessages([nb]);}}});function gb(hb){return (hb.event_name==='installing'||hb.event_name==='install_canceled');}e.exports=fb;});
__d("ChatAddFriendsTabSheetRawRenderer",["ContextualTypeaheadView","DOM","Event","MercuryTypeahead","ChatTabTemplates","tx","MercuryDataSourceWrapper"],function(a,b,c,d,e,f){var g=b('ContextualTypeaheadView'),h=b('DOM'),i=b('Event'),j=b('MercuryTypeahead'),k=b('ChatTabTemplates'),l=b('tx'),m=b('MercuryDataSourceWrapper').source,n={render:function(o,p,q,r,s){var t=k[':fb:mercury:chat:tab-sheet:add-friends'].build(),u=new j(m,g);u.setExcludedParticipants(r.participants);u.setPlaceholder("Enter a friend's name");u.build();h.replace(t.getNode('participantsTypeahead'),u.getElement());h.setContent(q,t.getRoot());u.focus();var v=function(){var w=u.getSelectedParticipantIDs();if(w.length)s(w);p.close(o);};i.listen(t.getNode('doneButton'),'click',v);}};e.exports=n;});
__d("MultiChatController",["Arbiter","AsyncSignal","copyProperties","Form","MercuryMessages","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncSignal'),i=b('copyProperties'),j=b('Form'),k=b('MercuryMessages').get(),l=b('MercuryServerRequests').get(),m=b('MercuryThreads').get();function n(){}i(n,{subscribe:function(o,p){o.subscribe('confirm',function(){this.createGroupThreadFromChooserDialog(o,p);}.bind(this));},createGroupThreadFromChooserDialog:function(o,p){var q=j.serialize(o.getRoot()),r=JSON.parse(q.profileChooserItems),s=[];for(var t in r)if(r[t])s.push(t);var u=n.createThreadForFBIDs(s);l.subscribe('update-thread-ids',function(v,w){for(var x in w)if(w[x]==u)new h('/ajax/groups/chat/log',{group_id:p,message_id:x}).send();});o.hide();},createThreadForTokens:function(o){if(!o.length)return;var p;if(o.length==1){p='user:'+o[0].split(':')[1];}else p='root:'+k.generateNewClientMessageID(Date.now());m.createNewLocalThread(p,o);g.inform('chat/open-tab',{thread_id:p});return p;},createThreadForFBIDs:function(o){var p=[];for(var q=0;q<o.length;q++)p.push("fbid:"+o[q]);return n.createThreadForTokens(p);}});e.exports=n;});
__d("ChatAddFriendsTabSheet",["Arbiter","ChatAddFriendsTabSheetRawRenderer","ChatTabModel","MercuryLogMessageType","MercurySourceType","MercuryMessages","MultiChatController","MercuryParticipants","MercuryThreads","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChatAddFriendsTabSheetRawRenderer'),i=b('ChatTabModel'),j=b('MercuryLogMessageType'),k=b('MercurySourceType'),l=b('MercuryMessages').get(),m=b('MultiChatController'),n=b('MercuryParticipants'),o=b('MercuryThreads').get(),p=b('copyProperties');function q(t,u,v){this._threadID=t;this._rootElement=u;this._sheetView=v;}p(q.prototype,{render:function(){o.getThreadMeta(this._threadID,function(t){var u=t.is_canonical_user?r:s;h.render(this,this._sheetView,this._rootElement,t,u.curry(t));}.bind(this));},isPermanent:function(){return true;},getType:function(){return 'add_friends_type';},open:function(){this._sheetView.open(this);}});function r(t,u){var v=t.participants;m.createThreadForTokens(v.concat(u));}function s(t,u){var v=t.thread_id;if(o.isNewEmptyLocalThread(v)&&u.length==1){var w='user:'+n.getUserID(u[0]);o.getThreadMeta(w,function(){i.raiseTab(w,true);i.promoteThreadInPlaceOfThread(w,v);i.closeTab(v);g.inform('chat/open-tab',{thread_id:w});});}else if(o.isEmptyLocalThread(v)){o.addParticipantsToThreadLocally(v,u);g.inform('chat/open-tab',{thread_id:v});}else{l.sendMessage(l.constructLogMessageObject(k.CHAT_WEB,v,j.SUBSCRIBE,{added_participants:u}));g.inform('chat/open-tab',{thread_id:v});}}e.exports=q;});
__d("ChatMessengerUpsellConfig",["AsyncRequest","KeyedCallbackManager"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('KeyedCallbackManager'),i=new h(),j={get:function(k,l){var m=i.executeOrEnqueue(k,l),n=i.getUnavailableResources(m);if(n.length)new g().setURI('/ajax/chat/messenger_upsell/config.php').setHandler(this._setPromoConfig.bind(this)).send();},_setPromoConfig:function(k){var l=k.payload;if(l){i.setResource('impression_count',l.number_of_impressions);i.setResource('max_impressions',l.max_impressions);i.setResource('promo_timeout',l.promo_timeout);i.setResource('post_click_timeout',l.post_click_timeout);i.setResource('should_show_orca_promotion',true);}else i.setResource('should_show_orca_promotion',false);},getNow:function(k){return i.getResource(k);},setImpressionCount:function(k,l){new g().setURI('/ajax/chat/messenger_upsell/update_impressions.php').setData({impressions:l,friend_id:k}).send();i.setResource('impression_count',l);if(l>=i.getResource('max_impressions'))i.setResource('should_show_orca_promotion',false);}};e.exports=j;});
__d("ChatMessengerPromoTabSheet",["AsyncRequest","DOM","Event","MercuryParticipants","MercurySourceType","MercuryThreads","ChatTabTemplates","ChatMessengerUpsellConfig","URI","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('DOM'),i=b('Event'),j=b('MercuryParticipants'),k=b('MercurySourceType'),l=b('MercuryThreads').get(),m=b('ChatTabTemplates'),n=b('ChatMessengerUpsellConfig'),o=b('URI'),p=b('copyProperties'),q=b('tx');function r(s,t,u){this._threadID=s;this._rootElement=t;this._sheetView=u;this._sheetHasBeenDisplayed=false;this._canonicalUser=l.getCanonicalUserInThread(s);this._timeoutResetCallback=null;this._template;}p(r.prototype,{render:function(){this._template=m[':fb:mercury:chat:tab-sheet:promo-sheet'].build();var s=j.getIDForUser(this._canonicalUser);j.get(s,function(t){h.setContent(this._template.getNode('text'),q._("{name} is using Messenger. Get the app to chat on the go.",{name:t.short_name}));}.bind(this));this._button=this._template.getNode('installButton');i.listen(this._template.getNode('installButton'),'click',this.installButtonClickHandler.bind(this));h.setContent(this._rootElement,this._template.getRoot());},rerender:function(){h.empty(this._rootElement);h.setContent(this._template.getNode('text'),"A link has been sent to your phone to install Messenger");h.remove(this._template.getNode('installButton'));h.setContent(this._rootElement,this._template.getRoot());n.get('post_click_timeout',function(s){this._timeoutResetCallback(this,s);}.bind(this));},installButtonClickHandler:function(){var s=new o('/ajax/marketing/messenger_send_to_mobile').setQueryData({fb_source:'web_chat_upsell'});new g().setURI(s).setMethod('POST').setHandler(function(v){this.rerender();}.bind(this)).send();var t=n.getNow('impression_count'),u=t*100;n.setImpressionCount(this._canonicalUser,u);},isPermanent:function(){return false;},timeoutCanBeReset:function(){return true;},setResetTimeoutCallback:function(s){this._timeoutResetCallback=s;},getType:function(){return 'messenger_promo_type';},getCloseTimeout:function(){return n.getNow('promo_timeout');},_displayUpsellCallback:function(s){if(!s)return;this._sheetView.open(this);this._sheetHasBeenDisplayed=true;var t=n.getNow('impression_count');n.setImpressionCount(this._canonicalUser,t+1);return;},displayPromo:function(s){if(!s||(s.source!=k.CHAT_ORCA&&s.source!=k.TITAN_ORCA)||j.getUserID(s.author)!=this._canonicalUser||this._sheetHasBeenDisplayed)return;n.get('should_show_orca_promotion',function(t){this._displayUpsellCallback(t);}.bind(this));}});e.exports=r;});
__d("ChatNewMessagesTabSheet",["Event","ArbiterMixin","DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('DOM'),j=b('ChatTabTemplates'),k=b('copyProperties');function l(m,n,o){this._threadID=m;this._rootElement=n;this._sheetView=o;}k(l.prototype,h,{render:function(){var m=j[':fb:mercury:chat:tab-sheet:clickable-message-icon-sheet'].build();i.setContent(m.getNode('text'),i.tx._("Scroll down to see new messages."));i.setContent(this._rootElement,m.getRoot());g.listen(m.getRoot(),'click',function(){this.inform('clicked',this._threadID);}.bind(this));},isPermanent:function(){return true;},getType:function(){return 'new_messages_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=l;});
__d("ChatNoRecipientsTabSheet",["DOM","MercuryParticipants","ChatTabTemplates","MercuryThreadInformer","MercuryThreads","copyProperties"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('MercuryParticipants'),i=b('ChatTabTemplates'),j=b('MercuryThreadInformer').get(),k=b('MercuryThreads').get(),l=b('copyProperties');function m(n,o,p){this._threadID=n;this._rootElement=o;this._sheetView=p;j.subscribe('threads-updated',this._handleThreadsUpdated.bind(this));}l(m.prototype,{render:function(){var n=i[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(n.getNode('text'),g.tx._("All recipients have left this conversation. Please close the stale tab."));g.setContent(this._rootElement,n.getRoot());},isPermanent:function(){return true;},getType:function(){return 'no_recipients_type';},_handleThreadsUpdated:function(){k.getThreadMeta(this._threadID,function(n){var o=h.user,p=n.participants.filter(function(q){return q!=o;});if(p.length<1&&!n.is_joinable&&!k.isNewEmptyLocalThread(this._threadID)){this._sheetView.open(this);}else this._sheetView.close(this);}.bind(this));}});e.exports=m;});
__d("ChatOfflineTabSheet",["ChatPrivacyActionController","ChatVisibility","CSS","DOM","Event","JSLogger","MercuryParticipants","MercuryThreads","ChatTabTemplates","copyProperties","cx"],function(a,b,c,d,e,f){var g=b('ChatPrivacyActionController'),h=b('ChatVisibility'),i=b('CSS'),j=b('DOM'),k=b('Event'),l=b('JSLogger'),m=b('MercuryParticipants'),n=b('MercuryThreads').get(),o=b('ChatTabTemplates'),p=b('copyProperties'),q=b('cx');function r(s,t,u){this._rootElement=t;this._sheetView=u;this._logger=l.create('blackbird');this._canonicalUser=n.getCanonicalUserInThread(s);if(this._canonicalUser)this._privacyActionController=new g(this._canonicalUser,this._handlePrivacyChange.bind(this));}p(r.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('offline_sheet_open_with_non_friend');return;}var s=o[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build(),t='fbid:'+this._canonicalUser;m.get(t,function(u){var v='fbChatGoOnlineLink',w=j.tx._("turn on chat"),x=j.create('a',{href:'#',className:v},w),y=j.tx._("To chat with {name} and other friends, {link}.",{name:u.short_name,link:x});j.setContent(s.getNode('text'),y);i.addClass(s.getRoot(),"_1sk1");j.setContent(this._rootElement,s.getRoot());k.listen(this._rootElement,'click',function(event){if(i.hasClass(event.getTarget(),v)){if(h.isOnline())this._logger.error('tab_sheet_already_online');this._privacyActionController.togglePrivacy();this._logger.log('tab_sheet_go_online',{tab_id:this._canonicalUser});return false;}}.bind(this));}.bind(this));},_handlePrivacyChange:function(s){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');switch(s){case g.OFFLINE:this._sheetView.open(this);break;case g.NORMAL:case g.BLOCKED:this._sheetView.close(this);break;}},isPermanent:function(){return true;},getType:function(){return 'offline_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=r;});
__d("ChatUploadWarningTabSheet",["DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('ChatTabTemplates'),i=b('copyProperties');function j(k,l,m){this._threadID=k;this._rootElement=l;this._sheetView=m;}i(j.prototype,{render:function(){var k=h[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(k.getNode('text'),g.tx._("Please wait until the upload is complete before you send your message."));g.setContent(this._rootElement,k.getRoot());},isPermanent:function(){return false;},getType:function(){return 'upload_warning_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=j;});
__d("ChatThreadIsMutedTabSheet",["Event","ArbiterMixin","DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('DOM'),j=b('ChatTabTemplates'),k=b('copyProperties');function l(m,n,o){this._threadID=m;this._rootElement=n;this._sheetView=o;}k(l.prototype,h,{render:function(){var m=j[':fb:mercury:chat:tab-sheet:message-mute-sheet'].build();i.setContent(m.getNode('text'),i.tx._("This conversation is muted. Chat tabs will not pop up for it and push notifications are off."));i.setContent(this._rootElement,m.getRoot());g.listen(m.getNode('unmuteButton'),'click',function(){this.inform('clicked',this._threadID);}.bind(this));},isPermanent:function(){return false;},getType:function(){return 'chat-thread-is-muted';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=l;});
__d("ChatUserBlockedTabSheet",["ChatPrivacyActionController","CSS","DOM","Event","GenderConst","JSLogger","MercuryParticipants","MercuryThreads","ChatTabTemplates","copyProperties","cx","tx"],function(a,b,c,d,e,f){var g=b('ChatPrivacyActionController'),h=b('CSS'),i=b('DOM'),j=b('Event'),k=b('GenderConst'),l=b('JSLogger'),m=b('MercuryParticipants'),n=b('MercuryThreads').get(),o=b('ChatTabTemplates'),p=b('copyProperties'),q=b('cx'),r=b('tx');function s(t,u,v){this._rootElement=u;this._sheetView=v;this._logger=l.create('blackbird');this._canonicalUser=n.getCanonicalUserInThread(t);if(this._canonicalUser)this._privacyActionController=new g(this._canonicalUser,this._handlePrivacyChange.bind(this));}p(s.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('user_blocked_sheet_open_with_non_friend');return;}var t=o[':fb:mercury:chat:tab-sheet:user-blocked'].build(),u='fbid:'+this._canonicalUser;m.get(u,function(v){var w=null;switch(v.gender){case k.FEMALE_SINGULAR:case k.FEMALE_SINGULAR_GUESS:w=r._("You turned off chat for {name} but you can still send her a message. ",{name:v.short_name});break;case k.MALE_SINGULAR:case k.MALE_SINGULAR_GUESS:w=r._("You turned off chat for {name} but you can still send him a message. ",{name:v.short_name});break;default:w=r._("You turned off chat for {name} but you can still send them a message. ",{name:v.short_name});}i.setContent(t.getNode('text'),w);var x=r._("Turn on chat for {name}?",{name:v.short_name});i.setContent(t.getNode('actionLink'),x);h.addClass(t.getRoot(),"_1sk0");i.setContent(this._rootElement,t.getRoot());j.listen(t.getNode('actionLink'),'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController));}.bind(this));},_handlePrivacyChange:function(t){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');switch(t){case g.BLOCKED:this._sheetView.open(this);break;case g.NORMAL:case g.OFFLINE:this._sheetView.close(this);break;}},isPermanent:function(){return true;},getType:function(){return 'user_blocked_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=s;});
__d("ChatTabSheetController",["ChatAddFriendsTabSheet","ChatConfig","ChatMessengerPromoTabSheet","ChatNewMessagesTabSheet","ChatNoRecipientsTabSheet","ChatOfflineTabSheet","ChatUploadWarningTabSheet","ChatThreadIsMutedTabSheet","ChatUserBlockedTabSheet","copyProperties","MercurySheetView","MercuryThreads"],function(a,b,c,d,e,f){var g=b('ChatAddFriendsTabSheet'),h=b('ChatConfig'),i=b('ChatMessengerPromoTabSheet'),j=b('ChatNewMessagesTabSheet'),k=b('ChatNoRecipientsTabSheet'),l=b('ChatOfflineTabSheet'),m=b('ChatUploadWarningTabSheet'),n=b('ChatThreadIsMutedTabSheet'),o=b('ChatUserBlockedTabSheet'),p=b('copyProperties'),q=b('MercurySheetView'),r=b('MercuryThreads').get(),s=function(t,u,v){this._sheetView=new q(t,u,v);this._addFriendsTabSheet=new g(t,u,this._sheetView);this._userBlockedTabSheet=new o(t,u,this._sheetView);this._offlineTabSheet=new l(t,u,this._sheetView);this._messengerPromoTabSheet=new i(t,u,this._sheetView);this._newMessagesTabSheet=new j(t,u,this._sheetView);this._uploadWarningTabSheet=new m(t,u,this._sheetView);this._threadIsMutedTabSheet=new n(t,u,this._sheetView);if(!r.getCanonicalUserInThread(t))this._noRecipientsTabSheet=new k(t,u,this._sheetView);};p(s.prototype,{openAddFriendsSheet:function(){this._addFriendsTabSheet.open();},openNewMessagesSheet:function(){this._newMessagesTabSheet.open();},openUploadWarningTabSheet:function(){this._uploadWarningTabSheet.open();},openThreadIsMutedTabSheet:function(){this._threadIsMutedTabSheet.open();},closeThreadIsMutedTabSheet:function(){this._threadIsMutedTabSheet.close();},closeNewMessagesSheet:function(){this._newMessagesTabSheet.close();},displayMessengerPromoTabSheet:function(t){this._messengerPromoTabSheet.displayPromo(t);},closeUploadWarningTabSheet:function(){this._uploadWarningTabSheet.close();},onClickNewMessagesSheet:function(t){this._newMessageClickSub=this._newMessagesTabSheet.subscribe('clicked',t);},onClickThreadIsMutedSheet:function(t){this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',t);},destroy:function(){this._sheetView.destroy();this._offlineTabSheet.destroy();this._userBlockedTabSheet.destroy();this._newMessageClickSub&&this._newMessageClickSub.unsubscribe();this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();}});e.exports=s;});
__d("ChatTabView",["Event","function-extensions","Arbiter","ArbiterMixin","AsyncDialog","AsyncRequest","AsyncSignal","AvailableList","AvailableListConstants","ChatBehavior","ChatConfig","ChatContextualDialogController","ChatPrivacyActionController","ChatQuietLinks","ChatTabMessagesView","ChatTabSheetController","ChatVisibility","MercuryConfig","CSS","Dialog","Dock","DOM","Input","JSLogger","Keys","Locale","MercuryFileUploader","MercuryLogMessageType","MercuryMessages","MercuryParticipants","MercuryServerRequests","MercurySourceType","MercuryThreadInformer","MercuryThreadMetadataRawRenderer","MercuryThreadMetadataRenderer","MercuryThreadMuter","MercuryThreads","MercuryTypingReceiver","MessagesEmoticonView","NubController","Parent","PhotosUploadWaterfall","PresencePrivacy","Run","Style","SubscriptionsHandler","ChatTabTemplates","TextAreaControl","Tooltip","TypingDetectorController","URI","UserAgent","VideoCallCore","WaterfallIDGenerator","copyProperties","cx","setIntervalAcrossTransitions","tx"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('Arbiter'),i=b('ArbiterMixin'),j=b('AsyncDialog'),k=b('AsyncRequest'),l=b('AsyncSignal'),m=b('AvailableList'),n=b('AvailableListConstants'),o=b('ChatBehavior'),p=b('ChatConfig'),q=b('ChatContextualDialogController'),r=b('ChatPrivacyActionController'),s=b('ChatQuietLinks'),t=b('ChatTabMessagesView'),u=b('ChatTabSheetController'),v=b('ChatVisibility'),w=b('MercuryConfig'),x=b('CSS'),y=b('Dialog'),z=b('Dock'),aa=b('DOM'),ba=b('Input'),ca=b('JSLogger'),da=b('Keys'),ea=b('Locale'),fa=b('MercuryFileUploader'),ga=b('MercuryLogMessageType'),ha=b('MercuryMessages').get(),ia=b('MercuryParticipants'),ja=b('MercuryServerRequests').get(),ka=b('MercurySourceType'),la=b('MercuryThreadInformer').get(),ma=b('MercuryThreadMetadataRawRenderer'),na=b('MercuryThreadMetadataRenderer').get(),oa=b('MercuryThreadMuter'),pa=b('MercuryThreads').get(),qa=b('MercuryTypingReceiver'),ra=b('MessagesEmoticonView'),sa=b('NubController'),ta=b('Parent'),ua=b('PhotosUploadWaterfall'),va=b('PresencePrivacy'),wa=b('Run'),xa=b('Style'),ya=b('SubscriptionsHandler'),za=b('ChatTabTemplates'),ab=b('TextAreaControl'),bb=b('Tooltip'),cb=b('TypingDetectorController'),db=b('URI'),eb=b('UserAgent'),fb=b('VideoCallCore'),gb=b('WaterfallIDGenerator'),hb=b('copyProperties'),ib=b('cx'),jb=b('setIntervalAcrossTransitions'),kb=b('tx'),lb=/^\s*$/,mb=ca.create('tab_view'),nb={};function ob(ic,jc){var kc=aa.create('div');jc=jc.filter(function(lc){return lc!=ia.user;});ia.getMulti(jc,function(lc){for(var mc in lc){var nc=lc[mc],oc=za[':fb:mercury:chat:multichat-tooltip-item'].build();aa.setContent(oc.getNode('name'),nc.name);var pc=ia.getUserID(mc),qc=pc&&m.get(pc)==n.ACTIVE;x.conditionShow(oc.getNode('icon'),qc);x.conditionClass(oc.getNode('name'),'tooltipItemWithIcon',qc);aa.appendContent(kc,oc.getRoot());}bb.set(ic,kc,'above','center');});}var pb={},qb=null,rb=false;function sb(ic,jc,kc){if(kc){pb[ic]=jc;if(!qb)qb=jb(tb,600);}else{x.removeClass(jc,'highlightTitle');delete pb[ic];}}function tb(){for(var ic in pb){var jc=pb[ic];if(jc.parentNode){x.conditionClass(jc,'highlightTitle',rb);}else delete pb[ic];}rb=!rb;if(!Object.keys(pb).length){clearInterval(qb);qb=null;}}function ub(ic){var jc=ja.tokenizeThreadID(ic);switch(jc.type){case 'user':return za[':fb:mercury:chat:user-tab'].build();}return za[':fb:mercury:chat:multichat-tab'].build();}function vb(ic){var jc=ic._fileUploader.getAttachments();if(ic._photoUploader)jc=jc.concat(ic._photoUploader.getAttachments());return jc;}function wb(ic){var jc=ic._tabTemplate.getNode('input').value||'',kc=vb(ic);if(!lb.test(jc)||kc.length>0)pa.getThreadMeta(ic._threadID,function(lc){var mc=ha.constructUserGeneratedMessageObject(jc,ka.CHAT_WEB,ic._threadID);if(kc.length>0){mc.has_attachment=true;mc.raw_attachments=kc;}if(pa.isEmptyLocalThread(ic._threadID)){var nc=ja.tokenizeThreadID(ic._threadID);mc.message_id=nc.value;mc.specific_to_list=lc.participants;}if(typeof mc!='undefined')mc.signatureID=this._signatureID;ha.sendMessage(mc);if(ic._photoUploader&&ic._photoUploader.getAttachments().length>0)dc(ic,ua.POST_PUBLISHED,{count:ic._photoUploader.getAttachments().length});xb(ic);ic._getNode('input').value='';ic._lastMessageIndicator&&ic._lastMessageIndicator.resetState();ic._messagesView&&ic._messagesView.scrollToBottom();ic._waterfallID=gb.generate();});}function xb(ic){ic._fileUploader.removeAttachments();ic._photoUploader&&ic._photoUploader.removeAttachments();}function yb(ic){ic._blocked=true;ic._sheetController.openUploadWarningTabSheet();}function zb(ic){if(ic._fileUploader.isUploading())return true;if(ic._photoUploader&&ic._photoUploader.isUploading())return true;return false;}function ac(){if(this._blocked){if(zb(this))return;this._blocked=false;wb(this);this._sheetController.closeUploadWarningTabSheet();}}function bc(){d(['Dock'],function(ic){ic.resizeAllFlyouts();});this._attachmentsDiv.scrollTop=this._attachmentsDiv.scrollHeight;}function cc(ic,jc,kc){ic._subscriptionsHandler.addSubscriptions(ic._photoUploader.subscribe(jc,function(lc,mc){dc(ic,kc,mc);}));}function dc(ic,jc,kc){ua.sendSignal(hb({qn:ic._waterfallID,step:jc,uploader:ua.APP_CHAT},kc||{}));}function ec(ic,jc){if(jc)ja.ensureThreadIsFetched(jc);this._threadID=ic;this._signatureID=hc();this._eventListeners=[];this._tabTemplate=ub(ic);this._tabElem=this._tabTemplate.getRoot();this._waterfallID=gb.generate();if(!(this._getNode instanceof Function))mb.log('getnode_undefined',{is_getnode_set:!!this._getNode,is_prototype_set:!!ec.prototype,is_window:window==this,is_chat_tab_view:this instanceof ec,ctor_name:this.constructor&&this.constructor.name});this._subscriptionsHandler=new ya();this._fileUploader=new fa(this._tabTemplate.getNode('attachmentShelf'),this._tabTemplate.getNode('attachButtonForm'),this._tabTemplate.getNode('fileInput'),this._tabTemplate.getNode('attachID'));this._initializeUploader(this._fileUploader);this._photoUploader=null;var kc=this._tabTemplate.getNode('photoAttachButtonForm');if(kc){this._photoUploader=new fa(this._tabTemplate.getNode('attachmentShelf'),kc,this._tabTemplate.getNode('photoFileInput'),this._tabTemplate.getNode('photoAttachID'));this._initializeUploader(this._photoUploader);cc(this,'open',ua.SELECT_START);cc(this,'submit',ua.UPLOAD_START);cc(this,'one-upload-completed',ua.ONE_UPLOAD_DONE);cc(this,'all-uploads-completed',ua.ALL_UPLOADS_DONE);cc(this,'upload-canceled-after-uploaded',ua.ONE_UPLOAD_CANCELED);cc(this,'upload-canceled-during-upload',ua.ONE_UPLOAD_CANCELED_DURING_UPLOAD);cc(this,'one-upload-failed',ua.CLIENT_ERROR);}this._attachmentsDiv=this._getNode('attachmentShelf');this._sheetController=new u(this._threadID,this._getNode('sheet'),this._tabElem);this._sheetController.onClickNewMessagesSheet(function(){this._messagesView&&this._messagesView.scrollToBottom();this.focus();ec.inform('read',this._threadID);}.bind(this));this._sheetController.onClickThreadIsMutedSheet(function(){oa.showMuteChangeDialog(0,this._threadID);this.focus();}.bind(this));this._contextualDialogController=new q(this._threadID,this._getNode('videoCallLink'));this._messagesView=null;var lc=this._getNode('conversationLink');if(lc){x.hide(lc);na.renderTitanLink(ic,lc,x.show.bind(x,lc));}if(!pa.getCanonicalUserInThread(this._threadID))this._titlebarTooltipAnchor=this._getNode('titlebarText');var mc=this._getCanonicalUserID();if(this._isTitleTextLinked())ia.get('fbid:'+mc,function(sc){if(sc.href){var tc=this._getNode('titlebarText');tc.setAttribute('href',sc.href);tc.removeAttribute('rel');x.removeClass(tc,'noLink');}}.bind(this));this._nubController=new sa().init(this._tabElem);ab.getInstance(this._getNode('input')).subscribe('resize',function(){this._nubController.flyoutContentChanged();}.bind(this));var nc=null,oc=this._getNode('inputContainer');this._nubController.subscribe('resize',function(){if(!nc)nc=this._tabElem.clientWidth;var sc=2,tc=nc-(oc.clientWidth+sc),uc=ea.isRTL()?'left':'right';xa.set(this._iconsContainerNode,uc,tc+'px');ab.getInstance(this._getNode('input')).update();}.bind(this));this._listen('closeButton','click',this._closeClicked);this._listen('titlebarCloseButton','click',this._closeClicked);this._listen('titlebarCloseButton','mousedown',this._closePreClicked);this._listen('dockButton','click',this._nubClicked);this._listen('dockButton','keydown',this._dockKeyDown);this._listen('nubFlyoutTitlebar','click',this._titleClicked);this._listen('chatConv','click',this._chatConvClicked);this._listen('addFriendLink','click',this._addFriendLinkClicked,true);this._listen('addToThreadLink','click',this._addFriendLinkClicked,true);this._listen('clearWindowLink','click',this._clearHistory,true);this._listen('unsubscribeLink','click',this._unsubscribeLinkClicked,true);this._listen('videoCallLink','click',this._callClicked,true);this._listen('reportSpamLink','click',this._reportSpamClicked,true);this._listen('muteThreadLink','click',this._showMuteSettingDialog.bind(this,-1),true);this._listen('unmuteThreadLink','click',this._showMuteSettingDialog.bind(this,0),true);this._listen('input','focus',this._focusTab);this._listen('input','blur',this._blurTab);this._iconsContainerNode=this._getNode('iconsContainer');this._emoticonsNode=this._getNode('emoticons');this._emoticonView=null;if(this._emoticonsNode)this._emoticonView=new ra(this._emoticonsNode,this._getNode('input'));if(eb.firefox()){this._listen('input','keypress',this._inputKeyDown);}else this._listen('input','keydown',this._inputKeyDown);this._privacyLink=this._getNode('privacyLink');if(this._privacyLink){this._privacyActionController=new r(mc,this._updatePrivacyLink.bind(this));this._eventListeners.push(g.listen(this._privacyLink,'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController)));}pa.getThreadMeta(this._threadID,function(sc){var tc=mc||(p.get('chat_multi_typ_send')&&!sc.is_canonical);if(tc)ja.getServerThreadID(this._threadID,function(uc){this._lastMessageIndicator=new cb(mc,this._getNode('input'),'mercury-chat',null,uc);}.bind(this));this._setUpMutingSettings(sc);}.bind(this));var pc=this._getNode('muteGroupLink');if(pc){var qc=pa.getCanonicalGroupInThread(this._threadID);if(qc)pc.setAttribute('ajaxify',db(pc.getAttribute('ajaxify')).addQueryData({id:qc}));}s.removeEmptyHrefs(this._tabElem);nb[ic]=this;this.updateAvailableStatus();this.updateTab();this._setCloseTooltip(false);var rc={threadID:ic,userID:mc,signatureID:this._signatureID};new l('/ajax/chat/opentab_tracking.php',rc).send();wa.onBeforeUnload(function(){var sc=this._tabTemplate.getNode('input').value||'';if(!lb.test(sc)||zb(this)||vb(this).length>0)return "You haven't sent your message yet. Do you want to leave without sending?";return null;}.bind(this),false);wa.onUnload(function(){this._photoUploader&&fc(this);}.bind(this));}function fc(ic){if(ic._photoUploader.isUploading()){dc(ic,ua.CANCEL_DURING_UPLOAD);}else if(ic._photoUploader.getAttachments().length>0)dc(ic,ua.CANCEL);}function gc(){for(var ic in nb){nb[ic].updateAvailableStatus();nb[ic].updateMultichatTooltip();}}function hc(){return (Math.random()*2147483648|0).toString(16);}h.subscribe(['buddylist/availability-changed'],gc);va.subscribe(['privacy-changed','privacy-availability-changed'],gc);o.subscribe(o.ON_CHANGED,function(){for(var ic in nb)pa.getThreadMeta(ic,function(jc){nb[ic]._updateUnreadCount(jc);});});qa.subscribe('state-changed',function(ic,jc){for(var kc in jc){var lc=jc[kc]&&jc[kc].length,mc=nb[kc];mc&&mc.showTypingIndicator(lc);}});la.subscribe('threads-updated',function(ic,jc){for(var kc in nb)jc[kc]&&nb[kc].updateTab();});la.subscribe('threads-deleted',function(ic,jc){for(var kc in nb)jc[kc]&&ec.inform('thread-deleted',kc);});hb(ec,i,{get:function(ic){return nb[ic];}});hb(ec.prototype,{getThreadID:function(){return this._threadID;},showAddFriend:function(){(function(){this._sheetController.openAddFriendsSheet();}).bind(this).defer();},isVisible:function(){return x.shown(this._tabElem);},setVisibleState:function(ic,jc){var kc=x.shown(this._tabElem),lc=x.hasClass(this._tabElem,'opened');x.conditionShow(this._tabElem,ic);x.conditionClass(this._tabElem,'opened',jc);if(!(kc&&lc)&&ic&&jc){if(!this._messagesView)this._messagesView=new t(this._threadID,this._sheetController,this._getNode('chatConv'),this._getNode('conversation'),this._getNode('loadingIndicator'),this._getNode('lastMessageIndicator'),this._getNode('typingIndicator'));this._nubController.flyoutContentChanged();this._messagesView.scrollToBottom();}if(kc&&lc&&!(ic&&jc))this._contextualDialogController.tabNotActive();},focus:function(){var ic=x.hasClass(this._tabElem,'opened')?'input':'dockButton';this._getNode(ic).focus();},isFocused:function(){var ic=document.activeElement;return ta.byClass(ic,"_50mz")===this._tabElem;},hasEmptyInput:function(){return lb.test(this._getNode('input').value);},setInput:function(ic){this._getNode('input').value=ic;},insertBefore:function(ic){aa.insertBefore(ic._tabElem,this._tabElem);},appendTo:function(ic){aa.appendContent(ic,this._tabElem);},nextTabIs:function(ic){var jc=ic&&ic._tabElem;return this._tabElem.nextSibling==jc;},destroy:function(){aa.remove(this._tabElem);this._emoticonView&&this._emoticonView.destroy();while(this._eventListeners.length)this._eventListeners.pop().remove();this._messagesView&&this._messagesView.destroy();this._sheetController.destroy();this._fileUploader.destroy();this._photoUploader&&this._photoUploader.destroy();this._subscriptionsHandler.release();this._contextualDialogController.destroy();this._privacyActionController&&this._privacyActionController.destroy();delete nb[this._threadID];z.unregisterNubController(this._nubController);ba.reset(this._getNode('input'));},updateAvailableStatus:function(){var ic={active:{on:false,cssClass:"_5238"},mobile:{on:false,cssClass:"_5239"}},jc=this._getCanonicalUserID(),kc=true,lc=false;if(jc){var mc=m.get(jc);kc=!v.isOnline();lc=!va.allows(jc);ic.active.on=(mc===n.ACTIVE);ic.mobile.on=mc===n.MOBILE;this._updateCallLink(mc);}var nc=this._getNode('presenceIndicator');if(!kc&&!lc){if(ic.mobile.on){nc.setAttribute('alt',"Mobile");}else nc.setAttribute('alt',"Online");}else nc.removeAttribute('alt');for(var oc in ic)x.conditionClass(this._tabElem,ic[oc].cssClass,!kc&&!lc&&ic[oc].on);},updateTab:function(){pa.getThreadMeta(this._threadID,function(ic){if(!ic.is_subscribed){ec.inform('unsubscribed',this._threadID);return;}na.renderAndSeparatedParticipantList(this._threadID,[this._getNode('name'),this._getNode('titlebarText')],{names_renderer:ma.renderShortNames,check_length:true});if(ic.is_joinable)this._updateJoinableAddFriendSheet(ic);this._updateMutingSettings(ic);this._updateUnreadCount(ic);this.updateMultichatTooltip();this._updateArchiveWarning(ic);if(pa.isNewEmptyLocalThread(this._threadID))this.showAddFriend();}.bind(this));},_updateJoinableAddFriendSheet:function(ic){var jc=ia.user,kc=ic.participants.filter(function(lc){return lc!=jc;});if(ic.is_joinable&&kc.length<1)this.showAddFriend();},_setUpMutingSettings:function(ic){var jc=oa.isThreadMuted(ic);if(jc&&w.MuteThreadsOnDesktopGK)this._sheetController.openThreadIsMutedTabSheet();this._updateActionMenu(jc);},_updateMutingSettings:function(ic){if(!w.MuteThreadsOnDesktopGK)return;var jc=oa.isThreadMuted(ic);if(jc&&x.shown(this._getNode('muteThreadLink').parentNode)){this._sheetController.openThreadIsMutedTabSheet();}else if(!jc&&x.shown(this._getNode('unmuteThreadLink').parentNode))this._sheetController.closeThreadIsMutedTabSheet();this._updateActionMenu(jc);},_updateActionMenu:function(ic){x.conditionShow(this._getNode('muteThreadLink').parentNode,w.MuteThreadsOnDesktopGK&&!ic);x.conditionShow(this._getNode('unmuteThreadLink').parentNode,w.MuteThreadsOnDesktopGK&&ic);},_updateArchiveWarning:function(ic){var jc=false;ia.get(ia.user,function(kc){jc=kc.employee;if(jc)ia.getMulti(ic.participants,this._showArchiveWarningIfAllParticipantsAreEmployees.bind(this));}.bind(this));},_showArchiveWarningIfAllParticipantsAreEmployees:function(ic){var jc=true;for(var kc in ic)jc=jc&&ic[kc].employee;var lc=this._getNode('titanArchiveWarning');if(lc){if(this._titlebarTooltipAnchor)x.conditionClass(this._titlebarTooltipAnchor,'narrowTitleBar',jc);x.conditionShow(lc,jc);}},updateMultichatTooltip:function(){pa.getThreadMeta(this._threadID,function(ic){if(!ic.is_canonical)ob(this._titlebarTooltipAnchor,ic.participants);}.bind(this));},_getNode:function(ic){return this._tabTemplate.getNode(ic);},_getCanonicalUserID:function(){return pa.getCanonicalUserInThread(this._threadID);},_listen:function(ic,event,jc,kc){var lc=this._getNode(ic);if(lc){this._eventListeners.push(g.listen(lc,event,jc.bind(this)));}else if(!kc)throw new Error('Could not find node "'+ic+'"');},_closePreClicked:function(ic){this._closeMouseDown=true;},_closeClicked:function(ic){this._photoUploader&&fc(this);ec.inform('closed-tab',this._threadID);ic.kill();},_nubClicked:function(ic){ic.kill();return ec.inform('nub-activated',this._threadID);},_dockKeyDown:function(event){if(event.keyCode===da.RETURN||event.keyCode===da.SPACE){ec.inform('nub-activated',this._threadID);event.kill();}else this._handleHotkeyPressed(event);},_handleHotkeyPressed:function(event){if(event.keyCode===da.ESC){this._photoUploader&&fc(this);ec.inform('esc-pressed',this._threadID);event.kill();}else if(event.keyCode===da.TAB&&!event.ctrlKey){var ic=ec.inform('tab-pressed',{id:this._threadID,shiftPressed:event.shiftKey});!ic&&event.kill();}},_isTitleTextLinked:function(){var ic=this._getCanonicalUserID();return ic&&p.get('chat_tab_title_link_timeline');},_titleClicked:function(event){var ic=event.getTarget(),jc=ta.byClass(ic,'titlebarText'),kc=jc&&this._isTitleTextLinked();if(!kc&&!ta.byClass(ic,'uiSelector')&&!ta.byClass(ic,'addToThread')){ec.inform('lower-activated',this._threadID);event.kill();}},_callClicked:function(ic){var jc=this._getCanonicalUserID();if(fb.availableForCall(jc)){var kc='chat_tab_icon';if(ic.target&&x.hasClass(ic.target,'video_call_promo')){kc='chat_tab_icon_promo';}else if(ic.target&&x.hasClass(ic.target,'video_call_tour'))kc='chat_tab_icon_tour';ec.inform('video-call-clicked',{threadID:this._threadID,userID:jc,clickSource:kc});}return false;},_addFriendLinkClicked:function(){this.showAddFriend();},_clearHistory:function(){var ic=pa.getThreadMetaNow(this._threadID);if(ic){var jc=this._getCanonicalUserID();ja.clearChat(this._threadID,jc,ic.timestamp);}},_unsubscribeLinkClicked:function(){var ic=[];ic.push({name:'unsubscribe',label:"Leave Conversation",handler:this._unsubscribeToThread.bind(this)});ic.push(y.CANCEL);new y().setTitle("Leave Conversation?").setBody("You will stop receiving messages from this conversation and people will see that you left.").setButtons(ic).show();},_reportSpamClicked:function(){var ic=this._getCanonicalUserID(),jc=db('/ajax/chat/report.php').addQueryData({id:ic}).addQueryData({src:'top_report_link'});j.send(new k(jc));},_showMuteSettingDialog:function(ic){oa.showMuteChangeDialog(ic,this._threadID);},_focusTab:function(){x.addClass(this._tabElem,'focusedTab');this.tryMarkAsRead();this._contextualDialogController.tabFocused();this._closeMouseDown=false;this._setCloseTooltip(true);},_blurTab:function(){x.removeClass(this._tabElem,'focusedTab');!this._closeMouseDown&&this._setCloseTooltip(false);},_setCloseTooltip:function(ic){var jc=this._getNode('titlebarCloseButton'),kc=ic?"Press Esc to close":"Close tab";bb.set(jc,kc,'above','center');},_inputKeyDown:function(event){if(event.keyCode===da.RETURN&&!event.shiftKey){if(zb(this)){yb(this);event.kill();return;}wb(this);event.kill();return;}if(event.keyCode===da.DOWN&&event.shiftKey&&this._getNode('input').value===''){ec.inform('lower-activated',this._threadID);event.kill();return;}this._handleHotkeyPressed(event);},tryMarkAsRead:function(){if(!this._messagesView||this._messagesView.isScrolledToBottom()){ec.inform('read',this._threadID);return true;}return false;},_chatConvClicked:function(ic){this.tryMarkAsRead();if(ta.byTag(ic.getTarget(),'a')||aa.getSelection())return;this.focus();},showTypingIndicator:function(ic){var jc=pa.getThreadMetaNow(this._threadID),kc=this._getCanonicalUserID()||(p.get('chat_multi_typ')&&jc&&!jc.is_canonical);if(kc)x.conditionClass(this._tabElem,'typing',ic);},_updateUnreadCount:function(ic){var jc=ic.unread_count;if(typeof jc!='undefined'){var kc=!!jc&&(!o.showsTabUnreadUI||o.showsTabUnreadUI()),lc=this._getNode('numMessages');x.conditionShow(lc,kc);x.conditionClass(this._tabElem,'highlightTab',kc);sb(this._threadID,this._tabElem,kc);aa.setContent(lc,jc);}},_updateCallLink:function(ic){var jc=this._getNode('videoCallLink');if(v.isOnline()){var kc=this._getCanonicalUserID(),lc='fbid:'+kc;ia.get(lc,function(mc){if(fb.availableForCall(kc)){bb.set(jc,kb._("Start a video call with {firstname}",{firstname:mc.short_name}));this._updateCallBackLinks(this._tabElem,true);}else{bb.set(jc,kb._("{firstname} is currently unavailable for video calling",{firstname:mc.short_name}));this._hideVideoCallouts();this._updateCallBackLinks(this._tabElem,false);}}.bind(this));}else{bb.set(jc,"You must be online to make a call.");this._hideVideoCallouts();this._updateCallBackLinks(document.body,false);}},_updateCallBackLinks:function(ic,jc){var kc=aa.scry(ic,'a.callBackLink');if(jc){kc.forEach(x.show);}else kc.forEach(x.hide);},_hideVideoCallouts:function(){this._contextualDialogController.hideVideoCallouts();},_updatePrivacyLink:function(ic){if(ic==r.OFFLINE){aa.setContent(this._privacyLink,"Go online");}else{var jc=this._getCanonicalUserID(),kc='fbid:'+jc;ia.get(kc,function(lc){var mc=null;if(ic==r.BLOCKED){mc=kb._("Turn On Chat for {name}",{name:lc.short_name});}else mc=kb._("Turn Off Chat for {name}",{name:lc.short_name});aa.setContent(this._privacyLink,mc);}.bind(this));}},_unsubscribeToThread:function(){if(pa.isEmptyLocalThread(this._threadID)){ec.inform('unsubscribed',this._threadID);}else{var ic=ha.constructLogMessageObject(ka.CHAT_WEB,this._threadID,ga.UNSUBSCRIBE,{});ha.sendMessage(ic);}return true;},_initializeUploader:function(ic){this._subscriptionsHandler.addSubscriptions(ic.subscribe(['all-uploads-completed','upload-canceled'],ac.bind(this)),ic.subscribe('dom-updated',bc.bind(this)),ic.subscribe('submit',function(){this._getNode('input').focus();}.bind(this)));},_emoticonView:null});e.exports=ec;});
__d("ChatNewMessageHandler",["ChatActivity","ChatConfig","ChatTabModel","ChatTabView","JSLogger","MercuryAssert","MercuryBrowserAlerts","MercuryUnseenState"],function(a,b,c,d,e,f){var g=b('ChatActivity'),h=b('ChatConfig'),i=b('ChatTabModel'),j=b('ChatTabView'),k=b('JSLogger'),l=b('MercuryAssert'),m=b('MercuryBrowserAlerts'),n=b('MercuryUnseenState').get(),o=k.create('chat_new_message'),p={_raiseTab:function(q,r){var s=i.getTab(q),t=false;if(s){t=s.raised;}else{i.raiseTab(q,false);t=true;}r.to_new_tab=!s;r.to_raised_tab=!!t;},_notify:function(q,r,s){var t=j.get(q);s.view_is_visible=t&&t.isVisible();s.view_is_focused=t&&t.isFocused();if(!s.view_is_visible)o.log('message_to_hidden');s.is_active=g.isActive();m.messageReceived(r);},_promoteTab:function(q,r,s){if(h.get('chat_promote_new_messages'))if(s&&!s[q]&&r)i.promoteThreadInPlaceOfThread(q,r);},newMessage:function(q,r,s,t){l.isThreadID(q);var u={thread_id:q,message_id:r.message_id};this._raiseTab(q,u);this._promoteTab(q,s,t);this._notify(q,r,u);o.log('message',u);}};m.subscribe('before-alert',function(q,event){var r=event.threadID,s=j.get(r),t=i.getTab(r);if(t&&t.raised&&s&&s.isVisible()&&s.isFocused()&&s.tryMarkAsRead()){n.markThreadSeen(r);event.cancelAlert();}});e.exports=p;});
__d("ChatTabPresence",["AvailableList","ChatTabModel","MercuryThreads"],function(a,b,c,d,e,f){var g=b('AvailableList'),h=b('ChatTabModel'),i=b('MercuryThreads').get(),j={};function k(l){var m=i.getCanonicalUserInThread(l);if(m)g.updateForID(m);}h.subscribe('chat/tabs-changed',function(event,l){l.tabs.forEach(function(m){if(m.raised&&!j[m.id])k(m.id);});j={};l.tabs.forEach(function(m){if(m.raised)j[m.id]=true;});});e.exports={};});
__d("ChatTabPolicy",["ChatBehavior","MercuryConfig","FBDesktopPlugin","JSLogger","MercuryActionTypeConstants","MercuryAssert","MercuryParticipants","MercuryParticipantTypes","MercurySourceType","MercuryThreadMode","MercuryThreadMuter","MercuryUnseenState","MessagingTag","PresencePrivacy","ShortProfiles"],function(a,b,c,d,e,f){var g=b('ChatBehavior'),h=b('MercuryConfig'),i=b('FBDesktopPlugin'),j=b('JSLogger'),k=b('MercuryActionTypeConstants'),l=b('MercuryAssert'),m=b('MercuryParticipants'),n=b('MercuryParticipantTypes'),o=b('MercurySourceType'),p=b('MercuryThreadMode'),q=b('MercuryThreadMuter'),r=b('MercuryUnseenState').get(),s=b('MessagingTag'),t=b('PresencePrivacy'),u=b('ShortProfiles'),v=j.create('tab_policy');function w(x,y){r.markThreadSeen(x,y);}e.exports={messageIsAllowed:function(x,y,z){var aa=x.thread_id,ba=y.message_id;l.isThreadID(aa);l.isParticipantID(y.author);var ca;if(h.MuteThreadsOnDesktopGK&&q.isThreadMuted(x)){ca={thread_id:aa,message_id:ba,mute_settings:x.mute_settings};v.log('message_thread_muted',ca);return;}if(x.mode==p.OBJECT_ORIGINATED){ca={thread_id:aa,message_id:ba,mode:x.mode};v.log('message_object_originated',ca);return;}if(y.source==o.EMAIL||y.source==o.TITAN_EMAIL_REPLY){ca={thread_id:aa,message_id:ba,source:y.source};v.log('message_source_not_allowed',ca);return;}var da=m.getUserID(y.author);if(!da){v.log('message_bad_author',{thread_id:aa,message_id:ba,user:da});return;}if(y.action_type!=k.USER_GENERATED_MESSAGE){ca={thread_id:aa,message_id:ba,type:y.action_type};v.log('message_non_user_generated',ca);return;}if(x.is_canonical_user&&!g.notifiesUserMessages()){v.log('message_jabber',{thread_id:aa,message_id:ba});w(aa,true);return;}if(x.is_canonical&&!x.canonical_fbid){v.log('message_canonical_contact',{thread_id:aa,message_id:ba});return;}if(i.shouldSuppressMessages()){v.log('message_desktop',{thread_id:aa,message_id:ba});return;}if(x.folder!=s.INBOX){v.log('message_folder',{thread_id:aa,message_id:ba,folder:x.folder});return;}var ea=m.getUserID(m.user);u.getMulti([da,ea],function(fa){if(!t.allows(da)){v.log('message_privacy',{thread_id:aa,message_id:ba,user:da});return;}var ga=fa[da].employee&&fa[ea].employee;if(!ga&&fa[da].type!==n.FRIEND){v.log('message_non_friend',{thread_id:aa,message_id:ba,user:da});return;}z();});}};});
__d("ChatTabViewSelector",["Event","Arbiter","CSS","DataStore","DOM","MenuDeprecated","MercuryThreadInformer","MercuryThreads","NubController","ChatTabTemplates","MercuryThreadMetadataRenderer","Toggler","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('CSS'),j=b('DataStore'),k=b('DOM'),l=b('MenuDeprecated'),m=b('MercuryThreadInformer').get(),n=b('MercuryThreads').get(),o=b('NubController'),p=b('ChatTabTemplates'),q=b('MercuryThreadMetadataRenderer').get(),r=b('Toggler'),s=b('copyProperties');function t(u){var v=p[':fb:chat:tab:selector'].build(),w=v.getRoot(),x=v.getNode('menu'),y=k.find(x,'.uiMenuInner'),z={},aa=new o().init(w);i.hide(w);k.insertBefore(u,w);function ba(ea){var fa=0;for(var ga in z){var ha=z[ga],ia=n.getThreadMetaNow(ga),ja=ha.getNode('unreadCount'),ka=(ia&&ia.unread_count)||0;fa+=ka;if(ka>9)ka='+';i.conditionClass(ja,'invisible_elem',!ka);k.setContent(ja,ka);}var la=v.getNode('numMessages');i.conditionShow(la,fa);k.setContent(la,fa);}this.setTabData=function(ea){z={};if(ea.length<1){i.hide(w);return;}i.show(w);k.empty(y);ea.forEach(function(fa){var ga=p[':fb:chat:tab:selector:item'].build();z[fa.id]=ga;var ha=ga.getNode('content');q.renderAndSeparatedParticipantList(fa.id,ha);k.prependContent(y,ga.getRoot());j.set(ga.getRoot(),'threadID',fa.id);var ia=ga.getNode('closeButton');g.listen(ia,'click',function(event){t.inform('selector/close-tab',fa.id);event.kill();});});aa.flyoutContentChanged();k.setContent(v.getNode('numTabs'),ea.length);ba();};function ca(event,ea){if(ea.menu!=x)return;var fa=j.get(ea.item,'threadID');t.inform('selected',fa);r.hide(w);}function da(event,ea){l.register(x);}l.subscribe('select',ca.bind(this));r.listen('show',w,function(){h.inform('layer_shown',{type:'ChatTabSelector'});da();});r.listen('hide',w,function(){h.inform('layer_hidden',{type:'ChatTabSelector'});});m.subscribe('threads-updated',ba);}s(t,new h());e.exports=t;});
__d("ChatTabController",["ChatTabPresence","ChatTypeaheadBehavior","Arbiter","ChatActivity","ChatBehavior","ChatConfig","ChatNewMessageHandler","ChatTabMessagesView","ChatTabModel","ChatTabPolicy","ChatTabView","ChatTabViewSelector","JSLogger","MercuryParticipants","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","MercuryUnseenState","Style","UserAgent","VideoCallCore"],function(a,b,c,d,e,f){b('ChatTabPresence');b('ChatTypeaheadBehavior');var g=b('Arbiter'),h=b('ChatActivity'),i=b('ChatBehavior'),j=b('ChatConfig'),k=b('ChatNewMessageHandler'),l=b('ChatTabMessagesView'),m=b('ChatTabModel'),n=b('ChatTabPolicy'),o=b('ChatTabView'),p=b('ChatTabViewSelector'),q=b('JSLogger'),r=b('MercuryParticipants'),s=b('MercuryServerRequests').get(),t=b('MercuryThreadInformer').get(),u=b('MercuryThreads').get(),v=b('MercuryUnseenState').get(),w=b('Style'),x=b('UserAgent'),y=b('VideoCallCore'),z=j.get('tab_auto_close_timeout')||7200000,aa=q.create('tab_controller');function ba(oa){u.changeThreadReadStatus(oa,true);ca(oa);}function ca(oa){v.markThreadSeen(oa);}function da(){var oa=m.get();oa.tabs.forEach(function(pa){if(pa.raised||i.showsTabUnreadUI())ca(pa.id);});}function ea(oa,pa,qa){var ra=m.get().tabs;oa+=pa?1:-1;while(oa>=0&&oa<ra.length){var sa=ra[oa],ta=o.get(sa.id);if(ta&&ta.isVisible()&&(!qa||sa.raised)){ta.focus();return true;}oa+=pa?1:-1;}return false;}function fa(oa,pa){var qa=pa.shouldPromoteOnRaise(oa);g.inform("chat/promote-tab",oa);if(qa){m.raiseAndPromoteTab(oa,true);}else m.raiseTab(oa,true);var ra=o.get(oa);ra&&ra.focus();}function ga(oa,pa,qa){var ra=qa.getMaxTabsToShow(),sa=m.indexOf(oa);m.closeTabAndDemote(oa,ra-2,pa);return sa;}function ha(oa){var pa=Object.keys(oa.getTabsToShow()||{}),qa=1*60,ra=null,sa=Infinity;for(var ta=0;ta<pa.length;ta++){var ua=pa[ta],va=u.getThreadMetaNow(ua);if(!o.get(ua).hasEmptyInput()||!va)continue;var wa=(m.getServerTime()-va.timestamp)/1000;if(!va.timestamp||(va.timestamp&&va.timestamp<sa&&wa>qa)){ra=va.thread_id;sa=va.timestamp;}}return ra;}function ia(oa){p.subscribe('selected',function(qa,ra){fa(ra,oa);});g.subscribe('chat/open-tab',function(qa,ra){fa(ra.thread_id,oa);});g.subscribe('page_transition',function(qa,ra){m.closeFragileTabs();});s.subscribe('model-update-completed',da);o.subscribe('read',function(event,qa){ba(qa);});h.subscribe('idle',function(qa,ra){if(ra>z){var sa=m.get().tabs;sa.forEach(function(ta){var ua=ta.id;u.getThreadMeta(ua,function(va){if(!va.unread_count){aa.log('autoclose_idle_seen',{thread_id:ua,idleness:ra});m.closeTab(ua,'autoclose_idle_seen');}});});}});o.subscribe('nub-activated',function(qa,ra){fa(ra,oa);});o.subscribe('lower-activated',function(qa,ra){m.lowerTab(ra);var sa=o.get(ra);sa&&sa.focus();});function pa(qa,ra){y.showOutgoingCallDialog(ra.userID,ra.clickSource);m.lowerTab(ra.threadID);}o.subscribe('video-call-clicked',pa);l.subscribe('video-call-clicked',pa);o.subscribe('closed-tab',function(qa,ra){aa.log('close_view',{thread_id:ra});ga(ra,'close_view',oa);return false;});o.subscribe('thread-deleted',function(qa,ra){aa.log('close_thread_deleted',{thread_id:ra});ga(ra,'close_thread_deleted',oa);return false;});o.subscribe('unsubscribed',function(qa,ra){aa.log('close_view_unsubscribed',{thread_id:ra});ga(ra,'close_view_unsubscribed',oa);return false;});o.subscribe('esc-pressed',function(qa,ra){aa.log('close_esc',{thread_id:ra});var sa=ga(ra,'close_esc',oa);(function(){ea(sa-1,true,true)||ea(sa,false,true);}).defer();});p.subscribe('selector/close-tab',function(qa,ra){aa.log('close_chat_from_selector',{thread_id:ra});ga(ra,'close_chat_from_selector',oa);});t.subscribe('messages-received',function(qa,ra){for(var sa in ra){var ta=ra[sa];for(var ua=0;ua<ta.length;ua++){var va=ta[ua];if(va.author!=r.user){if(!va.is_unread){aa.log('message_already_read',{action_id:va.action_id,thread_id:va.thread_id});continue;}u.getThreadMeta(sa,function(wa){n.messageIsAllowed(wa,va,function(){var xa=oa.hasRoomForRaisedTab()?undefined:ha(oa);k.newMessage(sa,va,xa,oa.getTabsToShow());});});}}}});t.subscribe('thread-read-changed',function(qa,ra){for(var sa in ra)if(!ra[sa].mark_as_read){aa.log('autoclose_marked_unread',{thread_id:sa});m.closeTab(sa,'autoclose_marked_unread');}});o.subscribe('tab-pressed',function(qa,ra){return !ea(m.indexOf(ra.id),ra.shiftPressed);});g.subscribe(q.DUMP_EVENT,function(qa,ra){ra.chat_controller={auto_close_timeout:z};});}if(x.firefox()){var ja=function(){return w.get(document.body,'overflowX')+' '+w.get(document.body,'overflowY');},ka=ja(),la=function(){var oa=ja();if(oa!==ka){ka=oa;g.inform('overflow-applied-to-body');}};if('MutationObserver' in window){var ma=new MutationObserver(la),na={attributes:true,attributeFilter:['class','style']};ma.observe(document.documentElement,na);}else document.documentElement.addEventListener('DOMAttrModified',function(event){if(event.getTarget()===document.documentElement&&(event.attrName==='class'||event.attrName==='style'))la();},false);}e.exports=ia;});
__d("ChatTabViewCoordinator",["Arbiter","ChatTabModel","ChatTabView","ChatTabViewSelector","CSS","VideoCallCore"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChatTabModel'),i=b('ChatTabView'),j=b('ChatTabViewSelector'),k=b('CSS'),l=b('VideoCallCore');function m(n,o){var p=new j(n),q={},r=false;function s(){var x=h.get(),y={};x.tabs.forEach(function(aa){y[aa.id]=1;});for(var z in q)if(!y[z]){q[z].destroy();delete(q[z]);}t(x);u(x);}function t(x){var y=null;x.tabs.forEach(function(z){var aa=z.id,ba=false;if(!q[aa]){q[aa]=new i(aa,z.server_id);ba=true;}if(ba||!q[aa].nextTabIs(y))if(y){q[aa].insertBefore(y);}else q[aa].appendTo(n);y=q[aa];});}function u(x){var y=o.getTabsToShow(x),z=[],aa=false;x.tabs.forEach(function(ba){if(!y[ba.id]){q[ba.id].setVisibleState(false,ba.raised);z.push(ba);}});x.tabs.forEach(function(ba){if(y[ba.id]){q[ba.id].setVisibleState(true,ba.raised);aa|=ba.raised;}});p.setTabData(z);w(aa);}function v(x){for(var y=0,z=x.tabs.length;y<z;y++){var aa=x.tabs[y];if(aa.raised)if(aa.id===x.promoted||y<o.getMaxTabsToShow()-1)return true;}return false;}function w(x){if(!x&&r){g.inform('layer_hidden',{type:'ChatTab'});r=false;}else if(x&&!r){g.inform('layer_shown',{type:'ChatTab'});r=true;}}if(l.isSupported())k.addClass(n,'videoCallEnabled');o.subscribe('tabs-changed',s);s();}e.exports=m;});
__d("TabsViewport",["Event","ArbiterMixin","ChatTabModel","Dock","DOMDimensions","Parent","Vector","areObjectsEqual","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('ChatTabModel'),j=b('Dock'),k=b('DOMDimensions'),l=b('Parent'),m=b('Vector'),n=b('areObjectsEqual'),o=b('copyProperties'),p=164,q=264;function r(s){this._root=s;g.listen(window,'resize',this._recalculateWidth.bind(this));j.subscribe('resize',this._recalculateWidth.bind(this));i.subscribe('chat/tabs-changed',this._recalculateTabs.shield(this,true));this._recalculateWidth();this._initialized=true;}o(r.prototype,h,{_root:null,_initialized:false,_availableWidth:0,_maxShown:1,_viewState:null,_recalculateWidth:function(){var s=r._getAvailableDockWidth(this._root),t=Math.max(1,Math.floor(s/q)),u=t!=this._maxShown;if(!this._viewState||u||s<=this._viewState.usedWidth||s>this._viewState.widthToShowNext){this._availableWidth=s;this._maxShown=t;this._viewState=null;this._recalculateTabs(u);}},_onTabsChanged:function(){if(this._initialized){this.inform('tabs-changed');this.inform('max-to-show-changed',this._maxShown);this.inform('max-to-show-change-completed');}},_recalculateTabs:function(s){var t=r._getTabsToShow(i.get(),this._availableWidth);if(s||!n(this._viewState,t)){this._viewState=t;this._onTabsChanged();}},getMaxTabsToShow:function(){return this._maxShown;},checkWidth:function(){this._recalculateWidth();},hasRoomForRaisedTab:function(){return this._availableWidth-this._viewState.usedWidth>q;},getTabsToShow:function(){return JSON.parse(JSON.stringify(this._viewState.tabsToShow));},shouldPromoteOnRaise:function(s){if(!this._viewState.tabsToShow[s])return true;if(this._viewState.nextToHide!=s)return false;var t=i.getTab(s),u=t&&t.raised;return !u&&(this._availableWidth-this._viewState.usedWidth<100);}});o(r,{_getAvailableDockWidth:function(s){var t=k.getViewportWithoutScrollbarDimensions().width;t-=205;t-=50;var u=l.byClass(s,'fbDock'),v=m.getElementDimensions(u),w=l.byClass(s,'fbDockChat'),x=m.getElementDimensions(w),y=v.x-x.x;t-=y;t-=15;return Math.max(t,0);},_getTabsToShow:function(s,t){t=Math.max(t,q+1);function u(ja){return ja.raised?q:p;}var v=JSON.parse(JSON.stringify(s.tabs)),w=-1,x=null;if(s.promoted)v.forEach(function(ja,ka){if(ja.id===s.promoted){w=ka;x=ja;}});var y=0,z=0,aa=!x;v.forEach(function(ja,ka){var la=u(ja);ja.leftmostOffset=y+q;y+=la;if(ja.leftmostOffset<t)z++;aa|=ka==w;ja.alreadyPlacedPromoted=aa;});function ba(ja,ka,la){var ma={};for(var na=0;na<ka;na++){var oa=ja[na];if(!oa.alreadyPlacedPromoted&&na==ka-1){ma[la]=true;}else ma[oa.id]=true;}return ma;}var ca=ba(v,z,s.promoted),da=ba(v,z-1,s.promoted),ea=null;for(var fa in ca)if(!da[fa])ea=fa;var ga=v[z-1],ha=ga?ga.leftmostOffset:0,ia=Infinity;if(z<v.length)ia=v[z].leftmostOffset;return {nextToHide:ea,tabsToShow:ca,usedWidth:ha,widthToShowNext:ia};}});e.exports=r;});
__d("LinkshimHandler",["Event","LinkshimAsyncLink","URI","LinkshimHandlerConfig"],function(a,b,c,d,e,f){var g=b('Event'),h=b('LinkshimAsyncLink'),i=b('URI'),j=b('LinkshimHandlerConfig'),k={setUpLinkshimHandling:function(q){var r=i(q.getAttribute('href')),s=l(r);if(s&&m(r)){g.listen(q,'mouseover',h.swap.shield(null,q,s));var t=o(r);g.listen(q,'click',function(){if(j.supports_meta_referrer){h.referrer_log(q,t,n(r).toString());}else h.swap(q,r);});}}};function l(q){return q.getQueryData().u?new i(q.getQueryData().u):null;}function m(q){return q.getQueryData().hasOwnProperty('s');}function n(q){return i('/si/ajax/l/render_linkshim_log/').setSubdomain('www').setQueryData(q.getQueryData());}function o(q){var r;if(p()){r=i(q).addQueryData({render_verification:true});}else r=l(q);return r;}function p(){var q=j.render_verification_rate||0;return Math.floor(Math.random()*q+1)===q;}e.exports=k;});